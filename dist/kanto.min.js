var PIXI=function(q){"use strict";var R="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function L(e,t){return e(t={exports:{}},t.exports),t.exports}var N,F=L(function(e,t){function i(){}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(){for(var e=0;e<I.length;e++)I[e][0](I[e][1]);T=!(I=[])}function o(e,t){I.push([e,t]),T||(T=!0,E(n,0))}function s(e){var t=e.owner,i=t.state_,t=t.data_,r=e[i],n=e.then;if("function"==typeof r){i=x;try{t=r(t)}catch(e){l(n,e)}}a(n,t)||(i===x&&h(n,t),i===w&&l(n,t))}function a(t,i){var r;try{if(t===i)throw new TypeError("A promises callback cannot return that same promise.");if(i&&("function"==typeof i||"object"==typeof i)){var e=i.then;if("function"==typeof e)return e.call(i,function(e){r||(r=!0,(i!==e?h:u)(t,e))},function(e){r||(r=!0,l(t,e))}),1}}catch(i){return r||l(t,i),1}}function h(e,t){e!==t&&a(e,t)||u(e,t)}function u(e,t){e.state_===v&&(e.state_=b,e.data_=t,o(p,e))}function l(e,t){e.state_===v&&(e.state_=b,e.data_=t,o(d,e))}function c(e){var t=e.then_;e.then_=void 0;for(var i=0;i<t.length;i++)s(t[i])}function p(e){e.state_=x,c(e)}function d(e){e.state_=w,c(e)}function f(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(this instanceof f==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[];var t=e,i=this;function r(e){l(i,e)}try{t(function(e){h(i,e)},r)}catch(t){r(t)}}var m,_,y,g,v,b,x,w,T,E,I;m="undefined"!=typeof window?window:R,y=m.Promise,g=y&&"resolve"in y&&"reject"in y&&"all"in y&&"race"in y&&(new y(function(e){_=e}),"function"==typeof _),t?(t.Promise=g?y:f,t.Polyfill=f):g||(m.Promise=f),v="pending",b="sealed",x="fulfilled",w="rejected",E="undefined"!=typeof setImmediate?setImmediate:setTimeout,I=[],f.prototype={constructor:f,state_:v,then_:null,data_:void 0,then:function(e,t){e={owner:this,then:new this.constructor(i),fulfilled:e,rejected:t};return this.state_===x||this.state_===w?o(s,e):this.then_.push(e),e.then},catch:function(e){return this.then(null,e)}},f.all=function(s){if(r(s))return new this(function(i,e){var r=[],n=0;for(var t,o=0;o<s.length;o++)(t=s[o])&&"function"==typeof t.then?t.then(function(t){return n++,function(e){r[t]=e,--n||i(r)}}(o),e):r[o]=t;n||i(r)});throw new TypeError("You must pass an array to Promise.all().")},f.race=function(n){if(r(n))return new this(function(e,t){for(var i,r=0;r<n.length;r++)(i=n[r])&&"function"==typeof i.then?i.then(e,t):e(i)});throw new TypeError("You must pass an array to Promise.race().")},f.resolve=function(t){return t&&"object"==typeof t&&t.constructor===this?t:new this(function(e){e(t)})},f.reject=function(i){return new this(function(e,t){t(i)})}}),F=(F.Promise,F.Polyfill),B=Object.getOwnPropertySymbols,X=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,e=function(){try{if(Object.assign){var e=new String("abc");if(e[5]="de","5"!==Object.getOwnPropertyNames(e)[0]){for(var t,i={},r=0;r<10;r++)i["_"+String.fromCharCode(r)]=r;if("0123456789"===Object.getOwnPropertyNames(i).map(function(e){return i[e]}).join(""))return t={},"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},t)).join("")}}}catch(e){}}()?Object.assign:function(e,t){for(var i,r=arguments,n=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var s in i=Object(r[o]))X.call(i,s)&&(n[s]=i[s]);if(B)for(var a=B(i),h=0;h<a.length;h++)U.call(i,a[h])&&(n[a[h]]=i[a[h]])}return n};window.Promise||(window.Promise=F),Object.assign||(Object.assign=e),Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),window.performance&&window.performance.now||(N=Date.now(),window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-N});for(var j=Date.now(),H=["ms","moz","webkit","o"],G=0;G<H.length&&!window.requestAnimationFrame;++G){var z=H[G];window.requestAnimationFrame=window[z+"RequestAnimationFrame"],window.cancelAnimationFrame=window[z+"CancelAnimationFrame"]||window[z+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),i=16+j-t;return i<0&&(i=0),j=t,window.setTimeout(function(){j=Date.now(),e(performance.now())},i)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){return clearTimeout(e)}),Math.sign||(Math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1}),Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);function W(e){return void 0!==e&&"MacIntel"===e.platform&&"number"==typeof e.maxTouchPoints&&1<e.maxTouchPoints&&"undefined"==typeof MSStream}var Y,F=/iPhone/i,e=/iPod/i,V=/iPad/i,Z=/\biOS-universal(?:.+)Mac\b/i,$=/\bAndroid(?:.+)Mobile\b/i,t=/Android/i,i=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,r=/Silk/i,n=/Windows Phone/i,J=/\bWindows(?:.+)ARM\b/i,o=/BlackBerry/i,s=/BB10/i,Q=/Opera Mini/i,ee=/\b(CriOS|Chrome)(?:.+)Mobile/i,te=/Mobile(?:.+)Firefox\b/i,ie=(y=window.navigator,Le={userAgent:"",platform:"",maxTouchPoints:0},y||"undefined"==typeof navigator?"string"==typeof y?Le.userAgent=y:y&&y.userAgent&&(Le={userAgent:y.userAgent,platform:y.platform,maxTouchPoints:y.maxTouchPoints||0}):Le={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0},y=Le.userAgent,void 0!==(m=(y=void 0!==(m=y.split("[FBAN"))[1]?m[0]:y).split("Twitter"))[1]&&(y=m[0]),Y=y,(y={apple:{phone:(m=function(e){return e.test(Y)})(F)&&!m(n),ipod:m(e),tablet:!m(F)&&(m(V)||W(Le))&&!m(n),universal:m(Z),device:(m(F)||m(e)||m(V)||m(Z)||W(Le))&&!m(n)},amazon:{phone:m(i),tablet:!m(i)&&m(r),device:m(i)||m(r)},android:{phone:!m(n)&&m(i)||!m(n)&&m($),tablet:!m(n)&&!m(i)&&!m($)&&(m(r)||m(t)),device:!m(n)&&(m(i)||m(r)||m($)||m(t))||m(/\bokhttp\b/i)},windows:{phone:m(n),tablet:m(J),device:m(n)||m(J)},other:{blackberry:m(o),blackberry10:m(s),opera:m(Q),firefox:m(te),chrome:m(ee),device:m(o)||m(s)||m(Q)||m(te)||m(ee)},any:!1,phone:!1,tablet:!1}).any=y.apple.device||y.android.device||y.windows.device||y.other.device,y.phone=y.apple.phone||y.android.phone||y.windows.phone,y.tablet=y.apple.tablet||y.android.tablet||y.windows.tablet,y),_={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:(F=!0,(ie.tablet||ie.phone)&&(ie.apple.device&&(We=navigator.userAgent.match(/OS (\d+)_(\d+)?/))&&parseInt(We[1],10)<11&&(F=!1),ie.android.device&&(We=navigator.userAgent.match(/Android\s([0-9.]*)/))&&parseInt(We[1],10)<7&&(F=!1)),F?32:4),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:ie.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!ie.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},e=L(function(e){var r=Object.prototype.hasOwnProperty,f="~";function i(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function n(e,t,i,r,n){if("function"!=typeof i)throw new TypeError("The listener must be a function");i=new o(i,r||e,n),r=f?f+t:t;return e._events[r]?e._events[r].fn?e._events[r]=[e._events[r],i]:e._events[r].push(i):(e._events[r]=i,e._eventsCount++),e}function h(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function t(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(f=!1)),t.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)r.call(e,t)&&i.push(f?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},t.prototype.listeners=function(e){var e=f?f+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var i=0,r=t.length,n=new Array(r);i<r;i++)n[i]=t[i].fn;return n},t.prototype.listenerCount=function(e){e=f?f+e:e,e=this._events[e];return e?e.fn?1:e.length:0},t.prototype.emit=function(e,t,i,r,n,o){var s=arguments,a=f?f+e:e;if(!this._events[a])return!1;var h,u=this._events[a],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,r),!0;case 5:return u.fn.call(u.context,t,i,r,n),!0;case 6:return u.fn.call(u.context,t,i,r,n,o),!0}for(d=1,h=new Array(l-1);d<l;d++)h[d-1]=s[d];u.fn.apply(u.context,h)}else for(var c,p=u.length,d=0;d<p;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,i);break;case 4:u[d].fn.call(u[d].context,t,i,r);break;default:if(!h)for(c=1,h=new Array(l-1);c<l;c++)h[c-1]=s[c];u[d].fn.apply(u[d].context,h)}return!0},t.prototype.on=function(e,t,i){return n(this,e,t,i,!1)},t.prototype.once=function(e,t,i){return n(this,e,t,i,!0)},t.prototype.removeListener=function(e,t,i,r){e=f?f+e:e;if(this._events[e])if(t){var n=this._events[e];if(n.fn)n.fn!==t||r&&!n.once||i&&n.context!==i||h(this,e);else{for(var o=0,s=[],a=n.length;o<a;o++)(n[o].fn!==t||r&&!n[o].once||i&&n[o].context!==i)&&s.push(n[o]);s.length?this._events[e]=1===s.length?s[0]:s:h(this,e)}}else h(this,e);return this},t.prototype.removeAllListeners=function(e){return e?(e=f?f+e:e,this._events[e]&&h(this,e)):(this._events=new i,this._eventsCount=0),this},t.prototype.off=t.prototype.removeListener,t.prototype.addListener=t.prototype.on,t.prefixed=f,e.exports=t.EventEmitter=t}),re=ne,V=ne;function ne(e,t,i){i=i||2;var r,n,o,s,a,h=t&&t.length,u=h?t[0]*i:e.length,l=oe(e,0,u,i,!0),c=[];if(l&&l.next!==l.prev){if(h&&(l=function(e,t,i,r){for(var n,o,s,a,h,u=[],l=0,c=t.length;l<c;l++)(n=oe(e,t[l]*r,l<c-1?t[l+1]*r:e.length,r,!1))===n.next&&(n.steiner=!0),u.push(function(e){var t=e,i=e;for(;(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next,t!==e;);return i}(n));for(u.sort(he),l=0;l<u.length;l++)i=se((o=u[l],h=a=void 0,i=(h=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&s<a){if((s=a)===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}}while((r=r.next)!==t);if(!i)return null;if(n!==s)for(var h,u,l,c=i,p=i.x,d=i.y,f=1/0,r=i;n>=r.x&&r.x>=p&&n!==r.x&&le(o<d?n:s,o,p,d,o<d?s:n,o,r.x,r.y)&&(h=Math.abs(o-r.y)/(n-r.x),me(r,e)&&(h<f||h===f&&(r.x>i.x||r.x===i.x&&(l=r,I((u=i).prev,u,l.prev)<0&&I(l.next,u,u.next)<0)))&&(i=r,f=h)),(r=r.next)!==c;);return i}(o,s=i))&&(o=_e(h,o),a=se(h,h.next),se(o,o.next),s===h)?a:s),i.next);return i}(e,t,l,i)),e.length>80*i){for(var p=r=e[0],d=n=e[1],f=i;f<u;f+=i)(o=e[f])<p&&(p=o),(s=e[f+1])<d&&(d=s),r<o&&(r=o),n<s&&(n=s);a=0!==(a=Math.max(r-p,n-d))?1/a:0}ae(l,c,i,p,d,a)}return c}function oe(e,t,i,r,n){var o,s;if(n===0<be(e,t,i,r))for(o=t;o<i;o+=r)s=ye(o,e[o],e[o+1],s);else for(o=i-r;t<=o;o-=r)s=ye(o,e[o],e[o+1],s);return s&&ce(s,s.next)&&(ge(s),s=s.next),s}function se(e,t){if(!e)return e;t=t||e;var i,r=e;do{if(i=!1,r.steiner||!ce(r,r.next)&&0!==I(r.prev,r,r.next))r=r.next;else{if(ge(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function ae(e,t,i,r,n,o,s){if(e){if(!s&&o){var a=e;var h=r;var u=n;var l=o;for(var c=a;null===c.z&&(c.z=ue(c.x,c.y,h,u,l)),c.prevZ=c.prev,c.nextZ=c.next,(c=c.next)!==a;);c.prevZ.nextZ=null,c.prevZ=null;var p,d,f,m,_,y,g,v,b=c,x=1;do{for(d=b,_=b=null,y=0;d;){for(y++,f=d,p=g=0;p<x&&(g++,f=f.nextZ);p++);for(v=x;0<g||0<v&&f;)0!==g&&(0===v||!f||d.z<=f.z)?(d=(m=d).nextZ,g--):(f=(m=f).nextZ,v--),_?_.nextZ=m:b=m,m.prevZ=_,_=m;d=f}}while(_.nextZ=null,x*=2,1<y)}for(var w,T,E=e;e.prev!==e.next;)if(w=e.prev,T=e.next,o?function(e,t,i,r){var n=e.prev,o=e,s=e.next;if(0<=I(n,o,s))return;for(var a=(n.x<o.x?n.x<s.x?n:s:o.x<s.x?o:s).x,h=(n.y<o.y?n.y<s.y?n:s:o.y<s.y?o:s).y,u=(n.x>o.x?n.x>s.x?n:s:o.x>s.x?o:s).x,l=(n.y>o.y?n.y>s.y?n:s:o.y>s.y?o:s).y,c=ue(a,h,t,i,r),p=ue(u,l,t,i,r),d=e.prevZ,f=e.nextZ;d&&d.z>=c&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&le(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=I(d.prev,d,d.next))return;if(d=d.prevZ,f!==e.prev&&f!==e.next&&le(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&0<=I(f.prev,f,f.next))return;f=f.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&le(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=I(d.prev,d,d.next))return;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&le(n.x,n.y,o.x,o.y,s.x,s.y,f.x,f.y)&&0<=I(f.prev,f,f.next))return;f=f.nextZ}return 1}(e,r,n,o):function(e){var t=e.prev,i=e,r=e.next;if(0<=I(t,i,r))return;for(var n=e.next.next;n!==e.prev;){if(le(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&0<=I(n.prev,n,n.next))return;n=n.next}return 1}(e))t.push(w.i/i),t.push(e.i/i),t.push(T.i/i),ge(e),e=T.next,E=T.next;else if((e=T)===E){s?1===s?ae(e=function(e,t,i){var r=e;do{var n=r.prev,o=r.next.next}while(!ce(n,o)&&pe(n,r,r.next,o)&&me(n,o)&&me(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),ge(r),ge(r.next),r=e=o),r=r.next,r!==e);return se(r)}(se(e),t,i),t,i,r,n,o,2):2===s&&function(e,t,i,r,n,o){var s=e;do{for(var a,h=s.next.next;h!==s.prev;){if(s.i!==h.i&&function(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&pe(i,i.next,e,t))return 1}while((i=i.next)!==e)}(e,t)&&(me(e,t)&&me(t,e)&&function(e,t){for(var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),(i=i.next)!==e;);return r}(e,t)&&(I(e.prev,e,t.prev)||I(e,t.prev,t))||ce(e,t)&&0<I(e.prev,e,e.next)&&0<I(t.prev,t,t.next))}(s,h))return a=_e(s,h),s=se(s,s.next),a=se(a,a.next),ae(s,t,i,r,n,o),ae(a,t,i,r,n,o);h=h.next}}while(s=s.next,s!==e)}(e,t,i,r,n,o):ae(se(e),t,i,r,n,o,1);break}}}function he(e,t){return e.x-t.x}function ue(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function le(e,t,i,r,n,o,s,a){return 0<=(n-s)*(t-a)-(e-s)*(o-a)&&0<=(e-s)*(r-a)-(i-s)*(t-a)&&0<=(i-s)*(o-a)-(n-s)*(r-a)}function I(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function ce(e,t){return e.x===t.x&&e.y===t.y}function pe(e,t,i,r){var n=fe(I(e,t,i)),o=fe(I(e,t,r)),s=fe(I(i,r,e)),a=fe(I(i,r,t));return n!==o&&s!==a||0===n&&de(e,i,t)||0===o&&de(e,r,t)||0===s&&de(i,e,r)||0===a&&de(i,t,r)}function de(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function fe(e){return 0<e?1:e<0?-1:0}function me(e,t){return I(e.prev,e,e.next)<0?0<=I(e,t,e.next)&&0<=I(e,e.prev,t):I(e,t,e.prev)<0||I(e,e.next,t)<0}function _e(e,t){var i=new ve(e.i,e.x,e.y),r=new ve(t.i,t.x,t.y),n=e.next,o=t.prev;return(e.next=t).prev=e,(i.next=n).prev=i,(r.next=i).prev=r,(o.next=r).prev=o,r}function ye(e,t,i,r){e=new ve(e,t,i);return r?(e.next=r.next,(e.prev=r).next.prev=e,r.next=e):(e.prev=e).next=e,e}function ge(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ve(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function be(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}ne.deviation=function(e,t,i,r){var n=t&&t.length,o=n?t[0]*i:e.length,s=Math.abs(be(e,0,o,i));if(n)for(var a=0,h=t.length;a<h;a++){var u=t[a]*i,l=a<h-1?t[a+1]*i:e.length;s-=Math.abs(be(e,u,l,i))}for(var c=0,a=0;a<r.length;a+=3){var p=r[a]*i,d=r[a+1]*i,f=r[a+2]*i;c+=Math.abs((e[p]-e[f])*(e[1+d]-e[1+p])-(e[p]-e[d])*(e[1+f]-e[1+p]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},ne.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var o=0;o<e[n].length;o++)for(var s=0;s<t;s++)i.vertices.push(e[n][o][s]);0<n&&(r+=e[n-1].length,i.holes.push(r))}return i},re.default=V;var xe=L(function(e,t){var i=R,r=t&&!t.nodeType&&t,t=e&&!e.nodeType&&e,n="object"==typeof R&&R;n.global!==n&&n.window!==n&&n.self!==n||(i=n);var o,s,_=2147483647,y=36,g=26,a=38,h=700,u=/^xn--/,l=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=y-1,v=Math.floor,b=String.fromCharCode;function x(e){throw RangeError(p[e])}function f(e,t){for(var i=e.length,r=[];i--;)r[i]=t(e[i]);return r}function m(e,t){var i=e.split("@"),r="";return 1<i.length&&(r=i[0]+"@",e=i[1]),r+f((e=e.replace(c,".")).split("."),t).join(".")}function w(e){for(var t,i,r=[],n=0,o=e.length;n<o;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<o?56320==(64512&(i=e.charCodeAt(n++)))?r.push(((1023&t)<<10)+(1023&i)+65536):(r.push(t),n--):r.push(t);return r}function T(e){return f(e,function(e){var t="";return 65535<e&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+b(e)}).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function I(e,t,i){var r=0;for(e=i?v(e/h):e>>1,e+=v(e/t);d*g>>1<e;r+=y)e=v(e/d);return v(r+(d+1)*e/(e+a))}function P(e){var t,i,r,n,o,s,a,h,u=[],l=e.length,c=0,p=128,d=72;for((i=e.lastIndexOf("-"))<0&&(i=0),r=0;r<i;++r)128<=e.charCodeAt(r)&&x("not-basic"),u.push(e.charCodeAt(r));for(n=0<i?i+1:0;n<l;){for(o=c,s=1,a=y;l<=n&&x("invalid-input"),((h=(h=e.charCodeAt(n++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:y)>=y||h>v((_-c)/s))&&x("overflow"),c+=h*s,!(h<(h=a<=d?1:d+g<=a?g:a-d));a+=y)s>v(_/(h=y-h))&&x("overflow"),s*=h;d=I(c-o,t=u.length+1,0==o),v(c/t)>_-p&&x("overflow"),p+=v(c/t),c%=t,u.splice(c++,0,p)}return T(u)}function S(e){for(var t,i,r,n,o,s,a,h,u,l=[],c=(e=w(e)).length,p=128,d=0,f=72,m=0;m<c;++m)(s=e[m])<128&&l.push(b(s));for(t=i=l.length,i&&l.push("-");t<c;){for(r=_,m=0;m<c;++m)(s=e[m])>=p&&s<r&&(r=s);for(r-p>v((_-d)/(a=t+1))&&x("overflow"),d+=(r-p)*a,p=r,m=0;m<c;++m)if((s=e[m])<p&&++d>_&&x("overflow"),s==p){for(n=d,o=y;!(n<(h=o<=f?1:f+g<=o?g:o-f));o+=y)l.push(b(E(h+(u=n-h)%(h=y-h),0))),n=v(u/h);l.push(b(E(n,0))),f=I(d,a,t==i),d=0,++t}++d,++p}return l.join("")}if(o={version:"1.3.2",ucs2:{decode:w,encode:T},decode:P,encode:S,toASCII:function(e){return m(e,function(e){return l.test(e)?"xn--"+S(e):e})},toUnicode:function(e){return m(e,function(e){return u.test(e)?P(e.slice(4).toLowerCase()):e})}},r&&t)if(e.exports==r)t.exports=o;else for(s in o)o.hasOwnProperty(s)&&(r[s]=o[s]);else i.punycode=o}),we=function(e){return"string"==typeof e},Te=function(e){return"object"==typeof e&&null!==e},Ee=function(e){return null===e},Ie=function(e){return null==e};function Pe(e,t,i,r){t=t||"&",i=i||"=";var n={};if("string"==typeof e&&0!==e.length){var o=/\+/g,t=(e=e.split(t),1e3),s=(r&&"number"==typeof r.maxKeys&&(t=r.maxKeys),e.length);0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var h,u=e[a].replace(o,"%20"),l=u.indexOf(i),l=0<=l?(h=u.substr(0,l),u.substr(l+1)):(h=u,""),u=decodeURIComponent(h),l=decodeURIComponent(l);Object.prototype.hasOwnProperty.call(n,u)?Array.isArray(n[u])?n[u].push(l):n[u]=[n[u],l]:n[u]=l}}return n}function Se(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function Ae(i,r,n,e){return r=r||"&",n=n||"=","object"==typeof(i=null===i?void 0:i)?Object.keys(i).map(function(e){var t=encodeURIComponent(Se(e))+n;return Array.isArray(i[e])?i[e].map(function(e){return t+encodeURIComponent(Se(e))}).join(r):t+encodeURIComponent(Se(i[e]))}).join(r):e?encodeURIComponent(Se(e))+n+encodeURIComponent(Se(i)):""}var ke=L(function(e,t){t.decode=t.parse=Pe,t.encode=t.stringify=Ae}),Oe=(ke.decode,ke.parse,ke.encode,ke.stringify,ze),Z=Me;function Me(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var Ce=/^([a-z0-9.+-]+:)/i,Re=/:[0-9]*$/,De=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Le=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),Ne=["'"].concat(Le),Fe=["%","/","?",";","#"].concat(Ne),Be=["/","?","#"],Xe=/^[+a-z0-9A-Z_-]{0,63}$/,Ue=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,je={javascript:!0,"javascript:":!0},He={javascript:!0,"javascript:":!0},Ge={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ze(e,t,i){var r;return e&&Te(e)&&e instanceof Me?e:((r=new Me).parse(e,t,i),r)}Me.prototype.parse=function(e,t,i){if(!we(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),r=-1!==r&&r<e.indexOf("#")?"?":"#",n=e.split(r);n[0]=n[0].replace(/\\/g,"/");var o=(o=e=n.join(r)).trim();if(!i&&1===e.split("#").length){n=De.exec(o);if(n)return this.path=o,this.href=o,this.pathname=n[1],n[2]?(this.search=n[2],this.query=t?ke.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var s,r=Ce.exec(o);if(r&&(s=(r=r[0]).toLowerCase(),this.protocol=s,o=o.substr(r.length)),!(i||r||o.match(/^\/\/[^@\/]+@[^@\/]+/))||!(b="//"===o.substr(0,2))||r&&He[r]||(o=o.substr(2),this.slashes=!0),!He[r]&&(b||r&&!Ge[r])){for(var a,h=-1,u=0;u<Be.length;u++)-1!==(a=o.indexOf(Be[u]))&&(-1===h||a<h)&&(h=a);for(-1!==(e=-1===h?o.lastIndexOf("@"):o.lastIndexOf("@",h))&&(n=o.slice(0,e),o=o.slice(e+1),this.auth=decodeURIComponent(n)),h=-1,u=0;u<Fe.length;u++)-1!==(a=o.indexOf(Fe[u]))&&(-1===h||a<h)&&(h=a);-1===h&&(h=o.length),this.host=o.slice(0,h),o=o.slice(h),this.parseHost(),this.hostname=this.hostname||"";i="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!i)for(var l=this.hostname.split(/\./),c=(u=0,l.length);u<c;u++){var p=l[u];if(p&&!p.match(Xe)){for(var d="",f=0,m=p.length;f<m;f++)127<p.charCodeAt(f)?d+="x":d+=p[f];if(!d.match(Xe)){var _=l.slice(0,u),y=l.slice(u+1),g=p.match(Ue);g&&(_.push(g[1]),y.unshift(g[2])),y.length&&(o="/"+y.join(".")+o),this.hostname=_.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),i||(this.hostname=xe.toASCII(this.hostname));var v=this.port?":"+this.port:"",b=this.hostname||"";this.host=b+v,this.href+=this.host,i&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!je[s])for(u=0,c=Ne.length;u<c;u++){var x,w=Ne[u];-1!==o.indexOf(w)&&((x=encodeURIComponent(w))===w&&(x=escape(w)),o=o.split(w).join(x))}r=o.indexOf("#"),-1!==r&&(this.hash=o.substr(r),o=o.slice(0,r)),e=o.indexOf("?");return-1!==e?(this.search=o.substr(e),this.query=o.substr(e+1),t&&(this.query=ke.parse(this.query)),o=o.slice(0,e)):t&&(this.search="",this.query={}),o&&(this.pathname=o),Ge[s]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(v=this.pathname||"",n=this.search||"",this.path=v+n),this.href=this.format(),this},Me.prototype.format=function(){var e=this.auth||"",t=(e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@"),this.protocol||""),i=this.pathname||"",r=this.hash||"",n=!1,o="",e=(this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&Te(this.query)&&Object.keys(this.query).length&&(o=ke.stringify(this.query)),this.search||o&&"?"+o||"");return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||Ge[t])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n=n||"",r&&"#"!==r.charAt(0)&&(r="#"+r),e&&"?"!==e.charAt(0)&&(e="?"+e),t+n+(i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(e=e.replace("#","%23"))+r},Me.prototype.resolve=function(e){return this.resolveObject(ze(e,!1,!0)).format()},Me.prototype.resolveObject=function(e){we(e)&&((p=new Me).parse(e,!1,!0),e=p);for(var t=new Me,i=Object.keys(this),r=0;r<i.length;r++){var n=i[r];t[n]=this[n]}if(t.hash=e.hash,""!==e.href)if(e.slashes&&!e.protocol){for(var o=Object.keys(e),s=0;s<o.length;s++){var a=o[s];"protocol"!==a&&(t[a]=e[a])}Ge[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/")}else if(e.protocol&&e.protocol!==t.protocol)if(Ge[e.protocol]){if(t.protocol=e.protocol,e.host||He[e.protocol])t.pathname=e.pathname;else{for(var h=(e.pathname||"").split("/");h.length&&!(e.host=h.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==h[0]&&h.unshift(""),h.length<2&&h.unshift(""),t.pathname=h.join("/")}t.search=e.search,t.query=e.query,t.host=e.host||"",t.auth=e.auth,t.hostname=e.hostname||e.host,t.port=e.port,(t.pathname||t.search)&&(p=t.pathname||"",d=t.search||"",t.path=p+d),t.slashes=t.slashes||e.slashes}else for(var u=Object.keys(e),l=0;l<u.length;l++){var c=u[l];t[c]=e[c]}else{var p=t.pathname&&"/"===t.pathname.charAt(0),d=e.host||e.pathname&&"/"===e.pathname.charAt(0),p=d||p||t.host&&e.pathname,f=p,m=t.pathname&&t.pathname.split("/")||[],_=(h=e.pathname&&e.pathname.split("/")||[],t.protocol&&!Ge[t.protocol]);if(_&&(t.hostname="",t.port=null,t.host&&(""===m[0]?m[0]=t.host:m.unshift(t.host)),t.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===h[0]?h[0]=e.host:h.unshift(e.host)),e.host=null),p=p&&(""===h[0]||""===m[0])),d)t.host=(e.host||""===e.host?e:t).host,t.hostname=(e.hostname||""===e.hostname?e:t).hostname,t.search=e.search,t.query=e.query,m=h;else if(h.length)(m=m||[]).pop(),m=m.concat(h),t.search=e.search,t.query=e.query;else if(!Ie(e.search))return _&&(t.hostname=t.host=m.shift(),(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),t.search=e.search,t.query=e.query,Ee(t.pathname)&&Ee(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.href=t.format(),t;if(m.length){for(var y=m.slice(-1)[0],d=(t.host||e.host||1<m.length)&&("."===y||".."===y)||""===y,g=0,v=m.length;0<=v;v--)"."===(y=m[v])?m.splice(v,1):".."===y?(m.splice(v,1),g++):g&&(m.splice(v,1),g--);if(!p&&!f)for(;g--;)m.unshift("..");!p||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),d&&"/"!==m.join("/").substr(-1)&&m.push("");var b,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);_&&(t.hostname=t.host=!f&&m.length?m.shift():"",(b=!!(t.host&&0<t.host.indexOf("@"))&&t.host.split("@"))&&(t.auth=b.shift(),t.host=t.hostname=b.shift())),(p=p||t.host&&m.length)&&!f&&m.unshift(""),m.length?t.pathname=m.join("/"):(t.pathname=null,t.path=null),Ee(t.pathname)&&Ee(t.search)||(t.path=(t.pathname||"")+(t.search||"")),t.auth=e.auth||t.auth,t.slashes=t.slashes||e.slashes}else t.pathname=null,t.search?t.path="/"+t.search:t.path=null}return t.href=t.format(),t},Me.prototype.parseHost=function(){var e=this.host,t=Re.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var We,Ye={parse:Oe,resolve:function(e,t){return ze(e,!1,!0).resolve(t)},resolveObject:function(e,t){return e?ze(e,!1,!0).resolveObject(t):t},format:function(e){return(e=we(e)?ze(e):e)instanceof Me?e.format():Me.prototype.format.call(e)},Url:Z};(i=q.ENV||(q.ENV={}))[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",(r=q.RENDERER_TYPE||(q.RENDERER_TYPE={}))[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",($=q.BUFFER_BITS||(q.BUFFER_BITS={}))[$.COLOR=16384]="COLOR",$[$.DEPTH=256]="DEPTH",$[$.STENCIL=1024]="STENCIL",(t=q.BLEND_MODES||(q.BLEND_MODES={}))[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",(n=q.DRAW_MODES||(q.DRAW_MODES={}))[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",(J=q.FORMATS||(q.FORMATS={}))[J.RGBA=6408]="RGBA",J[J.RGB=6407]="RGB",J[J.ALPHA=6406]="ALPHA",J[J.LUMINANCE=6409]="LUMINANCE",J[J.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",J[J.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",J[J.DEPTH_STENCIL=34041]="DEPTH_STENCIL",(o=q.TARGETS||(q.TARGETS={}))[o.TEXTURE_2D=3553]="TEXTURE_2D",o[o.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",o[o.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",o[o.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",o[o.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",o[o.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",o[o.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",o[o.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",o[o.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",(s=q.TYPES||(q.TYPES={}))[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.FLOAT=5126]="FLOAT",s[s.HALF_FLOAT=36193]="HALF_FLOAT",(Q=q.SCALE_MODES||(q.SCALE_MODES={}))[Q.NEAREST=0]="NEAREST",Q[Q.LINEAR=1]="LINEAR",(te=q.WRAP_MODES||(q.WRAP_MODES={}))[te.CLAMP=33071]="CLAMP",te[te.REPEAT=10497]="REPEAT",te[te.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",(m=q.MIPMAP_MODES||(q.MIPMAP_MODES={}))[m.OFF=0]="OFF",m[m.POW2=1]="POW2",m[m.ON=2]="ON",(ee=q.ALPHA_MODES||(q.ALPHA_MODES={}))[ee.NPM=0]="NPM",ee[ee.UNPACK=1]="UNPACK",ee[ee.PMA=2]="PMA",ee[ee.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",ee[ee.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",ee[ee.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",(y=q.CLEAR_MODES||(q.CLEAR_MODES={}))[y.NO=0]="NO",y[y.YES=1]="YES",y[y.AUTO=2]="AUTO",y[y.BLEND=0]="BLEND",y[y.CLEAR=1]="CLEAR",y[y.BLIT=2]="BLIT",(We=q.GC_MODES||(q.GC_MODES={}))[We.AUTO=0]="AUTO",We[We.MANUAL=1]="MANUAL",(F=q.PRECISION||(q.PRECISION={})).LOW="lowp",F.MEDIUM="mediump",F.HIGH="highp",(V=q.MASK_TYPES||(q.MASK_TYPES={}))[V.NONE=0]="NONE",V[V.SCISSOR=1]="SCISSOR",V[V.STENCIL=2]="STENCIL",V[V.SPRITE=3]="SPRITE",(Le=q.MSAA_QUALITY||(q.MSAA_QUALITY={}))[Le.NONE=0]="NONE",Le[Le.LOW=2]="LOW",Le[Le.MEDIUM=4]="MEDIUM",Le[Le.HIGH=8]="HIGH",_.RETINA_PREFIX=/@([0-9\.]+)x/;var Ve,qe=!(_.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0);function Ze(e){var t;qe||(-1<navigator.userAgent.toLowerCase().indexOf("chrome")?(t=window.console).log.apply(t,["\n %c %c %c PixiJS 5.3.12 - ✰ "+e+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):window.console&&window.console.log("PixiJS 5.3.12 - "+e+" - http://www.pixijs.com/"),qe=!0)}function Ke(){return Ve=void 0===Ve?function(){var e,t,i,r,n={stencil:!0,failIfMajorPerformanceCaveat:_.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{return window.WebGLRenderingContext?(i=!(!(t=(e=document.createElement("canvas")).getContext("webgl",n)||e.getContext("experimental-webgl",n))||!t.getContextAttributes().stencil),t&&(r=t.getExtension("WEBGL_lose_context"))&&r.loseContext(),t=null,i):!1}catch(n){return!1}}():Ve}function $e(e,t){return(t=void 0===t?[]:t)[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t}function Je(e){e=e.toString(16);return"#"+("000000".substr(0,6-e.length)+e)}function Qe(e){return"string"==typeof e&&"#"===e[0]&&(e=e.substr(1)),parseInt(e,16)}var et=function(){for(var e=[],t=[],i=0;i<32;i++)t[e[i]=i]=i;e[q.BLEND_MODES.NORMAL_NPM]=q.BLEND_MODES.NORMAL,e[q.BLEND_MODES.ADD_NPM]=q.BLEND_MODES.ADD,e[q.BLEND_MODES.SCREEN_NPM]=q.BLEND_MODES.SCREEN,t[q.BLEND_MODES.NORMAL]=q.BLEND_MODES.NORMAL_NPM,t[q.BLEND_MODES.ADD]=q.BLEND_MODES.ADD_NPM,t[q.BLEND_MODES.SCREEN]=q.BLEND_MODES.SCREEN_NPM;var r=[];return r.push(t),r.push(e),r}();function tt(e,t){return et[t?1:0][e]}function it(e,t,i,r){return i=i||new Float32Array(4),r||void 0===r?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t):(i[0]=e[0],i[1]=e[1],i[2]=e[2]),i[3]=t,i}function rt(e,t){return 1===t?(255*t<<24)+e:0===t?0:(255*t<<24)+(((e>>16&255)*t+.5|0)<<16)+(((e>>8&255)*t+.5|0)<<8)+((255&e)*t+.5|0)}function nt(e,t,i,r){return(i=i||new Float32Array(4))[0]=(e>>16&255)/255,i[1]=(e>>8&255)/255,i[2]=(255&e)/255,!r&&void 0!==r||(i[0]*=t,i[1]*=t,i[2]*=t),i[3]=t,i}function ot(e,t){var i=6*e;if((t=(t=void 0===t?null:t)||new Uint16Array(i)).length!==i)throw new Error("Out buffer length is incorrect, got "+t.length+" and expected "+i);for(var r=0,n=0;r<i;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function st(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}var at={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};function ht(e){return e+=0===e?1:0,--e,1+((e=(e=(e=(e|=e>>>1)|e>>>2)|e>>>4)|e>>>8)|e>>>16)}function ut(e){return!(e&e-1||!e)}function lt(e){var t=(65535<e?1:0)<<4,i=(255<(e>>>=t)?1:0)<<3;return(t|=i)|(i=(15<(e>>>=i)?1:0)<<2)|(i=(3<(e>>>=i)?1:0)<<1)|e>>>i>>1}function ct(e,t,i){var r=e.length;if(!(r<=t||0===i)){for(var n=r-(i=r<t+i?r-t:i),o=t;o<n;++o)e[o]=e[o+i];e.length=n}}function pt(e){return 0===e?0:e<0?-1:1}var dt=0;function ft(){return++dt}var mt={};function f(e,t,i){var r;void 0===i&&(i=3),mt[t]||(void 0===(r=(new Error).stack)?console.warn("PixiJS Deprecation Warning: ",t+"\nDeprecated since v"+e):(r=r.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+"\nDeprecated since v"+e),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+"\nDeprecated since v"+e),console.warn(r))),mt[t]=!0)}var _t={},yt=Object.create(null),gt=Object.create(null),vt=(bt.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},bt.prototype.resize=function(e,t){this.canvas.width=e*this.resolution,this.canvas.height=t*this.resolution},bt.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(bt.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(bt.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e},enumerable:!1,configurable:!0}),bt);function bt(e,t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=i||_.RESOLUTION,this.resize(e,t)}function xt(e){for(var t,i,r=e.width,n=e.height,e=e.getContext("2d"),o=e.getImageData(0,0,r,n).data,s=o.length,a={top:null,left:null,right:null,bottom:null},h=null,u=0;u<s;u+=4)0!==o[u+3]&&(t=u/4%r,i=~~(u/4/r),null===a.top&&(a.top=i),(null===a.left||t<a.left)&&(a.left=t),(null===a.right||a.right<t)&&(a.right=1+t),(null===a.bottom||a.bottom<i)&&(a.bottom=i));return null!==a.top&&(r=a.right-a.left,n=a.bottom-a.top+1,h=e.getImageData(a.left,a.top,r,n)),{height:n,width:r,data:h}}var wt,Tt=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Et(e,t){if(void 0===t&&(t=window.location),0===e.indexOf("data:"))return"";t=t||window.location,(wt=wt||document.createElement("a")).href=e;var e=Oe(wt.href),i=!e.port&&""===t.port||e.port===t.port;return e.hostname===t.hostname&&i&&e.protocol===t.protocol?"":"anonymous"}function It(e,t){e=_.RETINA_PREFIX.exec(e);return e?parseFloat(e[1]):void 0!==t?t:1}var Z={BaseTextureCache:gt,CanvasRenderTarget:vt,DATA_URI:Tt,ProgramCache:_t,TextureCache:yt,clearTextureCache:function(){for(var e in yt)delete yt[e];for(e in gt)delete gt[e]},correctBlendMode:tt,createIndicesForQuads:ot,decomposeDataUri:function(e){e=Tt.exec(e);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}},deprecation:f,destroyTextureCache:function(){for(var e in yt)yt[e].destroy();for(e in gt)gt[e].destroy()},determineCrossOrigin:Et,getBufferType:st,getResolutionOfUrl:It,hex2rgb:$e,hex2string:Je,interleaveTypedArrays:function(e,t){for(var i=0,r=0,n={},o=0;o<e.length;o++)r+=t[o],i+=e[o].length;for(var s=new ArrayBuffer(4*i),a=null,h=0,o=0;o<e.length;o++){var u=t[o],l=e[o],c=st(l);n[c]||(n[c]=new at[c](s));for(var a=n[c],p=0;p<l.length;p++)a[(p/u|0)*r+h+p%u]=l[p];h+=u}return new Float32Array(s)},isPow2:ut,isWebGLSupported:Ke,log2:lt,nextPow2:ht,premultiplyBlendMode:et,premultiplyRgba:it,premultiplyTint:rt,premultiplyTintToRgba:nt,removeItems:ct,rgb2hex:function(e){return(255*e[0]<<16)+(255*e[1]<<8)+(255*e[2]|0)},sayHello:Ze,sign:pt,skipHello:function(){qe=!0},string2hex:Qe,trimCanvas:xt,uid:ft,isMobile:ie,EventEmitter:e,earcut:re,url:Ye},Pt=2*Math.PI,St=180/Math.PI,At=Math.PI/180,x=((i=q.SHAPES||(q.SHAPES={}))[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",Object.defineProperty(Zt.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(Zt.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(Zt,"EMPTY",{get:function(){return new Zt(0,0,0,0)},enumerable:!1,configurable:!0}),Zt.prototype.clone=function(){return new Zt(this.x,this.y,this.width,this.height)},Zt.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},Zt.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},Zt.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},Zt.prototype.pad=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this},Zt.prototype.fit=function(e){var t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),e=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=r,this.height=Math.max(e-r,0),this},Zt.prototype.ceil=function(e,t){void 0===e&&(e=1),void 0===t&&(t=.001);var i=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=r-this.y,this},Zt.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),e=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=r,this.height=e-r,this},Zt),kt=(qt.prototype.clone=function(){return new qt(this.x,this.y,this.radius)},qt.prototype.contains=function(e,t){var i;return!(this.radius<=0)&&(i=this.radius*this.radius,e=this.x-e,t=this.y-t,(e*=e)+(t*=t)<=i)},qt.prototype.getBounds=function(){return new x(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},qt),Ot=(Vt.prototype.clone=function(){return new Vt(this.x,this.y,this.width,this.height)},Vt.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&(e=(e-this.x)/this.width,(e*=e)+(e=(t-this.y)/this.height)*e<=1)},Vt.prototype.getBounds=function(){return new x(this.x-this.width,this.y-this.height,this.width,this.height)},Vt),Mt=(Yt.prototype.clone=function(){var e=new Yt(this.points.slice());return e.closeStroke=this.closeStroke,e},Yt.prototype.contains=function(e,t){for(var i=!1,r=this.points.length/2,n=0,o=r-1;n<r;o=n++){var s=this.points[2*n],a=this.points[2*n+1],h=this.points[2*o],u=this.points[2*o+1];t<a!=t<u&&e<(t-a)/(u-a)*(h-s)+s&&(i=!i)}return i},Yt),Ct=(Wt.prototype.clone=function(){return new Wt(this.x,this.y,this.width,this.height,this.radius)},Wt.prototype.contains=function(e,t){if(!(this.width<=0||this.height<=0)&&e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){if(t>=this.y+this.radius&&t<=this.y+this.height-this.radius||e>=this.x+this.radius&&e<=this.x+this.width-this.radius)return!0;var i=e-(this.x+this.radius),r=t-(this.y+this.radius),n=this.radius*this.radius;if(i*i+r*r<=n)return!0;if((i=e-(this.x+this.width-this.radius))*i+r*r<=n)return!0;if(i*i+(r=t-(this.y+this.height-this.radius))*r<=n)return!0;if((i=e-(this.x+this.radius))*i+r*r<=n)return!0}return!1},Wt),Rt=(zt.prototype.clone=function(){return new zt(this.x,this.y)},zt.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},zt.prototype.copyTo=function(e){return e.set(this.x,this.y),e},zt.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},zt.prototype.set=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this.x=e,this.y=t,this},zt),Dt=(Gt.prototype.clone=function(e,t){return new Gt(e=void 0===e?this.cb:e,t=void 0===t?this.scope:t,this._x,this._y)},Gt.prototype.set=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=e),this._x===e&&this._y===t||(this._x=e,this._y=t,this.cb.call(this.scope)),this},Gt.prototype.copyFrom=function(e){return this._x===e.x&&this._y===e.y||(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},Gt.prototype.copyTo=function(e){return e.set(this._x,this._y),e},Gt.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},Object.defineProperty(Gt.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(Gt.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Gt),Lt=(a.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},a.prototype.set=function(e,t,i,r,n,o){return this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o,this},a.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));t=t||this.array;return e?(t[0]=this.a,t[1]=this.b,t[2]=0,t[3]=this.c,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty):(t[0]=this.a,t[1]=this.c,t[2]=this.tx,t[3]=this.b,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0),t[8]=1,t},a.prototype.apply=function(e,t){t=t||new Rt;var i=e.x,e=e.y;return t.x=this.a*i+this.c*e+this.tx,t.y=this.b*i+this.d*e+this.ty,t},a.prototype.applyInverse=function(e,t){t=t||new Rt;var i=1/(this.a*this.d+this.c*-this.b),r=e.x,e=e.y;return t.x=this.d*i*r+-this.c*i*e+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*e+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,t},a.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},a.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},a.prototype.rotate=function(e){var t=Math.cos(e),e=Math.sin(e),i=this.a,r=this.c,n=this.tx;return this.a=i*t-this.b*e,this.b=i*e+this.b*t,this.c=r*t-this.d*e,this.d=r*e+this.d*t,this.tx=n*t-this.ty*e,this.ty=n*e+this.ty*t,this},a.prototype.append=function(e){var t=this.a,i=this.b,r=this.c,n=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*i+e.b*n,this.c=e.c*t+e.d*r,this.d=e.c*i+e.d*n,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*i+e.ty*n+this.ty,this},a.prototype.setTransform=function(e,t,i,r,n,o,s,a,h){return this.a=Math.cos(s+h)*n,this.b=Math.sin(s+h)*n,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=e-(i*this.a+r*this.c),this.ty=t-(i*this.b+r*this.d),this},a.prototype.prepend=function(e){var t,i,r=this.tx;return 1===e.a&&0===e.b&&0===e.c&&1===e.d||(t=this.a,i=this.c,this.a=t*e.a+this.b*e.c,this.b=t*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d),this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this},a.prototype.decompose=function(e){var t=this.a,i=this.b,r=this.c,n=this.d,o=-Math.atan2(-r,n),s=Math.atan2(i,t),a=Math.abs(o+s);return a<1e-5||Math.abs(Pt-a)<1e-5?(e.rotation=s,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=s),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(r*r+n*n),e.position.x=this.tx,e.position.y=this.ty,e},a.prototype.invert=function(){var e=this.a,t=this.b,i=this.c,r=this.d,n=this.tx,o=e*r-t*i;return this.a=r/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(e*this.ty-t*n)/o,this},a.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},a.prototype.clone=function(){var e=new a;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},a.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},a.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},Object.defineProperty(a,"IDENTITY",{get:function(){return new a},enumerable:!1,configurable:!0}),Object.defineProperty(a,"TEMP_MATRIX",{get:function(){return new a},enumerable:!1,configurable:!0}),a),Nt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ft=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Bt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Xt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Ut=[],jt=[],Ht=Math.sign;function a(e,t,i,r,n,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),this.array=null,this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o}function Gt(e,t,i,r){void 0===r&&(r=0),this._x=i=void 0===i?0:i,this._y=r,this.cb=e,this.scope=t}function zt(e,t){void 0===t&&(t=0),this.x=e=void 0===e?0:e,this.y=t}function Wt(e,t,i,r,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=20),this.x=e=void 0===e?0:e,this.y=t,this.width=i,this.height=r,this.radius=n,this.type=q.SHAPES.RREC}function Yt(){for(var e=arguments,t=[],i=0;i<arguments.length;i++)t[i]=e[i];var r=Array.isArray(t[0])?t[0]:t;if("number"!=typeof r[0]){for(var n=[],o=0,s=r.length;o<s;o++)n.push(r[o].x,r[o].y);r=n}this.points=r,this.type=q.SHAPES.POLY,this.closeStroke=!0}function Vt(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=e=void 0===e?0:e,this.y=t,this.width=i,this.height=r,this.type=q.SHAPES.ELIP}function qt(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=e=void 0===e?0:e,this.y=t,this.radius=i,this.type=q.SHAPES.CIRC}function Zt(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(r),this.type=q.SHAPES.RECT}for(var Kt=0;Kt<16;Kt++){var $t=[];Ut.push($t);for(var Jt=0;Jt<16;Jt++)for(var Qt=Ht(Nt[Kt]*Nt[Jt]+Bt[Kt]*Ft[Jt]),ei=Ht(Ft[Kt]*Nt[Jt]+Xt[Kt]*Ft[Jt]),ti=Ht(Nt[Kt]*Bt[Jt]+Bt[Kt]*Xt[Jt]),ii=Ht(Ft[Kt]*Bt[Jt]+Xt[Kt]*Xt[Jt]),ri=0;ri<16;ri++)if(Nt[ri]===Qt&&Ft[ri]===ei&&Bt[ri]===ti&&Xt[ri]===ii){$t.push(ri);break}}for(Kt=0;Kt<16;Kt++){var ni=new Lt;ni.set(Nt[Kt],Ft[Kt],Bt[Kt],Xt[Kt],0,0),jt.push(ni)}var h={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(e){return Nt[e]},uY:function(e){return Ft[e]},vX:function(e){return Bt[e]},vY:function(e){return Xt[e]},inv:function(e){return 8&e?15&e:7&-e},add:function(e,t){return Ut[e][t]},sub:function(e,t){return Ut[e][h.inv(t)]},rotate180:function(e){return 4^e},isVertical:function(e){return 2==(3&e)},byDirection:function(e,t){return 2*Math.abs(e)<=Math.abs(t)?0<=t?h.S:h.N:2*Math.abs(t)<=Math.abs(e)?0<e?h.E:h.W:0<t?0<e?h.SE:h.SW:0<e?h.NE:h.NW},matrixAppendRotationInv:function(e,t,i,r){void 0===i&&(i=0),void 0===r&&(r=0);t=jt[h.inv(t)];t.tx=i,t.ty=r,e.append(t)}},oi=(si.prototype.onChange=function(){this._localID++},si.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},si.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},si.prototype.updateTransform=function(e){var t,i,r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID&&(t=e.worldTransform,(i=this.worldTransform).a=r.a*t.a+r.b*t.c,i.b=r.a*t.b+r.b*t.d,i.c=r.c*t.a+r.d*t.c,i.d=r.c*t.b+r.d*t.d,i.tx=r.tx*t.a+r.ty*t.c+t.tx,i.ty=r.tx*t.b+r.ty*t.d+t.ty,this._parentID=e._worldID,this._worldID++)},si.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(si.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),si.IDENTITY=new si,si);function si(){this.worldTransform=new Lt,this.localTransform=new Lt,this.position=new Dt(this.onChange,this,0,0),this.scale=new Dt(this.onChange,this,1,1),this.pivot=new Dt(this.onChange,this,0,0),this.skew=new Dt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}_.SORTABLE_CHILDREN=!1;ui.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},ui.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},ui.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?x.EMPTY:((e=e||new x(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},ui.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},ui.prototype.addQuad=function(e){var t=this.minX,i=this.minY,r=this.maxX,n=this.maxY,o=e[0],s=e[1],t=o<t?o:t,i=s<i?s:i,r=r<o?o:r,n=n<s?s:n;t=(o=e[2])<t?o:t,i=(s=e[3])<i?s:i,r=r<o?o:r,n=n<s?s:n,t=(o=e[4])<t?o:t,i=(s=e[5])<i?s:i,r=r<o?o:r,n=n<s?s:n,t=(o=e[6])<t?o:t,i=(s=e[7])<i?s:i,r=r<o?o:r,n=n<s?s:n,this.minX=t,this.minY=i,this.maxX=r,this.maxY=n},ui.prototype.addFrame=function(e,t,i,r,n){this.addFrameMatrix(e.worldTransform,t,i,r,n)},ui.prototype.addFrameMatrix=function(e,t,i,r,n){var o=e.a,s=e.b,a=e.c,h=e.d,u=e.tx,e=e.ty,l=o*t+a*i+u,c=s*t+h*i+e,p=l<(p=this.minX)?l:p,d=c<(d=this.minY)?c:d,f=(f=this.maxX)<l?l:f,m=(m=this.maxY)<c?c:m;p=(l=o*r+a*i+u)<p?l:p,d=(c=s*r+h*i+e)<d?c:d,f=f<l?l:f,m=m<c?c:m,p=(l=o*t+a*n+u)<p?l:p,d=(c=s*t+h*n+e)<d?c:d,f=f<l?l:f,m=m<c?c:m,p=(l=o*r+a*n+u)<p?l:p,d=(c=s*r+h*n+e)<d?c:d,f=f<l?l:f,m=m<c?c:m,this.minX=p,this.minY=d,this.maxX=f,this.maxY=m},ui.prototype.addVertexData=function(e,t,i){for(var r=this.minX,n=this.minY,o=this.maxX,s=this.maxY,a=t;a<i;a+=2)var h=e[a],u=e[a+1],r=h<r?h:r,n=u<n?u:n,o=o<h?h:o,s=s<u?u:s;this.minX=r,this.minY=n,this.maxX=o,this.maxY=s},ui.prototype.addVertices=function(e,t,i,r){this.addVerticesMatrix(e.worldTransform,t,i,r)},ui.prototype.addVerticesMatrix=function(e,t,i,r,n,o){void 0===n&&(n=0),void 0===o&&(o=n);for(var s=e.a,a=e.b,h=e.c,u=e.d,l=e.tx,c=e.ty,p=this.minX,d=this.minY,f=this.maxX,m=this.maxY,_=i;_<r;_+=2)var y=t[_],g=t[_+1],v=s*y+h*g+l,g=u*g+a*y+c,p=Math.min(p,v-n),f=Math.max(f,v+n),d=Math.min(d,g-o),m=Math.max(m,g+o);this.minX=p,this.minY=d,this.maxX=f,this.maxY=m},ui.prototype.addBounds=function(e){var t=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>r?e.maxX:r,this.maxY=e.maxY>n?e.maxY:n},ui.prototype.addBoundsMask=function(e,t){var i,r,n,o=(e.minX>t.minX?e:t).minX,s=(e.minY>t.minY?e:t).minY,a=(e.maxX<t.maxX?e:t).maxX,e=(e.maxY<t.maxY?e:t).maxY;o<=a&&s<=e&&(t=this.minX,i=this.minY,r=this.maxX,n=this.maxY,this.minX=o<t?o:t,this.minY=s<i?s:i,this.maxX=r<a?a:r,this.maxY=n<e?e:n)},ui.prototype.addBoundsMatrix=function(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)},ui.prototype.addBoundsArea=function(e,t){var i,r,n,o=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,a=e.maxX<t.x+t.width?e.maxX:t.x+t.width,e=e.maxY<t.y+t.height?e.maxY:t.y+t.height;o<=a&&s<=e&&(t=this.minX,i=this.minY,r=this.maxX,n=this.maxY,this.minX=o<t?o:t,this.minY=s<i?s:i,this.maxX=r<a?a:r,this.maxY=n<e?e:n)},ui.prototype.pad=function(e,t){void 0===e&&(e=0),void 0===t&&(t=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)},ui.prototype.addFramePad=function(e,t,i,r,n,o){t-=o,i+=n,r+=o,this.minX=this.minX<(e-=n)?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>r?this.maxY:r};var ai=ui,hi=function(e,t){return(hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function ui(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}function li(e,t){function i(){this.constructor=e}hi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}li(u,pi=e),u.mixin=function(e){for(var t=Object.keys(e),i=0;i<t.length;++i){var r=t[i];Object.defineProperty(u.prototype,r,Object.getOwnPropertyDescriptor(e,r))}},u.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},u.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},u.prototype.getBounds=function(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new x),t=this._boundsRect),this._bounds.getRectangle(t)},u.prototype.getLocalBounds=function(e){e||(this._localBoundsRect||(this._localBoundsRect=new x),e=this._localBoundsRect),this._localBounds||(this._localBounds=new ai);var t=this.transform,i=this.parent,r=(this.parent=null,this.transform=this._tempDisplayObjectParent.transform,this._bounds),n=this._boundsID,e=(this._bounds=this._localBounds,this.getBounds(!1,e));return this.parent=i,this.transform=t,this._bounds=r,this._bounds.updateID+=this._boundsID-n,e},u.prototype.toGlobal=function(e,t,i){return(i=void 0===i?!1:i)||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)},u.prototype.toLocal=function(e,t,i,r){return t&&(e=t.toGlobal(e,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)},u.prototype.setParent=function(e){if(e&&e.addChild)return e.addChild(this),e;throw new Error("setParent: Argument must be a Container")},u.prototype.setTransform=function(e,t,i,r,n,o,s,a,h){return void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===h&&(h=0),this.position.x=e=void 0===e?0:e,this.position.y=t,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=h,this},u.prototype.destroy=function(e){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(u.prototype,"_tempDisplayObjectParent",{get:function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new di),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),u.prototype.enableTempParent=function(){var e=this.parent;return this.parent=this._tempDisplayObjectParent,e},u.prototype.disableTempParent=function(e){this.parent=e},Object.defineProperty(u.prototype,"x",{get:function(){return this.position.x},set:function(e){this.transform.position.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"y",{get:function(){return this.position.y},set:function(e){this.transform.position.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"position",{get:function(){return this.transform.position},set:function(e){this.transform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this.transform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"skew",{get:function(){return this.transform.skew},set:function(e){this.transform.skew.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"angle",{get:function(){return this.transform.rotation*St},set:function(e){this.transform.rotation=e*At},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1}while(e=e.parent);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"mask",{get:function(){return this._mask},set:function(e){var t;this._mask&&((t=this._mask.maskObject||this._mask).renderable=!0,t.isMask=!1),this._mask=e,this._mask&&((t=this._mask.maskObject||this._mask).renderable=!1,t.isMask=!0)},enumerable:!1,configurable:!0});var ci,pi,r=u,di=(li(fi,ci=r),fi);function fi(){var e=null!==ci&&ci.apply(this,arguments)||this;return e.sortDirty=null,e}function u(){var e=pi.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new oi,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new ai,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}function mi(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}r.prototype.displayObjectUpdateTransform=r.prototype.updateTransform;li(l,_i=r),l.prototype.onChildrenChange=function(e){},l.prototype.addChild=function(){for(var e=arguments,t=[],i=0;i<arguments.length;i++)t[i]=e[i];if(1<t.length)for(var r=0;r<t.length;r++)this.addChild(t[r]);else{var n=t[0];n.parent&&n.parent.removeChild(n),(n.parent=this).sortDirty=!0,n.transform._parentID=-1,this.children.push(n),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",n,this,this.children.length-1),n.emit("added",this)}return t[0]},l.prototype.addChildAt=function(e,t){if(t<0||t>this.children.length)throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),(e.parent=this).sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e},l.prototype.swapChildren=function(e,t){var i,r;e!==t&&(i=this.getChildIndex(e),r=this.getChildIndex(t),this.children[i]=t,this.children[r]=e,this.onChildrenChange(i<r?i:r))},l.prototype.getChildIndex=function(e){e=this.children.indexOf(e);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},l.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The index "+t+" supplied is out of bounds "+this.children.length);var i=this.getChildIndex(e);ct(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)},l.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},l.prototype.removeChild=function(){for(var e=arguments,t=[],i=0;i<arguments.length;i++)t[i]=e[i];if(1<t.length)for(var r=0;r<t.length;r++)this.removeChild(t[r]);else{var n=t[0],o=this.children.indexOf(n);if(-1===o)return null;n.parent=null,n.transform._parentID=-1,ct(this.children,o,1),this._boundsID++,this.onChildrenChange(o),n.emit("removed",this),this.emit("childRemoved",n,this,o)}return t[0]},l.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,ct(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t},l.prototype.removeChildren=function(e,t){var i=e=void 0===e?0:e,r=(t=void 0===t?this.children.length:t)-i;if(0<r&&r<=t){for(var n=this.children.splice(i,r),o=0;o<n.length;++o)n[o].parent=null,n[o].transform&&(n[o].transform._parentID=-1);for(this._boundsID++,this.onChildrenChange(e),o=0;o<n.length;++o)n[o].emit("removed",this),this.emit("childRemoved",n[o],this,o);return n}if(0==r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},l.prototype.sortChildren=function(){for(var e=!1,t=0,i=this.children.length;t<i;++t){var r=this.children[t];r._lastSortedIndex=t,e||0===r.zIndex||(e=!0)}e&&1<this.children.length&&this.children.sort(mi),this.sortDirty=!1},l.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,t=this.children.length;e<t;++e){var i=this.children[e];i.visible&&i.updateTransform()}},l.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var t,i=this.children[e];i.visible&&i.renderable&&(i.calculateBounds(),i._mask?((t=i._mask.maskObject||i._mask).calculateBounds(),this._bounds.addBoundsMask(i._bounds,t._bounds)):i.filterArea?this._bounds.addBoundsArea(i._bounds,i.filterArea):this._bounds.addBounds(i._bounds))}this._bounds.updateID=this._boundsID},l.prototype.getLocalBounds=function(e,t){void 0===t&&(t=!1);e=_i.prototype.getLocalBounds.call(this,e);if(!t)for(var i=0,r=this.children.length;i<r;++i){var n=this.children[i];n.visible&&n.updateTransform()}return e},l.prototype._calculateBounds=function(){},l.prototype.render=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else{this._render(e);for(var t=0,i=this.children.length;t<i;++t)this.children[t].render(e)}},l.prototype.renderAdvanced=function(e){e.batch.flush();var t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]);for(var r=this._enabledFilters.length=0;r<t.length;r++)t[r].enabled&&this._enabledFilters.push(t[r]);this._enabledFilters.length&&e.filter.push(this,this._enabledFilters)}i&&e.mask.push(this,this._mask),this._render(e);for(var r=0,n=this.children.length;r<n;r++)this.children[r].render(e);e.batch.flush(),i&&e.mask.pop(this),t&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},l.prototype._render=function(e){},l.prototype.destroy=function(e){_i.prototype.destroy.call(this),this.sortDirty=!1;var t="boolean"==typeof e?e:e&&e.children,i=this.removeChildren(0,this.children.length);if(t)for(var r=0;r<i.length;++r)i[r].destroy(e)},Object.defineProperty(l.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e},enumerable:!1,configurable:!0});var _i,yi=l;function l(){var e=_i.call(this)||this;return e.children=[],e.sortableChildren=_.SORTABLE_CHILDREN,e.sortDirty=!1,e}yi.prototype.containerUpdateTransform=yi.prototype.updateTransform;$={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};r.mixin($);Object.defineProperty(gi.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(gi.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),gi.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessability for this content",t.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t},gi.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},gi.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},gi.prototype.deactivate=function(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},gi.prototype.updateAccessibleObjects=function(e){if(e.visible&&e.accessibleChildren){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}},gi.prototype.update=function(){var e=performance.now();if(!(ie.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),t=this.renderer.resolution,i=e.width/this.renderer.width*t,r=e.height/this.renderer.height*t;(o=this.div).style.left=e.left+"px",o.style.top=e.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var n=0;n<this.children.length;n++){var o,s,a,h=this.children[n];h.renderId!==this.renderId?(h._accessibleActive=!1,ct(this.children,n,1),this.div.removeChild(h._accessibleDiv),this.pool.push(h._accessibleDiv),h._accessibleDiv=null,n--):(o=h._accessibleDiv,s=h.hitArea,a=h.worldTransform,h.hitArea?(o.style.left=(a.tx+s.x*a.a)*i+"px",o.style.top=(a.ty+s.y*a.d)*r+"px",o.style.width=s.width*a.a*i+"px",o.style.height=s.height*a.d*r+"px"):(s=h.getBounds(),this.capHitArea(s),o.style.left=s.x*i+"px",o.style.top=s.y*r+"px",o.style.width=s.width*i+"px",o.style.height=s.height*r+"px",o.title!==h.accessibleTitle&&null!==h.accessibleTitle&&(o.title=h.accessibleTitle),o.getAttribute("aria-label")!==h.accessibleHint&&null!==h.accessibleHint&&o.setAttribute("aria-label",h.accessibleHint)),h.accessibleTitle===o.title&&h.tabIndex===o.tabIndex||(o.title=h.accessibleTitle,o.tabIndex=h.tabIndex,this.debug&&this.updateDebugHTML(o)))}this.renderId++}},gi.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},gi.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},gi.prototype.addChild=function(e){var t=this.pool.pop();t||((t=document.createElement("button")).style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2..toString(),t.style.borderStyle="none",-1<navigator.userAgent.toLowerCase().indexOf("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title="displayObject "+e.tabIndex),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,(e._accessibleDiv=t).displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},gi.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData),t.dispatchEvent(e.target.displayObject,"pointertap",t.eventData),t.dispatchEvent(e.target.displayObject,"tap",t.eventData)},gi.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},gi.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},gi.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},gi.prototype._onMouseMove=function(e){0===e.movementX&&0===e.movementY||this.deactivate()},gi.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null};t=gi;function gi(e){this._hookDiv=null,(ie.tablet||ie.phone)&&this.createTouchHook();var t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2..toString(),this.div=t,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}_.TARGET_FPMS=.06,(n=q.UPDATE_PRIORITY||(q.UPDATE_PRIORITY={}))[n.INTERACTION=50]="INTERACTION",n[n.HIGH=25]="HIGH",n[n.NORMAL=0]="NORMAL",n[n.LOW=-25]="LOW",n[n.UTILITY=-50]="UTILITY";Ii.prototype.match=function(e,t){return void 0===t&&(t=null),this.fn===e&&this.context===t},Ii.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},Ii.prototype.connect=function(e){(this.previous=e).next&&(e.next.previous=this),this.next=e.next,e.next=this},Ii.prototype.destroy=function(e){void 0===e&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t};var vi=Ii,bi=(c.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},c.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},c.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},c.prototype.add=function(e,t,i){return void 0===i&&(i=q.UPDATE_PRIORITY.NORMAL),this._addListener(new vi(e,t,i))},c.prototype.addOnce=function(e,t,i){return void 0===i&&(i=q.UPDATE_PRIORITY.NORMAL),this._addListener(new vi(e,t,i,!0))},c.prototype._addListener=function(e){var t=this._head.next,i=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(i);break}t=(i=t).next}e.previous||e.connect(i)}else e.connect(i);return this._startIfPossible(),this},c.prototype.remove=function(e,t){for(var i=this._head.next;i;)i=i.match(e,t)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(c.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,t=this._head;t=t.next;)e++;return e},enumerable:!1,configurable:!0}),c.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},c.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},c.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},c.prototype.update=function(e){var t;if((e=void 0===e?performance.now():e)>this.lastTime){if((t=this.elapsedMS=e-this.lastTime)>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var i=e-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=e-i%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*_.TARGET_FPMS;for(var i=this._head,r=i.next;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(c.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){e=Math.min(this.maxFPS,e),e=Math.min(Math.max(0,e)/1e3,_.TARGET_FPMS);this._maxElapsedMS=1/e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){0===e?this._minElapsedMS=0:(e=Math.max(this.minFPS,e),this._minElapsedMS=1/(e/1e3))},enumerable:!1,configurable:!0}),Object.defineProperty(c,"shared",{get:function(){var e;return c._shared||((e=c._shared=new c).autoStart=!0,e._protected=!0),c._shared},enumerable:!1,configurable:!0}),Object.defineProperty(c,"system",{get:function(){var e;return c._system||((e=c._system=new c).autoStart=!0,e._protected=!0),c._system},enumerable:!1,configurable:!0}),c),J=(Ei.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),(this._ticker=e)&&e.add(this.render,this,q.UPDATE_PRIORITY.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?bi.shared:new bi,e.autoStart&&this.start()},Ei.destroy=function(){var e;this._ticker&&(e=this._ticker,this.ticker=null,e.destroy())},Ei),xi=(Object.defineProperty(Ti.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),Ti.prototype.getLocalPosition=function(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)},Ti.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var t="buttons"in e&&e.buttons;this.buttons=Number.isInteger(t)?t:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},Ti.prototype.reset=function(){this.isPrimary=!1},Ti),wi=function(e,t){return(wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Ti(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Rt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}function Ei(){}function c(){var t=this;this._head=new vi(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/_.TARGET_FPMS,this.elapsedMS=1/_.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&null===t._requestId&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}function Ii(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=0),void 0===r&&(r=!1),this.fn=e,this.context=t,this.priority=i,this.once=r,this.next=null,this.previous=null,this._destroyed=!1}Mi.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},Mi.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var Pi=Mi,Si=(Oi.prototype._doSet=function(e,t){this._flags=t?this._flags|e:this._flags&~e},Object.defineProperty(Oi.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(Oi.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(Oi.prototype,"none",{get:function(){return this._flags===Oi.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(Oi.prototype,"over",{get:function(){return 0!=(this._flags&Oi.FLAGS.OVER)},set:function(e){this._doSet(Oi.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(Oi.prototype,"rightDown",{get:function(){return 0!=(this._flags&Oi.FLAGS.RIGHT_DOWN)},set:function(e){this._doSet(Oi.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(Oi.prototype,"leftDown",{get:function(){return 0!=(this._flags&Oi.FLAGS.LEFT_DOWN)},set:function(e){this._doSet(Oi.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),Oi.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),Oi),Ai=(ki.prototype.recursiveFindHit=function(e,t,i,r,n){if(!t||!t.visible)return!1;var o=e.data.global,s=!1,a=n=t.interactive||n,h=!0;if(t.hitArea?(r&&(t.worldTransform.applyInverse(o,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?s=!0:h=r=!1),a=!1):t._mask&&r&&(t._mask.containsPoint&&t._mask.containsPoint(o)||(r=!1)),h&&t.interactiveChildren&&t.children)for(var u=t.children,l=u.length-1;0<=l;l--){var c=u[l],p=this.recursiveFindHit(e,c,i,r,a);p&&c.parent&&(a=!1,p&&(e.target&&(r=!1),s=!0))}return n&&(r&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(o)&&(s=!0),t.interactive&&(s&&!e.target&&(e.target=t),i&&i(e,t,!!s))),s},ki.prototype.findHit=function(e,t,i,r){this.recursiveFindHit(e,t,i,r,!1)},ki),o={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(e){e?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};function ki(){this._tempPoint=new Rt}function Oi(e){this._pointerId=e,this._flags=Oi.FLAGS.NONE}function Mi(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}r.mixin(o);var Ci,Ri,Di={target:null,data:{global:null}},Q=(wi(Ri=p,s=Ci=e),Ri.prototype=null===s?Object.create(s):(Fi.prototype=s.prototype,new Fi),Object.defineProperty(p.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(e){(this._useSystemTicker=e)?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),p.prototype.hitTest=function(e,t){return Di.target=null,Di.data.global=e,t=t||this.lastObjectRendered,this.processInteractive(Di,t,null,!0),Di.target},p.prototype.setTargetElement=function(e,t){void 0===t&&(t=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=e,this.resolution=t,this.addEvents(),this.addTickerListener()},p.prototype.addTickerListener=function(){!this.tickerAdded&&this.interactionDOMElement&&this._useSystemTicker&&(bi.system.add(this.tickerUpdate,this,q.UPDATE_PRIORITY.INTERACTION),this.tickerAdded=!0)},p.prototype.removeTickerListener=function(){this.tickerAdded&&(bi.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},p.prototype.addEvents=function(){var e;!this.eventsAdded&&this.interactionDOMElement&&(e=this.interactionDOMElement.style,window.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},p.prototype.removeEvents=function(){var e;this.eventsAdded&&this.interactionDOMElement&&(e=this.interactionDOMElement.style,window.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},p.prototype.tickerUpdate=function(e){this._deltaTime+=e,this._deltaTime<this.interactionFrequency||(this._deltaTime=0,this.update())},p.prototype.update=function(){if(this.interactionDOMElement)if(this._didMove)this._didMove=!1;else{for(var e in this.cursor=null,this.activeInteractionData)!this.activeInteractionData.hasOwnProperty(e)||(e=this.activeInteractionData[e]).originalEvent&&"touch"!==e.pointerType&&(e=this.configureInteractionEventForDOMEvent(this.eventData,e.originalEvent,e),this.processInteractive(e,this.lastObjectRendered,this.processPointerOverOut,!0));this.setCursorMode(this.cursor)}},p.prototype.setCursorMode=function(e){if(this.currentCursorMode!==(e=e||"default")){this.currentCursorMode=e;var t=this.cursorStyles[e];if(t)switch(typeof t){case"string":this.interactionDOMElement.style.cursor=t;break;case"function":t(e);break;case"object":Object.assign(this.interactionDOMElement.style,t)}else"string"!=typeof e||Object.prototype.hasOwnProperty.call(this.cursorStyles,e)||(this.interactionDOMElement.style.cursor=e)}},p.prototype.dispatchEvent=function(e,t,i){i.stopPropagationHint&&e!==i.stopsPropagatingAt||(i.currentTarget=e,i.type=t,e.emit(t,i),e[t]&&e[t](i))},p.prototype.delayDispatchEvent=function(e,t,i){this.delayedEvents.push({displayObject:e,eventString:t,eventData:i})},p.prototype.mapPositionToPoint=function(e,t,i){var r=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0},n=1/this.resolution;e.x=(t-r.left)*(this.interactionDOMElement.width/r.width)*n,e.y=(i-r.top)*(this.interactionDOMElement.height/r.height)*n},p.prototype.processInteractive=function(e,t,i,r){var t=this.search.findHit(e,t,i,r),n=this.delayedEvents;if(n.length){e.stopPropagationHint=!1;var o=n.length;this.delayedEvents=[];for(var s=0;s<o;s++){var a=n[s],h=a.displayObject,u=a.eventString,a=a.eventData;a.stopsPropagatingAt===h&&(a.stopPropagationHint=!0),this.dispatchEvent(h,u,a)}}return t},p.prototype.onPointerDown=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(!e.cancelable&&"cancelable"in e||e.preventDefault());for(var i=t.length,r=0;r<i;r++){var n=t[r],o=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,o);o.data.originalEvent=e,this.processInteractive(o,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",o),"touch"===n.pointerType?this.emit("touchstart",o):"mouse"!==n.pointerType&&"pen"!==n.pointerType||(o=2===n.button,this.emit(o?"rightdown":"mousedown",this.eventData))}}},p.prototype.processPointerDown=function(e,t,i){var r=e.data,n=e.data.identifier;i&&(t.trackedPointers[n]||(t.trackedPointers[n]=new Si(n)),this.dispatchEvent(t,"pointerdown",e),"touch"===r.pointerType?this.dispatchEvent(t,"touchstart",e):"mouse"!==r.pointerType&&"pen"!==r.pointerType||((i=2===r.button)?t.trackedPointers[n].rightDown=!0:t.trackedPointers[n].leftDown=!0,this.dispatchEvent(t,i?"rightdown":"mousedown",e)))},p.prototype.onPointerComplete=function(e,t,i){for(var r=this.normalizeToPointerData(e),n=r.length,o=e.target!==this.interactionDOMElement?"outside":"",s=0;s<n;s++){var a,h=r[s],u=this.getInteractionDataForPointerId(h),u=this.configureInteractionEventForDOMEvent(this.eventData,h,u);u.data.originalEvent=e,this.processInteractive(u,this.lastObjectRendered,i,t||!o),this.emit(t?"pointercancel":"pointerup"+o,u),"mouse"===h.pointerType||"pen"===h.pointerType?(a=2===h.button,this.emit(a?"rightup"+o:"mouseup"+o,u)):"touch"===h.pointerType&&(this.emit(t?"touchcancel":"touchend"+o,u),this.releaseInteractionDataForPointerId(h.pointerId))}},p.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!0,this.processPointerCancel)},p.prototype.processPointerCancel=function(e,t){var i=e.data,r=e.data.identifier;void 0!==t.trackedPointers[r]&&(delete t.trackedPointers[r],this.dispatchEvent(t,"pointercancel",e),"touch"===i.pointerType&&this.dispatchEvent(t,"touchcancel",e))},p.prototype.onPointerUp=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!1,this.processPointerUp)},p.prototype.processPointerUp=function(e,t,i){var r,n=e.data,o=e.data.identifier,s=t.trackedPointers[o],a="touch"===n.pointerType,h="mouse"===n.pointerType||"pen"===n.pointerType,u=!1;h&&(n=2===n.button,r=Si.FLAGS,r=n?r.RIGHT_DOWN:r.LEFT_DOWN,r=void 0!==s&&s.flags&r,i?(this.dispatchEvent(t,n?"rightup":"mouseup",e),r&&(this.dispatchEvent(t,n?"rightclick":"click",e),u=!0)):r&&this.dispatchEvent(t,n?"rightupoutside":"mouseupoutside",e),s&&(n?s.rightDown=!1:s.leftDown=!1)),i?(this.dispatchEvent(t,"pointerup",e),a&&this.dispatchEvent(t,"touchend",e),s&&(h&&!u||this.dispatchEvent(t,"pointertap",e),a&&(this.dispatchEvent(t,"tap",e),s.over=!1))):s&&(this.dispatchEvent(t,"pointerupoutside",e),a&&this.dispatchEvent(t,"touchendoutside",e)),s&&s.none&&delete t.trackedPointers[o]},p.prototype.onPointerMove=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);"mouse"!==t[0].pointerType&&"pen"!==t[0].pointerType||(this._didMove=!0,this.cursor=null);for(var i=t.length,r=0;r<i;r++){var n=t[r],o=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,o);o.data.originalEvent=e,this.processInteractive(o,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",o),"touch"===n.pointerType&&this.emit("touchmove",o),"mouse"!==n.pointerType&&"pen"!==n.pointerType||this.emit("mousemove",o)}"mouse"===t[0].pointerType&&this.setCursorMode(this.cursor)}},p.prototype.processPointerMove=function(e,t,i){var r=e.data,n="touch"===r.pointerType,r="mouse"===r.pointerType||"pen"===r.pointerType;r&&this.processPointerOverOut(e,t,i),this.moveWhenInside&&!i||(this.dispatchEvent(t,"pointermove",e),n&&this.dispatchEvent(t,"touchmove",e),r&&this.dispatchEvent(t,"mousemove",e))},p.prototype.onPointerOut=function(e){var t,i;this.supportsTouchEvents&&"touch"===e.pointerType||("mouse"===(e=this.normalizeToPointerData(e)[0]).pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null)),t=this.getInteractionDataForPointerId(e),(i=this.configureInteractionEventForDOMEvent(this.eventData,e,t)).data.originalEvent=e,this.processInteractive(i,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",i),"mouse"===e.pointerType||"pen"===e.pointerType?this.emit("mouseout",i):this.releaseInteractionDataForPointerId(t.identifier))},p.prototype.processPointerOverOut=function(e,t,i){var r=e.data,n=e.data.identifier,r="mouse"===r.pointerType||"pen"===r.pointerType,o=t.trackedPointers[n];void 0!==(o=i&&!o?t.trackedPointers[n]=new Si(n):o)&&(i&&this.mouseOverRenderer?(o.over||(o.over=!0,this.delayDispatchEvent(t,"pointerover",e),r&&this.delayDispatchEvent(t,"mouseover",e)),r&&null===this.cursor&&(this.cursor=t.cursor)):o.over&&(o.over=!1,this.dispatchEvent(t,"pointerout",this.eventData),r&&this.dispatchEvent(t,"mouseout",e),o.none&&delete t.trackedPointers[n]))},p.prototype.onPointerOver=function(e){var e=this.normalizeToPointerData(e)[0],t=this.getInteractionDataForPointerId(e),t=this.configureInteractionEventForDOMEvent(this.eventData,e,t);"mouse"===(t.data.originalEvent=e).pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",t),"mouse"!==e.pointerType&&"pen"!==e.pointerType||this.emit("mouseover",t)},p.prototype.getInteractionDataForPointerId=function(e){var t,i=e.pointerId;return 1===i||"mouse"===e.pointerType?t=this.mouse:this.activeInteractionData[i]?t=this.activeInteractionData[i]:((t=this.interactionDataPool.pop()||new xi).identifier=i,this.activeInteractionData[i]=t),t.copyEvent(e),t},p.prototype.releaseInteractionDataForPointerId=function(e){var t=this.activeInteractionData[e];t&&(delete this.activeInteractionData[e],t.reset(),this.interactionDataPool.push(t))},p.prototype.configureInteractionEventForDOMEvent=function(e,t,i){return e.data=i,this.mapPositionToPoint(i.global,t.clientX,t.clientY),"touch"===t.pointerType&&(t.globalX=i.global.x,t.globalY=i.global.y),i.originalEvent=t,e.reset(),e},p.prototype.normalizeToPointerData=function(e){var t,i=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var r=0,n=e.changedTouches.length;r<n;r++){var o=e.changedTouches[r];void 0===o.button&&(o.button=e.touches.length?1:0),void 0===o.buttons&&(o.buttons=e.touches.length?1:0),void 0===o.isPrimary&&(o.isPrimary=1===e.touches.length&&"touchstart"===e.type),void 0===o.width&&(o.width=o.radiusX||1),void 0===o.height&&(o.height=o.radiusY||1),void 0===o.tiltX&&(o.tiltX=0),void 0===o.tiltY&&(o.tiltY=0),void 0===o.pointerType&&(o.pointerType="touch"),void 0===o.pointerId&&(o.pointerId=o.identifier||0),void 0===o.pressure&&(o.pressure=o.force||.5),void 0===o.twist&&(o.twist=0),void 0===o.tangentialPressure&&(o.tangentialPressure=0),void 0===o.layerX&&(o.layerX=o.offsetX=o.clientX),void 0===o.layerY&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,i.push(o)}else!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof window.PointerEvent?i.push(e):(void 0===(t=e).isPrimary&&(t.isPrimary=!0),void 0===t.width&&(t.width=1),void 0===t.height&&(t.height=1),void 0===t.tiltX&&(t.tiltX=0),void 0===t.tiltY&&(t.tiltY=0),void 0===t.pointerType&&(t.pointerType="mouse"),void 0===t.pointerId&&(t.pointerId=1),void 0===t.pressure&&(t.pressure=.5),void 0===t.twist&&(t.twist=0),void 0===t.tangentialPressure&&(t.tangentialPressure=0),t.isNormalized=!0,i.push(t));return i},p.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},p),Li=(Ni.prototype.emit=function(e,t,i,r,n,o,s,a){if(8<arguments.length)throw new Error("max arguments reached");var h=this.name,u=this.items;this._aliasCount++;for(var l=0,c=u.length;l<c;l++)u[l][h](e,t,i,r,n,o,s,a);return u===this.items&&this._aliasCount--,this},Ni.prototype.ensureNonAliasedItems=function(){0<this._aliasCount&&1<this.items.length&&(this._aliasCount=0,this.items=this.items.slice(0))},Ni.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},Ni.prototype.remove=function(e){e=this.items.indexOf(e);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},Ni.prototype.contains=function(e){return-1!==this.items.indexOf(e)},Ni.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},Ni.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(Ni.prototype,"empty",{get:function(){return 0===this.items.length},enumerable:!1,configurable:!0}),Object.defineProperty(Ni.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Ni);function Ni(e){this.items=[],this._name=e,this._aliasCount=0}function p(e,t){var i=Ci.call(this)||this;return t=t||{},i.renderer=e,i.autoPreventDefault=void 0===t.autoPreventDefault||t.autoPreventDefault,i.interactionFrequency=t.interactionFrequency||10,i.mouse=new xi,i.mouse.identifier=1,i.mouse.global.set(-999999),i.activeInteractionData={},i.activeInteractionData[1]=i.mouse,i.interactionDataPool=[],i.eventData=new Pi,i.interactionDOMElement=null,i.moveWhenInside=!1,i.eventsAdded=!1,i.tickerAdded=!1,i.mouseOverRenderer=!1,i.supportsTouchEvents="ontouchstart"in window,i.supportsPointerEvents=!!window.PointerEvent,i.onPointerUp=i.onPointerUp.bind(i),i.processPointerUp=i.processPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.processPointerCancel=i.processPointerCancel.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.processPointerDown=i.processPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.processPointerMove=i.processPointerMove.bind(i),i.onPointerOut=i.onPointerOut.bind(i),i.processPointerOverOut=i.processPointerOverOut.bind(i),i.onPointerOver=i.onPointerOver.bind(i),i.cursorStyles={default:"inherit",pointer:"pointer"},i.currentCursorMode=null,i.cursor=null,i.resolution=1,i.delayedEvents=[],i.search=new Ai,i._tempDisplayObject=new di,i._useSystemTicker=void 0===t.useSystemTicker||t.useSystemTicker,i.setTargetElement(i.renderer.view,i.renderer.resolution),i}function Fi(){this.constructor=Ri}Object.defineProperties(Li.prototype,{dispatch:{value:Li.prototype.emit},run:{value:Li.prototype.emit}}),_.PREFER_ENV=ie.any?q.ENV.WEBGL:q.ENV.WEBGL2,_.STRICT_TEXTURE_CACHE=!1;var Bi=[];function Xi(e,t){if(!e)return null;var i,r="";"string"==typeof e&&(i=/\.(\w{3,4})(?:$|\?|#)/i.exec(e))&&(r=i[1].toLowerCase());for(var n=Bi.length-1;0<=n;--n){var o=Bi[n];if(o.test&&o.test(e,r))return new o(e,t)}throw new Error("Unrecognized source type to auto-detect Resource")}var Ui=function(e,t){return(Ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function d(e,t){function i(){this.constructor=e}Ui(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}dr.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},dr.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},dr.prototype.resize=function(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(dr.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),dr.prototype.update=function(){this.destroyed||this.onUpdate.emit()},dr.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(dr.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(dr.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),dr.prototype.style=function(e,t,i){return!1},dr.prototype.dispose=function(){},dr.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},dr.test=function(e,t){return!1};var ji,Hi,Gi,zi,Wi,Yi,Vi,qi,Zi,Ki,$i,Ji=dr,Qi=(d(pr,$i=Ji),pr.prototype.upload=function(e,t,i){e=e.gl;return e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===q.ALPHA_MODES.UNPACK),i.width===t.width&&i.height===t.height?e.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.type,this.data):(i.width=t.width,i.height=t.height,e.texImage2D(t.target,0,i.internalFormat,t.width,t.height,0,t.format,i.type,this.data)),!0},pr.prototype.dispose=function(){this.data=null},pr.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},pr),er={scaleMode:q.SCALE_MODES.NEAREST,format:q.FORMATS.RGBA,alphaMode:q.ALPHA_MODES.NPM},D=(d(g,Ki=e),Object.defineProperty(g.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),g.prototype.setStyle=function(e,t){var i;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this},g.prototype.setSize=function(e,t,i){return this.resolution=i||this.resolution,this.width=e,this.height=t,this._refreshPOT(),this.update(),this},g.prototype.setRealSize=function(e,t,i){return this.resolution=i||this.resolution,this.width=e/this.resolution,this.height=t/this.resolution,this._refreshPOT(),this.update(),this},g.prototype._refreshPOT=function(){this.isPowerOfTwo=ut(this.realWidth)&&ut(this.realHeight)},g.prototype.setResolution=function(e){var t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=this.width*t/e,this.height=this.height*t/e,this.emit("update",this)),this._refreshPOT()),this},g.prototype.setResource=function(e){if(this.resource!==e){if(this.resource)throw new Error("Resource can be set only once");e.bind(this),this.resource=e}return this},g.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):0<this.width&&0<this.height&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},g.prototype.onError=function(e){this.emit("error",this,e)},g.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete gt[this.cacheId],delete yt[this.cacheId],this.cacheId=null),this.dispose(),g.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},g.prototype.dispose=function(){this.emit("dispose",this)},g.prototype.castToBaseTexture=function(){return this},g.from=function(e,t,i){void 0===i&&(i=_.STRICT_TEXTURE_CACHE);var r="string"==typeof e,n=null,n=r?e:(e._pixiId||(e._pixiId="pixiid_"+ ++dt),e._pixiId),o=gt[n];if(r&&i&&!o)throw new Error('The cacheId "'+n+'" does not exist in BaseTextureCache.');return o||((o=new g(e,t)).cacheId=n,g.addToCache(o,n)),o},g.fromBuffer=function(e,t,i,r){e=e||new Float32Array(t*i*4);var n=new Qi(e,{width:t,height:i}),e=e instanceof Float32Array?q.TYPES.FLOAT:q.TYPES.UNSIGNED_BYTE;return new g(n,Object.assign(er,r||{width:t,height:i,type:e}))},g.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),gt[t]&&console.warn("BaseTexture added to the cache with an id ["+t+"] that already had an entry"),gt[t]=e)},g.removeFromCache=function(e){if("string"==typeof e){var t,i=gt[e];if(i)return-1<(t=i.textureCacheIds.indexOf(e))&&i.textureCacheIds.splice(t,1),delete gt[e],i}else if(e&&e.textureCacheIds){for(var r=0;r<e.textureCacheIds.length;++r)delete gt[e.textureCacheIds[r]];return e.textureCacheIds.length=0,e}return null},g._globalBatch=0,g),te=(d(cr,Zi=Ji),cr.prototype.initFromArray=function(e,t){for(var i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof Ji?this.addResourceAt(e[i],i):this.addResourceAt(Xi(e[i],t),i))},cr.prototype.dispose=function(){for(var e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},cr.prototype.addResourceAt=function(e,t){if(this.items[t])return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this;throw new Error("Index "+t+" is out of bounds")},cr.prototype.bind=function(e){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");Zi.prototype.bind.call(this,e);for(var t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)},cr.prototype.unbind=function(e){Zi.prototype.unbind.call(this,e);for(var t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)},cr.prototype.load=function(){var e,i=this;return this._load||(e=this.items.map(function(e){return e.resource}).filter(function(e){return e}).map(function(e){return e.load()}),this._load=Promise.all(e).then(function(){var e=i.items[0],t=e.realWidth,e=e.realHeight;return i.resize(t,e),Promise.resolve(i)})),this._load},cr),m=(d(lr,qi=te),lr.prototype.addBaseTextureAt=function(e,t){if(e.resource)return this.addResourceAt(e.resource,t),this;throw new Error("ArrayResource does not support RenderTexture")},lr.prototype.bind=function(e){qi.prototype.bind.call(this,e),e.target=q.TARGETS.TEXTURE_2D_ARRAY},lr.prototype.upload=function(e,t,i){var r=this.length,n=this.itemDirtyIds,o=this.items,s=e.gl;i.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,t.format,this._width,this._height,r,0,t.format,t.type,null);for(var a=0;a<r;a++){var h=o[a];n[a]<h.dirtyId&&(n[a]=h.dirtyId,h.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,h.resource.width,h.resource.height,1,t.format,t.type,h.resource.source))}return!0},lr),tr=(d(ur,Vi=Ji),ur.crossOrigin=function(e,t,i){void 0===i&&0!==t.indexOf("data:")?e.crossOrigin=Et(t):!1!==i&&(e.crossOrigin="string"==typeof i?i:"anonymous")},ur.prototype.upload=function(e,t,i,r){var e=e.gl,n=t.realWidth,o=t.realHeight;return r=r||this.source,e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===q.ALPHA_MODES.UNPACK),this.noSubImage||t.target!==e.TEXTURE_2D||i.width!==n||i.height!==o?(i.width=n,i.height=o,e.texImage2D(t.target,0,t.format,t.format,t.type,r)):e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.format,t.type,r),!0},ur.prototype.update=function(){var e,t;this.destroyed||(e=(t=this.source).naturalWidth||t.videoWidth||t.width,t=t.naturalHeight||t.videoHeight||t.height,this.resize(e,t),Vi.prototype.update.call(this))},ur.prototype.dispose=function(){this.source=null},ur),ee=(d(hr,Yi=tr),hr.test=function(e){var t=window.OffscreenCanvas;return!!(t&&e instanceof t)||e instanceof HTMLCanvasElement},hr),y=(d(ar,Wi=te),ar.prototype.bind=function(e){Wi.prototype.bind.call(this,e),e.target=q.TARGETS.TEXTURE_CUBE_MAP},ar.prototype.addBaseTextureAt=function(e,t,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[t])throw new Error("Index "+t+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||0<Object.keys(e._glTextures).length){if(!e.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(e.resource,t)}else e.target=q.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this},ar.prototype.upload=function(e,t,i){for(var r=this.itemDirtyIds,n=0;n<ar.SIDES;n++){var o=this.items[n];r[n]<o.dirtyId&&(o.valid&&o.resource?(o.resource.upload(e,o,i),r[n]=o.dirtyId):r[n]<-1&&(e.gl.texImage2D(o.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),r[n]=-1))}return!0},ar.test=function(e){return Array.isArray(e)&&e.length===ar.SIDES},ar.SIDES=6,ar),ir=(d(sr,zi=tr),sr.prototype.load=function(e){var n=this;return this._load||(void 0!==e&&(this.createBitmap=e),this._load=new Promise(function(e,t){function i(){n.destroyed||(r.onload=null,r.onerror=null,n.resize(r.width,r.height),n._load=null,n.createBitmap?e(n.process()):e(n))}var r=n.source;n.url=r.src;r.complete&&r.src?i():(r.onload=i,r.onerror=function(e){t(e),n.onError.emit(e)})}),this._load)},sr.prototype.process=function(){var t=this,e=this.source;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(e,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===q.ALPHA_MODES.UNPACK?"premultiply":"none"}).then(function(e){return t.destroyed?Promise.reject():(t.bitmap=e,t.update(),t._process=null,Promise.resolve(t))}),this._process):Promise.resolve(this)},sr.prototype.upload=function(e,t,i){if("number"==typeof this.alphaMode&&(t.alphaMode=this.alphaMode),!this.createBitmap)return zi.prototype.upload.call(this,e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(zi.prototype.upload.call(this,e,t,i,this.bitmap),!this.preserveBitmap){var r,n=!0,o=t._glTextures;for(r in o){var s=o[r];if(s!==i&&s.dirtyId!==t.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},sr.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,zi.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},sr.test=function(e){return"string"==typeof e||e instanceof HTMLImageElement},sr),F=(d(or,Gi=tr),or.prototype.load=function(){var t=this;return this._load||(this._load=new Promise(function(e){if(t._resolve=function(){t.resize(t.source.width,t.source.height),e(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},or.prototype._loadSvg=function(){var o=this,s=new Image;tr.crossOrigin(s,this.svg,this._crossorigin),s.src=this.svg,s.onerror=function(e){o._resolve&&(s.onerror=null,o.onError.emit(e))},s.onload=function(){if(o._resolve){var e=s.width,t=s.height;if(!e||!t)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=e*o.scale,r=t*o.scale,n=((o._overrideWidth||o._overrideHeight)&&(i=o._overrideWidth||o._overrideHeight/t*e,r=o._overrideHeight||o._overrideWidth/e*t),i=Math.round(i),r=Math.round(r),o.source);n.width=i,n.height=r,n._pixiId="canvas_"+ ++dt,n.getContext("2d").drawImage(s,0,0,e,t,0,0,i,r),o._resolve(),o._resolve=null}}},or.getSize=function(e){var e=or.SVG_SIZE.exec(e),t={};return e&&(t[e[1]]=Math.round(parseFloat(e[3])),t[e[5]]=Math.round(parseFloat(e[7]))),t},or.prototype.dispose=function(){Gi.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},or.test=function(e,t){return"svg"===t||"string"==typeof e&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(e)||"string"==typeof e&&0===e.indexOf("<svg")},or.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,or),V=(d(nr,Hi=tr),nr.prototype.update=function(e){void 0===e&&(e=0),this.destroyed||(e=bi.shared.elapsedMS*this.source.playbackRate,this._msToNextUpdate=Math.floor(this._msToNextUpdate-e),(!this._updateFPS||this._msToNextUpdate<=0)&&(Hi.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0))},nr.prototype.load=function(){var t,i=this;return this._load||(((t=this.source).readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise(function(e){i.valid?e(i):(i._resolve=e,t.load())})),this._load},nr.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},nr.prototype._isSourcePlaying=function(){var e=this.source;return 0<e.currentTime&&!1===e.paused&&!1===e.ended&&2<e.readyState},nr.prototype._isSourceReady=function(){var e=this.source;return 3===e.readyState||4===e.readyState},nr.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(bi.shared.add(this.update,this),this._isConnectedToTicker=!0)},nr.prototype._onPlayStop=function(){this._isConnectedToTicker&&(bi.shared.remove(this.update,this),this._isConnectedToTicker=!1)},nr.prototype._onCanPlay=function(){var e=this.source,t=(e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),this.valid);this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},nr.prototype.dispose=function(){this._isConnectedToTicker&&bi.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),Hi.prototype.dispose.call(this)},Object.defineProperty(nr.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(bi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(bi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(nr.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),nr.test=function(e,t){return e instanceof HTMLVideoElement||-1<nr.TYPES.indexOf(t)},nr.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],nr.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},nr),Le=(d(rr,ji=tr),rr.test=function(e){return!!window.createImageBitmap&&e instanceof ImageBitmap},rr);function rr(){return null!==ji&&ji.apply(this,arguments)||this}function nr(e,t){var i=this;if(t=t||{},!(e instanceof HTMLVideoElement)){var r=document.createElement("video"),n=(r.setAttribute("preload","auto"),r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline",""),(e="string"==typeof e?[e]:e)[0].src||e[0]);tr.crossOrigin(r,n,t.crossorigin);for(var o=0;o<e.length;++o){var s=document.createElement("source"),a=e[o],h=a.src,a=a.mime,u=(h=h||e[o]).split("?").shift().toLowerCase(),u=u.substr(u.lastIndexOf(".")+1),a=a||nr.MIME_TYPES[u]||"video/"+u;s.src=h,s.type=a,r.appendChild(s)}e=r}return(i=Hi.call(this,e)||this).noSubImage=!0,i._autoUpdate=!0,i._isConnectedToTicker=!1,i._updateFPS=t.updateFPS||0,i._msToNextUpdate=0,i.autoPlay=!1!==t.autoPlay,i._load=null,i._resolve=null,i._onCanPlay=i._onCanPlay.bind(i),i._onError=i._onError.bind(i),!1!==t.autoLoad&&i.load(),i}function or(e,t){var i=this;return t=t||{},(i=Gi.call(this,document.createElement("canvas"))||this)._width=0,i._height=0,i.svg=e,i.scale=t.scale||1,i._overrideWidth=t.width,i._overrideHeight=t.height,i._resolve=null,i._crossorigin=t.crossorigin,i._load=null,!1!==t.autoLoad&&i.load(),i}function sr(e,t){var i,r=this;return t=t||{},e instanceof HTMLImageElement||(i=new Image,tr.crossOrigin(i,e,t.crossorigin),i.src=e,e=i),r=zi.call(this,e)||this,!e.complete&&r._width&&r._height&&(r._width=0,r._height=0),r.url=e.src,r._process=null,r.preserveBitmap=!1,r.createBitmap=(void 0!==t.createBitmap?t.createBitmap:_.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,r.alphaMode="number"==typeof t.alphaMode?t.alphaMode:null,void 0!==t.premultiplyAlpha&&(r.premultiplyAlpha=t.premultiplyAlpha),r.bitmap=null,r._load=null,!1!==t.autoLoad&&r.load(),r}function ar(e,t){var i=this,r=t||{},n=r.width,o=r.height,s=r.autoLoad,r=r.linkBaseTexture;if(e&&e.length!==ar.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");for(var i=Wi.call(this,6,{width:n,height:o})||this,a=0;a<ar.SIDES;a++)i.items[a].target=q.TARGETS.TEXTURE_CUBE_MAP_POSITIVE_X+a;return i.linkBaseTexture=!1!==r,e&&i.initFromArray(e,t),!1!==s&&i.load(),i}function hr(){return null!==Yi&&Yi.apply(this,arguments)||this}function ur(e){var t=this,i=e.naturalWidth||e.videoWidth||e.width,r=e.naturalHeight||e.videoHeight||e.height;return(t=Vi.call(this,i,r)||this).source=e,t.noSubImage=!1,t}function lr(e,t){var i,r=this,n=t||{},o=n.width,n=n.height,e=Array.isArray(e)?(i=e).length:e,r=qi.call(this,e,{width:o,height:n})||this;return i&&r.initFromArray(i,t),r}function cr(e,t){var i=this,t=t||{},r=t.width,t=t.height;(i=Zi.call(this,r,t)||this).items=[],i.itemDirtyIds=[];for(var n=0;n<e;n++){var o=new D;i.items.push(o),i.itemDirtyIds.push(-2)}return i.length=e,i._load=null,i.baseTexture=null,i}function g(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var i=Ki.call(this)||this,r=(t=t||{}).alphaMode,n=t.mipmap,o=t.anisotropicLevel,s=t.scaleMode,a=t.width,h=t.height,u=t.wrapMode,l=t.format,c=t.type,p=t.target,d=t.resolution,f=t.resourceOptions;return!e||e instanceof Ji||((e=Xi(e,f)).internal=!0),i.width=a||0,i.height=h||0,i.resolution=d||_.RESOLUTION,i.mipmap=void 0!==n?n:_.MIPMAP_TEXTURES,i.anisotropicLevel=void 0!==o?o:_.ANISOTROPIC_LEVEL,i.wrapMode=u||_.WRAP_MODE,i.scaleMode=void 0!==s?s:_.SCALE_MODE,i.format=l||q.FORMATS.RGBA,i.type=c||q.TYPES.UNSIGNED_BYTE,i.target=p||q.TARGETS.TEXTURE_2D,i.alphaMode=void 0!==r?r:q.ALPHA_MODES.UNPACK,void 0!==t.premultiplyAlpha&&(i.premultiplyAlpha=t.premultiplyAlpha),i.uid=++dt,i.touched=0,i.isPowerOfTwo=!1,i._refreshPOT(),i._glTextures={},i.dirtyId=0,i.dirtyStyleId=0,i.cacheId=null,i.valid=0<a&&0<h,i.textureCacheIds=[],i.destroyed=!1,i.resource=null,i._batchEnabled=0,i._batchLocation=0,i.parentTextureArray=null,i.setResource(e),i}function pr(e,t){var i=this,t=t||{},r=t.width,t=t.height;if(r&&t)return(i=$i.call(this,r,t)||this).data=e,i;throw new Error("BufferResource width or height invalid")}function dr(e,t){void 0===t&&(t=0),this._width=e=void 0===e?0:e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Li("setRealSize"),this.onUpdate=new Li("update"),this.onError=new Li("onError")}Bi.push(ir,Le,ee,V,F,Qi,y,m);var fr,mr,_r,i={Resource:Ji,BaseImageResource:tr,INSTALLED:Bi,autoDetectResource:Xi,AbstractMultiResource:te,ArrayResource:m,BufferResource:Qi,CanvasResource:ee,CubeResource:y,ImageResource:ir,SVGResource:F,VideoResource:V,ImageBitmapResource:Le},n=(Pr.prototype.destroy=function(){this.renderer=null},Pr),yr=(d(Ir,_r=Qi),Ir.prototype.upload=function(e,t,i){var r=e.gl;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===q.ALPHA_MODES.UNPACK),i.width===t.width&&i.height===t.height?r.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.type,this.data):(i.width=t.width,i.height=t.height,r.texImage2D(t.target,0,1===e.context.webGLVersion?r.DEPTH_COMPONENT:r.DEPTH_COMPONENT16,t.width,t.height,0,t.format,t.type,this.data)),!0},Ir),gr=(Object.defineProperty(Er.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),Er.prototype.addColorTexture=function(e,t){return this.colorTextures[e=void 0===e?0:e]=t||new D(null,{scaleMode:q.SCALE_MODES.NEAREST,resolution:1,mipmap:q.MIPMAP_MODES.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},Er.prototype.addDepthTexture=function(e){return this.depthTexture=e||new D(new yr(null,{width:this.width,height:this.height}),{scaleMode:q.SCALE_MODES.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:q.MIPMAP_MODES.OFF,format:q.FORMATS.DEPTH_COMPONENT,type:q.TYPES.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},Er.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},Er.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},Er.prototype.resize=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var i=0;i<this.colorTextures.length;i++){var r=this.colorTextures[i],n=r.resolution;r.setSize(e/n,t/n)}this.depthTexture&&(n=this.depthTexture.resolution,this.depthTexture.setSize(e/n,t/n))}},Er.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Er.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},Er),vr=(d(Tr,mr=D),Tr.prototype.resize=function(e,t){e=Math.ceil(e),t=Math.ceil(t),this.framebuffer.resize(e*this.resolution,t*this.resolution)},Tr.prototype.dispose=function(){this.framebuffer.dispose(),mr.prototype.dispose.call(this)},Tr.prototype.destroy=function(){mr.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},Tr),br=(wr.prototype.set=function(e,t,i){var r,n,o,s,a=t.width,t=t.height;i?(r=e.width/2/a,n=e.height/2/t,o=e.x/a+r,s=e.y/t+n,i=h.add(i,h.NW),this.x0=o+r*h.uX(i),this.y0=s+n*h.uY(i),i=h.add(i,2),this.x1=o+r*h.uX(i),this.y1=s+n*h.uY(i),i=h.add(i,2),this.x2=o+r*h.uX(i),this.y2=s+n*h.uY(i),i=h.add(i,2),this.x3=o+r*h.uX(i),this.y3=s+n*h.uY(i)):(this.x0=e.x/a,this.y0=e.y/t,this.x1=(e.x+e.width)/a,this.y1=e.y/t,this.x2=(e.x+e.width)/a,this.y2=(e.y+e.height)/t,this.x3=e.x/a,this.y3=(e.y+e.height)/t),this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},wr),xr=new br,K=(d(v,fr=e),v.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},v.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},v.prototype.destroy=function(e){this.baseTexture&&(e&&((e=this.baseTexture)&&e.url&&yt[e.url]&&v.removeFromCache(e.url),this.baseTexture.destroy()),this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,v.removeFromCache(this),this.textureCacheIds=null},v.prototype.clone=function(){return new v(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},v.prototype.updateUvs=function(){this._uvs===xr&&(this._uvs=new br),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},v.from=function(e,t,i){void 0===t&&(t={}),void 0===i&&(i=_.STRICT_TEXTURE_CACHE);var r="string"==typeof e,n=null,n=r?e:(e._pixiId||(e._pixiId="pixiid_"+ ++dt),e._pixiId),o=yt[n];if(r&&i&&!o)throw new Error('The cacheId "'+n+'" does not exist in TextureCache.');return o||(t.resolution||(t.resolution=It(e)),(o=new v(new D(e,t))).baseTexture.cacheId=n,D.addToCache(o.baseTexture,n),v.addToCache(o,n)),o},v.fromURL=function(e,t){var i=Object.assign({autoLoad:!1},null==t?void 0:t.resourceOptions),r=v.from(e,Object.assign({resourceOptions:i},t),!1),e=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):e.load().then(function(){return Promise.resolve(r)})},v.fromBuffer=function(e,t,i,r){return new v(D.fromBuffer(e,t,i,r))},v.fromLoader=function(e,t,i){e=new ir(e),e.url=t,e=new v(new D(e,{scaleMode:_.SCALE_MODE,resolution:It(t)}));return D.addToCache(e.baseTexture,i=i||t),v.addToCache(e,i),i!==t&&(D.addToCache(e.baseTexture,t),v.addToCache(e,t)),e},v.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),yt[t]&&console.warn("Texture added to the cache with an id ["+t+"] that already had an entry"),yt[t]=e)},v.removeFromCache=function(e){if("string"==typeof e){var t,i=yt[e];if(i)return-1<(t=i.textureCacheIds.indexOf(e))&&i.textureCacheIds.splice(t,1),delete yt[e],i}else if(e&&e.textureCacheIds){for(var r=0;r<e.textureCacheIds.length;++r)yt[e.textureCacheIds[r]]===e&&delete yt[e.textureCacheIds[r]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(v.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var t=e.x,i=e.y,r=e.width,n=e.height,o=t+r>this.baseTexture.width,s=i+n>this.baseTexture.height;if(o||s)throw t="X: "+t+" + "+r+" = "+(t+r)+" > "+this.baseTexture.width,i="Y: "+i+" + "+n+" = "+(i+n)+" > "+this.baseTexture.height,new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+t+" "+(o&&s?"and":"or")+" "+i);this.valid=r&&n&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),v.prototype.castToBaseTexture=function(){return this.baseTexture},v);function v(e,t,i,r,n,o){var s=fr.call(this)||this;if(s.noFrame=!1,t||(s.noFrame=!0,t=new x(0,0,1,1)),e instanceof v&&(e=e.baseTexture),s.baseTexture=e,s._frame=t,s.trim=r,s.valid=!1,s._uvs=xr,s.uvMatrix=null,s.orig=i||t,s._rotate=Number(n||0),!0===n)s._rotate=2;else if(s._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return s.defaultAnchor=o?new Rt(o.x,o.y):new Rt(0,0),s._updateID=0,s.textureCacheIds=[],e.valid?s.noFrame?e.valid&&s.onBaseTextureUpdated(e):s.frame=t:e.once("loaded",s.onBaseTextureUpdated,s),s.noFrame&&e.on("update",s.onBaseTextureUpdated,s),s}function wr(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}function Tr(e){var t=this,e=(t=mr.call(this,null,e="number"==typeof e?{width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}:e)||this,e||{}),i=e.width,e=e.height;return t.mipmap=0,t.width=Math.ceil(i)||100,t.height=Math.ceil(e)||100,t.valid=!0,t.clearColor=[0,0,0,0],t.framebuffer=new gr(t.width*t.resolution,t.height*t.resolution).addColorTexture(0,t),t.maskStack=[],t.filterStack=[{}],t}function Er(e,t){this.width=Math.ceil(e||100),this.height=Math.ceil(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Li("disposeFramebuffer"),this.multisample=q.MSAA_QUALITY.NONE}function Ir(){return null!==_r&&_r.apply(this,arguments)||this}function Pr(e){this.renderer=e}function Sr(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}K.EMPTY=new K(new D),Sr(K.EMPTY),Sr(K.EMPTY.baseTexture),K.WHITE=((s=document.createElement("canvas")).width=16,s.height=16,(te=s.getContext("2d")).fillStyle="white",te.fillRect(0,0,16,16),new K(new D(new ee(s)))),Sr(K.WHITE),Sr(K.WHITE.baseTexture);d(Fr,Ar=K),Object.defineProperty(Fr.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),Fr.prototype.resize=function(e,t,i){void 0===i&&(i=!0),e=Math.ceil(e),t=Math.ceil(t),this.valid=0<e&&0<t,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=t,i&&this.baseTexture.resize(e,t),this.updateUvs()},Fr.prototype.setResolution=function(e){var t=this.baseTexture;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))},Fr.create=function(e){return new Fr(new vr(e="number"==typeof e?{width:e,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}:e))};var Ar,kr=Fr,Or=(Nr.prototype.createTexture=function(e,t){e=new vr(Object.assign({width:e,height:t,resolution:1},this.textureOptions));return new kr(e)},Nr.prototype.getOptimalTexture=function(e,t,i){var r=Nr.SCREEN_KEY,n=(e*=i=void 0===i?1:i,t*=i,this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight||(r=(65535&(e=ht(e)))<<16|65535&(t=ht(t))),this.texturePool[r]||(this.texturePool[r]=[]),this.texturePool[r].pop());return(n=n||this.createTexture(e,t)).filterPoolKey=r,n.setResolution(i),n},Nr.prototype.getFilterTexture=function(e,t){t=this.getOptimalTexture(e.width,e.height,t||e.resolution);return t.filterFrame=e.filterFrame,t},Nr.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},Nr.prototype.returnFilterTexture=function(e){this.returnTexture(e)},Nr.prototype.clear=function(e){if(e=!1!==e)for(var t in this.texturePool){var i=this.texturePool[t];if(i)for(var r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}},Nr.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var t=Nr.SCREEN_KEY,i=this.texturePool[t];if(this.enableFullScreen=0<e.width&&0<e.height,i)for(var r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[t]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},Nr.SCREEN_KEY="screen",Nr),Mr=(Lr.prototype.destroy=function(){this.buffer=null},Lr.from=function(e,t,i,r,n){return new Lr(e,t,i,r,n)},Lr),Cr=0,Rr=(Dr.prototype.update=function(e){this.data=e||this.data,this._updateID++},Dr.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Dr.prototype.destroy=function(){this.dispose(),this.data=null},Dr.from=function(e){return new Dr(e=e instanceof Array?new Float32Array(e):e)},Dr);function Dr(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=Cr++,this.disposeRunner=new Li("disposeBuffer")}function Lr(e,t,i,r,n,o,s){void 0===t&&(t=0),void 0===i&&(i=!1),void 0===r&&(r=5126),this.buffer=e,this.size=t,this.normalized=i,this.type=r,this.stride=n,this.start=o,this.instance=s}function Nr(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}function Fr(e,t){var i,r,n,o,s=this,a=null;return e instanceof vr||(i=arguments[1],r=arguments[2],n=arguments[3],o=arguments[4],console.warn("Please use RenderTexture.create("+i+", "+r+") instead of the ctor directly."),a=arguments[0],t=null,e=new vr({width:i,height:r,scaleMode:n,resolution:o})),(s=Ar.call(this,e,t)||this).legacyRenderer=a,s.valid=!0,s.filterFrame=null,s.filterPoolKey=null,s.updateUvs(),s}function Br(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}var Xr,Ur,jr,Hr,Gr,zr,Wr,Yr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},Vr={5126:4,5123:2,5121:1},qr=0,Zr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Kr=(Pn.prototype.addAttribute=function(e,t,i,r,n,o,s,a){if(void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Rr||(t instanceof Array&&(t=new Float32Array(t)),t=new Rr(t));var h=e.split("|");if(1<h.length)for(var u=0;u<h.length;u++)this.addAttribute(h[u],t,i,r,n);else{var l=this.buffers.indexOf(t);-1===l&&(this.buffers.push(t),l=this.buffers.length-1),this.attributes[e]=new Mr(l,i,r,n,o,s,a),this.instanced=this.instanced||a}return this},Pn.prototype.getAttribute=function(e){return this.attributes[e]},Pn.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},Pn.prototype.addIndex=function(e){return e instanceof Rr||(e instanceof Array&&(e=new Uint16Array(e)),e=new Rr(e)),e.index=!0,this.indexBuffer=e,-1===this.buffers.indexOf(e)&&this.buffers.push(e),this},Pn.prototype.getIndex=function(){return this.indexBuffer},Pn.prototype.interleave=function(){if(!(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)){var e,t=[],i=[],r=new Rr;for(e in this.attributes){var n=this.attributes[e],o=this.buffers[n.buffer];t.push(o.data),i.push(n.size*Vr[n.type]/4),n.buffer=0}for(r.data=function(e,t){for(var i=0,r=0,n={},o=0;o<e.length;o++)r+=t[o],i+=e[o].length;for(var s=new ArrayBuffer(4*i),a=null,h=0,o=0;o<e.length;o++){var u=t[o],l=e[o],c=Br(l);n[c]||(n[c]=new Yr[c](s));for(var a=n[c],p=0;p<l.length;p++)a[(p/u|0)*r+h+p%u]=l[p];h+=u}return new Float32Array(s)}(t,i),e=0;e<this.buffers.length;e++)this.buffers[e]!==this.indexBuffer&&this.buffers[e].destroy();this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer)}return this},Pn.prototype.getSize=function(){for(var e in this.attributes){e=this.attributes[e];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0},Pn.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},Pn.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},Pn.prototype.clone=function(){for(var e=new Pn,t=0;t<this.buffers.length;t++)e.buffers[t]=new Rr(this.buffers[t].data.slice(0));for(t in this.attributes){var i=this.attributes[t];e.attributes[t]=new Mr(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},Pn.merge=function(e){for(var t=new Pn,i=[],r=[],n=[],o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.buffers.length;a++)r[a]=r[a]||0,r[a]+=s.buffers[a].data.length,n[a]=0;for(o=0;o<s.buffers.length;o++)i[o]=new Zr[Br(s.buffers[o].data)](r[o]),t.buffers[o]=new Rr(i[o]);for(o=0;o<e.length;o++)for(s=e[o],a=0;a<s.buffers.length;a++)i[a].set(s.buffers[a].data,n[a]),n[a]+=s.buffers[a].data.length;if(t.attributes=s.attributes,s.indexBuffer){t.indexBuffer=t.buffers[s.buffers.indexOf(s.indexBuffer)],t.indexBuffer.index=!0;var h=0,u=0,l=0,c=0;for(o=0;o<s.buffers.length;o++)if(s.buffers[o]!==s.indexBuffer){c=o;break}for(o in s.attributes){var p=s.attributes[o];(0|p.buffer)===c&&(u+=p.size*Vr[p.type]/4)}for(o=0;o<e.length;o++){for(var d=e[o].indexBuffer.data,a=0;a<d.length;a++)t.indexBuffer.data[a+l]+=h;h+=s.buffers[c].data.length/u,l+=d.length}}return t},Pn),$r=(d(In,Wr=Kr),In),Jr=(d(En,zr=Kr),En.prototype.map=function(e,t){var i;return this.uvs[0]=0,this.uvs[1]=0,this.uvs[2]=0+t.width/e.width,this.uvs[3]=0,this.uvs[4]=0+t.width/e.width,this.uvs[5]=0+t.height/e.height,this.uvs[6]=0,this.uvs[7]=0+t.height/e.height,e=t.x,i=t.y,this.vertices[0]=e,this.vertices[1]=i,this.vertices[2]=e+t.width,this.vertices[3]=i,this.vertices[4]=e+t.width,this.vertices[5]=i+t.height,this.vertices[6]=e,this.vertices[7]=i+t.height,this.invalidate(),this},En.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},En),Qr=0,en=(Tn.prototype.update=function(){this.dirtyId++},Tn.prototype.add=function(e,t,i){this.uniforms[e]=new Tn(t,i)},Tn.from=function(e,t){return new Tn(e,t)},Tn),tn=(wn.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},wn),rn=(d(xn,Gr=n),xn.prototype.push=function(e,t){for(var i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new tn,o=t[0].resolution,s=t[0].padding,a=t[0].autoFit,h=t[0].legacy,u=1;u<t.length;u++)var l=t[u],o=Math.min(o,l.resolution),s=this.useMaxPadding?Math.max(s,l.padding):s+l.padding,a=a&&l.autoFit,h=h||l.legacy;1===r.length&&(this.defaultFilterStack[0].renderTexture=i.renderTexture.current),r.push(n),n.resolution=o,n.legacy=h,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(s),a&&n.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),n.sourceFrame.ceil(o),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,o),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;r=this.tempRect;r.width=n.sourceFrame.width,r.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,i.renderTexture.bind(n.renderTexture,n.sourceFrame,r),i.renderTexture.clear()},xn.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),i=t.filters,r=(this.activeState=t,this.globalUniforms.uniforms),n=(r.outputFrame=t.sourceFrame,r.resolution=t.resolution,r.inputSize),o=r.inputPixel,s=r.inputClamp,n=(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=n[0]*t.resolution,o[1]=n[1]*t.resolution,o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=t.sourceFrame.width*n[2]-.5*o[2],s[3]=t.sourceFrame.height*n[3]-.5*o[3],t.legacy&&((s=r.filterArea)[0]=t.destinationFrame.width,s[1]=t.destinationFrame.height,s[2]=t.sourceFrame.x,s[3]=t.sourceFrame.y,r.filterClamp=r.inputClamp),this.globalUniforms.update(),e[e.length-1]);if(1<t.renderTexture.framebuffer.multisample&&this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,t.renderTexture,n.renderTexture,q.CLEAR_MODES.BLEND,t),this.returnFilterTexture(t.renderTexture);else{for(var a=t.renderTexture,h=((l=this.getOptimalFilterTexture(a.width,a.height,t.resolution)).filterFrame=a.filterFrame,0),h=0;h<i.length-1;++h){i[h].apply(this,a,l,q.CLEAR_MODES.CLEAR,t);var u=a,a=l,l=u}i[h].apply(this,a,n.renderTexture,q.CLEAR_MODES.BLEND,t),this.returnFilterTexture(a),this.returnFilterTexture(l)}t.clear(),this.statePool.push(t)},xn.prototype.bindAndClear=function(e,t){var i;void 0===t&&(t=q.CLEAR_MODES.CLEAR),e&&e.filterFrame?((i=this.tempRect).width=e.filterFrame.width,i.height=e.filterFrame.height,this.renderer.renderTexture.bind(e,e.filterFrame,i)):this.renderer.renderTexture.bind(e),"boolean"==typeof t&&(t=t?q.CLEAR_MODES.CLEAR:q.CLEAR_MODES.BLEND,f("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(t===q.CLEAR_MODES.CLEAR||t===q.CLEAR_MODES.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},xn.prototype.applyFilter=function(e,t,i,r){var n=this.renderer;this.bindAndClear(i,r),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.state.set(e.state),n.shader.bind(e),e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(q.DRAW_MODES.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(q.DRAW_MODES.TRIANGLE_STRIP))},xn.prototype.calculateSpriteMatrix=function(e,t){var i=this.activeState,r=i.sourceFrame,i=i.destinationFrame,n=t._texture.orig,e=e.set(i.width,0,0,i.height,r.x,r.y),i=t.worldTransform.copyTo(Lt.TEMP_MATRIX);return i.invert(),e.prepend(i),e.scale(1/n.width,1/n.height),e.translate(t.anchor.x,t.anchor.y),e},xn.prototype.destroy=function(){this.texturePool.clear(!1)},xn.prototype.getOptimalFilterTexture=function(e,t,i){return this.texturePool.getOptimalTexture(e,t,i=void 0===i?1:i)},xn.prototype.getFilterTexture=function(e,t){"number"==typeof e&&(i=e,e=t,t=i),e=e||this.activeState.renderTexture;var i=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution);return i.filterFrame=e.filterFrame,i},xn.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},xn.prototype.emptyPool=function(){this.texturePool.clear(!0)},xn.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},xn),nn=(bn.prototype.flush=function(){},bn.prototype.destroy=function(){this.renderer=null},bn.prototype.start=function(){},bn.prototype.stop=function(){this.flush()},bn.prototype.render=function(e){},bn),on=(d(vn,Hr=n),vn.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},vn.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},vn.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},vn.prototype.copyBoundTextures=function(e,t){for(var i=this.renderer.texture.boundTextures,r=t-1;0<=r;--r)e[r]=i[r]||null,e[r]&&(e[r]._batchLocation=r)},vn.prototype.boundArray=function(e,t,i,r){for(var n=e.elements,o=e.ids,s=e.count,a=0,h=0;h<s;h++){var u=n[h],l=u._batchLocation;if(0<=l&&l<r&&t[l]===u)o[h]=l;else for(;a<r;){var c=t[a];if(!c||c._batchEnabled!==i||c._batchLocation!==a){o[h]=a,t[u._batchLocation=a]=u;break}a++}}},vn),sn=0,an=(d(gn,jr=n),Object.defineProperty(gn.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),gn.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=sn++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()},gn.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=sn++,this.renderer.runners.contextChange.emit(e)},gn.prototype.initFromOptions=function(e){e=this.createContext(this.renderer.view,e);this.initFromContext(e)},gn.prototype.createContext=function(e,t){var i;if(i=_.PREFER_ENV>=q.ENV.WEBGL2?e.getContext("webgl2",t):i)this.webGLVersion=2;else if(this.webGLVersion=1,!(i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl},gn.prototype.getExtensions=function(){var e=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:e.getExtension("EXT_color_buffer_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear")})},gn.prototype.handleContextLost=function(e){e.preventDefault()},gn.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},gn.prototype.destroy=function(){var e=this.renderer.view;e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},gn.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},gn.prototype.validateContext=function(e){var t=e.getContextAttributes(),i="WebGL2RenderingContext"in window&&e instanceof window.WebGL2RenderingContext,t=(i&&(this.webGLVersion=2),t.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly"),i||!!e.getExtension("OES_element_index_uint"));(this.supports.uint32Indices=t)||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},gn),hn=function(e){this.framebuffer=e,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=q.MSAA_QUALITY.NONE,this.msaaBuffer=null,this.blitFramebuffer=null},un=new x,ln=(d(yn,Ur=n),yn.prototype.contextChange=function(){var t,e,i=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new x,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion?(t=this.renderer.context.extensions.drawBuffers,e=this.renderer.context.extensions.depthTexture,_.PREFER_ENV===q.ENV.WEBGL_LEGACY&&(e=t=null),t?i.drawBuffers=function(e){return t.drawBuffersWEBGL(e)}:(this.hasMRT=!1,i.drawBuffers=function(){}),e||(this.writeDepthTexture=!1)):this.msaaSamples=i.getInternalformatParameter(i.RENDERBUFFER,i.RGBA8,i.SAMPLES)},yn.prototype.bind=function(e,t){var i=this.gl;if(e){var r=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,i.bindFramebuffer(i.FRAMEBUFFER,r.framebuffer)),r.dirtyId!==e.dirtyId&&(r.dirtyId=e.dirtyId,r.dirtyFormat!==e.dirtyFormat?(r.dirtyFormat=e.dirtyFormat,this.updateFramebuffer(e)):r.dirtySize!==e.dirtySize&&(r.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var n=0;n<e.colorTextures.length;n++){var o=e.colorTextures[n];this.renderer.texture.unbind(o.parentTextureArray||o)}e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,e.width,e.height)}else this.current&&(this.current=null,i.bindFramebuffer(i.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},yn.prototype.setViewport=function(e,t,i,r){var n=this.viewport;n.width===i&&n.height===r&&n.x===e&&n.y===t||(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))},Object.defineProperty(yn.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),yn.prototype.clear=function(e,t,i,r,n){void 0===n&&(n=q.BUFFER_BITS.COLOR|q.BUFFER_BITS.DEPTH);var o=this.gl;o.clearColor(e,t,i,r),o.clear(n)},yn.prototype.initFramebuffer=function(e){var t=this.gl,t=new hn(t.createFramebuffer());return t.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=t,this.managedFramebuffers.push(e),e.disposeRunner.add(this),t},yn.prototype.resizeFramebuffer=function(e){var t=this.gl,i=e.glFramebuffers[this.CONTEXT_UID];i.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));for(var r=e.colorTextures,n=0;n<r.length;n++)this.renderer.texture.bind(r[n],0);e.depthTexture&&this.renderer.texture.bind(e.depthTexture,0)},yn.prototype.updateFramebuffer=function(e){var t=this.gl,i=e.glFramebuffers[this.CONTEXT_UID],r=e.colorTextures.length;t.drawBuffers||(r=Math.min(r,1)),1<i.multisample&&(i.msaaBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,t.RGBA8,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,i.msaaBuffer));for(var n,o,s,a=[],h=0;h<r;h++)0===h&&1<i.multisample||(o=(n=e.colorTextures[h]).parentTextureArray||n,this.renderer.texture.bind(o,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+h,n.target,o._glTextures[this.CONTEXT_UID].texture,0),a.push(t.COLOR_ATTACHMENT0+h));1<a.length&&t.drawBuffers(a),e.depthTexture&&this.writeDepthTexture&&(s=e.depthTexture,this.renderer.texture.bind(s,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)),i.stencil||!e.stencil&&!e.depth||(i.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),e.depthTexture||t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,i.stencil))},yn.prototype.detectSamples=function(e){var t=this.msaaSamples,i=q.MSAA_QUALITY.NONE;if(!(e<=1||null===t)){for(var r=0;r<t.length;r++)if(t[r]<=e){i=t[r];break}1===i&&(i=q.MSAA_QUALITY.NONE)}return i},yn.prototype.blit=function(e,t,i){var r=this.current,n=this.renderer,o=this.gl,s=this.CONTEXT_UID;if(2===n.context.webGLVersion&&r){n=r.glFramebuffers[s];if(n){if(!e){if(n.multisample<=1)return;n.blitFramebuffer||(n.blitFramebuffer=new gr(r.width,r.height),n.blitFramebuffer.addColorTexture(0,r.colorTextures[0])),(e=n.blitFramebuffer).width=r.width,e.height=r.height}t||((t=un).width=r.width,t.height=r.height);s=t.width===(i=i||t).width&&t.height===i.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,n.framebuffer),o.blitFramebuffer(t.x,t.y,t.width,t.height,i.x,i.y,i.width,i.height,o.COLOR_BUFFER_BIT,s?o.NEAREST:o.LINEAR)}}},yn.prototype.disposeFramebuffer=function(e,t){var i,r=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;r&&(delete e.glFramebuffers[this.CONTEXT_UID],0<=(i=this.managedFramebuffers.indexOf(e))&&this.managedFramebuffers.splice(i,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(r.framebuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)))},yn.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)},yn.prototype.forceStencil=function(){var e,t,i,r,n=this.current;n&&(e=n.glFramebuffers[this.CONTEXT_UID])&&!e.stencil&&(n.enableStencil(),t=n.width,n=n.height,r=(i=this.gl).createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,r),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,n),e.stencil=r,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,r))},yn.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new x},yn),cn=function(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0},pn={5126:4,5123:2,5121:1},dn=(d(_n,Xr=n),_n.prototype.contextChange=function(){this.disposeAll(!0);var t,o,e=this.gl=this.renderer.gl,i=this.renderer.context;this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==i.webGLVersion&&(t=this.renderer.context.extensions.vertexArrayObject,(t=_.PREFER_ENV===q.ENV.WEBGL_LEGACY?null:t)?(e.createVertexArray=function(){return t.createVertexArrayOES()},e.bindVertexArray=function(e){return t.bindVertexArrayOES(e)},e.deleteVertexArray=function(e){return t.deleteVertexArrayOES(e)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})),2!==i.webGLVersion&&((o=e.getExtension("ANGLE_instanced_arrays"))?(e.vertexAttribDivisor=function(e,t){return o.vertexAttribDivisorANGLE(e,t)},e.drawElementsInstanced=function(e,t,i,r,n){return o.drawElementsInstancedANGLE(e,t,i,r,n)},e.drawArraysInstanced=function(e,t,i,r){return o.drawArraysInstancedANGLE(e,t,i,r)}):this.hasInstance=!1),this.canUseUInt32ElementIndex=2===i.webGLVersion||!!i.extensions.uint32ElementIndex},_n.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var i=this.gl,r=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1,r=(r||((this.managedGeometries[e.id]=e).disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0),r[t.program.id]||this.initGeometryVao(e,t.program,n));this._activeGeometry=e,this._activeVao!==r&&(this._activeVao=r,this.hasVao?i.bindVertexArray(r):this.activateVao(e,t.program)),this.updateBuffers()},_n.prototype.reset=function(){this.unbind()},_n.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.gl,i=0;i<e.buffers.length;i++){var r,n,o=e.buffers[i],s=o._glBuffers[this.CONTEXT_UID];o._updateID!==s.updateID&&(s.updateID=o._updateID,r=o.index?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER,t.bindBuffer(r,s.buffer),(this._boundBuffer=s).byteLength>=o.data.byteLength?t.bufferSubData(r,0,o.data):(n=o.static?t.STATIC_DRAW:t.DYNAMIC_DRAW,s.byteLength=o.data.byteLength,t.bufferData(r,o.data,n)))}},_n.prototype.checkCompatibility=function(e,t){var i,r=e.attributes;for(i in t.attributeData)if(!r[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},_n.prototype.getSignature=function(e,t){var i,r=e.attributes,n=t.attributeData,o=["g",e.id];for(i in r)n[i]&&o.push(i);return o.join("-")},_n.prototype.initGeometryVao=function(e,t,i){void 0===i&&(i=!0),this.checkCompatibility(e,t);var r=this.gl,n=this.CONTEXT_UID,o=this.getSignature(e,t),s=e.glVertexArrayObjects[this.CONTEXT_UID],a=s[o];if(a)s[t.id]=a;else{var h,u=e.buffers,l=e.attributes,c={},p={};for(h in u)c[h]=0,p[h]=0;for(h in l)!l[h].size&&t.attributeData[h]?l[h].size=t.attributeData[h].size:l[h].size||console.warn("PIXI Geometry attribute '"+h+"' size cannot be determined (likely the bound shader does not have the attribute)"),c[l[h].buffer]+=l[h].size*pn[l[h].type];for(h in l){var d=l[h],f=d.size;void 0===d.stride&&(c[d.buffer]===f*pn[d.type]?d.stride=0:d.stride=c[d.buffer]),void 0===d.start&&(d.start=p[d.buffer],p[d.buffer]+=f*pn[d.type])}a=r.createVertexArray(),r.bindVertexArray(a);for(var m=0;m<u.length;m++){var _=u[m];_._glBuffers[n]||(_._glBuffers[n]=new cn(r.createBuffer()),(this.managedBuffers[_.id]=_).disposeRunner.add(this)),i&&_._glBuffers[n].refCount++}this.activateVao(e,t),this._activeVao=a,s[t.id]=a,s[o]=a}return a},_n.prototype.disposeBuffer=function(e,t){var i,r;this.managedBuffers[e.id]&&(delete this.managedBuffers[e.id],i=e._glBuffers[this.CONTEXT_UID],r=this.gl,e.disposeRunner.remove(this),i&&(t||r.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID]))},_n.prototype.disposeGeometry=function(e,t){if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var i=e.glVertexArrayObjects[this.CONTEXT_UID],r=this.gl,n=e.buffers;if(e.disposeRunner.remove(this),i){for(var o=0;o<n.length;o++){var s=n[o]._glBuffers[this.CONTEXT_UID];s.refCount--,0!==s.refCount||t||this.disposeBuffer(n[o],t)}if(!t)for(var a in i)"g"===a[0]&&(a=i[a],this._activeVao===a&&this.unbind(),r.deleteVertexArray(a));delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},_n.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e);for(t=Object.keys(this.managedBuffers),i=0;i<t.length;i++)this.disposeBuffer(this.managedBuffers[t[i]],e)},_n.prototype.activateVao=function(e,t){var i,r=this.gl,n=this.CONTEXT_UID,o=e.buffers,s=e.attributes,a=(e.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer._glBuffers[n].buffer),null);for(i in s){var h=s[i],u=o[h.buffer]._glBuffers[n];if(t.attributeData[i]){a!==u&&(r.bindBuffer(r.ARRAY_BUFFER,u.buffer),a=u);u=t.attributeData[i].location;if(r.enableVertexAttribArray(u),r.vertexAttribPointer(u,h.size,h.type||r.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(u,1)}}}},_n.prototype.draw=function(e,t,i,r){var n,o,s=this.gl,a=this._activeGeometry;return a.indexBuffer?(o=2===(n=a.indexBuffer.data.BYTES_PER_ELEMENT)?s.UNSIGNED_SHORT:s.UNSIGNED_INT,2===n||4===n&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(e,t||a.indexBuffer.data.length,o,(i||0)*n,r||1):s.drawElements(e,t||a.indexBuffer.data.length,o,(i||0)*n):console.warn("unsupported index buffer type: uint32")):a.instanced?s.drawArraysInstanced(e,i,t||a.getSize(),r||1):s.drawArrays(e,i,t||a.getSize()),this},_n.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},_n),fn=(mn.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=q.MASK_TYPES.NONE,this.autoDetect=!0),this._target=null},mn.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},mn);function mn(e){void 0===e&&(e=null),this.type=q.MASK_TYPES.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}function _n(e){e=Xr.call(this,e)||this;return e._activeGeometry=null,e._activeVao=null,e.hasVao=!0,e.hasInstance=!0,e.canUseUInt32ElementIndex=!1,e.managedGeometries={},e.managedBuffers={},e}function yn(e){e=Ur.call(this,e)||this;return e.managedFramebuffers=[],e.unknownFramebuffer=new gr(10,10),e.msaaSamples=null,e}function gn(e){var t=jr.call(this,e)||this;return t.webGLVersion=1,t.extensions={},t.supports={uint32Indices:!1},t.handleContextLost=t.handleContextLost.bind(t),t.handleContextRestored=t.handleContextRestored.bind(t),e.view.addEventListener("webglcontextlost",t.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",t.handleContextRestored,!1),t}function vn(e){var t=Hr.call(this,e)||this;return t.emptyRenderer=new nn(e),t.currentRenderer=t.emptyRenderer,t}function bn(e){this.renderer=e}function xn(e){var t=Gr.call(this,e)||this;return t.defaultFilterStack=[{}],t.texturePool=new Or,t.texturePool.setScreenSize(e.view),t.statePool=[],t.quad=new $r,t.quadUv=new Jr,t.tempRect=new x,t.activeState={},t.globalUniforms=new en({outputFrame:t.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),t.forceClear=!1,t.useMaxPadding=!1,t}function wn(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new x,this.destinationFrame=new x,this.filters=[]}function Tn(e,t){this.uniforms=e,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Qr++,this.static=!!t}function En(){var e=zr.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new Rr(e.vertices),e.uvBuffer=new Rr(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}function In(){var e=Wr.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}function Pn(e,t){void 0===t&&(t={}),this.buffers=e=void 0===e?[]:e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=qr++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Li("disposeGeometry"),this.refCount=0}function Sn(e,t,i){t=e.createShader(t);return e.shaderSource(t,i),e.compileShader(t),t}function An(e,t,i,r){var n=Sn(e,e.VERTEX_SHADER,t),o=Sn(e,e.FRAGMENT_SHADER,i),s=e.createProgram();if(e.attachShader(s,n),e.attachShader(s,o),r)for(var a in r)e.bindAttribLocation(s,r[a],a);return e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||(e.getShaderParameter(n,e.COMPILE_STATUS)||(console.warn(t),console.error(e.getShaderInfoLog(n))),e.getShaderParameter(o,e.COMPILE_STATUS)||(console.warn(i),console.error(e.getShaderInfoLog(o))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(s,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),""!==e.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(s)),e.deleteProgram(s),s=null),e.deleteShader(n),e.deleteShader(o),s}function kn(e){for(var t=new Array(e),i=0;i<t.length;i++)t[i]=!1;return t}function On(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return kn(2*t);case"bvec3":return kn(3*t);case"bvec4":return kn(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var Mn,Cn={},Rn=Cn;function Dn(){var e,t;return(Rn===Cn||Rn&&Rn.isContextLost())&&(e=document.createElement("canvas"),t=void 0,(t=_.PREFER_ENV>=q.ENV.WEBGL2?e.getContext("webgl2",{}):t)||((t=e.getContext("webgl",{})||e.getContext("experimental-webgl",{}))?t.getExtension("WEBGL_draw_buffers"):t=null),Rn=t),Rn}function Ln(e,t,i){return"precision"!==e.substring(0,9)?"precision "+(t===q.PRECISION.HIGH&&i!==q.PRECISION.HIGH?q.PRECISION.MEDIUM:t)+" float;\n"+e:i!==q.PRECISION.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var Nn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};var Fn=null,Bn={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function Xn(e,t){if(!Fn){var i=Object.keys(Bn);Fn={};for(var r=0;r<i.length;++r){var n=i[r];Fn[e[n]]=Bn[n]}}return Fn[t]}var Un,jn=[{test:function(e){return"float"===e.type&&1===e.size},code:function(e){return'\n            if(uv["'+e+'"] !== ud["'+e+'"].value)\n            {\n                ud["'+e+'"].value = uv["'+e+'"]\n                gl.uniform1f(ud["'+e+'"].location, uv["'+e+'"])\n            }\n            '}},{test:function(e){return("sampler2D"===e.type||"samplerCube"===e.type||"sampler2DArray"===e.type)&&1===e.size&&!e.isArray},code:function(e){return't = syncData.textureCount++;\n\n            renderer.texture.bind(uv["'+e+'"], t);\n\n            if(ud["'+e+'"].value !== t)\n            {\n                ud["'+e+'"].value = t;\n                gl.uniform1i(ud["'+e+'"].location, t);\n; // eslint-disable-line max-len\n            }'}},{test:function(e,t){return"mat3"===e.type&&1===e.size&&void 0!==t.a},code:function(e){return'\n            gl.uniformMatrix3fv(ud["'+e+'"].location, false, uv["'+e+'"].toArray(true));\n            '}},{test:function(e,t){return"vec2"===e.type&&1===e.size&&void 0!==t.x},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["'+e+'"].location, v.x, v.y);\n                }'}},{test:function(e){return"vec2"===e.type&&1===e.size},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["'+e+'"].location, v[0], v[1]);\n                }\n            '}},{test:function(e,t){return"vec4"===e.type&&1===e.size&&void 0!==t.width},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["'+e+'"].location, v.x, v.y, v.width, v.height)\n                }'}},{test:function(e){return"vec4"===e.type&&1===e.size},code:function(e){return'\n                cv = ud["'+e+'"].value;\n                v = uv["'+e+'"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["'+e+'"].location, v[0], v[1], v[2], v[3])\n                }'}}],Hn={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Gn={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},zn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Wn(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var i=t.createShader(t.FRAGMENT_SHADER);;){var r=zn.replace(/%forloop%/gi,function(e){for(var t="",i=0;i<e;++i)0<i&&(t+="\nelse "),i<e-1&&(t+="if(test == "+i+".0){}");return t}(e));if(t.shaderSource(i,r),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))break;e=e/2|0}return e}function Yn(){}var Vn,qn,Zn,Kn,$n,Jn,Qn,eo,to,io=0,ro={},no=(No.prototype.extractData=function(e,t){var i=Dn();i?(e=An(i,e,t),this.attributeData=this.getAttributeData(e,i),this.uniformData=this.getUniformData(e,i),i.deleteProgram(e)):(this.uniformData={},this.attributeData={})},No.prototype.getAttributeData=function(e,t){for(var i={},r=[],n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<n;o++){var s=t.getActiveAttrib(e,o),a=Xn(t,s.type),a={type:a,name:s.name,size:Nn[a],location:0};i[s.name]=a,r.push(a)}for(r.sort(function(e,t){return e.name>t.name?1:-1}),o=0;o<r.length;o++)r[o].location=o;return i},No.prototype.getUniformData=function(e,t){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),n=0;n<r;n++){var o=t.getActiveUniform(e,n),s=o.name.replace(/\[.*?\]$/,""),a=o.name.match(/\[.*?\]$/),h=Xn(t,o.type);i[s]={type:h,size:o.size,isArray:a,value:On(h,o.size)}}return i},Object.defineProperty(No,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(No,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},enumerable:!1,configurable:!0}),No.from=function(e,t,i){var r=e+t,n=_t[r];return n||(_t[r]=n=new No(e,t,i)),n},No),oo=(Lo.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var i in t.uniforms){i=t.uniforms[i];if(i.group&&this.checkUniformExists(e,i))return!0}return!1},Lo.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(Lo.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),Lo.from=function(e,t,i){return new Lo(no.from(e,t),i)},Lo),so=(Object.defineProperty(Do.prototype,"blend",{get:function(){return!!(1&this.data)},set:function(e){!!(1&this.data)!==e&&(this.data^=1)},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"offsets",{get:function(){return!!(2&this.data)},set:function(e){!!(2&this.data)!==e&&(this.data^=2)},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"culling",{get:function(){return!!(4&this.data)},set:function(e){!!(4&this.data)!==e&&(this.data^=4)},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"depthTest",{get:function(){return!!(8&this.data)},set:function(e){!!(8&this.data)!==e&&(this.data^=8)},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"clockwiseFrontFace",{get:function(){return!!(16&this.data)},set:function(e){!!(16&this.data)!==e&&(this.data^=16)},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==q.BLEND_MODES.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(Do.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),Do.for2d=function(){var e=new Do;return e.depthTest=!1,e.blend=!0,e},Do),m=(d(Ro,to=oo),Ro.prototype.apply=function(e,t,i,r,n){e.applyFilter(this,t,i,r)},Object.defineProperty(Ro.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ro,"defaultVertexSrc",{get:function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},enumerable:!1,configurable:!0}),Object.defineProperty(Ro,"defaultFragmentSrc",{get:function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},enumerable:!1,configurable:!0}),Ro),ao=new Lt,ho=(Object.defineProperty(Co.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),Co.prototype.multiplyUvs=function(e,t){void 0===t&&(t=e);for(var i=this.mapCoord,r=0;r<e.length;r+=2){var n=e[r],o=e[r+1];t[r]=n*i.a+o*i.c+i.tx,t[r+1]=n*i.b+o*i.d+i.ty}return t},Co.prototype.update=function(e){var t=this._texture;if(!t||!t.valid)return!1;if(!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var e=t._uvs,e=(this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0),t.orig),i=t.trim,e=(i&&(ao.set(e.width/i.width,0,0,e.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(ao)),t.baseTexture),i=this.uClampFrame,r=this.clampMargin/e.resolution,n=this.clampOffset;return i[0]=(t._frame.x+r+n)/e.width,i[1]=(t._frame.y+r+n)/e.height,i[2]=(t._frame.x+t._frame.width-r+n)/e.width,i[3]=(t._frame.y+t._frame.height-r+n)/e.height,this.uClampOffset[0]=n/e.realWidth,this.uClampOffset[1]=n/e.realHeight,this.isSimple=t._frame.width===e.width&&t._frame.height===e.height&&0===t.rotate,!0},Co),uo=(d(Mo,eo=m),Mo.prototype.apply=function(e,t,i,r){var n=this.maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new ho(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,i,r))},Mo),lo=(d(Oo,Qn=n),Oo.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},Oo.prototype.push=function(e,t){var i,r=t;switch(r.isMaskData||((i=this.maskDataPool.pop()||new fn).pooled=!0,i.maskObject=t,r=i),r.autoDetect&&this.detect(r),r.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),r._target=e,r.type){case q.MASK_TYPES.SCISSOR:this.maskStack.push(r),this.renderer.scissor.push(r);break;case q.MASK_TYPES.STENCIL:this.maskStack.push(r),this.renderer.stencil.push(r);break;case q.MASK_TYPES.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r),this.maskStack.push(r)}},Oo.prototype.pop=function(e){var t=this.maskStack.pop();if(t&&t._target===e){switch(t.type){case q.MASK_TYPES.SCISSOR:this.renderer.scissor.pop();break;case q.MASK_TYPES.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case q.MASK_TYPES.SPRITE:this.popSpriteMask()}t.reset(),t.pooled&&this.maskDataPool.push(t)}},Oo.prototype.detect=function(e){var t,i=e.maskObject;i.isSprite?e.type=q.MASK_TYPES.SPRITE:(e.type=q.MASK_TYPES.STENCIL,this.enableScissor&&i.isFastRect&&i.isFastRect()&&(i=i.worldTransform,t=Math.atan2(i.b,i.a),i=Math.atan2(i.d,i.c),t=Math.round(t*(180/Math.PI)*100),i=((Math.round(i*(180/Math.PI)*100)-t)%18e3+18e3)%18e3,0==(t=(t%9e3+9e3)%9e3)&&9e3===i&&(e.type=q.MASK_TYPES.SCISSOR)))},Oo.prototype.pushSpriteMask=function(e){var t=e.maskObject,e=e._target,i=this.alphaMaskPool[this.alphaMaskIndex],r=((i=i||(this.alphaMaskPool[this.alphaMaskIndex]=[new uo(t)]))[0].resolution=this.renderer.resolution,i[0].maskSprite=t,e.filterArea);e.filterArea=t.getBounds(!0),this.renderer.filter.push(e,i),e.filterArea=r,this.alphaMaskIndex++},Oo.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},Oo),y=(d(ko,Jn=n),ko.prototype.getStackLength=function(){return this.maskStack.length},ko.prototype.setMaskStack=function(e){var t=this.renderer.gl,i=this.getStackLength(),e=(this.maskStack=e,this.getStackLength());e!==i&&(0===e?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))},ko.prototype._useCurrent=function(){},ko.prototype.destroy=function(){Jn.prototype.destroy.call(this),this.maskStack=null},ko),co=(d(Ao,$n=y),Ao.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},Ao.prototype.push=function(e){var t=e.maskObject,i=(t.renderable=!0,e._scissorRect),r=t.getBounds(!0),n=this.renderer.gl;t.renderable=!1,i?r.fit(i):n.enable(n.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=r,this._useCurrent()},Ao.prototype.pop=function(){var e=this.renderer.gl;0<this.getStackLength()?this._useCurrent():e.disable(e.SCISSOR_TEST)},Ao.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,t=this.renderer.renderTexture.current,i=this.renderer.projection,r=i.transform,n=i.sourceFrame,i=i.destinationFrame,o=(t||this.renderer).resolution,s=(e.x-n.x)*o+i.x,n=(e.y-n.y)*o+i.y,i=e.width*o,e=e.height*o;r&&(s+=r.tx*o,n+=r.ty*o),t||(n=this.renderer.height-e-n),this.renderer.gl.scissor(s,n,i,e)},Ao),po=(d(So,Kn=y),So.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},So.prototype.push=function(e){var t=e.maskObject,i=this.renderer.gl,r=e._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),i.enable(i.STENCIL_TEST)),e._stencilCounter++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,r,this._getBitwiseMask()),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent()},So.prototype.pop=function(e){var t=this.renderer.gl;0===this.getStackLength()?(t.disable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(0)):(t.colorMask(!1,!1,!1,!1),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent())},So.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.getStackLength(),this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},So.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},So),fo=(d(Po,Zn=n),Po.prototype.update=function(e,t,i,r){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);t=this.renderer;t.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,t.globalUniforms.update(),t.shader.shader&&t.shader.syncUniformGroup(t.shader.shader.uniforms.globals)},Po.prototype.calculateProjection=function(e,t,i,r){var n=this.projectionMatrix,r=r?-1:1;n.identity(),n.a=1/t.width*2,n.d=r*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-r-t.y*n.d},Po.prototype.setTransform=function(e){},Po),mo=new x,_o=new x,yo=new x,go=(d(Io,qn=n),Io.prototype.bind=function(e,t,i){var r,n,o,s=this.renderer;(this.current=e=void 0===e?null:e)?(o=(r=e.baseTexture).resolution,t||(mo.width=e.frame.width,mo.height=e.frame.height,t=mo),i||(_o.x=e.frame.x,_o.y=e.frame.y,_o.width=t.width,_o.height=t.height,i=_o),n=r.framebuffer):(o=s.resolution,t||(mo.width=s.screen.width,mo.height=s.screen.height,t=mo),i||((i=mo).width=t.width,i.height=t.height)),yo.x=i.x*o,yo.y=i.y*o,yo.width=i.width*o,yo.height=i.height*o,this.renderer.framebuffer.bind(n,yo),this.renderer.projection.update(i,t,o,!n),e?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)},Io.prototype.clear=function(e,t){e=this.current?e||this.current.baseTexture.clearColor:e||this.clearColor,this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],t)},Io.prototype.resize=function(){this.bind(null)},Io.prototype.reset=function(){this.bind(null)},Io),vo=(Eo.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},Eo),bo=0,xo={textureCount:0},wo=(d(To,Vn=n),To.prototype.systemCheck=function(){if(!function(){if("boolean"!=typeof Un)try{var e=new Function("param1","param2","param3","return param1[param2] === param3;");Un=!0===e({a:"b"},"a","b")}catch(e){Un=!1}return Un}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},To.prototype.contextChange=function(e){this.gl=e,this.reset()},To.prototype.bind=function(e,t){e.uniforms.globals=this.renderer.globalUniforms;var i=e.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),t||(xo.textureCount=0,this.syncUniformGroup(e.uniformGroup,xo)),r},To.prototype.setUniforms=function(e){var t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)},To.prototype.syncUniformGroup=function(e,t){var i=this.getglProgram();e.static&&e.dirtyId===i.uniformGroups[e.id]||(i.uniformGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))},To.prototype.syncUniforms=function(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)},To.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData);return this.cache[t]||(this.cache[t]=function(e,t){var i,r=["\n        var v = null;\n        var cv = null\n        var t = 0;\n        var gl = renderer.gl\n    "];for(i in e.uniforms){var n=t[i];if(n){for(var o,s=e.uniforms[i],a=!1,h=0;h<jn.length;h++)if(jn[h].test(n,s)){r.push(jn[h].code(i,s)),a=!0;break}a||(o=(1===n.size?Hn:Gn)[n.type].replace("location",'ud["'+i+'"].location'),r.push('\n            cv = ud["'+i+'"].value;\n            v = uv["'+i+'"];\n            '+o+";"))}else e.uniforms[i].group&&r.push('\n                    renderer.shader.syncUniformGroup(uv["'+i+'"], syncData);\n                ')}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},To.prototype.getSignature=function(e,t){var i,r=[];for(i in e.uniforms)r.push(i),t[i]&&r.push(t[i].type);return r.join("-")},To.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},To.prototype.generateShader=function(e){var t=this.gl,i=e.program,r={};for(n in i.attributeData)r[n]=i.attributeData[n].location;var n,o=An(t,i.vertexSrc,i.fragmentSrc,r),s={};for(n in i.uniformData){var a=i.uniformData[n];s[n]={location:t.getUniformLocation(o,n),value:On(a.type,a.size)}}e=new vo(o,s);return i.glPrograms[this.renderer.CONTEXT_UID]=e},To.prototype.reset=function(){this.program=null,this.shader=null},To.prototype.destroy=function(){this.destroyed=!0},To);function To(e){e=Vn.call(this,e)||this;return e.destroyed=!1,e.systemCheck(),e.gl=null,e.shader=null,e.program=null,e.cache={},e.id=bo++,e}function Eo(e,t){this.program=e,this.uniformData=t,this.uniformGroups={}}function Io(e){var t=qn.call(this,e)||this;return t.clearColor=e._backgroundColorRgba,t.defaultMaskStack=[],t.current=null,t.sourceFrame=new x,t.destinationFrame=new x,t}function Po(e){e=Zn.call(this,e)||this;return e.destinationFrame=null,e.sourceFrame=null,e.defaultFrame=null,e.projectionMatrix=new Lt,e.transform=null,e}function So(e){e=Kn.call(this,e)||this;return e.glConst=WebGLRenderingContext.STENCIL_TEST,e}function Ao(e){e=$n.call(this,e)||this;return e.glConst=WebGLRenderingContext.SCISSOR_TEST,e}function ko(e){e=Jn.call(this,e)||this;return e.maskStack=[],e.glConst=0,e}function Oo(e){e=Qn.call(this,e)||this;return e.enableScissor=!1,e.alphaMaskPool=[],e.maskDataPool=[],e.maskStack=[],e.alphaMaskIndex=0,e}function Mo(e){var t=this,i=new Lt,t=eo.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n")||this;return e.renderable=!1,t.maskSprite=e,t.maskMatrix=i,t}function Co(e,t){this._texture=e,this.mapCoord=new Lt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===t?.5:t,this.isSimple=!1}function Ro(e,t,i){var r=this,e=no.from(e||Ro.defaultVertexSrc,t||Ro.defaultFragmentSrc);return(r=to.call(this,e,i)||this).padding=0,r.resolution=_.FILTER_RESOLUTION,r.enabled=!0,r.autoFit=!0,r.legacy=!!r.program.attributeData.aTextureCoord,r.state=new so,r}function Do(){this.data=0,this.blendMode=q.BLEND_MODES.NORMAL,this.polygonOffset=0,this.blend=!0}function Lo(e,t){for(var i in this.program=e,this.uniformGroup=t?t instanceof en?t:new en(t):new en({}),e.uniformData)this.uniformGroup.uniforms[i]instanceof Array&&(this.uniformGroup.uniforms[i]=new Float32Array(this.uniformGroup.uniforms[i]))}function No(e,t,i){void 0===i&&(i="pixi-shader"),this.id=io++,this.vertexSrc=e||No.defaultVertexSrc,this.fragmentSrc=t||No.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),ro[i]?(ro[i]++,i+="-"+ro[i]):ro[i]=1,this.vertexSrc="#define SHADER_NAME "+i+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+i+"\n"+this.fragmentSrc,this.vertexSrc=Ln(this.vertexSrc,_.PRECISION_VERTEX,q.PRECISION.HIGH),this.fragmentSrc=Ln(this.fragmentSrc,_.PRECISION_FRAGMENT,(Mn||(Mn=q.PRECISION.MEDIUM,(e=Dn())&&e.getShaderPrecisionFormat&&(e=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),Mn=e.precision?q.PRECISION.HIGH:q.PRECISION.MEDIUM)),Mn))),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}d(Jo,jo=n),Jo.prototype.contextChange=function(e){var t;this.gl=e,this.blendModes=(e=e,(t=void 0===t?[]:t)[q.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.ADD]=[e.ONE,e.ONE],t[q.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.NONE]=[0,0],t[q.BLEND_MODES.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[q.BLEND_MODES.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[q.BLEND_MODES.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[q.BLEND_MODES.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[q.BLEND_MODES.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[q.BLEND_MODES.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[q.BLEND_MODES.XOR]=[e.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[q.BLEND_MODES.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t),this.set(this.defaultState),this.reset()},Jo.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,i=0;t;)1&t&&this.map[i].call(this,!!(e.data&1<<i)),t>>=1,i++;this.stateId=e.data}for(i=0;i<this.checks.length;i++)this.checks[i](this,e)},Jo.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data},Jo.prototype.setBlend=function(e){this.updateCheck(Jo.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},Jo.prototype.setOffset=function(e){this.updateCheck(Jo.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},Jo.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},Jo.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},Jo.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},Jo.prototype.setBlendMode=function(e){var t;e!==this.blendMode&&(this.blendMode=e,e=this.blendModes[e],t=this.gl,2===e.length?t.blendFunc(e[0],e[1]):t.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,t.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD)))},Jo.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},Jo.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},Jo.prototype.updateCheck=function(e,t){var i=this.checks.indexOf(e);t&&-1===i?this.checks.push(e):t||-1===i||this.checks.splice(i,1)},Jo.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},Jo.checkPolygonOffset=function(e,t){e.setPolygonOffset(1,t.polygonOffset)};var Fo,Bo,Xo,Uo,jo,Ho=Jo,Go=(d($o,Uo=n),$o.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==q.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},$o.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,i=!1,r=0;r<t.length;r++){var n=t[r];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),i=!(t[r]=null))}if(i){for(var o=0,r=0;r<t.length;r++)null!==t[r]&&(t[o++]=t[r]);t.length=o}},$o.prototype.unload=function(e){var t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(var r=e.children.length-1;0<=r;r--)this.unload(e.children[r])},$o),zo=function(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},Wo=(d(Ko,Xo=n),Ko.prototype.contextChange=function(){var e=this.gl=this.renderer.gl,t=(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS));this.boundTextures.length=t;for(var i=0;i<t;i++)this.boundTextures[i]=null;this.emptyTextures={};var r=new zo(e.createTexture());for(e.bindTexture(e.TEXTURE_2D,r.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=r,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new zo(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture),i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);for(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR),i=0;i<this.boundTextures.length;i++)this.bind(null,i)},Ko.prototype.bind=function(e,t){void 0===t&&(t=0);var i,r=this.gl;e?(e=e.castToBaseTexture()).parentTextureArray||e.valid&&(e.touched=this.renderer.textureGC.count,i=e._glTextures[this.CONTEXT_UID]||this.initTexture(e),this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(e.target,i.texture)),i.dirtyId!==e.dirtyId&&(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.updateTexture(e)),this.boundTextures[t]=e):(this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null)},Ko.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},Ko.prototype.unbind=function(e){var t=this.gl,i=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(r=0;r<i.length;r++)i[r]===e&&(this.currentLocation!==r&&(t.activeTexture(t.TEXTURE0+r),this.currentLocation=r),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[r]=null)},Ko.prototype.initTexture=function(e){var t=new zo(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},Ko.prototype.initTextureType=function(e,t){var i;t.internalFormat=e.format,t.type=e.type,2===this.webGLVersion&&(i=this.renderer.gl,e.type===i.FLOAT&&e.format===i.RGBA&&(t.internalFormat=i.RGBA32F),e.type===q.TYPES.HALF_FLOAT&&(t.type=i.HALF_FLOAT),t.type===i.HALF_FLOAT&&e.format===i.RGBA&&(t.internalFormat=i.RGBA16F))},Ko.prototype.updateTexture=function(e){var t,i,r,n=e._glTextures[this.CONTEXT_UID];n&&(r=this.renderer,this.initTextureType(e,n),e.resource&&e.resource.upload(r,e,n)||(t=e.realWidth,i=e.realHeight,r=r.gl,(n.width!==t||n.height!==i||n.dirtyId<0)&&(n.width=t,n.height=i,r.texImage2D(e.target,0,n.internalFormat,t,i,0,e.format,n.type,null))),e.dirtyStyleId!==n.dirtyStyleId&&this.updateTextureStyle(e),n.dirtyId=e.dirtyId)},Ko.prototype.destroyTexture=function(e,t){var i=this.gl;(e=e.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)&&-1!==(i=this.managedTextures.indexOf(e))&&ct(this.managedTextures,i,1)},Ko.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==q.MIPMAP_MODES.POW2&&2===this.webGLVersion||e.isPowerOfTwo?t.mipmap=1<=e.mipmap:t.mipmap=!1,2===this.webGLVersion||e.isPowerOfTwo?t.wrapMode=e.wrapMode:t.wrapMode=q.WRAP_MODES.CLAMP,e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},Ko.prototype.setStyle=function(e,t){var i,r=this.gl;t.mipmap&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap?(r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===q.SCALE_MODES.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST),(t=this.renderer.context.extensions.anisotropicFiltering)&&0<e.anisotropicLevel&&e.scaleMode===q.SCALE_MODES.LINEAR&&(i=Math.min(e.anisotropicLevel,r.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),r.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY_EXT,i))):r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode===q.SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST),r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode===q.SCALE_MODES.LINEAR?r.LINEAR:r.NEAREST)},Ko),F={FilterSystem:rn,BatchSystem:on,ContextSystem:an,FramebufferSystem:ln,GeometrySystem:dn,MaskSystem:lo,ScissorSystem:co,StencilSystem:po,ProjectionSystem:fo,RenderTextureSystem:go,ShaderSystem:wo,StateSystem:Ho,TextureGCSystem:Go,TextureSystem:Wo},Yo=new Lt,V=(d(Zo,Bo=e),Zo.prototype.initPlugins=function(e){for(var t in e)this.plugins[t]=new e[t](this)},Object.defineProperty(Zo.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(Zo.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),Zo.prototype.resize=function(e,t){this.screen.width=e,this.screen.height=t,this.view.width=e*this.resolution,this.view.height=t*this.resolution,this.autoDensity&&(this.view.style.width=e+"px",this.view.style.height=t+"px"),this.emit("resize",e,t)},Zo.prototype.generateTexture=function(e,t,i,r){0===(r=r||e.getLocalBounds(null,!0)).width&&(r.width=1),0===r.height&&(r.height=1);t=kr.create({width:0|r.width,height:0|r.height,scaleMode:t,resolution:i});return Yo.tx=-r.x,Yo.ty=-r.y,this.render(e,t,!1,Yo,!!e.parent),t},Zo.prototype.destroy=function(e){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=q.RENDERER_TYPE.UNKNOWN,this.view=null,this.screen=null,this._tempDisplayObjectParent=null,this.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(Zo.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=Je(e),$e(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),Zo),Vo=(d(qo,Fo=V),qo.create=function(e){if(Ke())return new qo(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},qo.prototype.addSystem=function(e,t){t=t||e.name;var i,r=new e(this);if(this[t])throw new Error('Whoops! The name "'+t+'" is already in use');for(i in this[t]=r,this.runners)this.runners[i].add(r);return this},qo.prototype.render=function(e,t,i,r,n){this.renderingToScreen=!t,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=r,this.context.isLost||(t||(this._lastObjectRendered=e),n||(r=e.enableTempParent(),e.updateTransform(),e.disableTempParent(r)),this.renderTexture.bind(t),this.batch.currentRenderer.start(),(void 0!==i?i:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),t&&t.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender"))},qo.prototype.resize=function(e,t){Fo.prototype.resize.call(this,e,t),this.runners.resize.emit(e,t)},qo.prototype.reset=function(){return this.runners.reset.emit(),this},qo.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},qo.prototype.destroy=function(e){for(var t in this.runners.destroy.emit(),this.runners)this.runners[t].destroy();Fo.prototype.destroy.call(this,e),this.gl=null},qo.registerPlugin=function(e,t){(qo.__plugins=qo.__plugins||{})[e]=t},qo);function qo(e){var t=Fo.call(this,q.RENDERER_TYPE.WEBGL,e)||this;return e=t.options,t.gl=null,t.CONTEXT_UID=0,t.runners={destroy:new Li("destroy"),contextChange:new Li("contextChange"),reset:new Li("reset"),update:new Li("update"),postrender:new Li("postrender"),prerender:new Li("prerender"),resize:new Li("resize")},t.globalUniforms=new en({projectionMatrix:new Lt},!0),t.addSystem(lo,"mask").addSystem(an,"context").addSystem(Ho,"state").addSystem(wo,"shader").addSystem(Wo,"texture").addSystem(dn,"geometry").addSystem(ln,"framebuffer").addSystem(co,"scissor").addSystem(po,"stencil").addSystem(fo,"projection").addSystem(Go,"textureGC").addSystem(rn,"filter").addSystem(go,"renderTexture").addSystem(on,"batch"),t.initPlugins(qo.__plugins),e.context?t.context.initFromContext(e.context):t.context.initFromOptions({alpha:!!t.transparent,antialias:e.antialias,premultipliedAlpha:t.transparent&&"notMultiplied"!==t.transparent,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:t.options.powerPreference}),t.renderingToScreen=!0,Ze(2===t.context.webGLVersion?"WebGL 2":"WebGL 1"),t.resize(t.options.width,t.options.height),t}function Zo(e,t){void 0===e&&(e=q.RENDERER_TYPE.UNKNOWN);var i=Bo.call(this)||this;return(t=Object.assign({},_.RENDER_OPTIONS,t)).roundPixels&&(_.ROUND_PIXELS=t.roundPixels,f("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),i.options=t,i.type=e,i.screen=new x(0,0,t.width,t.height),i.view=t.view||document.createElement("canvas"),i.resolution=t.resolution||_.RESOLUTION,i.transparent=t.transparent,i.autoDensity=t.autoDensity||t.autoResize||!1,i.preserveDrawingBuffer=t.preserveDrawingBuffer,i.clearBeforeRender=t.clearBeforeRender,i._backgroundColor=0,i._backgroundColorRgba=[0,0,0,0],i._backgroundColorString="#000000",i.backgroundColor=t.backgroundColor||i._backgroundColor,i._lastObjectRendered=null,i.plugins={},i}function Ko(e){e=Xo.call(this,e)||this;return e.boundTextures=[],e.currentLocation=-1,e.managedTextures=[],e._unknownBoundTextures=!1,e.unknownTexture=new D,e}function $o(e){e=Uo.call(this,e)||this;return e.count=0,e.checkCount=0,e.maxIdle=_.GC_MAX_IDLE,e.checkCountMax=_.GC_MAX_CHECK_COUNT,e.mode=_.GC_MODE,e}function Jo(e){e=jo.call(this,e)||this;return e.gl=null,e.stateId=0,e.polygonOffset=0,e.blendMode=q.BLEND_MODES.NONE,e._blendEq=!1,e.map=[],e.map[0]=e.setBlend,e.map[1]=e.setOffset,e.map[2]=e.setCullFace,e.map[3]=e.setDepthTest,e.map[4]=e.setFrontFace,e.checks=[],e.defaultState=new so,e.defaultState.blend=!0,e}function Qo(e){return Vo.create(e)}var es,ts,is="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",rs="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",ns=function(){this.texArray=null,this.blend=0,this.type=q.DRAW_MODES.TRIANGLES,this.start=0,this.size=0,this.data=null},os=(ys.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},ys),ss=(Object.defineProperty(_s.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(_s.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(_s.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(_s.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(_s.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),_s.prototype.view=function(e){return this[e+"View"]},_s.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},_s.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},_s),as=(d(b,ts=nn),b.prototype.contextChange=function(){var e=this.renderer.gl;_.PREFER_ENV===q.ENV.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),_.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=Wn(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()},b.prototype.initFlushBuffers=function(){for(var e=b._drawCallPool,t=b._textureArrayPool,i=this.size/4,r=Math.floor(i/this.MAX_TEXTURES)+1;e.length<i;)e.push(new ns);for(;t.length<r;)t.push(new os);for(var n=0;n<this.MAX_TEXTURES;n++)this._tempBoundTextures[n]=null},b.prototype.onPrerender=function(){this._flushId=0},b.prototype.render=function(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},b.prototype.buildTexturesAndDrawCalls=function(){var e=this._bufferedTextures,t=this.MAX_TEXTURES,i=b._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count,s=++D._globalBatch,a=0,h=i[0],u=0;r.copyBoundTextures(n,t);for(var l=0;l<this._bufferSize;++l){var c=e[l];e[l]=null,c._batchEnabled!==s&&(h.count>=t&&(r.boundArray(h,n,s,t),this.buildDrawCalls(h,u,l),u=l,h=i[++a],++s),c._batchEnabled=s,c.touched=o,h.elements[h.count++]=c)}for(0<h.count&&(r.boundArray(h,n,s,t),this.buildDrawCalls(h,u,this._bufferSize),++a,++s),l=0;l<n.length;l++)n[l]=null;D._globalBatch=s},b.prototype.buildDrawCalls=function(e,t,i){var r=this._bufferedElements,n=this._attributeBuffer,o=this._indexBuffer,s=this.vertexSize,a=b._drawCallPool,h=this._dcIndex,u=this._aIndex,l=this._iIndex,c=a[h];c.start=this._iIndex,c.texArray=e;for(var p=t;p<i;++p){var d=r[p],f=d._texture.baseTexture,f=et[f.alphaMode?1:0][d.blendMode];r[p]=null,t<p&&c.blend!==f&&(c.size=l-c.start,t=p,(c=a[++h]).texArray=e,c.start=l),this.packInterleavedGeometry(d,n,o,u,l),u+=d.vertexData.length/2*s,l+=d.indices.length,c.blend=f}t<i&&(c.size=l-c.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=l},b.prototype.bindAndClearTexArray=function(e){for(var t=this.renderer.texture,i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0},b.prototype.updateGeometry=function(){var e=this._packedGeometries,t=this._attributeBuffer,i=this._indexBuffer;_.CAN_UPLOAD_SAME_BUFFER?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},b.prototype.drawBatches=function(){for(var e=this._dcIndex,t=this.renderer,i=t.gl,r=t.state,n=b._drawCallPool,o=null,s=0;s<e;s++){var a=n[s],h=a.texArray,u=a.type,l=a.size,c=a.start,a=a.blend;o!==h&&this.bindAndClearTexArray(o=h),this.state.blendMode=a,r.set(this.state),i.drawElements(u,l,i.UNSIGNED_SHORT,2*c)}},b.prototype.flush=function(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},b.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),_.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},b.prototype.stop=function(){this.flush()},b.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),ts.prototype.destroy.call(this)},b.prototype.getAttributeBuffer=function(e){var e=ht(Math.ceil(e/8)),t=lt(e),e=8*e,t=(this._aBuffers.length<=t&&(this._iBuffers.length=t+1),this._aBuffers[e]);return t||(this._aBuffers[e]=t=new ss(e*this.vertexSize*4)),t},b.prototype.getIndexBuffer=function(e){var e=ht(Math.ceil(e/12)),t=lt(e),e=12*e,i=(this._iBuffers.length<=t&&(this._iBuffers.length=t+1),this._iBuffers[t]);return i||(this._iBuffers[t]=i=new Uint16Array(e)),i},b.prototype.packInterleavedGeometry=function(e,t,i,r,n){for(var o=t.uint32View,s=t.float32View,a=r/this.vertexSize,h=e.uvs,u=e.indices,l=e.vertexData,c=e._texture.baseTexture._batchLocation,t=Math.min(e.worldAlpha,1),p=t<1&&e._texture.baseTexture.alphaMode?rt(e._tintRGB,t):e._tintRGB+(255*t<<24),d=0;d<l.length;d+=2)s[r++]=l[d],s[r++]=l[d+1],s[r++]=h[d],s[r++]=h[d+1],o[r++]=p,s[r++]=c;for(d=0;d<u.length;d++)i[n++]=a+u[d]},b._drawCallPool=[],b._textureArrayPool=[],b),hs=(ms.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),i=0;i<e;i++)t[i]=i;this.defaultGroupCache[e]=en.from({uSamplers:t},!0);var r=(r=(r=this.fragTemplate).replace(/%count%/gi,""+e)).replace(/%forloop%/gi,this.generateSampleSrc(e));this.programCache[e]=new no(this.vertexSrc,r)}r={tint:new Float32Array([1,1,1,1]),translationMatrix:new Lt,default:this.defaultGroupCache[e]};return new oo(this.programCache[e],r)},ms.prototype.generateSampleSrc=function(e){for(var t=(t="")+"\n"+"\n",i=0;i<e;i++)0<i&&(t+="\nelse "),i<e-1&&(t+="if(vTextureId < "+i+".5)"),t=(t+="\n{")+("\n\tcolor = texture2D(uSamplers["+i+"], vTextureCoord);")+"\n}";return(t+="\n")+"\n"},ms),us=(d(fs,es=Kr),fs),ls="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",cs="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",Le=(ds.create=function(e){var t,e=Object.assign({vertex:ls,fragment:cs,geometryClass:us,vertexSize:6},e),i=e.vertex,r=e.fragment,n=e.vertexSize,o=e.geometryClass;return d(s,t=as),s;function s(e){e=t.call(this,e)||this;return e.shaderGenerator=new hs(i,r),e.geometryClass=o,e.vertexSize=n,e}},Object.defineProperty(ds,"defaultVertexSrc",{get:function(){return ls},enumerable:!1,configurable:!0}),Object.defineProperty(ds,"defaultFragmentTemplate",{get:function(){return cs},enumerable:!1,configurable:!0}),ds),te=Le.create(),ee=(ps.registerPlugin=function(e){ps._plugins.push(e)},ps.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(ps.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(ps.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),ps.prototype.destroy=function(e,t){var i=this,r=ps._plugins.slice(0);r.reverse(),r.forEach(function(e){e.destroy.call(i)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null},ps);function ps(t){var i=this;t=Object.assign({forceCanvas:!1},t),this.renderer=Qo(t),this.stage=new yi,ps._plugins.forEach(function(e){e.init.call(i,t)})}function ds(){}function fs(e){void 0===e&&(e=!1);var t=es.call(this)||this;return t._buffer=new Rr(null,e,!1),t._indexBuffer=new Rr(null,e,!0),t.addAttribute("aVertexPosition",t._buffer,2,!1,q.TYPES.FLOAT).addAttribute("aTextureCoord",t._buffer,2,!1,q.TYPES.FLOAT).addAttribute("aColor",t._buffer,4,!0,q.TYPES.UNSIGNED_BYTE).addAttribute("aTextureId",t._buffer,1,!0,q.TYPES.FLOAT).addIndex(t._indexBuffer),t}function ms(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}function b(e){var t=ts.call(this,e)||this;return t.shaderGenerator=null,t.geometryClass=null,t.vertexSize=null,t.state=so.for2d(),t.size=4*_.SPRITE_BATCH_SIZE,t._vertexCount=0,t._indexCount=0,t._bufferedElements=[],t._bufferedTextures=[],t._bufferSize=0,t._shader=null,t._packedGeometries=[],t._packedGeometryPoolSize=2,t._flushId=0,t._aBuffers={},t._iBuffers={},t.MAX_TEXTURES=1,t.renderer.on("prerender",t.onPrerender,t),e.runners.contextChange.add(t),t._dcIndex=0,t._aIndex=0,t._iIndex=0,t._attributeBuffer=null,t._indexBuffer=null,t._tempBoundTextures=[],t}function _s(e){this.rawBinaryData=new ArrayBuffer(e),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}function ys(){this.elements=[],this.ids=[],this.count=0}function gs(){}ee._plugins=[],gs.init=function(e){var i=this;Object.defineProperty(this,"resizeTo",{set:function(e){window.removeEventListener("resize",this.queueResize),(this._resizeTo=e)&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){i._resizeTo&&(i.cancelResize(),i._resizeId=requestAnimationFrame(function(){return i.resize()}))},this.cancelResize=function(){i._resizeId&&(cancelAnimationFrame(i._resizeId),i._resizeId=null)},this.resize=function(){var e,t;i._resizeTo&&(i.cancelResize(),t=i._resizeTo===window?(e=window.innerWidth,window.innerHeight):(e=(t=i._resizeTo).clientWidth,t.clientHeight),i.renderer.resize(e,t))},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},gs.destroy=function(){window.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},ee.registerPlugin(gs);function vs(e,t){if(void 0===t&&(t={}),e){for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i=r.parser[t.strictMode?"strict":"loose"].exec(e),n={},o=14;o--;)n[r.key[o]]=i[o]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(e,t,i){t&&(n[r.q.name][t]=i)}),n}}var bs=new x,s=(ws.prototype.image=function(e,t,i){var r=new Image;return r.src=this.base64(e,t,i),r},ws.prototype.base64=function(e,t,i){return this.canvas(e).toDataURL(t,i)},ws.prototype.canvas=function(e){var t,i,r=this.renderer,n=!1,o=!1,e=(e&&(e instanceof kr?t=e:(t=this.renderer.generateTexture(e),o=!0)),t?(i=t.baseTexture.resolution,u=t.frame,n=!1,r.renderTexture.bind(t)):(i=this.renderer.resolution,n=!0,(u=bs).width=this.renderer.width,u.height=this.renderer.height,r.renderTexture.bind(null)),Math.floor(u.width*i+1e-4)),s=Math.floor(u.height*i+1e-4),a=new vt(e,s,1),h=new Uint8Array(4*e*s),r=r.gl,u=(r.readPixels(u.x*i,u.y*i,e,s,r.RGBA,r.UNSIGNED_BYTE,h),a.context.getImageData(0,0,e,s));return ws.arrayPostDivide(h,u.data),a.context.putImageData(u,0,0),n&&((i=new vt(a.width,a.height,1)).context.scale(1,-1),i.context.drawImage(a.canvas,0,-s),a.destroy(),a=i),o&&t.destroy(!0),a.canvas},ws.prototype.pixels=function(e){var t,i,r,n=this.renderer,o=!1,e=(e&&(e instanceof kr?r=e:(r=this.renderer.generateTexture(e),o=!0)),r?(t=r.baseTexture.resolution,i=r.frame,n.renderTexture.bind(r)):(t=n.resolution,(i=bs).width=n.width,i.height=n.height,n.renderTexture.bind(null)),i.width*t),s=i.height*t,a=new Uint8Array(4*e*s),n=n.gl;return n.readPixels(i.x*t,i.y*t,e,s,n.RGBA,n.UNSIGNED_BYTE,a),o&&r.destroy(!0),ws.arrayPostDivide(a,a),a},ws.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},ws.arrayPostDivide=function(e,t){for(var i=0;i<e.length;i+=4){var r=t[i+3]=e[i+3];0!==r?(t[i]=Math.round(Math.min(255*e[i]/r,255)),t[i+1]=Math.round(Math.min(255*e[i+1]/r,255)),t[i+2]=Math.round(Math.min(255*e[i+2]/r,255))):(t[i]=e[i],t[i+1]=e[i+1],t[i+2]=e[i+2])}},ws),xs=(y=L(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}i(s,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]);var o=s;function s(e,t,i){void 0===t&&(t=!1),n(this,s),this._fn=e,this._once=t,this._thisArg=i,this._next=this._prev=this._owner=null}function a(e,t){return e._head?(e._tail._next=t)._prev=e._tail:e._head=t,(e._tail=t)._owner=e,t}i(h,[{key:"handlers",value:function(){var e=this._head;if(!(arguments.length<=0||void 0===arguments[0])&&arguments[0])return!!e;for(var t=[];e;)t.push(e),e=e._next;return t}},{key:"has",value:function(e){if(e instanceof o)return e._owner===this;throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.")}},{key:"dispatch",value:function(){var e=arguments,t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,e),t=t._next;return!0}},{key:"add",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#add(): First arg must be a Function.");return a(this,new o(e,!1,t))}},{key:"once",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#once(): First arg must be a Function.");return a(this,new o(e,!0,t))}},{key:"detach",value:function(e){if(e instanceof o)return e._owner!==this||(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,null===e._next&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null),this;throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.")}},{key:"detachAll",value:function(){var e=this._head;if(e)for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this}}]);i=h;function h(){n(this,h),this._head=this._tail=void 0}i.MiniSignalBinding=o,t.default=i,e.exports=t.default}))&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y;function ws(e){(this.renderer=e).extract=this}function Ts(){}function Es(i,r,n,o){var s=0,a=i.length;!function e(t){t||s===a?n&&n(t):o?setTimeout(function(){r(i[s++],e)},1):r(i[s++],e)}()}function Is(t,e){if(null==e)e=1;else if(0===e)throw new Error("Concurrency must not be zero");var i=0,r={_tasks:[],concurrency:e,saturated:Ts,unsaturated:Ts,buffer:e/4,empty:Ts,drain:Ts,error:Ts,started:!1,paused:!1,push:function(e,t){n(e,!1,t)},kill:function(){i=0,r.drain=Ts,r.started=!1,r._tasks=[]},unshift:function(e,t){n(e,!0,t)},process:function(){for(;!r.paused&&i<r.concurrency&&r._tasks.length;){var e=r._tasks.shift();0===r._tasks.length&&r.empty(),(i+=1)===r.concurrency&&r.saturated(),t(e.data,function(t){return function(){if(null===t)throw new Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}}(function(e){return function(){--i,e.callback.apply(e,arguments),null!=arguments[0]&&r.error(arguments[0],e.data),i<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}(e)))}},length:function(){return r._tasks.length},running:function(){return i},idle:function(){return r._tasks.length+i===0},pause:function(){!0!==r.paused&&(r.paused=!0)},resume:function(){if(!1!==r.paused){r.paused=!1;for(var e=1;e<=r.concurrency;e++)r.process()}}};function n(e,t,i){if(null!=i&&"function"!=typeof i)throw new Error("task callback must be a function");r.started=!0,null==e&&r.idle()?setTimeout(function(){return r.drain()},1):(e={data:e,callback:"function"==typeof i?i:Ts},t?r._tasks.unshift(e):r._tasks.push(e),setTimeout(function(){return r.process()},1))}return r}var Ps={};function Ss(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function As(e,t,i){t&&Ss(e.prototype,t),i&&Ss(e,i)}var ks=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Os=null;function Ms(){}T.setExtensionLoadType=function(e,t){Cs(T._loadTypeMap,e,t)},T.setExtensionXhrType=function(e,t){Cs(T._xhrTypeMap,e,t)},(e=T.prototype).complete=function(){this._clearEvents(),this._finish()},e.abort=function(e){if(!this.error){if(this.error=new Error(e),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=T.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(e){var t=this;if(!this.isLoading)if(this.isComplete)e&&setTimeout(function(){return e(t)},1);else switch(e&&this.onComplete.once(e),this._setFlag(T.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case T.LOAD_TYPE.IMAGE:this.type=T.TYPE.IMAGE,this._loadElement("image");break;case T.LOAD_TYPE.AUDIO:this.type=T.TYPE.AUDIO,this._loadSourceElement("audio");break;case T.LOAD_TYPE.VIDEO:this.type=T.TYPE.VIDEO,this._loadSourceElement("video");break;default:T.LOAD_TYPE.XHR;ks&&this.crossOrigin?this._loadXdr():this._loadXhr()}},e._hasFlag=function(e){return 0!=(this._flags&e)},e._setFlag=function(e,t){this._flags=t?this._flags|e:this._flags&~e},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(T.STATUS_FLAGS.COMPLETE,!0),this._setFlag(T.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===e&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===e&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(e),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=this.metadata.mimeType,i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(e,this.url[i],Array.isArray(t)?t[i]:t));else{var r=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(r)?r[0]:r))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+e)},e._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XMLHttpRequest;e.open("GET",this.url,!0),e.timeout=this.timeout,this.xhrType===T.XHR_RESPONSE_TYPE.JSON||this.xhrType===T.XHR_RESPONSE_TYPE.DOCUMENT?e.responseType=T.XHR_RESPONSE_TYPE.TEXT:e.responseType=this.xhrType,e.addEventListener("error",this._boundXhrOnError,!1),e.addEventListener("timeout",this._boundXhrOnTimeout,!1),e.addEventListener("abort",this._boundXhrOnAbort,!1),e.addEventListener("progress",this._boundOnProgress,!1),e.addEventListener("load",this._boundXhrOnLoad,!1),e.send()},e._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout(function(){return e.send()},1)},e._createSource=function(e,t,i){i=i||e+"/"+this._getExtension(t);e=document.createElement("source");return e.src=t,e.type=i,e},e._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},e._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var e=this.xhr;this.abort(Rs(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},e._xhrOnTimeout=function(){var e=this.xhr;this.abort(Rs(e)+" Request timed out.")},e._xhrOnAbort=function(){var e=this.xhr;this.abort(Rs(e)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var e,t,i=this.xhr,r="",n=void 0===i.status?200:i.status;if(""!==i.responseType&&"text"!==i.responseType&&void 0!==i.responseType||(r=i.responseText),0===n&&(0<r.length||i.responseType===T.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2==(n/100|0)){if(this.xhrType===T.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=T.TYPE.TEXT;else if(this.xhrType===T.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=T.TYPE.JSON}catch(e){return void this.abort("Error trying to parse loaded json: "+e)}else if(this.xhrType===T.XHR_RESPONSE_TYPE.DOCUMENT)try{window.DOMParser?(e=new DOMParser,this.data=e.parseFromString(r,"text/xml")):((t=document.createElement("div")).innerHTML=r,this.data=t),this.type=T.TYPE.XML}catch(e){return void this.abort("Error trying to parse loaded xml: "+e)}else this.data=i.response||r;this.complete()}else this.abort("["+i.status+"] "+i.statusText+": "+i.responseURL)},e._determineCrossOrigin=function(e,t){if(0===e.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";t=t||window.location,(Os=Os||document.createElement("a")).href=e;var i=!(e=vs(Os.href,{strictMode:!0})).port&&""===t.port||e.port===t.port,r=e.protocol?e.protocol+":":"";return e.host===t.hostname&&i&&r===t.protocol?"":"anonymous"},e._determineXhrType=function(){return T._xhrTypeMap[this.extension]||T.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return T._loadTypeMap[this.extension]||T.LOAD_TYPE.XHR},e._getExtension=function(){var e,t,i=this.url;return(this.isDataUrl?(t=i.indexOf("/"),i.substring(t+1,i.indexOf(";",t))):(t=i.indexOf("?"),e=i.indexOf("#"),t=Math.min(-1<t?t:i.length,-1<e?e:i.length),(i=i.substring(0,t)).substring(i.lastIndexOf(".")+1))).toLowerCase()},e._getMimeFromXhrType=function(e){switch(e){case T.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case T.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case T.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case T.XHR_RESPONSE_TYPE.JSON:return"application/json";case T.XHR_RESPONSE_TYPE.DEFAULT:case T.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},As(T,[{key:"isDataUrl",get:function(){return this._hasFlag(T.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(T.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(T.STATUS_FLAGS.LOADING)}}]);var w=T;function T(e,t,i){if("string"!=typeof e||"string"!=typeof t)throw new Error("Both name and url are required for constructing a resource.");i=i||{},this._flags=0,this._setFlag(T.STATUS_FLAGS.DATA_URL,0===t.indexOf("data:")),this.name=e,this.url=t,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===i.crossOrigin?"anonymous":i.crossOrigin,this.timeout=i.timeout||0,this.loadType=i.loadType||this._determineLoadType(),this.xhrType=i.xhrType,this.metadata=i.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=T.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Ms,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new xs,this.onProgress=new xs,this.onComplete=new xs,this.onAfterMiddleware=new xs}function Cs(e,t,i){(t=t&&0===t.indexOf(".")?t.substring(1):t)&&(e[t]=i)}function Rs(e){return e.toString().replace("object ","")}w.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},w.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},w.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},w.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},w._loadTypeMap={gif:w.LOAD_TYPE.IMAGE,png:w.LOAD_TYPE.IMAGE,bmp:w.LOAD_TYPE.IMAGE,jpg:w.LOAD_TYPE.IMAGE,jpeg:w.LOAD_TYPE.IMAGE,tif:w.LOAD_TYPE.IMAGE,tiff:w.LOAD_TYPE.IMAGE,webp:w.LOAD_TYPE.IMAGE,tga:w.LOAD_TYPE.IMAGE,svg:w.LOAD_TYPE.IMAGE,"svg+xml":w.LOAD_TYPE.IMAGE,mp3:w.LOAD_TYPE.AUDIO,ogg:w.LOAD_TYPE.AUDIO,wav:w.LOAD_TYPE.AUDIO,mp4:w.LOAD_TYPE.VIDEO,webm:w.LOAD_TYPE.VIDEO},w._xhrTypeMap={xhtml:w.XHR_RESPONSE_TYPE.DOCUMENT,html:w.XHR_RESPONSE_TYPE.DOCUMENT,htm:w.XHR_RESPONSE_TYPE.DOCUMENT,xml:w.XHR_RESPONSE_TYPE.DOCUMENT,tmx:w.XHR_RESPONSE_TYPE.DOCUMENT,svg:w.XHR_RESPONSE_TYPE.DOCUMENT,tsx:w.XHR_RESPONSE_TYPE.DOCUMENT,gif:w.XHR_RESPONSE_TYPE.BLOB,png:w.XHR_RESPONSE_TYPE.BLOB,bmp:w.XHR_RESPONSE_TYPE.BLOB,jpg:w.XHR_RESPONSE_TYPE.BLOB,jpeg:w.XHR_RESPONSE_TYPE.BLOB,tif:w.XHR_RESPONSE_TYPE.BLOB,tiff:w.XHR_RESPONSE_TYPE.BLOB,webp:w.XHR_RESPONSE_TYPE.BLOB,tga:w.XHR_RESPONSE_TYPE.BLOB,json:w.XHR_RESPONSE_TYPE.JSON,text:w.XHR_RESPONSE_TYPE.TEXT,txt:w.XHR_RESPONSE_TYPE.TEXT,ttf:w.XHR_RESPONSE_TYPE.BUFFER,otf:w.XHR_RESPONSE_TYPE.BUFFER},w.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var Ds=window.URL||window.webkitURL,y={caching:function(e,t){var i=this;Ps[e.url]?(e.data=Ps[e.url],e.complete()):e.onComplete.once(function(){return Ps[i.url]=i.data}),t()},parsing:function(e,t){if(e.data&&e.xhr&&e.xhrType===w.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof e.data){var i;if(0===e.data.type.indexOf("image"))return i=Ds.createObjectURL(e.data),e.blob=e.data,e.data=new Image,e.data.src=i,e.type=w.TYPE.IMAGE,void(e.data.onload=function(){Ds.revokeObjectURL(i),e.data.onload=null,t()})}else{var r=e.xhr.getResponseHeader("content-type");if(r&&0===r.indexOf("image"))return e.data=new Image,e.data.src="data:"+r+";base64,"+function(e){for(var t="",i=0;i<e.length;){for(var r=[0,0,0],n=[0,0,0,0],o=0;o<r.length;++o)i<e.length?r[o]=255&e.charCodeAt(i++):r[o]=0;switch(n[0]=r[0]>>2,n[1]=(3&r[0])<<4|r[1]>>4,n[2]=(15&r[1])<<2|r[2]>>6,n[3]=63&r[2],i-(e.length-1)){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64}for(var s=0;s<n.length;++s)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n[s])}return t}(e.xhr.responseText),e.type=w.TYPE.IMAGE,void(e.data.onload=function(){e.data.onload=null,t()})}t()}},Ls=/(#[\w-]+)?$/,Ns=((e=Fs.prototype).add=function(e,t,i,r){if(Array.isArray(e))for(var n=0;n<e.length;++n)this.add(e[n]);else{if("object"==typeof e&&(r=t||e.callback||e.onComplete,t=(i=e).url,e=e.name||e.key||e.url),"string"!=typeof t&&(r=i,i=t,t=e),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof i&&(r=i,i=null),this.loading&&(!i||!i.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(t=this._prepareUrl(t),this.resources[e]=new w(e,t,i),"function"==typeof r&&this.resources[e].onAfterMiddleware.once(r),this.loading){for(var o=i.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var h=o.progressChunk*(s.length+1)/(s.length+2);o.children.push(this.resources[e]),o.progressChunk=h;for(var u=0;u<s.length;++u)s[u].progressChunk=h;this.resources[e].progressChunk=h}this._queue.push(this.resources[e])}return this},e.pre=function(e){return this._beforeMiddleware.push(e),this},e.use=function(e){return this._afterMiddleware.push(e),this},e.reset=function(){for(var e in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){e=this.resources[e];e._onLoadBinding&&e._onLoadBinding.detach(),e.isLoading&&e.abort()}return this.resources={},this},e.load=function(e){if("function"==typeof e&&this.onComplete.once(e),!this.loading)if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=100/this._queue._tasks.length,i=0;i<this._queue._tasks.length;++i)this._queue._tasks[i].data.progressChunk=t;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(e){var t=vs(e,{strictMode:!0}),t=t.protocol||!t.path||0===e.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e;return this.defaultQueryString&&(e=Ls.exec(t)[0],-1!==(t=t.substr(0,t.length-e.length)).indexOf("?")?t+="&"+this.defaultQueryString:t+="?"+this.defaultQueryString,t+=e),t},e._loadResource=function(i,e){var r=this;i._dequeue=e,Es(this._beforeMiddleware,function(e,t){e.call(r,i,function(){t(i.isComplete?{}:null)})},function(){i.isComplete?r._onLoad(i):(i._onLoadBinding=i.onComplete.once(r._onLoad,r),i.load())},!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(i){var r=this;i._onLoadBinding=null,this._resourcesParsing.push(i),i._dequeue(),Es(this._afterMiddleware,function(e,t){e.call(r,i,t)},function(){i.onAfterMiddleware.dispatch(i),r.progress=Math.min(100,r.progress+i.progressChunk),r.onProgress.dispatch(r,i),i.error?r.onError.dispatch(i.error,r,i):r.onLoad.dispatch(r,i),r._resourcesParsing.splice(r._resourcesParsing.indexOf(i),1),r._queue.idle()&&0===r._resourcesParsing.length&&r._onComplete()},!0)},As(Fs,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e}}]),Fs);function Fs(e,t){var i=this;void 0===t&&(t=10),this.baseUrl=e=void 0===e?"":e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(e,t){return i._loadResource(e,t)},this._queue=Is(this._boundLoadResource,t),this._queue.pause(),this.resources={},this.onProgress=new xs,this.onError=new xs,this.onLoad=new xs,this.onStart=new xs,this.onComplete=new xs;for(var r=0;r<Fs._defaultBeforeMiddleware.length;++r)this.pre(Fs._defaultBeforeMiddleware[r]);for(var n=0;n<Fs._defaultAfterMiddleware.length;++n)this.use(Fs._defaultAfterMiddleware[n])}Ns._defaultBeforeMiddleware=[],Ns._defaultAfterMiddleware=[],Ns.pre=function(e){return Ns._defaultBeforeMiddleware.push(e),Ns},Ns.use=function(e){return Ns._defaultAfterMiddleware.push(e),Ns};var Bs,Xs,Us=w,js=function(e,t){return(js=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},e=(Ws.use=function(e,t){e.data&&e.type===w.TYPE.IMAGE&&(e.texture=K.fromLoader(e.data,e.url,e.name)),t()},Ws),Hs=(js(Xs=Gs,Ys=Bs=Ns),Xs.prototype=null===Ys?Object.create(Ys):(zs.prototype=Ys.prototype,new zs),Gs.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(Gs,"shared",{get:function(){var e=Gs._shared;return e||((e=new Gs)._protected=!0,Gs._shared=e),e},enumerable:!1,configurable:!0}),Gs.registerPlugin=function(e){return Gs._plugins.push(e),e.add&&e.add(),Gs},Gs._plugins=[],Gs);function Gs(e,t){for(var i=Bs.call(this,e,t)||this,r=0;r<Gs._plugins.length;++r){var n=Gs._plugins[r],o=n.pre,n=n.use;o&&i.pre(o),n&&i.use(n)}return i._protected=!1,i}function zs(){this.constructor=Xs}function Ws(){}Hs.registerPlugin({use:y.parsing}),Hs.registerPlugin(e);qs.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?Hs.shared:new Hs},qs.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var Ys=qs,Vs=function(e,t){return(Vs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function qs(){}function Zs(e,t){function i(){this.constructor=e}Vs(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}Zs(ia,$s=yi),ia.prototype.setProperties=function(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])},ia.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(ia.prototype,"tint",{get:function(){return this._tint},set:function(e){$e(this._tint=e,this.tintRgb)},enumerable:!1,configurable:!0}),ia.prototype.render=function(e){var t=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return t.onChildrenChange(0)})),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},ia.prototype.onChildrenChange=function(e){for(var t=Math.floor(e/this._batchSize);this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID},ia.prototype.dispose=function(){if(this._buffers){for(var e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}},ia.prototype.destroy=function(e){$s.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null};var Ks,$s,y=ia,Js=(ta.prototype.initBuffers=function(){var e=this.geometry,t=0;this.indexBuffer=new Rr(ot(this.size),!0,!0),e.addIndex(this.indexBuffer);for(var i=this.dynamicStride=0;i<this.dynamicProperties.length;++i)(o=this.dynamicProperties[i]).offset=t,t+=o.size,this.dynamicStride+=o.size;for(var r=new ArrayBuffer(this.size*this.dynamicStride*4*4),n=(this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new Rr(this.dynamicData,!1,!1),0),i=this.staticStride=0;i<this.staticProperties.length;++i)(o=this.staticProperties[i]).offset=n,n+=o.size,this.staticStride+=o.size;r=new ArrayBuffer(this.size*this.staticStride*4*4);for(this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new Rr(this.staticData,!0,!1),i=0;i<this.dynamicProperties.length;++i){var o=this.dynamicProperties[i];e.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===q.TYPES.UNSIGNED_BYTE,o.type,4*this.dynamicStride,4*o.offset)}for(i=0;i<this.staticProperties.length;++i)o=this.staticProperties[i],e.addAttribute(o.attributeName,this.staticBuffer,0,o.type===q.TYPES.UNSIGNED_BYTE,o.type,4*this.staticStride,4*o.offset)},ta.prototype.uploadDynamic=function(e,t,i){for(var r=0;r<this.dynamicProperties.length;r++){var n=this.dynamicProperties[r];n.uploadFunction(e,t,i,n.type===q.TYPES.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++},ta.prototype.uploadStatic=function(e,t,i){for(var r=0;r<this.staticProperties.length;r++){var n=this.staticProperties[r];n.uploadFunction(e,t,i,n.type===q.TYPES.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++},ta.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},ta),Qs=(Zs(ea,Ks=nn),ea.prototype.render=function(e){var t=e.children,i=e._maxSize,r=e._batchSize,n=this.renderer,o=t.length;if(0!==o){i<o&&!e.autoResize&&(o=i);var s=(s=e._buffers)||(e._buffers=this.generateBuffers(e)),i=t[0]._texture.baseTexture,a=(this.state.blendMode=tt(e.blendMode,i.alphaMode),n.state.set(this.state),n.gl),h=e.worldTransform.copyTo(this.tempMatrix);h.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=it(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,i.alphaMode),this.shader.uniforms.uSampler=i,this.renderer.shader.bind(this.shader);for(var u=!1,l=0,c=0;l<o;l+=r,c+=1){var p=o-l,d=(r<p&&(p=r),c>=s.length&&s.push(this._generateOneMoreBuffer(e)),s[c]),f=(d.uploadDynamic(t,l,p),e._bufferUpdateIDs[c]||0);(u=u||d._updateID<f)&&(d._updateID=e._updateID,d.uploadStatic(t,l,p)),n.geometry.bind(d.geometry),a.drawElements(a.TRIANGLES,6*p,a.UNSIGNED_SHORT,0)}}},ea.prototype.generateBuffers=function(e){for(var t=[],i=e._maxSize,r=e._batchSize,n=e._properties,o=0;o<i;o+=r)t.push(new Js(this.properties,n,r));return t},ea.prototype._generateOneMoreBuffer=function(e){var t=e._batchSize,e=e._properties;return new Js(this.properties,e,t)},ea.prototype.uploadVertices=function(e,t,i,r,n,o){for(var s=0,a=0,h=0,u=0,l=0;l<i;++l){var c=e[t+l],p=c._texture,d=c.scale.x,f=c.scale.y,m=p.trim,p=p.orig;m?(s=(a=m.x-c.anchor.x*p.width)+m.width,h=(u=m.y-c.anchor.y*p.height)+m.height):(s=p.width*(1-c.anchor.x),a=p.width*-c.anchor.x,h=p.height*(1-c.anchor.y),u=p.height*-c.anchor.y),r[o]=a*d,r[o+1]=u*f,r[o+n]=s*d,r[o+n+1]=u*f,r[o+2*n]=s*d,r[o+2*n+1]=h*f,r[o+3*n]=a*d,r[o+3*n+1]=h*f,o+=4*n}},ea.prototype.uploadPosition=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s].position;r[o]=a.x,r[o+1]=a.y,r[o+n]=a.x,r[o+n+1]=a.y,r[o+2*n]=a.x,r[o+2*n+1]=a.y,r[o+3*n]=a.x,r[o+3*n+1]=a.y,o+=4*n}},ea.prototype.uploadRotation=function(e,t,i,r,n,o){for(var s=0;s<i;s++){var a=e[t+s].rotation;r[o]=a,r[o+n]=a,r[o+2*n]=a,r[o+3*n]=a,o+=4*n}},ea.prototype.uploadUvs=function(e,t,i,r,n,o){for(var s=0;s<i;++s){var a=e[t+s]._texture._uvs;a?(r[o]=a.x0,r[o+1]=a.y0,r[o+n]=a.x1,r[o+n+1]=a.y1,r[o+2*n]=a.x2,r[o+2*n+1]=a.y2,r[o+3*n]=a.x3,r[o+3*n+1]=a.y3):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+2*n]=0,r[o+2*n+1]=0,r[o+3*n]=0,r[o+3*n+1]=0),o+=4*n}},ea.prototype.uploadTint=function(e,t,i,r,n,o){for(var s=0;s<i;++s){var a=e[t+s],h=0<a._texture.baseTexture.alphaMode,u=a.alpha,h=u<1&&h?rt(a._tintRGB,u):a._tintRGB+(255*u<<24);r[o]=h,r[o+n]=h,r[o+2*n]=h,r[o+3*n]=h,o+=4*n}},ea.prototype.destroy=function(){Ks.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},ea);function ea(e){e=Ks.call(this,e)||this;return e.shader=null,e.properties=null,e.tempMatrix=new Lt,e.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:e.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:e.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:e.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:e.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:q.TYPES.UNSIGNED_BYTE,uploadFunction:e.uploadTint,offset:0}],e.shader=oo.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),e.state=so.for2d(),e}function ta(e,t,i){this.geometry=new Kr,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(var r=0;r<e.length;++r){var n={attributeName:(n=e[r]).attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||q.TYPES.FLOAT,offset:n.offset};(t[r]?this.dynamicProperties:this.staticProperties).push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}function ia(e,t,i,r){void 0===e&&(e=1500),void 0===i&&(i=16384),void 0===r&&(r=!1);var n=$s.call(this)||this;return 16384<i&&(i=16384),n._properties=[!1,!0,!1,!1,!1],n._maxSize=e,n._batchSize=i,n._buffers=null,n._bufferUpdateIDs=[],n._updateID=0,n.interactiveChildren=!1,n.blendMode=q.BLEND_MODES.NORMAL,n.autoResize=r,n.roundPixels=!0,n.baseTexture=null,n.setProperties(t),n._tint=0,n.tintRgb=new Float32Array(4),n.tint=16777215,n}(ua=q.LINE_JOIN||(q.LINE_JOIN={})).MITER="miter",ua.BEVEL="bevel",ua.ROUND="round",(ua=q.LINE_CAP||(q.LINE_CAP={})).BUTT="butt",ua.ROUND="round",ua.SQUARE="square";var ra={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(e,t){return void 0===t&&(t=20),this.adaptive&&e&&!isNaN(e)?((e=Math.ceil(e/this.maxLength))<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e):t}},na=(sa.prototype.clone=function(){var e=new sa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},sa.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1},sa.prototype.destroy=function(){this.texture=null,this.matrix=null},sa),oa=function(e,t){return(oa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function sa(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1,this.reset()}function aa(e,t){function i(){this.constructor=e}oa(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var ha={build:function(e){e.points=e.shape.points.slice()},triangulate:function(e,t){var i=e.points,r=e.holes,n=t.points,o=t.indices;if(6<=i.length){for(var s=[],a=0;a<r.length;a++){var h=r[a];s.push(i.length/2),i=i.concat(h.points)}var u=re(i,s,2);if(u){for(var l=n.length/2,a=0;a<u.length;a+=3)o.push(u[a]+l),o.push(u[a+1]+l),o.push(u[a+2]+l);for(a=0;a<i.length;a++)n.push(i[a])}}}},ua={build:function(e){var t,i,r=e.shape,n=e.points,o=r.x,s=r.y;if(n.length=0,i=e.type===q.SHAPES.CIRC?(t=r.radius,r.radius):(t=(e=e.shape).width,e.height),0!==t&&0!==i){var a=Math.floor(30*Math.sqrt(r.radius))||Math.floor(15*Math.sqrt(t+i));a/=2.3;for(var h=2*Math.PI/a,u=0;u<a-.5;u++)n.push(o+Math.sin(-h*u)*t,s+Math.cos(-h*u)*i);n.push(n[0],n[1])}},triangulate:function(e,t){var i=e.points,r=t.points,n=t.indices,o=r.length/2,s=o,t=e.shape,a=e.matrix,h=t.x,t=t.y;r.push(e.matrix?a.a*h+a.c*t+a.tx:h,e.matrix?a.b*h+a.d*t+a.ty:t);for(var u=0;u<i.length;u+=2)r.push(i[u],i[u+1]),n.push(o++,s,o)}},la={build:function(e){var t=e.shape,i=t.x,r=t.y,n=t.width,t=t.height,e=e.points;e.length=0,e.push(i,r,i+n,r,i+n,r+t,i,r+t)},triangulate:function(e,t){var e=e.points,i=t.points,r=i.length/2;i.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(r,1+r,2+r,1+r,2+r,3+r)}};function ca(e,t,i){return e+(t-e)*i}function pa(e,t,i,r,n,o,s){for(var a,h,u,l,c,p=s=void 0===s?[]:s,d=0;d<=20;++d)u=ca(e,i,c=d/20),a=ca(t,r,c),l=ca(i,n,c),h=ca(r,o,c),u=ca(u,l,c),l=ca(a,h,c),p.push(u,l)}var da={build:function(e){var t=e.shape,e=e.points,i=t.x,r=t.y,n=t.width,o=t.height,t=Math.max(0,Math.min(t.radius,Math.min(n,o)/2));e.length=0,t?(pa(i,r+t,i,r,i+t,r,e),pa(i+n-t,r,i+n,r,i+n,r+t,e),pa(i+n,r+o-t,i+n,r+o,i+n-t,r+o,e),pa(i+t,r+o,i,r+o,i,r+o-t,e)):e.push(i,r,i+n,r,i+n,r+o,i,r+o)},triangulate:function(e,t){for(var i=e.points,r=t.points,n=t.indices,o=r.length/2,s=re(i,null,2),a=0,h=s.length;a<h;a+=3)n.push(s[a]+o),n.push(s[a+1]+o),n.push(s[a+2]+o);for(a=0,h=i.length;a<h;a++)r.push(i[a],i[++a])}};function fa(e,t,i,r,n,o,s,a){var h,s=s?(h=r,-i):(h=-r,i),u=e+i*o+h,o=t+r*o+s;return a.push(e-i*n+h,t-r*n+s),a.push(u,o),2}function ma(e,t,i,r,n,o,s,a){var h=i-e,u=r-t,l=Math.atan2(h,u),c=Math.atan2(n-e,o-t),p=(a&&l<c?l+=2*Math.PI:!a&&c<l&&(c+=2*Math.PI),l),c=c-l,l=Math.abs(c),d=Math.sqrt(h*h+u*u),f=1+(15*l*Math.sqrt(d)/Math.PI>>0),m=c/f;if(p+=m,a){s.push(e,t),s.push(i,r);for(var _=1,y=p;_<f;_++,y+=m)s.push(e,t),s.push(e+Math.sin(y)*d,t+Math.cos(y)*d);s.push(e,t),s.push(n,o)}else{for(s.push(i,r),s.push(e,t),_=1,y=p;_<f;_++,y+=m)s.push(e+Math.sin(y)*d,t+Math.cos(y)*d),s.push(e,t);s.push(n,o),s.push(e,t)}return 2*f}function _a(e,t){if(e.lineStyle.native){var i=0,r=e.shape,n=e.points||r.points,r=r.type!==q.SHAPES.POLY||r.closeStroke;if(0!==n.length){var N=t.points,F=t.indices,B=n.length/2,o=N.length/2,s=o;for(N.push(n[0],n[1]),i=1;i<B;i++)N.push(n[2*i],n[2*i+1]),F.push(s,s+1),s++;r&&F.push(s,o)}}else{var r=t,t=(o=e).shape,a=o.points||t.points.slice(),e=r.closePointEps;if(0!==a.length){var h=o.lineStyle,o=new Rt(a[0],a[1]),u=new Rt(a[a.length-2],a[a.length-1]),t=t.type!==q.SHAPES.POLY||t.closeStroke,e=Math.abs(o.x-u.x)<e&&Math.abs(o.y-u.y)<e,l=(t&&(a=a.slice(),e&&(a.pop(),a.pop(),u.set(a[a.length-2],a[a.length-1])),e=.5*(o.x+u.x),u=.5*(u.y+o.y),a.unshift(e,u),a.push(e,u)),r.points),c=a.length/2,p=a.length,X=l.length/2,d=h.width/2,U=d*d,j=h.miterLimit*h.miterLimit,f=a[0],m=a[1],_=a[2],y=a[3],g=0,v=0,b=-(m-y),x=f-_,w=0,T=0,E=Math.sqrt(b*b+x*x),o=(b=b/E*d,x=x/E*d,h.alignment),I=2*(1-o),P=2*o;t||(h.cap===q.LINE_CAP.ROUND?p+=ma(f-b*(I-P)*.5,m-x*(I-P)*.5,f-b*I,m-x*I,f+b*P,m+x*P,l,!0)+2:h.cap===q.LINE_CAP.SQUARE&&(p+=fa(f,m,b,x,I,P,!0,l))),l.push(f-b*I,m-x*I),l.push(f+b*P,m+x*P);for(var S=1;S<c-1;++S){f=a[2*(S-1)],m=a[2*(S-1)+1],_=a[2*S],y=a[2*S+1],g=a[2*(S+1)],v=a[2*(S+1)+1],x=f-_,b=(b=-(m-y))/(E=Math.sqrt(b*b+x*x))*d,x=x/E*d,T=_-g;var A,k,O,M,C,H,w=(w=-(y-v))/(E=Math.sqrt(w*w+T*T))*d,T=T/E*d,R=_-f,G=m-y,z=_-g,W=v-y,D=G*z-W*R,L=D<0;Math.abs(D)<.1?(l.push(_-b*I,y-x*I),l.push(_+b*P,y+x*P)):(O=_+((k=(R*(M=(-w+g)*(-T+y)-(-w+_)*(-T+v))-z*(A=(-b+f)*(-x+y)-(-b+_)*(-x+m)))/D)-_)*I,M=y+((A=(W*A-G*M)/D)-y)*I,D=_-(k-_)*P,C=y-(A-y)*P,H=L?I:P,(k=(k-_)*(k-_)+(A-y)*(A-y))<=Math.min(R*R+G*G,z*z+W*W)+H*H*U?h.join===q.LINE_JOIN.BEVEL||j<k/U?(L?(l.push(O,M),l.push(_+b*P,y+x*P),l.push(O,M),l.push(_+w*P,y+T*P)):(l.push(_-b*I,y-x*I),l.push(D,C),l.push(_-w*I,y-T*I),l.push(D,C)),p+=2):h.join===q.LINE_JOIN.ROUND?L?(l.push(O,M),l.push(_+b*P,y+x*P),p+=ma(_,y,_+b*P,y+x*P,_+w*P,y+T*P,l,!0)+4,l.push(O,M),l.push(_+w*P,y+T*P)):(l.push(_-b*I,y-x*I),l.push(D,C),p+=ma(_,y,_-b*I,y-x*I,_-w*I,y-T*I,l,!1)+4,l.push(_-w*I,y-T*I),l.push(D,C)):(l.push(O,M),l.push(D,C)):(l.push(_-b*I,y-x*I),l.push(_+b*P,y+x*P),h.join===q.LINE_JOIN.BEVEL||j<k/U||(h.join===q.LINE_JOIN.ROUND?p+=L?ma(_,y,_+b*P,y+x*P,_+w*P,y+T*P,l,!0)+2:ma(_,y,_-b*I,y-x*I,_-w*I,y-T*I,l,!1)+2:(L?(l.push(D,C),l.push(D,C)):(l.push(O,M),l.push(O,M)),p+=2)),l.push(_-w*I,y-T*I),l.push(_+w*P,y+T*P),p+=2))}f=a[2*(c-2)],m=a[2*(c-2)+1],_=a[2*(c-1)],b=-(m-(y=a[2*(c-1)+1])),x=f-_,b/=E=Math.sqrt(b*b+x*x),l.push(_-(b*=d)*I,y-(x=x/E*d)*I),l.push(_+b*P,y+x*P),t||(h.cap===q.LINE_CAP.ROUND?p+=ma(_-b*(I-P)*.5,y-x*(I-P)*.5,_-b*I,y-x*I,_+b*P,y+x*P,l,!1)+2:h.cap===q.LINE_CAP.SQUARE&&(p+=fa(_,y,b,x,I,P,!1,l)));for(var Y=r.indices,V=ra.epsilon*ra.epsilon,S=X;S<p+X-2;++S)f=l[2*S],m=l[2*S+1],_=l[2*(S+1)],y=l[2*(S+1)+1],g=l[2*(S+2)],v=l[2*(S+2)+1],Math.abs(f*(y-v)+_*(v-m)+g*(m-y))<V||Y.push(S,S+1,S+2)}}}aa(Wa,ba=Mt);var ya,ga,va,ba,xa=Wa,wa=(za.curveTo=function(e,t,i,r,n,o){var s,a,h,u,l=o[o.length-2],c=o[o.length-1]-t,l=l-e,r=r-t,i=i-e,p=Math.abs(c*i-l*r);return p<1e-8||0===n?(o[o.length-2]===e&&o[o.length-1]===t||o.push(e,t),null):(o=c*c+l*l,h=r*r+i*i,u=c*r+l*i,o=(s=n*Math.sqrt(o)/p)*u/o,h=i*(s+(u=(p=n*Math.sqrt(h)/p)*u/h)),u=r*(s+u),{cx:(a=s*i+p*l)+e,cy:(e=s*r+p*c)+t,radius:n,startAngle:Math.atan2(c*(p+o)-e,l*(p+o)-a),endAngle:Math.atan2(u-e,h-a),anticlockwise:i*c<l*r})},za.arc=function(e,t,i,r,n,o,s,a,h){for(var s=s-o,u=ra._segmentsCount(Math.abs(s)*n,40*Math.ceil(Math.abs(s)/Pt)),l=s/(2*u),c=2*l,p=Math.cos(l),d=Math.sin(l),f=u-1,m=f%1/f,_=0;_<=f;++_){var y=l+o+c*(_+m*_),g=Math.cos(y),y=-Math.sin(y);h.push((p*g+d*y)*n+i,(p*-y+d*g)*n+r)}},za),Ta=(Ga.curveLength=function(e,t,i,r,n,o,s,a){for(var h,u,l,c,p,d,f,m,_=0,y=e,g=t,v=1;v<=10;++v)f=y-(p=(d=(m=(c=1-(h=v/10))*c)*c)*e+3*m*h*i+3*c*(u=h*h)*n+(l=u*h)*s),m=g-(d=d*t+3*m*h*r+3*c*u*o+l*a),y=p,g=d,_+=Math.sqrt(f*f+m*m);return _},Ga.curveTo=function(e,t,i,r,n,o,s){var a,h,u,l,c,p=s[s.length-2],d=s[s.length-1],f=(s.length-=2,ra._segmentsCount(Ga.curveLength(p,d,e,t,i,r,n,o)));s.push(p,d);for(var m,_=1;_<=f;++_)u=(h=(a=1-(m=_/f))*a)*a,c=(l=m*m)*m,s.push(u*p+3*h*m*e+3*a*l*i+c*n,u*d+3*h*m*t+3*a*l*r+c*o)},Ga),Ea=(Ha.curveLength=function(e,t,i,r,n,o){var n=e-2*i+n,o=t-2*r+o,i=2*i-2*e,e=2*r-2*t,r=4*(n*n+o*o),t=4*(n*i+o*e),n=i*i+e*e,o=2*Math.sqrt(r+t+n),i=Math.sqrt(r),e=2*r*i,s=2*Math.sqrt(n),a=t/i;return(e*o+i*t*(o-s)+(4*n*r-t*t)*Math.log((2*i+a+o)/(a+s)))/(4*e)},Ha.curveTo=function(e,t,i,r,n){for(var o=n[n.length-2],s=n[n.length-1],a=ra._segmentsCount(Ha.curveLength(o,s,e,t,i,r)),h=1;h<=a;++h){var u,l=h/a;n.push((u=o+(e-o)*l)+(e+(i-e)*l-u)*l,(u=s+(t-s)*l)+(t+(r-t)*l-u)*l)}},Ha),Ia=(ja.prototype.begin=function(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i},ja.prototype.end=function(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start},ja.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},ja),Pa=((ka={})[q.SHAPES.POLY]=ha,ka[q.SHAPES.CIRC]=ua,ka[q.SHAPES.ELIP]=ua,ka[q.SHAPES.RECT]=la,ka[q.SHAPES.RREC]=da,ka),Sa=[],Aa=[],ka={buildPoly:ha,buildCircle:ua,buildRectangle:la,buildRoundedRectangle:da,FILL_COMMANDS:Pa,BATCH_POOL:Sa,DRAW_CALL_POOL:Aa,buildLine:_a,Star:xa,ArcUtils:wa,BezierUtils:Ta,QuadraticUtils:Ea,BatchPart:Ia},Oa=(Ua.prototype.clone=function(){return new Ua(this.shape,this.fillStyle,this.lineStyle,this.matrix)},Ua.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},Ua),Ma=new Rt,Ca=new ai,Ra=(aa(P,va=us),Object.defineProperty(P.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),P.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0;for(var e=this.textureIds.length=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),Aa.push(this.drawCalls[e]);for(e=this.drawCalls.length=0;e<this.batches.length;e++){var t=this.batches[e];t.reset(),Sa.push(t)}this.batches.length=0},P.prototype.clear=function(){return 0<this.graphicsData.length&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},P.prototype.drawShape=function(e,t,i,r){e=new Oa(e,t=void 0===t?null:t,i=void 0===i?null:i,r=void 0===r?null:r);return this.graphicsData.push(e),this.dirty++,this},P.prototype.drawHole=function(e,t){return void 0===t&&(t=null),this.graphicsData.length?(e=new Oa(e,null,null,t),t=this.graphicsData[this.graphicsData.length-1],e.lineStyle=t.lineStyle,t.holes.push(e),this.dirty++,this):null},P.prototype.destroy=function(){va.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},P.prototype.containsPoint=function(e){for(var t=this.graphicsData,i=0;i<t.length;++i){var r=t[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(e,Ma):Ma.copyFrom(e),r.shape.contains(Ma.x,Ma.y))){var n=!1;if(r.holes)for(var o=0;o<r.holes.length;o++)if(r.holes[o].shape.contains(Ma.x,Ma.y)){n=!0;break}if(!n)return!0}}return!1},P.prototype.updateBatches=function(e){if(this.graphicsData.length){if(this.validateBatching()){this.cacheDirty=this.dirty;var t=this.uvs,i=this.graphicsData,r=null,n=null;0<this.batches.length&&(n=(r=this.batches[this.batches.length-1]).style);for(var o=this.shapeIndex;o<i.length;o++){this.shapeIndex++;var s=i[o],a=s.fillStyle,h=s.lineStyle;Pa[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix);for(var u=0;u<2;u++){var l,c,p,d=0===u?a:h;d.visible&&(p=d.texture.baseTexture,l=this.indices.length,c=this.points.length/2,p.wrapMode=q.WRAP_MODES.REPEAT,0===u?this.processFill(s):this.processLine(s),0!=(p=this.points.length/2-c)&&(r&&!this._compareStyles(n,d)&&(r.end(l,c),r=null),r||((r=Sa.pop()||new Ia).begin(d,l,c),this.batches.push(r),n=d),this.addUvs(this.points,t,d.texture,c,p,d.matrix)))}}var f=this.indices.length,m=this.points.length/2;r&&r.end(f,m),0!==this.batches.length?(this.indicesUint16&&this.indices.length===this.indicesUint16.length?this.indicesUint16.set(this.indices):this.indicesUint16=new(65535<m&&e?Uint32Array:Uint16Array)(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()):this.batchable=!0}}else this.batchable=!0},P.prototype._compareStyles=function(e,t){return!(!e||!t)&&e.texture.baseTexture===t.texture.baseTexture&&e.color+e.alpha===t.color+t.alpha&&!!e.native==!!t.native},P.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var e=0,t=this.graphicsData.length;e<t;e++){var i=this.graphicsData[e],r=i.fillStyle,i=i.lineStyle;if(r&&!r.texture.baseTexture.valid)return!1;if(i&&!i.texture.baseTexture.valid)return!1}return!0},P.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var e=this.batches,t=0,i=e.length;t<i;t++)for(var r=e[t],n=0;n<r.size;n++){var o=r.start+n;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}},P.prototype.isBatchable=function(){if(131070<this.points.length)return!1;for(var e=this.batches,t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<2*P.BATCHABLE_SIZE},P.prototype.buildDrawCalls=function(){for(var e=++D._globalBatch,t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Aa.push(this.drawCalls[t]);this.drawCalls.length=0;var i=this.colors,r=this.textureIds,n=Aa.pop(),o=(n||((n=new ns).texArray=new os),n.texArray.count=0,n.start=0,n.size=0,n.type=q.DRAW_MODES.TRIANGLES,0),s=null,a=!1,h=q.DRAW_MODES.TRIANGLES,u=0;for(this.drawCalls.push(n),t=0;t<this.batches.length;t++){var l=this.batches[t],c=l.style,p=c.texture.baseTexture;a!==!!c.native&&(h=(a=!!c.native)?q.DRAW_MODES.LINES:q.DRAW_MODES.TRIANGLES,s=null,o=8,e++),s!==p&&((s=p)._batchEnabled!==e&&(8===o&&(e++,(o=0)<n.size&&((n=Aa.pop())||((n=new ns).texArray=new os),this.drawCalls.push(n)),n.start=u,n.size=0,n.texArray.count=0,n.type=h),p.touched=1,p._batchEnabled=e,p._batchLocation=o,p.wrapMode=10497,n.texArray.elements[n.texArray.count++]=p,o++)),n.size+=l.size,u+=l.size,p=p._batchLocation,this.addColors(i,c.color,c.alpha,l.attribSize,l.attribStart),this.addTextureIds(r,p,l.attribSize,l.attribStart)}D._globalBatch=e,this.packAttributes()},P.prototype.packAttributes=function(){for(var e=this.points,t=this.uvs,i=this.colors,r=this.textureIds,n=new ArrayBuffer(3*e.length*4),o=new Float32Array(n),s=new Uint32Array(n),a=0,h=0;h<e.length/2;h++)o[a++]=e[2*h],o[a++]=e[2*h+1],o[a++]=t[2*h],o[a++]=t[2*h+1],s[a++]=i[h],o[a++]=r[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)},P.prototype.processFill=function(e){(e.holes.length?(this.processHoles(e.holes),ha):Pa[e.type]).triangulate(e,this)},P.prototype.processLine=function(e){_a(e,this);for(var t=0;t<e.holes.length;t++)_a(e.holes[t],this)},P.prototype.processHoles=function(e){for(var t=0;t<e.length;t++){var i=e[t];Pa[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}},P.prototype.calculateBounds=function(){var e=this._bounds,t=Ca,i=Lt.IDENTITY;this._bounds.clear(),t.clear();for(var r=0;r<this.graphicsData.length;r++){var n,o=this.graphicsData[r],s=o.shape,a=o.type,h=o.lineStyle,o=o.matrix||Lt.IDENTITY,u=0;h&&h.visible&&(n=h.alignment,u=h.width,a===q.SHAPES.POLY?u*=.5+Math.abs(.5-n):u*=Math.max(0,n)),i!==o&&(t.isEmpty()||(e.addBoundsMatrix(t,i),t.clear()),i=o),a===q.SHAPES.RECT||a===q.SHAPES.RREC?t.addFramePad(s.x,s.y,s.x+s.width,s.y+s.height,u,u):a===q.SHAPES.CIRC?t.addFramePad(s.x,s.y,s.x,s.y,s.radius+u,s.radius+u):a===q.SHAPES.ELIP?t.addFramePad(s.x,s.y,s.x,s.y,s.width+u,s.height+u):e.addVerticesMatrix(i,s.points,0,s.points.length,u,u)}t.isEmpty()||e.addBoundsMatrix(t,i),e.pad(this.boundsPadding,this.boundsPadding)},P.prototype.transformPoints=function(e,t){for(var i=0;i<e.length/2;i++){var r=e[2*i],n=e[2*i+1];e[2*i]=t.a*r+t.c*n+t.tx,e[2*i+1]=t.b*r+t.d*n+t.ty}},P.prototype.addColors=function(e,t,i,r,n){void 0===n&&(n=0);var o=rt((t>>16)+(65280&t)+((255&t)<<16),i);e.length=Math.max(e.length,n+r);for(var s=0;s<r;s++)e[n+s]=o},P.prototype.addTextureIds=function(e,t,i,r){void 0===r&&(r=0),e.length=Math.max(e.length,r+i);for(var n=0;n<i;n++)e[r+n]=t},P.prototype.addUvs=function(e,t,i,r,n,o){void 0===o&&(o=null);for(var s=0,a=t.length,h=i.frame;s<n;){var u,l=e[2*(r+s)],c=e[2*(r+s)+1];o&&(u=o.a*l+o.c*c+o.tx,c=o.b*l+o.d*c+o.ty,l=u),s++,t.push(l/h.width,c/h.height)}var p=i.baseTexture;(h.width<p.width||h.height<p.height)&&this.adjustUvs(t,i,a,n)},P.prototype.adjustUvs=function(e,t,i,r){for(var n=t.baseTexture,o=i+2*r,r=t.frame,s=r.width/n.width,a=r.height/n.height,h=r.x/r.width,u=r.y/r.height,l=Math.floor(e[i]+1e-6),c=Math.floor(e[i+1]+1e-6),p=i+2;p<o;p+=2)l=Math.min(l,Math.floor(e[p]+1e-6)),c=Math.min(c,Math.floor(e[p+1]+1e-6));for(h-=l,u-=c,p=i;p<o;p+=2)e[p]=(e[p]+h)*s,e[p+1]=(e[p+1]+u)*a},P.BATCHABLE_SIZE=100,P),Da=(aa(Xa,ga=na),Xa.prototype.clone=function(){var e=new Xa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e},Xa.prototype.reset=function(){ga.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},Xa),La=new Float32Array(3),Na={},Fa=(aa(E,ya=yi),Object.defineProperty(E.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),E.prototype.clone=function(){return this.finishPoly(),new E(this._geometry)},Object.defineProperty(E.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),E.prototype.lineStyle=function(e){var t;return"number"==typeof(e=void 0===e?null:e)&&(e={width:(t=arguments)[0]||0,color:t[1]||0,alpha:void 0!==t[2]?t[2]:1,alignment:void 0!==t[3]?t[3]:.5,native:!!t[4]}),this.lineTextureStyle(e)},E.prototype.lineTextureStyle=function(t){"number"==typeof t&&(f("v5.2.0","Please use object-based options for Graphics#lineTextureStyle"),t={width:(e=arguments)[0],texture:e[1],color:e[2],alpha:e[3],matrix:e[4],alignment:e[5],native:e[6]},Object.keys(t).forEach(function(e){return void 0===t[e]&&delete t[e]})),t=Object.assign({width:0,texture:K.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:q.LINE_CAP.BUTT,join:q.LINE_JOIN.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var e=0<t.width&&0<t.alpha;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this},E.prototype.startPoly=function(){var e,t;this.currentPath?(e=this.currentPath.points,2<(t=this.currentPath.points.length)&&(this.drawShape(this.currentPath),this.currentPath=new Mt,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))):(this.currentPath=new Mt,this.currentPath.closeStroke=!1)},E.prototype.finishPoly=function(){this.currentPath&&(2<this.currentPath.points.length?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},E.prototype.moveTo=function(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this},E.prototype.lineTo=function(e,t){this.currentPath||this.moveTo(0,0);var i=this.currentPath.points,r=i[i.length-2],n=i[i.length-1];return r===e&&n===t||i.push(e,t),this},E.prototype._initCurve=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)},E.prototype.quadraticCurveTo=function(e,t,i,r){this._initCurve();var n=this.currentPath.points;return 0===n.length&&this.moveTo(0,0),Ea.curveTo(e,t,i,r,n),this},E.prototype.bezierCurveTo=function(e,t,i,r,n,o){return this._initCurve(),Ta.curveTo(e,t,i,r,n,o,this.currentPath.points),this},E.prototype.arcTo=function(e,t,i,r,n){this._initCurve(e,t);var o=this.currentPath.points,e=wa.curveTo(e,t,i,r,n,o);return e&&(t=e.cx,i=e.cy,r=e.radius,n=e.startAngle,o=e.endAngle,e=e.anticlockwise,this.arc(t,i,r,n,o,e)),this},E.prototype.arc=function(e,t,i,r,n,o){var s,a,h,u,l,c;return void 0===o&&(o=!1),r!==n&&(!o&&n<=r?n+=Pt:o&&r<=n&&(r+=Pt),0!=n-r&&(s=e+Math.cos(r)*i,a=t+Math.sin(r)*i,h=this._geometry.closePointEps,(u=this.currentPath?this.currentPath.points:null)?(l=Math.abs(u[u.length-2]-s),c=Math.abs(u[u.length-1]-a),l<h&&c<h||u.push(s,a)):(this.moveTo(s,a),u=this.currentPath.points),wa.arc(s,a,e,t,i,r,n,o,u))),this},E.prototype.beginFill=function(e,t){return this.beginTextureFill({texture:K.WHITE,color:e=void 0===e?0:e,alpha:t=void 0===t?1:t})},E.prototype.beginTextureFill=function(t){t instanceof K&&(f("v5.2.0","Please use object-based options for Graphics#beginTextureFill"),t={texture:(e=arguments)[0],color:e[1],alpha:e[2],matrix:e[3]},Object.keys(t).forEach(function(e){return void 0===t[e]&&delete t[e]})),t=Object.assign({texture:K.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var e=0<t.alpha;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this},E.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},E.prototype.drawRect=function(e,t,i,r){return this.drawShape(new x(e,t,i,r))},E.prototype.drawRoundedRect=function(e,t,i,r,n){return this.drawShape(new Ct(e,t,i,r,n))},E.prototype.drawCircle=function(e,t,i){return this.drawShape(new kt(e,t,i))},E.prototype.drawEllipse=function(e,t,i,r){return this.drawShape(new Ot(e,t,i,r))},E.prototype.drawPolygon=function(){for(var e=arguments,t=[],i=0;i<arguments.length;i++)t[i]=e[i];var r=!0,n=t[0],n=n.points?(r=n.closeStroke,n.points):Array.isArray(t[0])?t[0]:t,n=new Mt(n);return n.closeStroke=r,this.drawShape(n),this},E.prototype.drawShape=function(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},E.prototype.drawStar=function(e,t,i,r,n,o){return this.drawPolygon(new xa(e,t,i,r,n,o=void 0===o?0:o))},E.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},E.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return 1===e.length&&e[0].shape.type===q.SHAPES.RECT&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)},E.prototype._render=function(e){this.finishPoly();var t=this._geometry,i=e.context.supports.uint32Indices;t.updateBatches(i),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))},E.prototype._populateBatches=function(){var e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(var r=0;r<i;r++){var n=e.batches[r],o=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),a=new Float32Array(e.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),s={vertexData:s,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*n.start,n.size),uvs:a,_batchRGB:$e(o),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=s}},E.prototype._renderBatched=function(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var t=0,i=this.batches.length;t<i;t++){var r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,e.plugins[this.pluginName].render(r)}}},E.prototype._renderDirect=function(e){var t=this._resolveDirectShader(e),i=this._geometry,r=this.tint,n=this.worldAlpha,o=t.uniforms,s=i.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(r>>16&255)/255*n,o.tint[1]=(r>>8&255)/255*n,o.tint[2]=(255&r)/255*n,o.tint[3]=n,e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(var a=0,h=s.length;a<h;a++)this._renderDrawCallDirect(e,i.drawCalls[a])},E.prototype._renderDrawCallDirect=function(e,t){for(var i=t.texArray,r=t.type,n=t.size,t=t.start,o=i.count,s=0;s<o;s++)e.texture.bind(i.elements[s],s);e.geometry.draw(r,n,t)},E.prototype._resolveDirectShader=function(e){var t=this.shader,i=this.pluginName;if(!t){if(!Na[i]){for(var r=e.plugins.batch.MAX_TEXTURES,n=new Int32Array(r),o=0;o<r;o++)n[o]=o;var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Lt,default:en.from({uSamplers:n},!0)},e=e.plugins[i]._shader.program;Na[i]=new oo(e,s)}t=Na[i]}return t},E.prototype._calculateBounds=function(){this.finishPoly();var e,t,i,r=this._geometry;r.graphicsData.length&&(e=(r=r.bounds).minX,t=r.minY,i=r.maxX,r=r.maxY,this._bounds.addFrame(this.transform,e,t,i,r))},E.prototype.containsPoint=function(e){return this.worldTransform.applyInverse(e,E._TEMP_POINT),this._geometry.containsPoint(E._TEMP_POINT)},E.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var e=$e(this.tint,La),t=0;t<this.batches.length;t++){var i=this.batches[t],r=i._batchRGB,r=(e[0]*r[0]*255<<16)+(e[1]*r[1]*255<<8)+(0|e[2]*r[2]*255);i._tintRGB=(r>>16)+(65280&r)+((255&r)<<16)}}},E.prototype.calculateVertices=function(){var e=this.transform._worldID;if(this._transformID!==e){this._transformID=e;for(var e=this.transform.worldTransform,t=e.a,i=e.b,r=e.c,n=e.d,o=e.tx,s=e.ty,a=this._geometry.points,h=this.vertexData,u=0,l=0;l<a.length;l+=2){var c=a[l],p=a[l+1];h[u++]=t*c+r*p+o,h[u++]=n*p+i*c+s}}},E.prototype.closePath=function(){var e=this.currentPath;return e&&(e.closeStroke=!0),this},E.prototype.setMatrix=function(e){return this._matrix=e,this},E.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},E.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},E.prototype.destroy=function(e){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,ya.prototype.destroy.call(this,e)},E._TEMP_POINT=new Rt,E),Ba=function(e,t){return(Ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function E(e){void 0===e&&(e=null);var t=ya.call(this)||this;return t._geometry=e||new Ra,t._geometry.refCount++,t.shader=null,t.state=so.for2d(),t._fillStyle=new na,t._lineStyle=new Da,t._matrix=null,t._holeMode=!1,t.currentPath=null,t.batches=[],t.batchTint=-1,t.batchDirty=-1,t.vertexData=null,t.pluginName="batch",t._transformID=-1,t.tint=16777215,t.blendMode=q.BLEND_MODES.NORMAL,t}function Xa(){var e=null!==ga&&ga.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=q.LINE_CAP.BUTT,e.join=q.LINE_JOIN.MITER,e.miterLimit=10,e}function P(){var e=va.call(this)||this;return e.uvsFloat32=null,e.indicesUint16=null,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.dirty=0,e.batchDirty=-1,e.cacheDirty=-1,e.clearDirty=0,e.drawCalls=[],e.batches=[],e.shapeIndex=0,e._bounds=new ai,e.boundsDirty=-1,e.boundsPadding=0,e.batchable=!1,e.indicesUint16=null,e.uvsFloat32=null,e.closePointEps=1e-4,e}function Ua(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=r,this.type=e.type,this.points=[],this.holes=[]}function ja(){this.reset()}function Ha(){}function Ga(){}function za(){}function Wa(e,t,i,r,n,o){void 0===o&&(o=0),n=n||r/2;for(var s=-1*Math.PI/2+o,a=2*i,h=Pt/a,u=[],l=0;l<a;l++){var c=l%2?n:r,p=l*h+s;u.push(e+c*Math.cos(p),t+c*Math.sin(p))}return ba.call(this,u)||this}var Ya,Va,qa=new Rt,Za=new Uint16Array([0,1,2,0,2,3]),Ka=(Ba(Va=Ja,ua=Ya=yi),Va.prototype=null===ua?Object.create(ua):(Qa.prototype=ua.prototype,new Qa),Ja.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=pt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=pt(this.scale.y)*this._height/this._texture.orig.height)},Ja.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},Ja.prototype.calculateVertices=function(){var e=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==e._updateID){this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;var t=this.transform.worldTransform,i=t.a,r=t.b,n=t.c,o=t.d,s=t.tx,t=t.ty,a=this.vertexData,h=e.trim,e=e.orig,u=this._anchor,l=0,c=0,p=0,d=0,p=h?(l=(c=h.x-u._x*e.width)+h.width,(d=h.y-u._y*e.height)+h.height):(l=(c=-u._x*e.width)+e.width,(d=-u._y*e.height)+e.height);if(a[0]=i*c+n*d+s,a[1]=o*d+r*c+t,a[2]=i*l+n*d+s,a[3]=o*d+r*l+t,a[4]=i*l+n*p+s,a[5]=o*p+r*l+t,a[6]=i*c+n*p+s,a[7]=o*p+r*c+t,this._roundPixels)for(var f=_.RESOLUTION,m=0;m<a.length;++m)a[m]=Math.round((a[m]*f|0)/f)}},Ja.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var e=this._texture,t=this.vertexTrimmedData,e=e.orig,i=this._anchor,r=this.transform.worldTransform,n=r.a,o=r.b,s=r.c,a=r.d,h=r.tx,r=r.ty,u=-i._x*e.width,l=u+e.width,i=-i._y*e.height,e=i+e.height;t[0]=n*u+s*i+h,t[1]=a*i+o*u+r,t[2]=n*l+s*i+h,t[3]=a*i+o*l+r,t[4]=n*l+s*e+h,t[5]=a*e+o*l+r,t[6]=n*u+s*e+h,t[7]=a*e+o*u+r},Ja.prototype._render=function(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},Ja.prototype._calculateBounds=function(){var e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},Ja.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new x),e=this._localBoundsRect),this._bounds.getRectangle(e)):Ya.prototype.getLocalBounds.call(this,e)},Ja.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,qa);var e=this._texture.orig.width,t=this._texture.orig.height,i=-e*this.anchor.x;return qa.x>=i&&qa.x<i+e&&(i=-t*this.anchor.y,qa.y>=i&&qa.y<i+t)},Ja.prototype.destroy=function(e){Ya.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,("boolean"==typeof e?e:e&&e.texture)&&(e="boolean"==typeof e?e:e&&e.baseTexture,this._texture.destroy(!!e)),this._texture=null},Ja.from=function(e,t){return new Ja(e instanceof K?e:K.from(e,t))},Object.defineProperty(Ja.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ja.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){var t=pt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ja.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){var t=pt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(Ja.prototype,"anchor",{get:function(){return this._anchor},set:function(e){this._anchor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(Ja.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e,this._tintRGB=(e>>16)+(65280&e)+((255&e)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(Ja.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||K.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),Ja),$a=function(e,t){return($a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Ja(e){var t=Ya.call(this)||this;return t._anchor=new Dt(t._onAnchorUpdate,t,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),t._texture=null,t._width=0,t._height=0,t._tint=null,t._tintRGB=null,t.tint=16777215,t.blendMode=q.BLEND_MODES.NORMAL,t._cachedTint=16777215,t.uvs=null,t.texture=e||K.EMPTY,t.vertexData=new Float32Array(8),t.vertexTrimmedData=null,t._transformID=-1,t._textureID=-1,t._transformTrimmedID=-1,t._textureTrimmedID=-1,t.indices=Za,t.pluginName="batch",t.isSprite=!0,t._roundPixels=_.ROUND_PIXELS,t}function Qa(){this.constructor=Va}(la=q.TEXT_GRADIENT||(q.TEXT_GRADIENT={}))[la.LINEAR_VERTICAL=0]="LINEAR_VERTICAL";var eh={align:"left",breakWords:!(la[la.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"),dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:q.TEXT_GRADIENT.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},th=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],ih=(S.prototype.clone=function(){var e={};return oh(e,this,eh),new S(e)},S.prototype.reset=function(){oh(this,eh,eh)},Object.defineProperty(S.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){e=nh(e);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fill",{get:function(){return this._fill},set:function(e){e=nh(e);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){!function(e,t){if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){for(var i=0;i<e.length;++i)if(e[i]!==t[i])return;return 1}}(this._fillGradientStops,e)&&(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"stroke",{get:function(){return this._stroke},set:function(e){e=nh(e);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(S.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),S.prototype.toFontString=function(){for(var e="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,t=this.fontFamily,i=(t=Array.isArray(this.fontFamily)?t:this.fontFamily.split(",")).length-1;0<=i;i--){var r=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&th.indexOf(r)<0&&(r='"'+r+'"'),t[i]=r}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},S);function S(e){this.styleID=0,this.reset(),oh(this,e,e)}function rh(e){return"number"==typeof e?Je(e):e="string"==typeof e&&0===e.indexOf("0x")?e.replace("0x","#"):e}function nh(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)e[t]=rh(e[t]);return e}return rh(e)}function oh(e,t,i){for(var r in i)Array.isArray(t[r])?e[r]=t[r].slice():e[r]=t[r]}A.measureText=function(e,t,i,r){void 0===r&&(r=A._canvas),i=null==i?t.wordWrap:i;var n=t.toFontString(),o=A.measureFont(n),s=(0===o.fontSize&&(o.fontSize=t.fontSize,o.ascent=t.fontSize),r.getContext("2d"));s.font=n;for(var a=(i?A.wordWrap(e,t,r):e).split(/(?:\r\n|\r|\n)/),h=new Array(a.length),u=0,l=0;l<a.length;l++){var c=s.measureText(a[l]).width+(a[l].length-1)*t.letterSpacing;h[l]=c,u=Math.max(u,c)}n=u+t.strokeThickness,t.dropShadow&&(n+=t.dropShadowDistance),i=t.lineHeight||o.fontSize+t.strokeThickness,r=Math.max(i,o.fontSize+t.strokeThickness)+(a.length-1)*(i+t.leading);return t.dropShadow&&(r+=t.dropShadowDistance),new A(e,t,n,r,a,h,i+t.leading,u,o)},A.wordWrap=function(e,t,i){for(var r=(i=void 0===i?A._canvas:i).getContext("2d"),n=0,o="",s="",a=Object.create(null),h=t.letterSpacing,i=t.whiteSpace,u=A.collapseSpaces(i),l=A.collapseNewlines(i),c=!u,p=t.wordWrapWidth+h,d=A.tokenize(e),f=0;f<d.length;f++){var m=d[f];if(A.isNewline(m)){if(!l){s+=A.addLine(o),c=!u,o="",n=0;continue}m=" "}if(u){var _=A.isBreakingSpace(m),y=A.isBreakingSpace(o[o.length-1]);if(_&&y)continue}_=A.getFromCache(m,h,a,r);if(p<_)if(""!==o&&(s+=A.addLine(o),o="",n=0),A.canBreakWords(m,t.breakWords))for(var g=A.wordWrapSplit(m),v=0;v<g.length;v++){for(var b=g[v],x=1;g[v+x];){var w=g[v+x],T=b[b.length-1];if(A.canBreakChars(T,w,m,v,t.breakWords))break;b+=w,x++}v+=b.length-1;var E=A.getFromCache(b,h,a,r);p<E+n&&(s+=A.addLine(o),c=!1,o="",n=0),o+=b,n+=E}else{0<o.length&&(s+=A.addLine(o),o="",n=0);y=f===d.length-1;s+=A.addLine(m,!y),c=!1,o="",n=0}else p<_+n&&(c=!1,s+=A.addLine(o),o="",n=0),(0<o.length||!A.isBreakingSpace(m)||c)&&(o+=m,n+=_)}return s+A.addLine(o,!1)},A.addLine=function(e,t){return void 0===t&&(t=!0),e=A.trimRight(e),t?e+"\n":e},A.getFromCache=function(e,t,i,r){var n=i[e];return"number"!=typeof n&&(t=e.length*t,n=r.measureText(e).width+t,i[e]=n),n},A.collapseSpaces=function(e){return"normal"===e||"pre-line"===e},A.collapseNewlines=function(e){return"normal"===e},A.trimRight=function(e){if("string"!=typeof e)return"";for(var t=e.length-1;0<=t;t--){var i=e[t];if(!A.isBreakingSpace(i))break;e=e.slice(0,-1)}return e},A.isNewline=function(e){return"string"==typeof e&&0<=A._newlines.indexOf(e.charCodeAt(0))},A.isBreakingSpace=function(e){return"string"==typeof e&&0<=A._breakingSpaces.indexOf(e.charCodeAt(0))},A.tokenize=function(e){var t=[],i="";if("string"==typeof e){for(var r=0;r<e.length;r++){var n=e[r];A.isBreakingSpace(n)||A.isNewline(n)?(""!==i&&(t.push(i),i=""),t.push(n)):i+=n}""!==i&&t.push(i)}return t},A.canBreakWords=function(e,t){return t},A.canBreakChars=function(e,t,i,r,n){return!0},A.wordWrapSplit=function(e){return e.split("")},A.measureFont=function(e){if(A._fonts[e])return A._fonts[e];for(var t={ascent:0,descent:0,fontSize:0},i=A._canvas,r=A._context,n=(r.font=e,A.METRICS_STRING+A.BASELINE_SYMBOL),o=Math.ceil(r.measureText(n).width),s=2*(a=Math.ceil(r.measureText(A.BASELINE_SYMBOL).width)),a=a*A.BASELINE_MULTIPLIER|0,h=(i.width=o,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,o,s),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,a),r.getImageData(0,0,o,s).data),i=h.length,u=4*o,l=0,c=0,p=!1,l=0;l<a;++l){for(var d=0;d<u;d+=4)if(255!==h[c+d]){p=!0;break}if(p)break;c+=u}for(t.ascent=a-l,c=i-u,p=!1,l=s;a<l;--l){for(d=0;d<u;d+=4)if(255!==h[c+d]){p=!0;break}if(p)break;c-=u}return t.descent=l-a,t.fontSize=t.ascent+t.descent,A._fonts[e]=t},A.clearMetrics=function(e){(e=void 0===e?"":e)?delete A._fonts[e]:A._fonts={}};var sh=A,da=function(){try{var e=new OffscreenCanvas(0,0),t=e.getContext("2d");return t&&t.measureText?e:document.createElement("canvas")}catch(e){return document.createElement("canvas")}}();function A(e,t,i,r,n,o,s,a,h){this.text=e,this.style=t,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=h}da.width=da.height=10,sh._canvas=da,sh._context=da.getContext("2d"),sh._fonts={},sh.METRICS_STRING="|ÉqÅ",sh.BASELINE_SYMBOL="M",sh.BASELINE_MULTIPLIER=1.4,sh._newlines=[10,13];var ah,hh,uh={texture:!0,children:!(sh._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]),baseTexture:!0},lh=($a(hh=ch,ua=ah=Ka),hh.prototype=null===ua?Object.create(ua):(ph.prototype=ua.prototype,new ph),ch.prototype.updateText=function(e){var t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),this.dirty||!e){this._font=this._style.toFontString();var i,r,n=this.context,o=sh.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),e=o.width,s=o.height,a=o.lines,h=o.lineHeight,u=o.lineWidths,l=o.maxLineWidth,c=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,e)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,s)+2*t.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=t.strokeThickness,n.textBaseline=t.textBaseline,n.lineJoin=t.lineJoin,n.miterLimit=t.miterLimit;for(var p=t.dropShadow?2:1,d=0;d<p;++d){var f,m,_=t.dropShadow&&0===d,y=_?Math.ceil(Math.max(1,s)+2*t.padding):0,g=y*this._resolution;_?(n.fillStyle="black",n.strokeStyle="black",_=$e("number"==typeof(_=t.dropShadowColor)?_:Qe(_)),f=t.dropShadowBlur*this._resolution,m=t.dropShadowDistance*this._resolution,n.shadowColor="rgba("+255*_[0]+","+255*_[1]+","+255*_[2]+","+t.dropShadowAlpha+")",n.shadowBlur=f,n.shadowOffsetX=Math.cos(t.dropShadowAngle)*m,n.shadowOffsetY=Math.sin(t.dropShadowAngle)*m+g):(n.fillStyle=this._generateFillStyle(t,a,o),n.strokeStyle=t.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0);for(var v=0;v<a.length;v++)i=t.strokeThickness/2,r=t.strokeThickness/2+v*h+c.ascent,"right"===t.align?i+=l-u[v]:"center"===t.align&&(i+=(l-u[v])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[v],i+t.padding,r+t.padding-y,!0),t.fill&&this.drawLetterSpacing(a[v],i+t.padding,r+t.padding-y)}this.updateTexture()}},ch.prototype.drawLetterSpacing=function(e,t,i,r){void 0===r&&(r=!1);var n=this._style.letterSpacing;if(0!==n)for(var o=t,s=Array.from?Array.from(e):e.split(""),a=this.context.measureText(e).width,h=0;h<s.length;++h){var u=s[h];r?this.context.strokeText(u,o,i):this.context.fillText(u,o,i),o+=a-(u=this.context.measureText(e.substring(h+1)).width)+n,a=u}else r?this.context.strokeText(e,t,i):this.context.fillText(e,t,i)},ch.prototype.updateTexture=function(){var e=this.canvas,t=(!this._style.trim||(t=xt(e)).data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0)),this._texture),i=this._style,i=i.trim?0:i.padding,r=t.baseTexture;t.trim.width=t._frame.width=Math.ceil(e.width/this._resolution),t.trim.height=t._frame.height=Math.ceil(e.height/this._resolution),t.trim.x=-i,t.trim.y=-i,t.orig.width=t._frame.width-2*i,t.orig.height=t._frame.height-2*i,this._onTextureUpdate(),r.setRealSize(e.width,e.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},ch.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),ah.prototype._render.call(this,e)},ch.prototype.getLocalBounds=function(e){return this.updateText(!0),ah.prototype.getLocalBounds.call(this,e)},ch.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},ch.prototype._generateFillStyle=function(e,t,i){var r=e.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];var n=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,s=Math.ceil(this.canvas.width/this._resolution)-n-2*o,a=Math.ceil(this.canvas.height/this._resolution)-n-2*o,h=r.slice(),u=e.fillGradientStops.slice();if(!u.length)for(var l=h.length+1,c=1;c<l;++c)u.push(c/l);if(h.unshift(r[0]),u.unshift(0),h.push(r[r.length-1]),u.push(1),e.fillGradientType===q.TEXT_GRADIENT.LINEAR_VERTICAL)for(var p=this.context.createLinearGradient(s/2,o,s/2,a+o),d=0,f=(i.fontProperties.fontSize+e.strokeThickness)/a,c=0;c<t.length;c++)for(var m=i.lineHeight*c,_=0;_<h.length;_++){var y=m/a+("number"==typeof u[_]?u[_]:_/h.length)*f,y=Math.max(d,y),y=Math.min(y,1);p.addColorStop(y,h[_]),d=y}else{p=this.context.createLinearGradient(o,a/2,s+o,a/2);var g=h.length+1,v=1;for(c=0;c<h.length;c++){var b="number"==typeof u[c]?u[c]:v/g;p.addColorStop(b,h[c]),v++}}return p},ch.prototype.destroy=function(e){"boolean"==typeof e&&(e={children:e}),e=Object.assign({},uh,e),ah.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(ch.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){this.updateText(!0);var t=pt(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(ch.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){this.updateText(!0);var t=pt(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(ch.prototype,"style",{get:function(){return this._style},set:function(e){this._style=(e=e||{})instanceof ih?e:new ih(e),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(ch.prototype,"text",{get:function(){return this._text},set:function(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(ch.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)},enumerable:!1,configurable:!0}),ch);function ch(e,t,i){var r=this,n=!1,o=(i||(i=document.createElement("canvas"),n=!0),i.width=3,i.height=3,K.from(i));return o.orig=new x,o.trim=new x,(r=ah.call(this,o)||this)._ownCanvas=n,r.canvas=i,r.context=r.canvas.getContext("2d"),r._resolution=_.RESOLUTION,r._autoResolution=!0,r._text=null,r._style=null,r._styleListener=null,r._font="",r.text=e,r.style=t,r.localStyleID=-1,r}function ph(){this.constructor=hh}_.UPLOADS_PER_FRAME=4;var dh=function(e,t){return(dh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},fh=(mh.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},mh.prototype.allowedToUpload=function(){return 0<this.itemsLeft--},mh);function mh(e){this.maxItemsPerFrame=e,this.itemsLeft=0}function _h(e,t){var i,r=!1;if(e&&e._textures&&e._textures.length)for(var n=0;n<e._textures.length;n++)e._textures[n]instanceof K&&(i=e._textures[n].baseTexture,-1===t.indexOf(i)&&(t.push(i),r=!0));return r}function yh(e,t){return e.baseTexture instanceof D&&(e=e.baseTexture,-1===t.indexOf(e)&&t.push(e),!0)}function gh(e,t){return!!(e._texture&&e._texture instanceof K)&&(e=e._texture.baseTexture,-1===t.indexOf(e)&&t.push(e),!0)}function vh(e,t){return t instanceof lh&&(t.updateText(!0),!0)}function bh(e,t){return t instanceof ih&&(t=t.toFontString(),sh.measureFont(t),!0)}function xh(e,t){return e instanceof lh&&(-1===t.indexOf(e.style)&&t.push(e.style),-1===t.indexOf(e)&&t.push(e),e=e._texture.baseTexture,-1===t.indexOf(e)&&t.push(e),!0)}function wh(e,t){return e instanceof ih&&(-1===t.indexOf(e)&&t.push(e),!0)}Th.prototype.upload=function(e,t){"function"==typeof e&&(t=e,e=null),e&&this.add(e),this.queue.length?(t&&this.completes.push(t),this.ticking||(this.ticking=!0,bi.system.addOnce(this.tick,this,q.UPDATE_PRIORITY.UTILITY))):t&&t()},Th.prototype.tick=function(){setTimeout(this.delayedTick,0)},Th.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed)for(var i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)bi.system.addOnce(this.tick,this,q.UPDATE_PRIORITY.UTILITY);else{this.ticking=!1;for(var n=this.completes.slice(0),i=this.completes.length=0,r=n.length;i<r;i++)n[i]()}},Th.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},Th.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},Th.prototype.add=function(e){for(var t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof yi)for(t=e.children.length-1;0<=t;t--)this.add(e.children[t]);return this},Th.prototype.destroy=function(){this.ticking&&bi.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};la=Th;function Th(e){var t=this;this.limiter=new fh(_.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){t.queue&&t.prepareItems()},this.registerFindHook(xh),this.registerFindHook(wh),this.registerFindHook(_h),this.registerFindHook(yh),this.registerFindHook(gh),this.registerUploadHook(vh),this.registerUploadHook(bh)}function Eh(e,t){return t instanceof D&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function Ih(e,t){if(!(t instanceof Fa))return!1;var i=t.geometry;t.finishPoly(),i.updateBatches();for(var r=i.batches,n=0;n<r.length;n++){var o=r[n].style.texture;o&&Eh(e,o.baseTexture)}return i.batchable||e.geometry.bind(i,t._resolveDirectShader(e)),!0}function Ph(e,t){return e instanceof Fa&&(t.push(e),!0)}dh(Ah=Lh,da=Sh=la),Ah.prototype=null===da?Object.create(da):(Nh.prototype=da.prototype,new Nh);var Sh,Ah,ua=Lh,da=(Dh.prototype.beginFrame=function(){this.frameStart=Date.now()},Dh.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},Dh),kh=(Rh.prototype._updateResolution=function(e){var t=this.data.meta.scale,e=It(e=void 0===e?null:e,null);return 1!==(e=null===e?void 0!==t?parseFloat(t):1:e)&&this.baseTexture.setResolution(e),e},Rh.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=Rh.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Rh.prototype._processFrames=function(e){for(var t=e,i=Rh.BATCH_SIZE;t-e<i&&t<this._frameKeys.length;){var r,n,o,s=this._frameKeys[t],a=this._frames[s],h=a.frame;h&&(r=o=null,n=!1!==a.trimmed&&a.sourceSize?a.sourceSize:a.frame,n=new x(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution),o=a.rotated?new x(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.h)/this.resolution,Math.floor(h.w)/this.resolution):new x(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution),!1!==a.trimmed&&a.spriteSourceSize&&(r=new x(Math.floor(a.spriteSourceSize.x)/this.resolution,Math.floor(a.spriteSourceSize.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution)),this.textures[s]=new K(this.baseTexture,o,n,r,a.rotated?2:0,a.anchor),K.addToCache(this.textures[s],s)),t++}},Rh.prototype._processAnimations=function(){var e,t=this.data.animations||{};for(e in t){this.animations[e]=[];for(var i=0;i<t[e].length;i++){var r=t[e][i];this.animations[e].push(this.textures[r])}}},Rh.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},Rh.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*Rh.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*Rh.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},Rh.prototype.destroy=function(e){for(var t in void 0===e&&(e=!1),this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(null!=(e=this._texture)&&e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},Rh.BATCH_SIZE=1e3,Rh),Oh=(Ch.use=function(i,r){var e,t,n=i.name+"_image";i.data&&i.type===Us.TYPE.JSON&&i.data.frames&&!this.resources[n]?(e={crossOrigin:i.crossOrigin,metadata:i.metadata.imageMetadata,parentResource:i},t=Ch.getResourcePath(i,this.baseUrl),this.add(n,t,e,function(e){var t;e.error?r(e.error):(t=new kh(e.texture,i.data,i.url)).parse(function(){i.spritesheet=t,i.textures=t.textures,r()})})):r()},Ch.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:Ye.resolve(e.url.replace(t,""),e.data.meta.image)},Ch),Mh=function(e,t){return(Mh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Ch(){}function Rh(e,t,i){void 0===i&&(i=null),this._texture=e instanceof K?e:null,this.baseTexture=e instanceof D?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;e=this.baseTexture.resource;this.resolution=this._updateResolution(i||(e?e.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}function Dh(e){this.maxMilliseconds=e,this.frameStart=0}function Lh(e){e=Sh.call(this,e)||this;return e.uploadHookHelper=e.renderer,e.registerFindHook(Ph),e.registerUploadHook(Eh),e.registerUploadHook(Ih),e}function Nh(){this.constructor=Ah}function Fh(e,t){function i(){this.constructor=e}Mh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var Bh,Xh,Uh=new Rt,jh=(Fh(Vh,Xh=Ka),Object.defineProperty(Vh.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(Vh.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(e){this.tileTransform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(Vh.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(e){this.tileTransform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Vh.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},Vh.prototype._render=function(e){var t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))},Vh.prototype._calculateBounds=function(){var e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),r=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,i,r)},Vh.prototype.getLocalBounds=function(e){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new x),e=this._localBoundsRect),this._bounds.getRectangle(e)):Xh.prototype.getLocalBounds.call(this,e)},Vh.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,Uh);var e=this._width,t=this._height,i=-e*this.anchor._x;if(Uh.x>=i&&Uh.x<i+e){i=-t*this.anchor._y;if(Uh.y>=i&&Uh.y<i+t)return!0}return!1},Vh.prototype.destroy=function(e){Xh.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},Vh.from=function(e,t){return"number"==typeof t&&(f("5.3.0","TilingSprite.from use options instead of width and height args"),t={width:t,height:arguments[2]}),new Vh(K.from(e,t),t.width,t.height)},Object.defineProperty(Vh.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(Vh.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),Vh),Hh="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Gh=new Lt,zh=(Fh(Yh,Bh=nn),Yh.prototype.render=function(e){var t=this.renderer,i=this.quad,r=i.vertices,r=(r[0]=r[6]=e._width*-e.anchor.x,r[1]=r[3]=e._height*-e.anchor.y,r[2]=r[4]=e._width*(1-e.anchor.x),r[5]=r[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((r=i.uvs)[0]=r[6]=-e.anchor.x,r[1]=r[3]=-e.anchor.y,r[2]=r[4]=1-e.anchor.x,r[5]=r[7]=1-e.anchor.y),i.invalidate(),e._texture),n=r.baseTexture,o=e.tileTransform.localTransform,s=e.uvMatrix,a=n.isPowerOfTwo&&r.frame.width===n.width&&r.frame.height===n.height,h=(a&&(n._glTextures[t.CONTEXT_UID]?a=n.wrapMode!==q.WRAP_MODES.CLAMP:n.wrapMode===q.WRAP_MODES.CLAMP&&(n.wrapMode=q.WRAP_MODES.REPEAT)),a?this.simpleShader:this.shader),u=r.width,l=r.height,c=e._width,p=e._height;Gh.set(o.a*u/c,o.b*u/p,o.c*l/c,o.d*l/p,o.tx/c,o.ty/p),Gh.invert(),a?Gh.prepend(s.mapCoord):(h.uniforms.uMapCoord=s.mapCoord.toArray(!0),h.uniforms.uClampFrame=s.uClampFrame,h.uniforms.uClampOffset=s.uClampOffset),h.uniforms.uTransform=Gh.toArray(!0),h.uniforms.uColor=nt(e.tint,e.worldAlpha,h.uniforms.uColor,n.alphaMode),h.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),h.uniforms.uSampler=r,t.shader.bind(h),t.geometry.bind(i),this.state.blendMode=tt(e.blendMode,n.alphaMode),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},Yh),Wh=function(e,t){return(Wh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Yh(e){var e=Bh.call(this,e)||this,t={globals:e.renderer.globalUniforms};return e.shader=oo.from(Hh,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture2D(uSampler, coord);\n    gl_FragColor = texSample * uColor;\n}\n",t),e.simpleShader=oo.from(Hh,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",t),e.quad=new Jr,e.state=so.for2d(),e}function Vh(e,t,i){void 0===t&&(t=100),void 0===i&&(i=100);var r=Xh.call(this,e)||this;return r.tileTransform=new oi,r._width=t,r._height=i,r.uvMatrix=r.texture.uvMatrix||new ho(e),r.pluginName="tilingSprite",r.uvRespectAnchor=!1,r}function qh(e,t){function i(){this.constructor=e}Wh(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}hu.prototype.update=function(e){!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID||(this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID,e=this.uvBuffer.data,this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++)};var Zh,Kh,$h,Jh=hu,Qh=new Rt,eu=new Mt,tu=(qh(au,$h=yi),Object.defineProperty(au.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"material",{get:function(){return this.shader},set:function(e){this.shader=e},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"tint",{get:function(){return this.shader.tint},set:function(e){this.shader.tint=e},enumerable:!1,configurable:!0}),Object.defineProperty(au.prototype,"texture",{get:function(){return this.shader.texture},set:function(e){this.shader.texture=e},enumerable:!1,configurable:!0}),au.prototype._render=function(e){var t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===q.DRAW_MODES.TRIANGLES&&t.length<2*au.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},au.prototype._renderDefault=function(e){var t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.program.uniformData.translationMatrix&&(t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},au.prototype._renderToBatch=function(e){var t=this.geometry,t=(this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture,this.material.pluginName);e.batch.setObjectRenderer(e.plugins[t]),e.plugins[t].render(this)},au.prototype.calculateVertices=function(){var e=this.geometry,t=e.buffers[0].data;if(e.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));for(var i=this.transform.worldTransform,r=i.a,n=i.b,o=i.c,s=i.d,a=i.tx,h=i.ty,u=this.vertexData,l=0;l<u.length/2;l++){var c=t[2*l],p=t[2*l+1];u[2*l]=r*c+o*p+a,u[2*l+1]=n*c+s*p+h}if(this._roundPixels)for(var d=_.RESOLUTION,l=0;l<u.length;++l)u[l]=Math.round((u[l]*d|0)/d);this.vertexDirty=e.vertexDirtyId}},au.prototype.calculateUvs=function(){var e=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Jh(e,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},au.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},au.prototype.containsPoint=function(e){if(this.getBounds().contains(e.x,e.y)){this.worldTransform.applyInverse(e,Qh);for(var t=this.geometry.getBuffer("aVertexPosition").data,i=eu.points,r=this.geometry.getIndex().data,n=r.length,o=4===this.drawMode?3:1,s=0;s+2<n;s+=o){var a=2*r[s],h=2*r[s+1],u=2*r[s+2];if(i[0]=t[a],i[1]=t[1+a],i[2]=t[h],i[3]=t[1+h],i[4]=t[u],i[5]=t[1+u],eu.contains(Qh.x,Qh.y))return!0}}return!1},au.prototype.destroy=function(e){$h.prototype.destroy.call(this,e),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},au.BATCHABLE_SIZE=100,au),iu=(qh(su,Kh=oo),Object.defineProperty(su.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(e){this.uniforms.uSampler!==e&&(this.uniforms.uSampler=e,this.uvMatrix.texture=e)},enumerable:!1,configurable:!0}),Object.defineProperty(su.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(su.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this._tintRGB=(e>>16)+(65280&e)+((255&e)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),su.prototype.update=function(){var e;this._colorDirty&&(this._colorDirty=!1,e=this.texture.baseTexture,nt(this._tint,this._alpha,this.uniforms.uColor,e.alphaMode)),this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},su),ru=(qh(ou,Zh=Kr),Object.defineProperty(ou.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),ou),nu=function(e,t){return(nu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function ou(e,t,i){var r=Zh.call(this)||this,e=new Rr(e),t=new Rr(t,!0),i=new Rr(i,!0,!0);return r.addAttribute("aVertexPosition",e,2,!1,q.TYPES.FLOAT).addAttribute("aTextureCoord",t,2,!1,q.TYPES.FLOAT).addIndex(i),r._updateId=-1,r}function su(e,t){var i=this,r={uSampler:e,alpha:1,uTextureMatrix:Lt.IDENTITY,uColor:new Float32Array([1,1,1,1])};return(t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t)).uniforms&&Object.assign(r,t.uniforms),(i=Kh.call(this,t.program||no.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),r)||this)._colorDirty=!1,i.uvMatrix=new ho(e),i.batchable=void 0===t.program,i.pluginName=t.pluginName,i.tint=t.tint,i.alpha=t.alpha,i}function au(e,t,i,r){void 0===r&&(r=q.DRAW_MODES.TRIANGLES);var n=$h.call(this)||this;return(n.geometry=e).refCount++,n.shader=t,n.state=i||so.for2d(),n.drawMode=r,n.start=0,n.size=0,n.uvs=null,n.indices=null,n.vertexData=new Float32Array(1),n.vertexDirty=0,n._transformID=-1,n._roundPixels=_.ROUND_PIXELS,n.batchUvs=null,n}function hu(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}var uu=function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]},lu=(mu.test=function(e){return"string"==typeof e&&0===e.indexOf("info face=")},mu.parse=function(e){var t,i=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(t in i){var n,o=i[t].match(/^[a-z]+/gm)[0],s=i[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(n in s){var h=s[n].split("="),u=h[0],h=h[1].replace(/"/gm,""),l=parseFloat(h),h=isNaN(l)?h:l;a[u]=h}r[o].push(a)}var c=new uu;return r.info.forEach(function(e){return c.info.push({face:e.face,size:parseInt(e.size,10)})}),r.common.forEach(function(e){return c.common.push({lineHeight:parseInt(e.lineHeight,10)})}),r.page.forEach(function(e){return c.page.push({id:parseInt(e.id,10),file:e.file})}),r.char.forEach(function(e){return c.char.push({id:parseInt(e.id,10),page:parseInt(e.page,10),x:parseInt(e.x,10),y:parseInt(e.y,10),width:parseInt(e.width,10),height:parseInt(e.height,10),xoffset:parseInt(e.xoffset,10),yoffset:parseInt(e.yoffset,10),xadvance:parseInt(e.xadvance,10)})}),r.kerning.forEach(function(e){return c.kerning.push({first:parseInt(e.first,10),second:parseInt(e.second,10),amount:parseInt(e.amount,10)})}),c},mu),cu=(fu.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")},fu.parse=function(e){for(var t=new uu,i=e.getElementsByTagName("info"),r=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),s=e.getElementsByTagName("kerning"),a=0;a<i.length;a++)t.info.push({face:i[a].getAttribute("face"),size:parseInt(i[a].getAttribute("size"),10)});for(a=0;a<r.length;a++)t.common.push({lineHeight:parseInt(r[a].getAttribute("lineHeight"),10)});for(a=0;a<n.length;a++)t.page.push({id:parseInt(n[a].getAttribute("id"),10)||0,file:n[a].getAttribute("file")});for(a=0;a<o.length;a++){var h=o[a];t.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(a=0;a<s.length;a++)t.kerning.push({first:parseInt(s[a].getAttribute("first"),10),second:parseInt(s[a].getAttribute("second"),10),amount:parseInt(s[a].getAttribute("amount"),10)});return t},fu);du.test=function(e){return"string"==typeof e&&-1<e.indexOf("<font>")&&(e=(new self.DOMParser).parseFromString(e,"text/xml"),cu.test(e))},du.parse=function(e){e=(new window.DOMParser).parseFromString(e,"text/xml");return cu.parse(e)};var pu=[lu,cu,du];function du(){}function fu(){}function mu(){}function _u(e){for(var t=0;t<pu.length;t++)if(pu[t].test(e))return pu[t];return null}Pu.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},Pu.install=function(e,t,i){var r;if(e instanceof uu)r=e;else{var n=_u(e);if(!n)throw new Error("Unrecognized data format for font.");r=n.parse(e)}n=new Pu(r,t=t instanceof K?[t]:t,i);return Pu.available[n.font]=n},Pu.uninstall=function(e){var t=Pu.available[e];if(!t)throw new Error("No font found named '"+e+"'");t.destroy(),delete Pu.available[e]},Pu.from=function(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var i=Object.assign({},Pu.defaultOptions,i),u=i.chars,r=i.padding,n=i.resolution,o=i.textureWidth,s=i.textureHeight,a=function(e){for(var t=[],i=0,r=(e="string"==typeof u?[u]:u).length;i<r;i++){var n=e[i];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var o=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<o)throw new Error("[BitmapFont]: Invalid character range.");for(var a=o,h=s;a<=h;a++)t.push(String.fromCharCode(a))}else t.push.apply(t,n.split(""))}if(0===t.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}(u),h=t instanceof ih?t:new ih(t),l=o,c=new uu;c.info[0]={face:h.fontFamily,size:h.fontSize},c.common[0]={lineHeight:h.fontSize};for(var p,d,f,m,_,y,g,v,b,x,w,T,E=0,I=0,P=0,S=[],A=0;A<a.length;A++){p||((p=document.createElement("canvas")).width=o,p.height=s,d=p.getContext("2d"),f=new D(p,{resolution:n}),S.push(new K(f)),c.page.push({id:S.length-1,file:""}));var k,O=sh.measureText(a[A],h,!1,p),M=O.width,C=Math.ceil(O.height),R=Math.ceil(("italic"===h.fontStyle?2:1)*M);if(s-C*n<=I){if(0===I)throw new Error("[BitmapFont] textureHeight "+s+"px is too small for "+h.fontSize+"px fonts");--A,f=d=p=null,P=E=I=0}else P=Math.max(C+O.fontProperties.descent,P),l<=R*n+E?(--A,I+=P*n,I=Math.ceil(I),P=E=0):(k=p,m=d,y=E,g=I,v=n,b=h,T=w=x=void 0,w=(_=O).text,T=_.fontProperties,m.translate(y,g),m.scale(v,v),y=b.strokeThickness/2,g=-b.strokeThickness/2,m.font=b.toFontString(),m.lineWidth=b.strokeThickness,m.textBaseline=b.textBaseline,m.lineJoin=b.lineJoin,m.miterLimit=b.miterLimit,m.fillStyle=function(e,t,i,r,n,o){var s=i.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];var a=i.dropShadow?i.dropShadowDistance:0,h=i.padding||0,u=Math.ceil(e.width/r)-a-2*h,l=Math.ceil(e.height/r)-a-2*h,c=s.slice(),p=i.fillGradientStops.slice();if(!p.length)for(var d=c.length+1,f=1;f<d;++f)p.push(f/d);if(c.unshift(s[0]),p.unshift(0),c.push(s[s.length-1]),p.push(1),i.fillGradientType===q.TEXT_GRADIENT.LINEAR_VERTICAL)for(var m=t.createLinearGradient(u/2,h,u/2,l+h),_=0,y=(o.fontProperties.fontSize+i.strokeThickness)/l,f=0;f<n.length;f++)for(var g=o.lineHeight*f,v=0;v<c.length;v++){var b=g/l+("number"==typeof p[v]?p[v]:v/c.length)*y,b=Math.max(_,b),b=Math.min(b,1);m.addColorStop(b,c[v]),_=b}else{m=t.createLinearGradient(h,l/2,u+h,l/2);var x=c.length+1,w=1;for(f=0;f<c.length;f++){var T="number"==typeof p[f]?p[f]:w/x;m.addColorStop(T,c[f]),w++}}return m}(k,m,b,v,[w],_),m.strokeStyle=b.stroke,b.dropShadow?(k=$e("number"==typeof(k=b.dropShadowColor)?k:Qe(k)),x=b.dropShadowBlur*v,v=b.dropShadowDistance*v,m.shadowColor="rgba("+255*k[0]+","+255*k[1]+","+255*k[2]+","+b.dropShadowAlpha+")",m.shadowBlur=x,m.shadowOffsetX=Math.cos(b.dropShadowAngle)*v,m.shadowOffsetY=Math.sin(b.dropShadowAngle)*v):(m.shadowColor="black",m.shadowBlur=0,m.shadowOffsetX=0,m.shadowOffsetY=0),b.stroke&&b.strokeThickness&&m.strokeText(w,y,g+_.lineHeight-T.descent),b.fill&&m.fillText(w,y,g+_.lineHeight-T.descent),m.setTransform(1,0,0,1,0,0),m.fillStyle="rgba(0, 0, 0, 0)",k=O.text.charCodeAt(0),c.char.push({id:k,page:S.length-1,x:E/n,y:I/n,width:R,height:C,xoffset:0,yoffset:0,xadvance:Math.ceil(M-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0))}),E+=(R+2*r)*n,E=Math.ceil(E))}i=new Pu(c,S,!0);return void 0!==Pu.available[e]&&Pu.uninstall(e),Pu.available[e]=i},Pu.ALPHA=[["a","z"],["A","Z"]," "],Pu.NUMERIC=[["0","9"]],Pu.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Pu.ASCII=[[" ","~"]],Pu.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Pu.ALPHANUMERIC},Pu.available={};var yu,gu,vu=Pu,bu=[],xu=[],lu=(nu(gu=k,lu=yu=yi),gu.prototype=null===lu?Object.create(lu):(Iu.prototype=lu.prototype,new Iu),k.prototype.updateText=function(){for(var e=vu.available[this._fontName],t=this._fontSize/e.size,i=new Rt,r=[],n=[],o=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",N=o.length,F=this._maxWidth*e.size/this._fontSize,s=null,a=0,h=0,u=0,l=-1,c=0,B=0,p=0,d=0;d<N;d++){var f,m,_=o.charCodeAt(d),y=o.charAt(d);/(?:\s)/.test(y)&&(l=d,c=a),"\r"!==y&&"\n"!==y?(f=e.chars[_])&&(s&&f.kerning[s]&&(i.x+=f.kerning[s]),(m=xu.pop()||{texture:K.EMPTY,line:0,charCode:0,position:new Rt}).texture=f.texture,m.line=u,m.charCode=_,m.position.x=i.x+f.xOffset+this._letterSpacing/2,m.position.y=i.y+f.yOffset,r.push(m),i.x+=f.xAdvance+this._letterSpacing,a=i.x,p=Math.max(p,f.yOffset+f.texture.height),s=_,-1!==l&&0<F&&i.x>F&&(ct(r,1+l-++B,1+d-l),d=l,l=-1,n.push(c),h=Math.max(h,c),u++,i.x=0,i.y+=e.lineHeight,s=null)):(n.push(a),h=Math.max(h,a),++u,++B,i.x=0,i.y+=e.lineHeight,s=null)}var g=o.charAt(o.length-1),X=("\r"!==g&&"\n"!==g&&(/(?:\s)/.test(g)&&(a=c),n.push(a),h=Math.max(h,a)),[]);for(d=0;d<=u;d++){var U=0;"right"===this._align?U=h-n[d]:"center"===this._align&&(U=(h-n[d])/2),X.push(U)}var j=r.length,v={},b=[],x=this._activePagesMeshData;for(d=0;d<x.length;d++)bu.push(x[d]);for(d=0;d<j;d++){var H,w,T=(I=r[d].texture).baseTexture.uid;v[T]||((C=bu.pop())||(w=new ru,H=new iu(K.EMPTY),C={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new tu(w,H),vertices:null,uvs:null,indices:null}),C.index=0,C.indexCount=0,C.vertexCount=0,C.uvsCount=0,C.total=0,(w=this._textureCache)[T]=w[T]||new K(I.baseTexture),C.mesh.texture=w[T],C.mesh.tint=this._tint,b.push(C),v[T]=C),v[T].total++}for(d=0;d<x.length;d++)-1===b.indexOf(x[d])&&this.removeChild(x[d].mesh);for(d=0;d<b.length;d++)b[d].mesh.parent!==this&&this.addChild(b[d].mesh);for(d in this._activePagesMeshData=b,v){var E=(C=v[d]).total;if(!((null==(G=C.indices)?void 0:G.length)>6*E)||C.vertices.length<2*tu.BATCHABLE_SIZE)C.vertices=new Float32Array(8*E),C.uvs=new Float32Array(8*E),C.indices=new Uint16Array(6*E);else for(var G=C.total,z=C.vertices,W=4*G*2;W<z.length;W++)z[W]=0;C.mesh.size=6*E}for(d=0;d<j;d++){var I,P=(y=r[d]).position.x+X[y.line],P=(P=this._roundPixels?Math.round(P):P)*t,S=y.position.y*t,A=v[(I=y.texture).baseTexture.uid],k=I.frame,O=I._uvs,M=A.index++;A.indices[6*M+0]=0+4*M,A.indices[6*M+1]=1+4*M,A.indices[6*M+2]=2+4*M,A.indices[6*M+3]=0+4*M,A.indices[6*M+4]=2+4*M,A.indices[6*M+5]=3+4*M,A.vertices[8*M+0]=P,A.vertices[8*M+1]=S,A.vertices[8*M+2]=P+k.width*t,A.vertices[8*M+3]=S,A.vertices[8*M+4]=P+k.width*t,A.vertices[8*M+5]=S+k.height*t,A.vertices[8*M+6]=P,A.vertices[8*M+7]=S+k.height*t,A.uvs[8*M+0]=O.x0,A.uvs[8*M+1]=O.y0,A.uvs[8*M+2]=O.x1,A.uvs[8*M+3]=O.y1,A.uvs[8*M+4]=O.x2,A.uvs[8*M+5]=O.y2,A.uvs[8*M+6]=O.x3,A.uvs[8*M+7]=O.y3}for(d in this._textWidth=h*t,this._textHeight=(i.y+e.lineHeight)*t,v){var C=v[d];if(0!==this.anchor.x||0!==this.anchor.y)for(var R=0,D=this._textWidth*this.anchor.x,L=this._textHeight*this.anchor.y,Y=0;Y<C.total;Y++)C.vertices[R++]-=D,C.vertices[R++]-=L,C.vertices[R++]-=D,C.vertices[R++]-=L,C.vertices[R++]-=D,C.vertices[R++]-=L,C.vertices[R++]-=D,C.vertices[R++]-=L;this._maxLineHeight=p*t;var V=C.mesh.geometry.getBuffer("aVertexPosition"),q=C.mesh.geometry.getBuffer("aTextureCoord"),Z=C.mesh.geometry.getIndex();V.data=C.vertices,q.data=C.uvs,Z.data=C.indices,V.update(),q.update(),Z.update()}for(d=0;d<r.length;d++)xu.push(r[d])},k.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},k.prototype.getLocalBounds=function(){return this.validate(),yu.prototype.getLocalBounds.call(this)},k.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(k.prototype,"tint",{get:function(){return this._tint},set:function(e){if(this._tint!==e){this._tint=e;for(var t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"fontName",{get:function(){return this._fontName},set:function(e){if(!vu.available[e])throw new Error('Missing BitmapFont "'+e+'"');this._fontName!==e&&(this._fontName=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"anchor",{get:function(){return this._anchor},set:function(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"text",{get:function(){return this._text},set:function(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),k.prototype._upgradeStyle=function(e){var t;"string"==typeof e.font?(t=e.font.split(" "),e.fontName=1===t.length?t[0]:t.slice(1).join(" "),2<=t.length&&(e.fontSize=parseInt(t[0],10))):(e.fontName=e.font.name,e.fontSize="number"==typeof e.font.size?e.font.size:parseInt(e.font.size,10))},k.prototype.destroy=function(e){var t,i=this._textureCache;for(t in i)i[t].destroy(),delete i[t];this._textureCache=null,yu.prototype.destroy.call(this,e)},k.registerFont=function(e,t){return f("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),vu.install(e,t)},Object.defineProperty(k,"fonts",{get:function(){return f("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),vu.available},enumerable:!1,configurable:!0}),k.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},k),wu=(Eu.add=function(){Us.setExtensionXhrType("fnt",Us.XHR_RESPONSE_TYPE.TEXT)},Eu.use=function(t,i){var e=_u(t.data);if(e)for(var r=Eu.getBaseUrl(this,t),n=e.parse(t.data),o={},s=function(e){o[e.metadata.pageFile]=e.texture,Object.keys(o).length===n.page.length&&(t.bitmapFont=vu.install(n,o,!0),i())},a=0;a<n.page.length;++a){var h,u,l=n.page[a].file,c=r+l,p=!1;for(h in this.resources){var d=this.resources[h];if(d.url===c){d.metadata.pageFile=l,d.texture?s(d):d.onAfterMiddleware.add(s),p=!0;break}}p||(u={crossOrigin:t.crossOrigin,loadType:Us.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:l},t.metadata.imageMetadata),parentResource:t},this.add(c,u,s))}else i()},Eu.getBaseUrl=function(e,t){var i=t.isDataUrl?"":Eu.dirname(t.url);return t.isDataUrl&&("."===i&&(i=""),e.baseUrl&&i&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(i+="/")),(i=i.replace(e.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},Eu.dirname=function(e){var t=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return t===e?".":""===t?"/":t},Eu),Tu=function(e,t){return(Tu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Eu(){}function k(e,t){void 0===t&&(t={});var i=yu.call(this)||this,t=(i._tint=16777215,t.font&&(f("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),i._upgradeStyle(t)),Object.assign({},k.styleDefaults,t)),r=t.align,n=t.tint,o=t.maxWidth,s=t.letterSpacing,a=t.fontName,t=t.fontSize;if(vu.available[a])return i._activePagesMeshData=[],i._textWidth=0,i._textHeight=0,i._align=r,i._tint=n,i._fontName=a,i._fontSize=t||vu.available[a].size,i._text=e,i._maxWidth=o,i._maxLineHeight=0,i._letterSpacing=s,i._anchor=new Dt(function(){i.dirty=!0},i,0,0),i._roundPixels=_.ROUND_PIXELS,i.dirty=!0,i._textureCache={},i;throw new Error('Missing BitmapFont "'+a+'"')}function Iu(){this.constructor=gu}function Pu(e,t,i){var r=e.info[0],n=e.common[0],o=It(e.page[0].file),s={};this._ownsTextures=i,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/o,this.chars={},this.pageTextures=s;for(var a=0;a<e.page.length;a++){var h=e.page[a],u=h.id,h=h.file;s[u]=t instanceof Array?t[a]:t[h]}for(a=0;a<e.char.length;a++){var l=e.char[a],l=(u=l.id,l.page),c=e.char[a],p=c.x,d=c.y,f=c.width,m=c.height,_=c.xoffset,y=c.yoffset,c=c.xadvance,p=(d/=o,f/=o,m/=o,_/=o,y/=o,c/=o,new x((p/=o)+s[l].frame.x/o,d+s[l].frame.y/o,f,m));this.chars[u]={xOffset:_,yOffset:y,xAdvance:c,kerning:{},texture:new K(s[l].baseTexture,p),page:l}}for(a=0;a<e.kerning.length;a++){var g=e.kerning[a],v=g.first,b=g.second,g=g.amount;v/=o,b/=o,g/=o,this.chars[b]&&(this.chars[b].kerning[v]=g)}}Tu(Au=Mu,ku=Su=m),Au.prototype=null===ku?Object.create(ku):(Cu.prototype=ku.prototype,new Cu),Object.defineProperty(Mu.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0});var Su,Au,ku=Mu,Ou=function(e,t){return(Ou=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Mu(e){void 0===e&&(e=1);var t=Su.call(this,is,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1})||this;return t.alpha=e,t}function Cu(){this.constructor=Au}function Ru(e,t){function i(){this.constructor=e}Ou(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var Du,Lu,Nu,Fu={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Bu=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n"),Xu=(0,0,0,(O={NORMAL:0,0:"NORMAL",ADD:1,1:"ADD",MULTIPLY:2,2:"MULTIPLY",SCREEN:3,3:"SCREEN",OVERLAY:4,4:"OVERLAY",DARKEN:5,5:"DARKEN",LIGHTEN:6,6:"LIGHTEN",COLOR_DODGE:7,7:"COLOR_DODGE",COLOR_BURN:8,8:"COLOR_BURN",HARD_LIGHT:9,9:"HARD_LIGHT",SOFT_LIGHT:10,10:"SOFT_LIGHT",DIFFERENCE:11,11:"DIFFERENCE",EXCLUSION:12,12:"EXCLUSION",HUE:13,13:"HUE",SATURATION:14,14:"SATURATION",COLOR:15,15:"COLOR",LUMINOSITY:16,16:"LUMINOSITY",NORMAL_NPM:17,17:"NORMAL_NPM",ADD_NPM:18,18:"ADD_NPM",SCREEN_NPM:19,19:"SCREEN_NPM",NONE:20,20:"NONE",SRC_OVER:0})[0]="SRC_OVER",O[O.SRC_IN=21]="SRC_IN",O[O.SRC_OUT=22]="SRC_OUT",O[O.SRC_ATOP=23]="SRC_ATOP",O[O.DST_OVER=24]="DST_OVER",O[O.DST_IN=25]="DST_IN",O[O.DST_OUT=26]="DST_OUT",O[O.DST_ATOP=27]="DST_ATOP",O[O.ERASE=26]="ERASE",O[O.SUBTRACT=28]="SUBTRACT",O[O.XOR=29]="XOR",0,0,0,0,0,0,0,(O={NPM:0,0:"NPM",UNPACK:1,1:"UNPACK",PMA:2,2:"PMA",NO_PREMULTIPLIED_ALPHA:0})[0]="NO_PREMULTIPLIED_ALPHA",O[O.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",O[O.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA",(O=Du=Du||{})[O.NO=0]="NO",O[O.YES=1]="YES",O[O.AUTO=2]="AUTO",O[O.BLEND=0]="BLEND",O[O.CLEAR=1]="CLEAR",O[O.BLIT=2]="BLIT",0,0,0,0,Ru(Hu,Nu=m),Hu.prototype.apply=function(e,t,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,i,r);else{var n=e.getFilterTexture(),o=e.renderer,s=t,a=n;this.state.blend=!1,e.applyFilter(this,s,a,Du.CLEAR);for(var h=1;h<this.passes-1;h++){e.bindAndClear(s,Du.BLIT);var u=this.uniforms.uSampler=a,a=s,s=u;o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,a,i,r),e.returnFilterTexture(n)}},Object.defineProperty(Hu.prototype,"blur",{get:function(){return this.strength},set:function(e){this.padding=1+2*Math.abs(e),this.strength=e},enumerable:!1,configurable:!0}),Object.defineProperty(Hu.prototype,"quality",{get:function(){return this._quality},set:function(e){this._quality=e,this.passes=e},enumerable:!1,configurable:!0}),Hu),O=(Ru(ju,Lu=m),ju.prototype.apply=function(e,t,i,r){var n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);n&&o?(n=e.getFilterTexture(),this.blurXFilter.apply(e,t,n,Du.CLEAR),this.blurYFilter.apply(e,n,i,r),e.returnFilterTexture(n)):(o?this.blurYFilter:this.blurXFilter).apply(e,t,i,r)},ju.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},Object.defineProperty(ju.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(ju.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(e){this.blurXFilter.quality=this.blurYFilter.quality=e},enumerable:!1,configurable:!0}),Object.defineProperty(ju.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(ju.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(ju.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(e){this.blurYFilter.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(ju.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(e){this._repeatEdgePixels=e,this.updatePadding()},enumerable:!1,configurable:!0}),ju),Uu=function(e,t){return(Uu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function ju(e,t,i,r){void 0===e&&(e=8),void 0===t&&(t=4),void 0===i&&(i=_.FILTER_RESOLUTION),void 0===r&&(r=5);var n=Lu.call(this)||this;return n.blurXFilter=new Xu(!0,e,t,i,r),n.blurYFilter=new Xu(!1,e,t,i,r),n.resolution=i,n.quality=t,n.blur=e,n.repeatEdgePixels=!1,n}function Hu(e,t,i,r,n){void 0===t&&(t=8),void 0===i&&(i=4),void 0===r&&(r=_.FILTER_RESOLUTION);var o=this,s=function(e,t){for(var i=Math.ceil(e/2),r="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",n="",o=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);",s=0;s<e;s++)n=n+o.replace("%index%",s.toString()).replace("%sampleIndex%",s-(i-1)+".0")+"\n";return(r=r.replace("%blur%",n)).replace("%size%",e.toString())}(n=void 0===n?5:n,e),n=function(e){for(var t=Fu[e],i=t.length,r=Bu,n="",o=0;o<e;o++)var s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString()),a=i<=o?e-o-1:o,n=n+(s=s.replace("%value%",t[a].toString()))+"\n";return(r=r.replace("%blur%",n)).replace("%size%",e.toString())}(n);return(o=Nu.call(this,s,n)||this).horizontal=e,o.resolution=r,o._quality=0,o.quality=i,o.blur=t,o}Uu(zu=M,Wu=Gu=m),zu.prototype=null===Wu?Object.create(Wu):(Yu.prototype=Wu.prototype,new Yu),M.prototype._loadMatrix=function(e,t){var i=e;(t=void 0===t?!1:t)&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i},M.prototype._multiply=function(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e},M.prototype._colorMatrix=function(e){e=new Float32Array(e);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e},M.prototype.brightness=function(e,t){this._loadMatrix([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0],t)},M.prototype.greyscale=function(e,t){this._loadMatrix([e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0],t)},M.prototype.blackAndWhite=function(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)},M.prototype.hue=function(e,t){e=(e||0)/180*Math.PI;var i=Math.cos(e),e=Math.sin(e),r=(0,Math.sqrt)(1/3);this._loadMatrix([i+1/3*(1-i),1/3*(1-i)-r*e,1/3*(1-i)+r*e,0,0,1/3*(1-i)+r*e,i+1/3*(1-i),1/3*(1-i)-r*e,0,0,1/3*(1-i)-r*e,1/3*(1-i)+r*e,i+1/3*(1-i),0,0,0,0,0,1,0],t)},M.prototype.contrast=function(e,t){var e=(e||0)+1,i=-.5*(e-1);this._loadMatrix([e,0,0,0,i,0,e,0,0,i,0,0,e,0,i,0,0,0,1,0],t)},M.prototype.saturate=function(e,t){var e=2*(e=void 0===e?0:e)/3+1,i=-.5*(e-1);this._loadMatrix([e,i,i,0,0,i,e,i,0,0,i,i,e,0,0,0,0,0,1,0],t)},M.prototype.desaturate=function(){this.saturate(-1)},M.prototype.negative=function(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)},M.prototype.sepia=function(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)},M.prototype.technicolor=function(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)},M.prototype.polaroid=function(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)},M.prototype.toBGR=function(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)},M.prototype.kodachrome=function(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)},M.prototype.browni=function(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)},M.prototype.vintage=function(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)},M.prototype.colorTone=function(e,t,i,r,n){var o=((i=i||16770432)>>16&255)/255,s=(i>>8&255)/255,i=(255&i)/255,a=((r=r||3375104)>>16&255)/255,h=(r>>8&255)/255,r=(255&r)/255,e=[.3,.59,.11,0,0,o,s,i,e=e||.2,0,a,h,r,t=t||.15,0,o-a,s-h,i-r,0,0];this._loadMatrix(e,n)},M.prototype.night=function(e,t){e=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(e,t)},M.prototype.predator=function(e,t){this._loadMatrix([11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0],t)},M.prototype.lsd=function(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)},M.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},Object.defineProperty(M.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(e){this.uniforms.m=e},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0});var Gu,zu,Wu=M;function M(){var e=this,t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return(e=Gu.call(this,rs,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t)||this).alpha=1,e}function Yu(){this.constructor=zu}Wu.prototype.grayscale=Wu.prototype.greyscale;var Vu,qu,Zu=function(e,t){return(Zu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},Ku=(Zu(qu=Ju,Ku=Vu=m),qu.prototype=null===Ku?Object.create(Ku):(Qu.prototype=Ku.prototype,new Qu),Ju.prototype.apply=function(e,t,i,r){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),s=Math.sqrt(n.c*n.c+n.d*n.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/s,this.uniforms.rotation[3]=n.d/s),e.applyFilter(this,t,i,r)},Object.defineProperty(Ju.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(e){this.uniforms.mapSampler=e},enumerable:!1,configurable:!0}),Ju),$u=function(e,t){return($u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Ju(e,t){var i=this,r=new Lt;return e.renderable=!1,(i=Vu.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:e._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this).maskSprite=e,i.maskMatrix=r,i.scale=new Rt(t=null==t?20:t,t),i}function Qu(){this.constructor=qu}$u(tl=nl,il=el=m),tl.prototype=null===il?Object.create(il):(ol.prototype=il.prototype,new ol);var el,tl,il=nl,rl=function(e,t){return(rl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function nl(){return el.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')||this}function ol(){this.constructor=tl}rl(al=ll,hl=sl=m),al.prototype=null===hl?Object.create(hl):(cl.prototype=hl.prototype,new cl),Object.defineProperty(ll.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(e){this.uniforms.uNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(ll.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(e){this.uniforms.uSeed=e},enumerable:!1,configurable:!0});var sl,al,hl=ll,ul=new Lt;function ll(e,t){void 0===e&&(e=.5),void 0===t&&(t=Math.random());var i=sl.call(this,rs,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0})||this;return i.noise=e,i.seed=t,i}function cl(){this.constructor=al}r.prototype._cacheAsBitmap=!1,r.prototype._cacheData=null;var pl=function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null},dl=(Object.defineProperties(r.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){var t;this._cacheAsBitmap!==e&&((this._cacheAsBitmap=e)?(this._cacheData||(this._cacheData=new pl),(t=this._cacheData).originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((t=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea))}}}),r.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},r.prototype._initCachedDisplayObject=function(e){var t,i,r,n,o,s,a,h;this._cacheData&&this._cacheData.sprite||(t=this.alpha,this.alpha=1,e.batch.flush(),i=this.getLocalBounds(null,!0).clone(),this.filters&&(r=this.filters[0].padding,i.pad(r)),i.ceil(_.RESOLUTION),r=e.renderTexture.current,n=e.renderTexture.sourceFrame.clone(),o=e.renderTexture.destinationFrame.clone(),s=e.projection.transform,a=kr.create({width:i.width,height:i.height}),h="cacheAsBitmap_"+ ++dt,this._cacheData.textureCacheId=h,D.addToCache(a.baseTexture,h),K.addToCache(a,h),h=this.transform.localTransform.copyTo(ul).invert().translate(-i.x,-i.y),this.render=this._cacheData.originalRender,e.render(this,a,!0,h,!1),e.projection.transform=s,e.renderTexture.bind(r,n,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,(h=new Ka(a)).transform.worldTransform=this.transform.worldTransform,h.anchor.x=-i.x/i.width,h.anchor.y=-i.y/i.height,h.alpha=t,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=h.containsPoint.bind(h))},r.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},r.prototype._initCachedDisplayObjectCanvas=function(e){var t,i,r,n,o,s;this._cacheData&&this._cacheData.sprite||(t=this.getLocalBounds(null,!0),i=this.alpha,this.alpha=1,r=e.context,n=e._projTransform,t.ceil(_.RESOLUTION),o=kr.create({width:t.width,height:t.height}),s="cacheAsBitmap_"+ ++dt,this._cacheData.textureCacheId=s,D.addToCache(o.baseTexture,s),K.addToCache(o,s),this.transform.localTransform.copyTo(s=ul),s.invert(),s.tx-=t.x,s.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,o,!0,s,!1),e.context=r,e._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,(s=new Ka(o)).transform.worldTransform=this.transform.worldTransform,s.anchor.x=-t.x/t.width,s.anchor.y=-t.y/t.height,s.alpha=i,s._bounds=this._bounds,this._cacheData.sprite=s,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=s.containsPoint.bind(s))},r.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},r.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},r.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,D.removeFromCache(this._cacheData.textureCacheId),K.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},r.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},r.prototype.name=null,yi.prototype.getChildByName=function(e,t){for(var i=0,r=this.children.length;i<r;i++)if(this.children[i].name===e)return this.children[i];if(t)for(i=0,r=this.children.length;i<r;i++)if(this.children[i].getChildByName){var n=this.children[i].getChildByName(e,!0);if(n)return n}return null},r.prototype.getGlobalPosition=function(e,t){return void 0===e&&(e=new Rt),void 0===t&&(t=!1),this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e},function(e,t){return(dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)});function fl(e,t){function i(){this.constructor=e}dl(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var C="5.0.0",ml=function(e,t){return(ml=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function _l(e,t){function i(){this.constructor=e}ml(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}_l(Ll,wl=ru),Ll.prototype.build=function(){for(var e=this.segWidth*this.segHeight,t=[],i=[],r=[],n=this.segWidth-1,o=this.segHeight-1,s=this.width/n,a=this.height/o,h=0;h<e;h++){var u=h%this.segWidth,l=h/this.segWidth|0;t.push(u*s,l*a),i.push(u/n,l/o)}for(var c=n*o,h=0;h<c;h++){var p=h%n,d=h/n|0,f=d*this.segWidth+p,m=d*this.segWidth+p+1,_=(1+d)*this.segWidth+p,d=(1+d)*this.segWidth+p+1;r.push(f,m,_,m,d,_)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(r),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()};var yl,gl,vl,bl,xl,wl,Tl=Ll,El=(_l(Dl,xl=ru),Object.defineProperty(Dl.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Dl.prototype.build=function(){var e=this.points;if(e){var t=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),r=this.getIndex();if(!(e.length<1)){t.data.length/4!==e.length&&(t.data=new Float32Array(4*e.length),i.data=new Float32Array(4*e.length),r.data=new Uint16Array(6*(e.length-1)));var n=i.data,o=r.data;n[0]=0,n[1]=0,n[2]=0,n[3]=1;for(var s=0,a=e[0],h=this._width*this.textureScale,u=e.length,l=0;l<u;l++){var c,p,d=4*l;0<this.textureScale?(p=a.x-e[l].x,c=a.y-e[l].y,p=Math.sqrt(p*p+c*c),a=e[l],s+=p/h):s=l/(u-1),n[d]=s,n[d+1]=0,n[d+2]=s,n[d+3]=1}for(var f=0,l=0;l<u-1;l++)o[f++]=d=2*l,o[f++]=d+1,o[f++]=d+2,o[f++]=d+2,o[f++]=d+1,o[f++]=d+3;i.update(),r.update(),this.updateVertices()}}},Dl.prototype.updateVertices=function(){var e=this.points;if(!(e.length<1)){for(var t=e[0],i=0,r=0,n=this.buffers[0].data,o=e.length,s=0;s<o;s++){var a=e[s],h=4*s,r=-((u=s<e.length-1?e[s+1]:a).x-t.x),i=u.y-t.y,u=Math.sqrt(i*i+r*r),l=0<this.textureScale?this.textureScale*this._width/2:this._width/2;r=r/u*l,n[h]=a.x+(i=i/u*l),n[1+h]=a.y+r,n[2+h]=a.x-i,n[3+h]=a.y-r,t=a}this.buffers[0].update()}},Dl.prototype.update=function(){0<this.textureScale?this.build():this.updateVertices()},Dl),Il=(_l(Rl,bl=tu),Rl.prototype._render=function(e){var t=this.geometry;!this.autoUpdate&&t._width===this.shader.texture.height||(t._width=this.shader.texture.height,t.update()),bl.prototype._render.call(this,e)},Rl),Pl=(_l(Cl,vl=tu),Cl.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var e=this.geometry;e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build()},Object.defineProperty(Cl.prototype,"texture",{get:function(){return this.shader.texture},set:function(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),Cl.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),vl.prototype._render.call(this,e)},Cl.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),vl.prototype.destroy.call(this,e)},Cl),Sl=(_l(Ml,gl=tu),Object.defineProperty(Ml.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(e){this.geometry.getBuffer("aVertexPosition").data=e},enumerable:!1,configurable:!0}),Ml.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),gl.prototype._render.call(this,e)},Ml),Al=(_l(Ol,yl=Pl),Ol.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(Ol.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(e){this.geometry.getBuffer("aVertexPosition").data=e},enumerable:!1,configurable:!0}),Ol.prototype.updateHorizontalVertices=function(){var e=this.vertices,t=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*t,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*t,e[25]=e[27]=e[29]=e[31]=this._height},Ol.prototype.updateVerticalVertices=function(){var e=this.vertices,t=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*t,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*t,e[6]=e[14]=e[22]=e[30]=this._width},Ol.prototype._getMinScale=function(){var e=this._leftWidth+this._rightWidth,e=this._width>e?1:this._width/e,t=this._topHeight+this._bottomHeight,t=this._height>t?1:this._height/t;return Math.min(e,t)},Object.defineProperty(Ol.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(e){this._leftWidth=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(e){this._rightWidth=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"topHeight",{get:function(){return this._topHeight},set:function(e){this._topHeight=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(Ol.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(e){this._bottomHeight=e,this._refresh()},enumerable:!1,configurable:!0}),Ol.prototype._refresh=function(){var e=this.texture,t=this.geometry.buffers[1].data,e=(this._origWidth=e.orig.width,this._origHeight=e.orig.height,1/this._origWidth),i=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[9]=t[11]=t[13]=t[15]=i*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-i*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},Ol),kl=function(e,t){return(kl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function Ol(e,t,i,r,n){void 0===t&&(t=10),void 0===i&&(i=10),void 0===r&&(r=10),void 0===n&&(n=10);var o=yl.call(this,K.WHITE,4,4)||this;return o._origWidth=e.orig.width,o._origHeight=e.orig.height,o._width=o._origWidth,o._height=o._origHeight,o._leftWidth=t,o._rightWidth=r,o._topHeight=i,o._bottomHeight=n,o.texture=e,o}function Ml(e,t,i,r,n){void 0===e&&(e=K.EMPTY);var o=this,t=new ru(t,i,r),i=(t.getBuffer("aVertexPosition").static=!1,new iu(e));return(o=gl.call(this,t,i,null,n)||this).autoUpdate=!0,o}function Cl(e,t,i){var r=this,t=new Tl(e.width,e.height,t,i),i=new iu(K.WHITE);return(r=vl.call(this,t,i)||this).texture=e,r}function Rl(e,t,i){var r=this,t=new El(e.height,t,i=void 0===i?0:i),n=new iu(e);return 0<i&&(e.baseTexture.wrapMode=q.WRAP_MODES.REPEAT),(r=bl.call(this,t,n)||this).autoUpdate=!0,r}function Dl(e,t,i){void 0===e&&(e=200),void 0===i&&(i=0);var r=xl.call(this,new Float32Array(4*t.length),new Float32Array(4*t.length),new Uint16Array(6*(t.length-1)))||this;return r.points=t,r._width=e,r.textureScale=i,r.build(),r}function Ll(e,t,i,r){void 0===e&&(e=100),void 0===t&&(t=100),void 0===i&&(i=10),void 0===r&&(r=10);var n=wl.call(this)||this;return n.segWidth=i,n.segHeight=r,n.width=e,n.height=t,n.build(),n}kl(Fl=Xl,Bl=Nl=Ka),Fl.prototype=null===Bl?Object.create(Bl):(Ul.prototype=Bl.prototype,new Ul),Xl.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(bi.shared.remove(this.update,this),this._isConnectedToTicker=!1))},Xl.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(bi.shared.add(this.update,this,q.UPDATE_PRIORITY.HIGH),this._isConnectedToTicker=!0))},Xl.prototype.gotoAndStop=function(e){this.stop();var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()},Xl.prototype.gotoAndPlay=function(e){var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture(),this.play()},Xl.prototype.update=function(e){if(this._playing){var t=this.animationSpeed*e,i=this.currentFrame;if(null!==this._durations){var r=this._currentTime%1*this._durations[this.currentFrame];for(r+=t/60*1e3;r<0;)this._currentTime--,r+=this._durations[this.currentFrame];var n=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);r>=this._durations[this.currentFrame];)r-=this._durations[this.currentFrame]*n,this._currentTime+=n;this._currentTime+=r/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(0<this.animationSpeed&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}},Xl.prototype.updateTexture=function(){var e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},Xl.prototype.destroy=function(e){this.stop(),Nl.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},Xl.fromFrames=function(e){for(var t=[],i=0;i<e.length;++i)t.push(K.from(e[i]));return new Xl(t)},Xl.fromImages=function(e){for(var t=[],i=0;i<e.length;++i)t.push(K.from(e[i]));return new Xl(t)},Object.defineProperty(Xl.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(Xl.prototype,"textures",{get:function(){return this._textures},set:function(e){if(e[0]instanceof K)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(Xl.prototype,"currentFrame",{get:function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(Xl.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(Xl.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(bi.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(bi.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0});var Nl,Fl,Bl=Xl;function Xl(e,t){void 0===t&&(t=!0);var i=Nl.call(this,e[0]instanceof K?e[0]:e[0].texture)||this;return i._textures=null,i._durations=null,i._autoUpdate=t,i._isConnectedToTicker=!1,i.animationSpeed=1,i.loop=!0,i.updateAnchor=!1,i.onComplete=null,i.onFrameChange=null,i.onLoop=null,i._currentTime=0,i._playing=!1,i._previousFrame=null,i.textures=e,i}function Ul(){this.constructor=Fl}Vo.registerPlugin("accessibility",t),Vo.registerPlugin("extract",s),Vo.registerPlugin("interaction",Q),Vo.registerPlugin("particle",Qs),Vo.registerPlugin("prepare",ua),Vo.registerPlugin("batch",te),Vo.registerPlugin("tilingSprite",zh),Hs.registerPlugin(wu),Hs.registerPlugin(Oh),ee.registerPlugin(J),ee.registerPlugin(Ys);ku={AlphaFilter:ku,BlurFilter:O,BlurFilterPass:Xu,ColorMatrixFilter:Wu,DisplacementFilter:Ku,FXAAFilter:il,NoiseFilter:hl};return q.AbstractBatchRenderer=as,q.AbstractRenderer=V,q.AccessibilityManager=t,q.AnimatedSprite=Bl,q.AppLoaderPlugin=Ys,q.Application=ee,q.Attribute=Mr,q.BasePrepare=la,q.BaseRenderTexture=vr,q.BaseTexture=D,q.BatchDrawCall=ns,q.BatchGeometry=us,q.BatchPluginFactory=Le,q.BatchRenderer=te,q.BatchShaderGenerator=hs,q.BatchTextureArray=os,q.BitmapFont=vu,q.BitmapFontData=uu,q.BitmapFontLoader=wu,q.BitmapText=lu,q.Bounds=ai,q.Buffer=Rr,q.Circle=kt,q.Container=yi,q.CountLimiter=fh,q.DEG_TO_RAD=At,q.DisplayObject=r,q.Ellipse=Ot,q.Extract=s,q.FillStyle=na,q.Filter=m,q.FilterState=tn,q.Framebuffer=gr,q.GLFramebuffer=hn,q.GLProgram=vo,q.GLTexture=zo,q.GRAPHICS_CURVES=ra,q.Geometry=Kr,q.Graphics=Fa,q.GraphicsData=Oa,q.GraphicsGeometry=Ra,q.IGLUniformData=Yn,q.InteractionData=xi,q.InteractionEvent=Pi,q.InteractionManager=Q,q.InteractionTrackingData=Si,q.LineStyle=Da,q.Loader=Hs,q.LoaderResource=Us,q.MaskData=fn,q.Matrix=Lt,q.Mesh=tu,q.MeshBatchUvs=Jh,q.MeshGeometry=ru,q.MeshMaterial=iu,q.NineSlicePlane=Al,q.ObjectRenderer=nn,q.ObservablePoint=Dt,q.PI_2=Pt,q.ParticleContainer=y,q.ParticleRenderer=Qs,q.PlaneGeometry=Tl,q.Point=Rt,q.Polygon=Mt,q.Prepare=ua,q.Program=no,q.Quad=$r,q.QuadUv=Jr,q.RAD_TO_DEG=St,q.Rectangle=x,q.RenderTexture=kr,q.RenderTexturePool=Or,q.Renderer=Vo,q.RopeGeometry=El,q.RoundedRectangle=Ct,q.Runner=Li,q.Shader=oo,q.SimpleMesh=Sl,q.SimplePlane=Pl,q.SimpleRope=Il,q.Sprite=Ka,q.SpriteMaskFilter=uo,q.Spritesheet=kh,q.SpritesheetLoader=Oh,q.State=so,q.System=n,q.TemporaryDisplayObject=di,q.Text=lh,q.TextMetrics=sh,q.TextStyle=ih,q.Texture=K,q.TextureLoader=e,q.TextureMatrix=ho,q.TextureUvs=br,q.Ticker=bi,q.TickerPlugin=J,q.TilingSprite=jh,q.TilingSpriteRenderer=zh,q.TimeLimiter=da,q.Transform=oi,q.UniformGroup=en,q.VERSION="5.3.12",q.ViewableBuffer=ss,q.accessibleTarget=$,q.autoDetectRenderer=Qo,q.checkMaxIfStatementsInShader=Wn,q.defaultFilterVertex=rs,q.defaultVertex=is,q.filters=ku,q.graphicsUtils=ka,q.groupD8=h,q.interactiveTarget=o,q.isMobile=ie,q.resources=i,q.settings=_,q.systems=F,q.uniformParsers=jn,q.useDeprecated=function(){function t(e){return"on"+e.charAt(0).toUpperCase()+e.slice(1)}var n,o,s=this,a=(Object.defineProperties(s,{SVG_SIZE:{get:function(){return f(C,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),s.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return f(C,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),s.Transform}},TransformBase:{get:function(){return f(C,"PIXI.TransformBase class has been removed, use PIXI.Transform"),s.Transform}},TRANSFORM_MODE:{get:function(){return f(C,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return f(C,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),s.Renderer}},CanvasRenderTarget:{get:function(){return f(C,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),s.utils.CanvasRenderTarget}},loader:{get:function(){return f(C,"PIXI.loader instance has moved to PIXI.Loader.shared"),s.Loader.shared}},FilterManager:{get:function(){return f(C,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),s.systems.FilterSystem}},CanvasTinter:{get:function(){return f("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),s.canvasUtils}},GroupD8:{get:function(){return f("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),s.groupD8}}}),s.accessibility={},Object.defineProperties(s.accessibility,{AccessibilityManager:{get:function(){return f("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),s.AccessibilityManager}}}),s.interaction={},Object.defineProperties(s.interaction,{InteractionManager:{get:function(){return f("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),s.InteractionManager}},InteractionData:{get:function(){return f("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),s.InteractionData}},InteractionEvent:{get:function(){return f("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),s.InteractionEvent}}}),s.prepare={},Object.defineProperties(s.prepare,{BasePrepare:{get:function(){return f("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),s.BasePrepare}},Prepare:{get:function(){return f("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),s.Prepare}},CanvasPrepare:{get:function(){return f("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),s.CanvasPrepare}}}),s.extract={},Object.defineProperties(s.extract,{Extract:{get:function(){return f("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),s.Extract}},CanvasExtract:{get:function(){return f("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),s.CanvasExtract}}}),s.extras={},Object.defineProperties(s.extras,{TilingSprite:{get:function(){return f(C,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),s.TilingSprite}},TilingSpriteRenderer:{get:function(){return f(C,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),s.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return f(C,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),s.AnimatedSprite}},BitmapText:{get:function(){return f(C,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),s.BitmapText}}}),s.TilingSprite.fromFrame=function(e,t,i){return f("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),s.TilingSprite.from(e,{width:t,height:i})},s.TilingSprite.fromImage=function(e,t,i,r){return void 0===r&&(r={}),f("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),(r=r&&"object"!=typeof r?{scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}:r).width=t,r.height=i,s.TilingSprite.from(e,r)},Object.defineProperties(s.utils,{getSvgSize:{get:function(){return f(C,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),s.resources.SVGResource.getSize}}}),s.mesh={},Object.defineProperties(s.mesh,{Mesh:{get:function(){return f(C,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),s.SimpleMesh}},NineSlicePlane:{get:function(){return f(C,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),s.NineSlicePlane}},Plane:{get:function(){return f(C,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),s.SimplePlane}},Rope:{get:function(){return f(C,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),s.SimpleRope}},RawMesh:{get:function(){return f(C,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),s.Mesh}},CanvasMeshRenderer:{get:function(){return f(C,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),s.CanvasMeshRenderer}},MeshRenderer:{get:function(){return f(C,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),s.MeshRenderer}}}),s.particles={},Object.defineProperties(s.particles,{ParticleContainer:{get:function(){return f(C,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),s.ParticleContainer}},ParticleRenderer:{get:function(){return f(C,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),s.ParticleRenderer}}}),s.ticker={},Object.defineProperties(s.ticker,{Ticker:{get:function(){return f(C,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),s.Ticker}},shared:{get:function(){return f(C,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),s.Ticker.shared}}}),s.loaders={},Object.defineProperties(s.loaders,{Loader:{get:function(){return f(C,"PIXI.loaders.Loader class has moved to PIXI.Loader"),s.Loader}},Resource:{get:function(){return f(C,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),s.LoaderResource}},bitmapFontParser:{get:function(){return f(C,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),s.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){f(C,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return f(C,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),s.SpritesheetLoader.use}},getResourcePath:{get:function(){return f(C,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),s.SpritesheetLoader.getResourcePath}}}),s.Loader.addPixiMiddleware=function(e){return f(C,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),s.loaders.Loader.registerPlugin({use:e()})},Object.assign(s.Loader.prototype,{on:function(e){e=t(e);f(C,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+e+".add")},once:function(e){e=t(e);f(C,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+e+".once")},off:function(e){e=t(e);f(C,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+e+".detach")}}),Object.defineProperty(s.extract,"WebGLExtract",{get:function(){return f(C,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),s.Extract}}),Object.defineProperty(s.prepare,"WebGLPrepare",{get:function(){return f(C,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),s.Prepare}}),s.Container.prototype._renderWebGL=function(e){f(C,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(e)},s.Container.prototype.renderWebGL=function(e){f(C,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(e)},s.DisplayObject.prototype.renderWebGL=function(e){f(C,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(e)},s.Container.prototype.renderAdvancedWebGL=function(e){f(C,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(e)},Object.defineProperties(s.settings,{TRANSFORM_MODE:{get:function(){return f(C,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){f(C,"PIXI.settings.TRANSFORM_MODE property has been removed")}}}),s.BaseTexture),e=!(a.prototype.loadSource=function(e){f(C,"PIXI.BaseTexture.loadSource method has been deprecated");e=s.resources.autoDetectResource(e);e.internal=!0,this.setResource(e),this.update()}),i=(Object.defineProperties(a.prototype,{hasLoaded:{get:function(){return f(C,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var e;return f(C,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),null==(e=this.resource)?void 0:e.url},set:function(e){f(C,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=e)}},source:{get:function(){return f(C,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(e){f(C,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=e)}},premultiplyAlpha:{get:function(){return f("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(e){f("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(e)}},_id:{get:function(){return e||(f("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),e=!0),this._batchLocation},set:function(e){this._batchLocation=e}}}),a.fromImage=function(e,t,i,r){return f(C,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from"),a.from(e,{scaleMode:i,resourceOptions:{scale:r,crossorigin:t}})},a.fromCanvas=function(e,t){return f(C,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),a.from(e,{scaleMode:t})},a.fromSVG=function(e,t,i,r){return f(C,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from"),a.from(e,{scaleMode:i,resourceOptions:{scale:r,crossorigin:t}})},Object.defineProperties(s.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return f("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),0!==this.alphaMode},set:function(e){f("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(e)}}}),s.Point.prototype.copy=function(e){return f(C,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(e)},s.ObservablePoint.prototype.copy=function(e){return f(C,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(e)},s.Rectangle.prototype.copy=function(e){return f(C,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(e)},s.Matrix.prototype.copy=function(e){return f(C,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(e)},s.systems.StateSystem.prototype.setState=function(e){return f("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(e)},Object.assign(s.systems.FilterSystem.prototype,{getRenderTarget:function(e,t){return f(C,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,t)},returnRenderTarget:function(e){f(C,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(e)},calculateScreenSpaceMatrix:function(e){f(C,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var e=e.identity(),t=this.activeState,i=t.sourceFrame,t=t.destinationFrame;return e.translate(i.x/t.width,i.y/t.height),e.scale(t.width,t.height),e},calculateNormalizedScreenSpaceMatrix:function(e){f(C,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var t=this.activeState,i=t.sourceFrame,t=t.destinationFrame,e=e.identity(),r=(e.translate(i.x/t.width,i.y/t.height),t.width/i.width),t=t.height/i.height;return e.scale(r,t),e}}),Object.defineProperties(s.RenderTexture.prototype,{sourceFrame:{get:function(){return f(C,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return f(C,"PIXI.RenderTexture.size property has been removed"),this._frame}}}),fl(u,o=s.filters.BlurFilterPass),u),r=(fl(h,n=s.filters.BlurFilterPass),h);function h(e,t,i,r){return f(C,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),n.call(this,!1,e,t,i,r)||this}function u(e,t,i,r){return f(C,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),o.call(this,!0,e,t,i,r)||this}Object.assign(s.filters,{BlurXFilter:i,BlurYFilter:r});var l=s.Sprite,c=s.Texture,i=s.Graphics;function p(e,t,i,r){return f(C,"PIXI.Sprite."+e+" method is deprecated, use PIXI.Sprite.from"),l.from(t,{resourceOptions:{scale:r,crossorigin:i}})}function d(e,t,i,r){return f(C,"PIXI.Texture."+e+" method is deprecated, use PIXI.Texture.from"),c.from(t,{resourceOptions:{scale:r,crossorigin:i}})}i.prototype.generateCanvasTexture||(i.prototype.generateCanvasTexture=function(){f(C,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(i.prototype,"graphicsData",{get:function(){return f(C,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),l.fromImage=p.bind(null,"fromImage"),l.fromSVG=p.bind(null,"fromSVG"),l.fromCanvas=p.bind(null,"fromCanvas"),l.fromVideo=p.bind(null,"fromVideo"),l.fromFrame=p.bind(null,"fromFrame"),c.fromImage=d.bind(null,"fromImage"),c.fromSVG=d.bind(null,"fromSVG"),c.fromCanvas=d.bind(null,"fromCanvas"),c.fromVideo=d.bind(null,"fromVideo"),c.fromFrame=d.bind(null,"fromFrame"),Object.defineProperty(s.AbstractRenderer.prototype,"autoResize",{get:function(){return f(C,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(e){f(C,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=e}}),Object.defineProperty(s.Renderer.prototype,"textureManager",{get:function(){return f(C,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),s.utils.mixins={mixin:function(){f(C,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){f(C,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){f(C,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(s.BitmapText.prototype,"font",{get:function(){return f("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(e){f("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),e&&(this._upgradeStyle(e={font:e}),e.fontSize=e.fontSize||s.BitmapFont.available[e.fontName].size,this._fontName=e.fontName,this._fontSize=e.fontSize,this.dirty=!0)}})},q.utils=Z,q}({});PIXI.useDeprecated(),function(){"use strict";function e(){this.init()}function t(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")}e.prototype={init:function(){var e=this||g;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||g;if(e=parseFloat(e),t.ctx||c(),void 0!==e&&0<=e&&e<=1){if(t._volume=e,!t._muted){t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,g.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),n=0;n<r.length;n++){var o=t._howls[i]._soundById(r[n]);o&&o._node&&(o._node.volume=o._volume*e)}}return t}return t._volume},mute:function(e){var t=this||g;t.ctx||c(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,g.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var r=t._howls[i]._getSoundIds(),n=0;n<r.length;n++){var o=t._howls[i]._soundById(r[n]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||g,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||g,t=e._howls.length-1;0<=t;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||g)._codecs[e.replace(/^x-/,"")]},_setup:function(){var t=this||g;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var e,t,i,r,n=this||g,o=null;try{o="undefined"!=typeof Audio?new Audio:null}catch(e){return n}return o&&"function"==typeof o.canPlayType&&(e=o.canPlayType("audio/mpeg;").replace(/^no$/,""),t=(t=(i=n._navigator?n._navigator.userAgent:"").match(/OPR\/([0-6].)/g))&&parseInt(t[0].split("/")[1],10)<33,r=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),i=i.match(/Version\/(.*?) /),r=r&&i&&parseInt(i[1],10)<15,n._codecs={mp3:!(t||!e&&!o.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!e,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(r||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(r||!o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")}),n},_unlockAudio:function(){var a,h=this||g;if(!h._audioUnlocked&&h.ctx)return h._audioUnlocked=!1,h.autoUnlock=!1,h._mobileUnloaded||44100===h.ctx.sampleRate||(h._mobileUnloaded=!0,h.unload()),h._scratchBuffer=h.ctx.createBuffer(1,1,22050),a=function(e){for(;h._html5AudioPool.length<h.html5PoolSize;)try{var t=new Audio;t._unlocked=!0,h._releaseHtml5Audio(t)}catch(e){h.noAudio=!0;break}for(var i=0;i<h._howls.length;i++)if(!h._howls[i]._webAudio)for(var r=h._howls[i]._getSoundIds(),n=0;n<r.length;n++){var o=h._howls[i]._soundById(r[n]);o&&o._node&&!o._node._unlocked&&(o._node._unlocked=!0,o._node.load())}h._autoResume();var s=h.ctx.createBufferSource();s.buffer=h._scratchBuffer,s.connect(h.ctx.destination),void 0===s.start?s.noteOn(0):s.start(0),"function"==typeof h.ctx.resume&&h.ctx.resume(),s.onended=function(){s.disconnect(0),h._audioUnlocked=!0,document.removeEventListener("touchstart",a,!0),document.removeEventListener("touchend",a,!0),document.removeEventListener("click",a,!0),document.removeEventListener("keydown",a,!0);for(var e=0;e<h._howls.length;e++)h._howls[e]._emit("unlock")}},document.addEventListener("touchstart",a,!0),document.addEventListener("touchend",a,!0),document.addEventListener("click",a,!0),document.addEventListener("keydown",a,!0),h},_obtainHtml5Audio:function(){var e=this||g;return e._html5AudioPool.length?e._html5AudioPool.pop():((e=(new Audio).play())&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio)},_releaseHtml5Audio:function(e){var t=this||g;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&g.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){var e;t.autoSuspend&&(t._suspendTimer=null,t.state="suspending",e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())},t.ctx.suspend().then(e,e))},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&g.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var g=new e,o=(t.prototype={init:function(e){var t=this;return g.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=g.usingWebAudio&&!t._html5,void 0!==g.ctx&&g.ctx&&g.autoUnlock&&g._unlockAudio(),g._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(!g.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var i,r,n=0;n<e._src.length;n++){if(e._format&&e._format[n])i=e._format[n];else{if("string"!=typeof(r=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}i=(i=(i=/^data:audio\/([^;,]+);/i.exec(r))||/\.([^.]+)$/.exec(r.split("?",1)[0]))&&i[1].toLowerCase()}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&g.codecs(i)){t=e._src[n];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")}e._emit("loaderror",null,"No audio support.")},play:function(t,i){var r=this,e=null;if("number"==typeof t)e=t,t=null;else{if("string"==typeof t&&"loaded"===r._state&&!r._sprite[t])return null;if(void 0===t&&(t="__default",!r._playLock)){for(var n=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(n++,e=r._sounds[o]._id);1===n?t=null:e=null}}var s,a=e?r._soundById(e):r._inactiveSound();if(!a)return null;if(e&&!t&&(t=a._sprite||"__default"),"loaded"!==r._state)return a._sprite=t,a._ended=!1,s=a._id,r._queue.push({event:"play",action:function(){r.play(s)}}),s;if(e&&!a._paused)return i||r._loadQueue("play"),a._id;r._webAudio&&g._autoResume();var h,u,l,c,p=Math.max(0,0<a._seek?a._seek:r._sprite[t][0]/1e3),d=Math.max(0,(r._sprite[t][0]+r._sprite[t][1])/1e3-p),f=1e3*d/Math.abs(a._rate),m=r._sprite[t][0]/1e3,_=(r._sprite[t][0]+r._sprite[t][1])/1e3,y=(a._sprite=t,a._ended=!1,function(){a._paused=!1,a._seek=p,a._start=m,a._stop=_,a._loop=!(!a._loop&&!r._sprite[t][2])});if(!(_<=p))return h=a._node,r._webAudio?(l=function(){r._playLock=!1,y(),r._refreshBuffer(a);var e=a._muted||r._muted?0:a._volume;h.gain.setValueAtTime(e,g.ctx.currentTime),a._playStart=g.ctx.currentTime,void 0===h.bufferSource.start?a._loop?h.bufferSource.noteGrainOn(0,p,86400):h.bufferSource.noteGrainOn(0,p,d):a._loop?h.bufferSource.start(0,p,86400):h.bufferSource.start(0,p,d),f!==1/0&&(r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),f)),i||setTimeout(function(){r._emit("play",a._id),r._loadQueue()},0)},"running"===g.state&&"interrupted"!==g.ctx.state?l():(r._playLock=!0,r.once("resume",l),r._clearTimer(a._id))):(u=function(){h.currentTime=p,h.muted=a._muted||r._muted||g._muted||h.muted,h.volume=a._volume*g.volume(),h.playbackRate=a._rate;try{var e=h.play();(e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)?(r._playLock=!0,y(),e.then(function(){r._playLock=!1,h._unlocked=!0,i?r._loadQueue():r._emit("play",a._id)}).catch(function(){r._playLock=!1,r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0})):i||(r._playLock=!1,y(),r._emit("play",a._id)),h.playbackRate=a._rate,h.paused)?r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."):"__default"!==t||a._loop?r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),f):(r._endTimers[a._id]=function(){r._ended(a),h.removeEventListener("ended",r._endTimers[a._id],!1)},h.addEventListener("ended",r._endTimers[a._id],!1))}catch(e){r._emit("playerror",a._id,e)}},"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===h.src&&(h.src=r._src,h.load()),l=window&&window.ejecta||!h.readyState&&g._navigator.isCocoonJS,3<=h.readyState||l?u():(r._playLock=!0,r._state="loading",c=function(){r._state="loaded",u(),h.removeEventListener(g._canPlayEvent,c,!1)},h.addEventListener(g._canPlayEvent,c,!1),r._clearTimer(a._id))),a._id;r._ended(a)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)t._queue.push({event:"pause",action:function(){t.pause(e)}});else for(var i=t._getSoundIds(e),r=0;r<i.length;r++){t._clearTimer(i[r]);var n=t._soundById(i[r]);if(n&&!n._paused&&(n._seek=t.seek(i[r]),n._rateSeek=0,n._paused=!0,t._stopFade(i[r]),n._node))if(t._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),t._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||t._emit("pause",n?n._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)i._queue.push({event:"stop",action:function(){i.stop(e)}});else for(var r=i._getSoundIds(e),n=0;n<r.length;n++){i._clearTimer(r[n]);var o=i._soundById(r[n]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,i._stopFade(r[n]),o._node&&(i._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),i._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&i._clearSound(o._node))),t||i._emit("stop",o._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)i._queue.push({event:"mute",action:function(){i.mute(e,t)}});else{if(void 0===t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var r=i._getSoundIds(t),n=0;n<r.length;n++){var o=i._soundById(r[n]);o&&(o._muted=e,o._interval&&i._stopFade(o._id),i._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,g.ctx.currentTime):o._node&&(o._node.muted=!!g._muted||e),i._emit("mute",o._id))}}return i},volume:function(){var e,t,i=this,r=arguments;if(0===r.length)return i._volume;if(1===r.length||2===r.length&&void 0===r[1]?0<=i._getSoundIds().indexOf(r[0])?n=parseInt(r[0],10):e=parseFloat(r[0]):2<=r.length&&(e=parseFloat(r[0]),n=parseInt(r[1],10)),!(void 0!==e&&0<=e&&e<=1))return(t=n?i._soundById(n):i._sounds[0])?t._volume:0;if("loaded"!==i._state||i._playLock)i._queue.push({event:"volume",action:function(){i.volume.apply(i,r)}});else{void 0===n&&(i._volume=e);for(var n=i._getSoundIds(n),o=0;o<n.length;o++)(t=i._soundById(n[o]))&&(t._volume=e,r[2]||i._stopFade(n[o]),i._webAudio&&t._node&&!t._muted?t._node.gain.setValueAtTime(e,g.ctx.currentTime):t._node&&!t._muted&&(t._node.volume=e*g.volume()),i._emit("volume",t._id))}return i},fade:function(e,t,i,r){var n=this;if("loaded"!==n._state||n._playLock)n._queue.push({event:"fade",action:function(){n.fade(e,t,i,r)}});else{e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),n.volume(e,r);for(var o=n._getSoundIds(r),s=0;s<o.length;s++){var a,h,u=n._soundById(o[s]);u&&(r||n._stopFade(o[s]),n._webAudio&&!u._muted&&(h=(a=g.ctx.currentTime)+i/1e3,u._volume=e,u._node.gain.setValueAtTime(e,a),u._node.gain.linearRampToValueAtTime(t,h)),n._startFadeInterval(u,e,t,i,o[s],void 0===r))}}return n},_startFadeInterval:function(t,i,r,n,e,o){var s=this,a=i,h=r-i,u=Math.abs(h/.01),u=Math.max(4,0<u?n/u:n),l=Date.now();t._fadeTo=r,t._interval=setInterval(function(){var e=(Date.now()-l)/n;l=Date.now(),a+=h*e,a=Math.round(100*a)/100,a=h<0?Math.max(r,a):Math.min(r,a),s._webAudio?t._volume=a:s.volume(a,t._id,!0),o&&(s._volume=a),(r<i&&a<=r||i<r&&r<=a)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,s.volume(r,t._id),s._emit("fade",t._id))},u)},_stopFade:function(e){var t=this._soundById(e);return t&&t._interval&&(this._webAudio&&t._node.gain.cancelScheduledValues(g.ctx.currentTime),clearInterval(t._interval),t._interval=null,this.volume(t._fadeTo,e),t._fadeTo=null,this._emit("fade",e)),this},loop:function(){var e,t,i,r=this,n=arguments;if(0===n.length)return r._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(i=r._soundById(parseInt(n[0],10)))&&i._loop;r._loop=e=n[0]}else 2===n.length&&(e=n[0],t=parseInt(n[1],10));for(var o=r._getSoundIds(t),s=0;s<o.length;s++)(i=r._soundById(o[s]))&&(i._loop=e,r._webAudio&&i._node&&i._node.bufferSource&&((i._node.bufferSource.loop=e)&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,r.playing(o[s])&&(r.pause(o[s],!0),r.play(o[s],!0)))));return r},rate:function(){var e,t,i=this,r=arguments;if(0===r.length?o=i._sounds[0]._id:1===r.length?0<=i._getSoundIds().indexOf(r[0])?o=parseInt(r[0],10):e=parseFloat(r[0]):2===r.length&&(e=parseFloat(r[0]),o=parseInt(r[1],10)),"number"!=typeof e)return((t=i._soundById(o))||i)._rate;if("loaded"!==i._state||i._playLock)i._queue.push({event:"rate",action:function(){i.rate.apply(i,r)}});else{void 0===o&&(i._rate=e);for(var n,o=i._getSoundIds(o),s=0;s<o.length;s++)(t=i._soundById(o[s]))&&(i.playing(o[s])&&(t._rateSeek=i.seek(o[s]),t._playStart=i._webAudio?g.ctx.currentTime:t._playStart),t._rate=e,i._webAudio&&t._node&&t._node.bufferSource?t._node.bufferSource.playbackRate.setValueAtTime(e,g.ctx.currentTime):t._node&&(t._node.playbackRate=e),n=i.seek(o[s]),n=1e3*((i._sprite[t._sprite][0]+i._sprite[t._sprite][1])/1e3-n)/Math.abs(t._rate),!i._endTimers[o[s]]&&t._paused||(i._clearTimer(o[s]),i._endTimers[o[s]]=setTimeout(i._ended.bind(i,t),n)),i._emit("rate",t._id))}return i},seek:function(){var e,t,i=this,r=arguments;if(0===r.length?i._sounds.length&&(t=i._sounds[0]._id):1===r.length?0<=i._getSoundIds().indexOf(r[0])?t=parseInt(r[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(r[0])):2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10)),void 0===t)return 0;if("number"!=typeof e||"loaded"===i._state&&!i._playLock){var n,o,s=i._soundById(t);if(s){if(!("number"==typeof e&&0<=e))return i._webAudio?(n=i.playing(t)?g.ctx.currentTime-s._playStart:0,o=s._rateSeek?s._rateSeek-s._seek:0,s._seek+(o+n*Math.abs(s._rate))):s._node.currentTime;var a,h=i.playing(t),u=(h&&i.pause(t,!0),s._seek=e,s._ended=!1,i._clearTimer(t),i._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e),function(){h&&i.play(t,!0),i._emit("seek",t)});h&&!i._webAudio?(a=function(){i._playLock?setTimeout(a,0):u()},setTimeout(a,0)):u()}}else i._queue.push({event:"seek",action:function(){i.seek.apply(i,r)}});return i},playing:function(e){if("number"==typeof e)return!!(e=this._soundById(e))&&!e._paused;for(var t=0;t<this._sounds.length;t++)if(!this._sounds[t]._paused)return!0;return!1},duration:function(e){var t=this._duration,e=this._soundById(e);return t=e?this._sprite[e._sprite][1]/1e3:t},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(g._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),g._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);for(var r=g._howls.indexOf(e),n=(0<=r&&g._howls.splice(r,1),!0),i=0;i<g._howls.length;i++)if(g._howls[i]._src===e._src||0<=e._src.indexOf(g._howls[i]._src)){n=!1;break}return s&&n&&delete s[e._src],g.noAudio=!1,e._state="unloaded",e._sounds=[],null},on:function(e,t,i,r){e=this["_on"+e];return"function"==typeof t&&e.push(r?{id:i,fn:t,once:r}:{id:i,fn:t}),this},off:function(e,t,i){var r=this["_on"+e],n=0;if("number"==typeof t&&(i=t,t=null),t||i)for(n=0;n<r.length;n++){var o=i===r[n].id;if(t===r[n].fn&&o||!t&&o){r.splice(n,1);break}}else if(e)this["_on"+e]=[];else for(var s=Object.keys(this),n=0;n<s.length;n++)0===s[n].indexOf("_on")&&Array.isArray(this[s[n]])&&(this[s[n]]=[]);return this},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var r=this["_on"+e],n=r.length-1;0<=n;n--)r[n].id&&r[n].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(this,r[n].fn),0),r[n].once&&this.off(e,r[n].fn,r[n].id));return this._loadQueue(e),this},_loadQueue:function(e){var t;return 0<this._queue.length&&((t=this._queue[0]).event===e&&(this._queue.shift(),this._loadQueue()),e||t.action()),this},_ended:function(e){var t,i=this,r=e._sprite;return!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop?setTimeout(i._ended.bind(i,e),100):(r=!(!e._loop&&!i._sprite[r][2]),i._emit("end",e._id),!i._webAudio&&r&&i.stop(e._id,!0).play(e._id),i._webAudio&&r&&(i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=g.ctx.currentTime,t=1e3*(e._stop-e._start)/Math.abs(e._rate),i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),t)),i._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),g._autoSuspend()),i._webAudio||r||i.stop(e._id,!0)),i},_clearTimer:function(e){var t;return this._endTimers[e]&&("function"!=typeof this._endTimers[e]?clearTimeout(this._endTimers[e]):(t=this._soundById(e))&&t._node&&t._node.removeEventListener("ended",this._endTimers[e],!1),delete this._endTimers[e]),this},_soundById:function(e){for(var t=0;t<this._sounds.length;t++)if(e===this._sounds[t]._id)return this._sounds[t];return null},_inactiveSound:function(){this._drain();for(var e=0;e<this._sounds.length;e++)if(this._sounds[e]._ended)return this._sounds[e].reset();return new o(this)},_drain:function(){var e=this,t=e._pool,i=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&i++;for(r=e._sounds.length-1;0<=r;r--){if(i<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),i--)}}},_getSoundIds:function(e){if(void 0!==e)return[e];for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t},_refreshBuffer:function(e){return e._node.bufferSource=g.ctx.createBufferSource(),e._node.bufferSource.buffer=s[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,g.ctx.currentTime),this},_cleanBuffer:function(e){var t=g._navigator&&0<=g._navigator.vendor.indexOf("Apple");if(g._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=g._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(g._navigator&&g._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}},function(e){this._parent=e,this.init()}),s=(o.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++g._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=g._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===g.ctx.createGain?g.ctx.createGainNode():g.ctx.createGain(),e._node.gain.setValueAtTime(i,g.ctx.currentTime),e._node.paused=!0,e._node.connect(g.masterGain)):g.noAudio||(e._node=g._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(g._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*g.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++g._counter,e},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var e=this._parent;e._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),this._node.removeEventListener(g._canPlayEvent,this._loadFn,!1)},_endListener:function(){var e=this._parent;e._duration===1/0&&(e._duration=Math.ceil(10*this._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(this)),this._node.removeEventListener("ended",this._endFn,!1)}},{}),a=function(t){var e=t._src;if(s[e])t._duration=s[e].duration,l(t);else if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),r=new Uint8Array(i.length),n=0;n<i.length;++n)r[n]=i.charCodeAt(n);u(r.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(e){o.setRequestHeader(e,t._xhr.headers[e])}),o.onload=function(){var e=(o.status+"")[0];"0"!==e&&"2"!==e&&"3"!==e?t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+"."):u(o.response,t)},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete s[e],t.load())},h(o)}},h=function(t){try{t.send()}catch(e){t.onerror()}},u=function(e,t){function i(){t._emit("loaderror",null,"Decoding audio data failed.")}function r(e){e&&0<t._sounds.length?(s[t._src]=e,l(t,e)):i()}"undefined"!=typeof Promise&&1===g.ctx.decodeAudioData.length?g.ctx.decodeAudioData(e).then(r).catch(i):g.ctx.decodeAudioData(e,r,i)},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){if(g.usingWebAudio){try{"undefined"!=typeof AudioContext?g.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?g.ctx=new webkitAudioContext:g.usingWebAudio=!1}catch(e){g.usingWebAudio=!1}g.ctx||(g.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(g._navigator&&g._navigator.platform),t=g._navigator&&g._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),t=t?parseInt(t[1],10):null;e&&t&&t<9&&(t=/safari/.test(g._navigator&&g._navigator.userAgent.toLowerCase()),g._navigator&&!t&&(g.usingWebAudio=!1)),g.usingWebAudio&&(g.masterGain=void 0===g.ctx.createGain?g.ctx.createGainNode():g.ctx.createGain(),g.masterGain.gain.setValueAtTime(g._muted?0:g._volume,g.ctx.currentTime),g.masterGain.connect(g.ctx.destination)),g._setup()}};"function"==typeof define&&define.amd&&define([],function(){return{Howler:g,Howl:t}}),"undefined"!=typeof exports&&(exports.Howler=g,exports.Howl=t),"undefined"!=typeof global?(global.HowlerGlobal=e,global.Howler=g,global.Howl=t,global.Sound=o):"undefined"!=typeof window&&(window.HowlerGlobal=e,window.Howler=g,window.Howl=t,window.Sound=o)}(),function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){if(this.ctx&&this.ctx.listener)for(var t=this._howls.length-1;0<=t;t--)this._howls[t].stereo(e);return this},HowlerGlobal.prototype.pos=function(e,t,i){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,i="number"!=typeof i?r._pos[2]:i,"number"!=typeof e?r._pos:(r._pos=[e,t,i],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,i,r,n,o){var s,a=this;return a.ctx&&a.ctx.listener?(s=a._orientation,t="number"!=typeof t?s[1]:t,i="number"!=typeof i?s[2]:i,r="number"!=typeof r?s[3]:r,n="number"!=typeof n?s[4]:n,o="number"!=typeof o?s[5]:o,"number"!=typeof e?s:(a._orientation=[e,t,i,r,n,o],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,t,i,r,n,o),a)):a},Howl.prototype.init=(t=Howl.prototype.init,function(e){return this._orientation=e.orientation||[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(e,t){var i=this;if(i._webAudio)if("loaded"!==i._state)i._queue.push({event:"stereo",action:function(){i.stereo(e,t)}});else{var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===t){if("number"!=typeof e)return i._stereo;i._stereo=e,i._pos=[e,0,0]}for(var n=i._getSoundIds(t),o=0;o<n.length;o++){var s=i._soundById(n[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||u(s,r),"spatial"==r?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",s._id)}}}return i},Howl.prototype.pos=function(e,t,i,r){var n=this;if(n._webAudio)if("loaded"!==n._state)n._queue.push({event:"pos",action:function(){n.pos(e,t,i,r)}});else{if(t="number"!=typeof t?0:t,i="number"!=typeof i?-.5:i,void 0===r){if("number"!=typeof e)return n._pos;n._pos=[e,t,i]}for(var o=n._getSoundIds(r),s=0;s<o.length;s++){var a=n._soundById(o[s]);if(a){if("number"!=typeof e)return a._pos;a._pos=[e,t,i],a._node&&(a._panner&&!a._panner.pan||u(a,"spatial"),void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):a._panner.setPosition(e,t,i)),n._emit("pos",a._id)}}}return n},Howl.prototype.orientation=function(e,t,i,r){var n=this;if(n._webAudio)if("loaded"!==n._state)n._queue.push({event:"orientation",action:function(){n.orientation(e,t,i,r)}});else{if(t="number"!=typeof t?n._orientation[1]:t,i="number"!=typeof i?n._orientation[2]:i,void 0===r){if("number"!=typeof e)return n._orientation;n._orientation=[e,t,i]}for(var o=n._getSoundIds(r),s=0;s<o.length;s++){var a=n._soundById(o[s]);if(a){if("number"!=typeof e)return a._orientation;a._orientation=[e,t,i],a._node&&(a._panner||(a._pos||(a._pos=n._pos||[0,0,-.5]),u(a,"spatial")),void 0!==a._panner.orientationX?(a._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),a._panner.orientationY.setValueAtTime(t,Howler.ctx.currentTime),a._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):a._panner.setOrientation(e,t,i)),n._emit("orientation",a._id)}}}return n},Howl.prototype.pannerAttr=function(){var e,t,i,r=this,n=arguments;if(r._webAudio){if(0===n.length)return r._pannerAttr;if(1===n.length){if("object"!=typeof n[0])return((i=r._soundById(parseInt(n[0],10)))||r)._pannerAttr;e=n[0],void 0===t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:r._panningModel})}else 2===n.length&&(e=n[0],t=parseInt(n[1],10));for(var o,s,a=r._getSoundIds(t),h=0;h<a.length;h++)(i=r._soundById(a[h]))&&(o=i._pannerAttr,o={coneInnerAngle:(void 0!==e.coneInnerAngle?e:o).coneInnerAngle,coneOuterAngle:(void 0!==e.coneOuterAngle?e:o).coneOuterAngle,coneOuterGain:(void 0!==e.coneOuterGain?e:o).coneOuterGain,distanceModel:(void 0!==e.distanceModel?e:o).distanceModel,maxDistance:(void 0!==e.maxDistance?e:o).maxDistance,refDistance:(void 0!==e.refDistance?e:o).refDistance,rolloffFactor:(void 0!==e.rolloffFactor?e:o).rolloffFactor,panningModel:(void 0!==e.panningModel?e:o).panningModel},(s=i._panner)?(s.coneInnerAngle=o.coneInnerAngle,s.coneOuterAngle=o.coneOuterAngle,s.coneOuterGain=o.coneOuterGain,s.distanceModel=o.distanceModel,s.maxDistance=o.maxDistance,s.refDistance=o.refDistance,s.rolloffFactor=o.rolloffFactor,s.panningModel=o.panningModel):(i._pos||(i._pos=r._pos||[0,0,-.5]),u(i,"spatial")))}return r},Sound.prototype.init=(r=Sound.prototype.init,function(){var e=this,t=e._parent;e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,r.call(this),e._stereo?t.stereo(e._stereo):e._pos&&t.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}),Sound.prototype.reset=(i=Sound.prototype.reset,function(){var e=this,t=e._parent;return e._orientation=t._orientation,e._stereo=t._stereo,e._pos=t._pos,e._pannerAttr=t._pannerAttr,e._stereo?t.stereo(e._stereo):e._pos?t.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,t._refreshBuffer(e)),i.call(this)});var i,r,t,u=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).io=t()}(this,function(){"use strict";function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function e(e,t,i){t&&r(e.prototype,t),i&&r(e,i)}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,r=arguments[t];for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function t(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function l(e,t,i){return(l=o()?Reflect.construct:function(e,t,i){var r=[null];r.push.apply(r,t);t=new(Function.bind.apply(e,r));return i&&n(t,i.prototype),t}).apply(null,arguments)}function N(e){var i="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(e))return i.get(e);i.set(e,t)}function t(){return l(e,arguments,u(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n(t,e)}(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(i){var r=o();return function(){var e,t=u(i),t=(e=r?(e=u(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}}function c(e,t,i){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var e=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(e)return(e=Object.getOwnPropertyDescriptor(e,t)).get?e.get.call(i):e.value})(e,t,i||e)}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function m(e,t){var i,r,n,o,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return r=!(i=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return i=e.done,e},e:function(e){r=!0,n=e},f:function(){try{i||null==s.return||s.return()}finally{if(r)throw n}}};if(Array.isArray(e)||(s=function(e,t){var i;if(e)return"string"==typeof e?f(e,t):"Map"===(i="Object"===(i=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),o=0,{s:t=function(){},n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}for(var _=Object.create(null),y=(_.open="0",_.close="1",_.ping="2",_.pong="3",_.message="4",_.upgrade="5",_.noop="6",Object.create(null)),F=(Object.keys(_).forEach(function(e){y[_[e]]=e}),{type:"error",data:"parser error"}),B="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),X="function"==typeof ArrayBuffer,U=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer},j=function(e,t,i){var r=e.type,e=e.data;return B&&e instanceof Blob?t?i(e):H(e,i):X&&(e instanceof ArrayBuffer||U(e))?t?i(e):H(new Blob([e]),i):i(_[r]+(e||""))},H=function(e,t){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];t("b"+e)},i.readAsDataURL(e)},G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<G.length;i++)g[G.charCodeAt(i)]=i;function z(e,t){var i;return"string"!=typeof e?{type:"message",data:q(e,t)}:"b"===(i=e.charAt(0))?{type:"message",data:W(e.substring(1),t)}:y[i]?1<e.length?{type:y[i],data:e.substring(1)}:{type:y[i]}:F}function W(e,t){var i;return V?(i=Y(e),q(i,t)):{base64:!0,data:e}}var Y=function(e){for(var t,i,r,n,o=.75*e.length,s=e.length,a=0,o=("="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--),new ArrayBuffer(o)),h=new Uint8Array(o),u=0;u<s;u+=4)t=g[e.charCodeAt(u)],i=g[e.charCodeAt(u+1)],r=g[e.charCodeAt(u+2)],n=g[e.charCodeAt(u+3)],h[a++]=t<<2|i>>4,h[a++]=(15&i)<<4|r>>2,h[a++]=(3&r)<<6|63&n;return o},V="function"==typeof ArrayBuffer,q=function(e,t){return"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e},Z=String.fromCharCode(30);function v(e){if(e){var t,i=e;for(t in v.prototype)i[t]=v.prototype[t];return i}}v.prototype.on=v.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},v.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},v.prototype.off=v.prototype.removeListener=v.prototype.removeAllListeners=v.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)this._callbacks={};else{var i=this._callbacks["$"+e];if(i)if(1==arguments.length)delete this._callbacks["$"+e];else{for(var r,n=0;n<i.length;n++)if((r=i[n])===t||r.fn===t){i.splice(n,1);break}0===i.length&&delete this._callbacks["$"+e]}}return this},v.prototype.emitReserved=v.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),i=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(i)for(var r=0,n=(i=i.slice(0)).length;r<n;++r)i[r].apply(this,t);return this},v.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},v.prototype.hasListeners=function(e){return!!this.listeners(e).length};var b="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function K(i){for(var e=arguments.length,t=new Array(1<e?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return t.reduce(function(e,t){return i.hasOwnProperty(t)&&(e[t]=i[t]),e},{})}var $=setTimeout,J=clearTimeout;function x(e,t){t.useNativeTimers?(e.setTimeoutFn=$.bind(b),e.clearTimeoutFn=J.bind(b)):(e.setTimeoutFn=setTimeout.bind(b),e.clearTimeoutFn=clearTimeout.bind(b))}var Q,ee=function(){t(n,N(Error));var r=d(n);function n(e,t,i){return s(this,n),(e=r.call(this,e)).description=t,e.context=i,e.type="TransportError",e}return n}(),te=function(){t(r,v);var i=d(r);function r(e){var t;return s(this,r),(t=i.call(this)).writable=!1,x(p(t),e),t.opts=e,t.query=e.query,t.readyState="",t.socket=e.socket,t}return e(r,[{key:"onError",value:function(e,t,i){return c(u(r.prototype),"emitReserved",this).call(this,"error",new ee(e,t,i)),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(e){"open"===this.readyState&&this.write(e)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,c(u(r.prototype),"emitReserved",this).call(this,"open")}},{key:"onData",value:function(e){e=z(e,this.socket.binaryType);this.onPacket(e)}},{key:"onPacket",value:function(e){c(u(r.prototype),"emitReserved",this).call(this,"packet",e)}},{key:"onClose",value:function(e){this.readyState="closed",c(u(r.prototype),"emitReserved",this).call(this,"close",e)}}]),r}(),ie="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),w=64,re={},ne=0,T=0;function oe(e){for(var t="";t=ie[e%w]+t,0<(e=Math.floor(e/w)););return t}function se(){var e=oe(+new Date);return e!==Q?(ne=0,Q=e):e+"."+oe(ne++)}for(;T<w;T++)re[ie[T]]=T;function ae(e){var t,i="";for(t in e)e.hasOwnProperty(t)&&(i.length&&(i+="&"),i+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return i}var E=!1;try{E="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}var he=E;function ue(e){e=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||he))return new XMLHttpRequest}catch(e){}if(!e)try{return new b[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function le(){}var ce=null!=new ue({xdomain:!1}).responseType,E=function(){t(o,te);var n=d(o);function o(e){s(this,o),(t=n.call(this,e)).polling=!1,"undefined"!=typeof location&&(i="https:"===location.protocol,r=(r=location.port)||(i?"443":"80"),t.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port,t.xs=e.secure!==i);var t,i,r=e&&e.forceBase64;return t.supportsBinary=ce&&!r,t}return e(o,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(e){function t(){r.readyState="paused",e()}var i,r=this;this.readyState="pausing";this.polling||!this.writable?(i=0,this.polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))):t()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}},{key:"onData",value:function(e){var t=this;!function(e,t){for(var i=e.split(Z),r=[],n=0;n<i.length;n++){var o=z(i[n],t);if(r.push(o),"error"===o.type)break}return r}(e,this.socket.binaryType).forEach(function(e){if("opening"===t.readyState&&"open"===e.type&&t.onOpen(),"close"===e.type)return t.onClose({description:"transport closed by the server"}),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){function e(){t.write([{type:"close"}])}var t=this;"open"===this.readyState?e():this.once("open",e)}},{key:"write",value:function(e){var i,r,n,o,t=this;this.writable=!1,i=function(e){t.doWrite(e,function(){t.writable=!0,t.emitReserved("drain")})},r=(e=e).length,n=new Array(r),o=0,e.forEach(function(e,t){j(e,!1,function(e){n[t]=e,++o===r&&i(n.join(Z))})})}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"https":"http",i="",e=(!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=se()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"==t&&443!==Number(this.opts.port)||"http"==t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),ae(e));return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(e.length?"?"+e:"")}},{key:"request",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a(e,{xd:this.xd,xs:this.xs},this.opts),new I(this.uri(),e)}},{key:"doWrite",value:function(e,t){var i=this,e=this.request({method:"POST",data:e});e.on("success",t),e.on("error",function(e,t){i.onError("xhr post error",e,t)})}},{key:"doPoll",value:function(){var i=this,e=this.request();e.on("data",this.onData.bind(this)),e.on("error",function(e,t){i.onError("xhr poll error",e,t)}),this.pollXhr=e}}]),o}(),I=function(){t(n,v);var r=d(n);function n(e,t){var i;return s(this,n),x(p(i=r.call(this)),t),i.opts=t,i.method=t.method||"GET",i.uri=e,i.async=!1!==t.async,i.data=void 0!==t.data?t.data:null,i.create(),i}return e(n,[{key:"create",value:function(){var t=this,e=K(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref"),i=(e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs,this.xhr=new ue(e));try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var r in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this.opts.extraHeaders[r])}catch(e){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{i.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||1223===i.status?t.onLoad():t.setTimeoutFn(function(){t.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(e){return void this.setTimeoutFn(function(){t.onError(e)},0)}"undefined"!=typeof document&&(this.index=n.requestsCount++,n.requests[this.index]=this)}},{key:"onError",value:function(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}},{key:"cleanup",value:function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=le,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete n.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}},{key:"abort",value:function(){this.cleanup()}}]),n}();function pe(){for(var e in I.requests)I.requests.hasOwnProperty(e)&&I.requests[e].abort()}I.requestsCount=0,I.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",pe):"function"==typeof addEventListener&&(A="onpagehide"in b?"pagehide":"unload",addEventListener(A,pe,!1)));var de="function"==typeof Promise&&"function"==typeof Promise.resolve?function(e){return Promise.resolve().then(e)}:function(e,t){return t(e,0)},P=b.WebSocket||b.MozWebSocket,fe="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),me={websocket:function(){t(r,te);var i=d(r);function r(e){var t;return s(this,r),(t=i.call(this,e)).supportsBinary=!e.forceBase64,t}return e(r,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var e=this.uri(),t=this.opts.protocols,i=fe?{}:K(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=fe?new P(e,t,i):t?new P(e,t):new P(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}}},{key:"addEventListeners",value:function(){var t=this;this.ws.onopen=function(){t.opts.autoUnref&&t.ws._socket.unref(),t.onOpen()},this.ws.onclose=function(e){return t.onClose({description:"websocket connection closed",context:e})},this.ws.onmessage=function(e){return t.onData(e.data)},this.ws.onerror=function(e){return t.onError("websocket error",e)}}},{key:"write",value:function(r){for(var n=this,e=(this.writable=!1,0);e<r.length;e++)!function(e){var t=r[e],i=e===r.length-1;j(t,n.supportsBinary,function(e){try{n.ws.send(e)}catch(e){}i&&de(function(){n.writable=!0,n.emitReserved("drain")},n.setTimeoutFn)})}(e)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var e=this.query||{},t=this.opts.secure?"wss":"ws",i="",e=(this.opts.port&&("wss"==t&&443!==Number(this.opts.port)||"ws"==t&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=se()),this.supportsBinary||(e.b64=1),ae(e));return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(e.length?"?"+e:"")}},{key:"check",value:function(){return!(!P||"__initialize"in P&&this.name===r.prototype.name)}}]),r}(),polling:E},_e=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ye=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function S(e){for(var r,t=e,i=e.indexOf("["),n=e.indexOf("]"),o=(-1!=i&&-1!=n&&(e=e.substring(0,i)+e.substring(i,n).replace(/:/g,";")+e.substring(n,e.length)),_e.exec(e||"")),s={},a=14;a--;)s[ye[a]]=o[a]||"";return-1!=i&&-1!=n&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(e){var t=e.replace(/\/{2,9}/g,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||t.splice(0,1);"/"==e.substr(e.length-1,1)&&t.splice(t.length-1,1);return t}(s.path),s.queryKey=(e=s.query,r={},e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,i){t&&(r[t]=i)}),r),s}var ge=function(){t(c,v);var r=d(c);function c(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return s(this,c),t=r.call(this),e&&"object"===h(e)&&(i=e,e=null),e?(e=S(e),i.hostname=e.host,i.secure="https"===e.protocol||"wss"===e.protocol,i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=S(i.host).host),x(p(t),i),t.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=t.secure?"443":"80"),t.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),t.port=i.port||("undefined"!=typeof location&&location.port?location.port:t.secure?"443":"80"),t.transports=i.transports||["polling","websocket"],t.readyState="",t.writeBuffer=[],t.prevBufferLen=0,t.opts=a({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),t.opts.path=t.opts.path.replace(/\/$/,"")+"/","string"==typeof t.opts.query&&(t.opts.query=function(e){for(var t={},i=e.split("&"),r=0,n=i.length;r<n;r++){var o=i[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}(t.opts.query)),t.id=null,t.upgrades=null,t.pingInterval=null,t.pingTimeout=null,t.pingTimeoutTimer=null,"function"==typeof addEventListener&&(t.opts.closeOnBeforeunload&&addEventListener("beforeunload",function(){t.transport&&(t.transport.removeAllListeners(),t.transport.close())},!1),"localhost"!==t.hostname&&(t.offlineEventListener=function(){t.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",t.offlineEventListener,!1))),t.open(),t}return e(c,[{key:"createTransport",value:function(e){var t=a({},this.opts.query),t=(t.EIO=4,t.transport=e,this.id&&(t.sid=this.id),a({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port}));return new me[e](t)}},{key:"open",value:function(){var e,t=this;if(this.opts.rememberUpgrade&&c.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(function(){t.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}},{key:"setTransport",value:function(e){var t=this;this.transport&&this.transport.removeAllListeners(),(this.transport=e).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",function(e){return t.onClose("transport close",e)})}},{key:"probe",value:function(e){var t=this,i=this.createTransport(e),r=!1,n=(c.priorWebsocketSuccess=!1,function(){r||(i.send([{type:"ping",data:"probe"}]),i.once("packet",function(e){r||("pong"===e.type&&"probe"===e.data?(t.upgrading=!0,t.emitReserved("upgrading",i),i&&(c.priorWebsocketSuccess="websocket"===i.name,t.transport.pause(function(){r||"closed"!==t.readyState&&(l(),t.setTransport(i),i.send([{type:"upgrade"}]),t.emitReserved("upgrade",i),i=null,t.upgrading=!1,t.flush())}))):((e=new Error("probe error")).transport=i.name,t.emitReserved("upgradeError",e)))}))});function o(){r||(r=!0,l(),i.close(),i=null)}var s=function(e){e=new Error("probe error: "+e);e.transport=i.name,o(),t.emitReserved("upgradeError",e)};function a(){s("transport closed")}function h(){s("socket closed")}function u(e){i&&e.name!==i.name&&o()}var l=function(){i.removeListener("open",n),i.removeListener("error",s),i.removeListener("close",a),t.off("close",h),t.off("upgrading",u)};i.once("open",n),i.once("error",s),i.once("close",a),this.once("close",h),this.once("upgrading",u),i.open()}},{key:"onOpen",value:function(){if(this.readyState="open",c.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},{key:"onPacket",value:function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}},{key:"onHandshake",value:function(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var e=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(function(){e.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){var e;"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(e=this.getWritablePackets(),this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush"))}},{key:"getWritablePackets",value:function(){if(this.maxPayload&&"polling"===this.transport.name&&1<this.writeBuffer.length)for(var e=1,t=0;t<this.writeBuffer.length;t++){var i=this.writeBuffer[t].data;if(i&&(e+=function(e){if("string"!=typeof e)return Math.ceil(1.33*(e.byteLength||e.size));for(var t=e,i=0,r=0,n=0,o=t.length;n<o;n++)(i=t.charCodeAt(n))<128?r+=1:i<2048?r+=2:i<55296||57344<=i?r+=3:(n++,r+=4);return r}(i)),0<t&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}},{key:"write",value:function(e,t,i){return this.sendPacket("message",e,t,i),this}},{key:"send",value:function(e,t,i){return this.sendPacket("message",e,t,i),this}},{key:"sendPacket",value:function(e,t,i,r){"function"==typeof t&&(r=t,t=void 0),"function"==typeof i&&(r=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((i=i||{}).compress=!1!==i.compress,this.emitReserved("packetCreate",e={type:e,data:t,options:i}),this.writeBuffer.push(e),r&&this.once("flush",r),this.flush())}},{key:"close",value:function(){function e(){i.off("upgrade",e),i.off("upgradeError",e),r()}function t(){i.once("upgrade",e),i.once("upgradeError",e)}var i=this,r=function(){i.onClose("forced close"),i.transport.close()};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){(i.upgrading?t:r)()}):(this.upgrading?t:r)()),this}},{key:"onError",value:function(e){c.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}},{key:"onClose",value:function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(e){for(var t=[],i=0,r=e.length;i<r;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}]),c}();ge.protocol=4;var ve="function"==typeof ArrayBuffer,be=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer},A=Object.prototype.toString,xe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===A.call(Blob),we="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===A.call(File);function k(e){return ve&&(e instanceof ArrayBuffer||be(e))||xe&&e instanceof Blob||we&&e instanceof File}function Te(e){var t=[],i=e.data;return e.data=function e(t,i){if(!t)return t;{var r;if(k(t))return r={_placeholder:!0,num:i.length},i.push(t),r;if(Array.isArray(t)){for(var n=new Array(t.length),o=0;o<t.length;o++)n[o]=e(t[o],i);return n}if("object"===h(t)&&!(t instanceof Date)){var s,a={};for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&(a[s]=e(t[s],i));return a}}return t}(i,t),e.attachments=t.length,{packet:e,buffers:t}}function Ee(e,t){return e.data=function e(t,i){if(!t)return t;{if(t&&t._placeholder)return i[t.num];if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],i);else if("object"===h(t))for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=e(t[n],i))}return t}(e.data,t),e.attachments=void 0,e}(E=O=O||{})[E.CONNECT=0]="CONNECT",E[E.DISCONNECT=1]="DISCONNECT",E[E.EVENT=2]="EVENT",E[E.ACK=3]="ACK",E[E.CONNECT_ERROR=4]="CONNECT_ERROR",E[E.BINARY_EVENT=5]="BINARY_EVENT",E[E.BINARY_ACK=6]="BINARY_ACK";var O,A=function(){function t(e){s(this,t),this.replacer=e}return e(t,[{key:"encode",value:function(e){return e.type!==O.EVENT&&e.type!==O.ACK||!function e(t){if(t&&"object"===h(t))if(Array.isArray(t)){for(var i=0,r=t.length;i<r;i++)if(e(t[i]))return!0}else{if(k(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return!0}return!1}(e)?[this.encodeAsString(e)]:(e.type=e.type===O.EVENT?O.BINARY_EVENT:O.BINARY_ACK,this.encodeAsBinary(e))}},{key:"encodeAsString",value:function(e){var t=""+e.type;return e.type!==O.BINARY_EVENT&&e.type!==O.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}},{key:"encodeAsBinary",value:function(e){var e=Te(e),t=this.encodeAsString(e.packet),e=e.buffers;return e.unshift(t),e}}]),t}(),E=function(){t(o,v);var i=d(o);function o(e){var t;return s(this,o),(t=i.call(this)).reviver=e,t}return e(o,[{key:"add",value:function(e){var t;if("string"==typeof e)((t=this.decodeString(e)).type!==O.BINARY_EVENT&&t.type!==O.BINARY_ACK||(this.reconstructor=new Ie(t),0===t.attachments))&&c(u(o.prototype),"emitReserved",this).call(this,"decoded",t);else{if(!k(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,c(u(o.prototype),"emitReserved",this).call(this,"decoded",t))}}},{key:"decodeString",value:function(e){var t=0,i={type:Number(e.charAt(0))};if(void 0===O[i.type])throw new Error("unknown packet type "+i.type);if(i.type===O.BINARY_EVENT||i.type===O.BINARY_ACK){for(var r=t+1;"-"!==e.charAt(++t)&&t!=e.length;);r=e.substring(r,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");i.attachments=Number(r)}if("/"===e.charAt(t+1)){for(r=t+1;++t;){if(","===e.charAt(t))break;if(t===e.length)break}i.nsp=e.substring(r,t)}else i.nsp="/";r=e.charAt(t+1);if(""!==r&&Number(r)==r){for(r=t+1;++t;){var n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}i.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){r=this.tryParse(e.substr(t));if(!o.isPayloadValid(i.type,r))throw new Error("invalid payload");i.data=r}return i}},{key:"tryParse",value:function(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(e,t){switch(e){case O.CONNECT:return"object"===h(t);case O.DISCONNECT:return void 0===t;case O.CONNECT_ERROR:return"string"==typeof t||"object"===h(t);case O.EVENT:case O.BINARY_EVENT:return Array.isArray(t)&&0<t.length;case O.ACK:case O.BINARY_ACK:return Array.isArray(t)}}}]),o}(),Ie=function(){function t(e){s(this,t),this.packet=e,this.buffers=[],this.reconPack=e}return e(t,[{key:"takeBinaryData",value:function(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=Ee(this.reconPack,this.buffers),this.finishedReconstruction(),e):null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),t}(),Pe=Object.freeze({__proto__:null,protocol:5,get PacketType(){return O},Encoder:A,Decoder:E});function M(e,t,i){return e.on(t,i),function(){e.off(t,i)}}var Se=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ae=function(){t(o,v);var n=d(o);function o(e,t,i){var r;return s(this,o),(r=n.call(this)).connected=!1,r.receiveBuffer=[],r.sendBuffer=[],r.ids=0,r.acks={},r.flags={},r.io=e,r.nsp=t,i&&i.auth&&(r.auth=i.auth),r.io._autoConnect&&r.open(),r}return e(o,[{key:"disconnected",get:function(){return!this.connected}},{key:"subEvents",value:function(){var e;this.subs||(e=this.io,this.subs=[M(e,"open",this.onopen.bind(this)),M(e,"packet",this.onpacket.bind(this)),M(e,"error",this.onerror.bind(this)),M(e,"close",this.onclose.bind(this))])}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.unshift("message"),this.emit.apply(this,t),this}},{key:"emit",value:function(e){if(Se.hasOwnProperty(e))throw new Error('"'+e+'" is a reserved event name');for(var t=arguments.length,i=new Array(1<t?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];i.unshift(e);var n,e={type:O.EVENT,data:i,options:{}},o=(e.options.compress=!1!==this.flags.compress,"function"==typeof i[i.length-1]&&(n=this.ids++,o=i.pop(),this._registerAckCallback(n,o),e.id=n),this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable);return this.flags.volatile&&(!o||!this.connected)||(this.connected?(this.notifyOutgoingListeners(e),this.packet(e)):this.sendBuffer.push(e)),this.flags={},this}},{key:"_registerAckCallback",value:function(t,r){var n,o=this,e=this.flags.timeout;void 0===e?this.acks[t]=r:(n=this.io.setTimeoutFn(function(){delete o.acks[t];for(var e=0;e<o.sendBuffer.length;e++)o.sendBuffer[e].id===t&&o.sendBuffer.splice(e,1);r.call(o,new Error("operation has timed out"))},e),this.acks[t]=function(){o.io.clearTimeoutFn(n);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];r.apply(o,[null].concat(t))})}},{key:"packet",value:function(e){e.nsp=this.nsp,this.io._packet(e)}},{key:"onopen",value:function(){var t=this;"function"==typeof this.auth?this.auth(function(e){t.packet({type:O.CONNECT,data:e})}):this.packet({type:O.CONNECT,data:this.auth})}},{key:"onerror",value:function(e){this.connected||this.emitReserved("connect_error",e)}},{key:"onclose",value:function(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}},{key:"onpacket",value:function(e){if(e.nsp===this.nsp)switch(e.type){case O.CONNECT:e.data&&e.data.sid?(t=e.data.sid,this.onconnect(t)):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case O.EVENT:case O.BINARY_EVENT:this.onevent(e);break;case O.ACK:case O.BINARY_ACK:this.onack(e);break;case O.DISCONNECT:this.ondisconnect();break;case O.CONNECT_ERROR:this.destroy();var t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}},{key:"onevent",value:function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}},{key:"emitEvent",value:function(e){if(this._anyListeners&&this._anyListeners.length){var t,i=m(this._anyListeners.slice());try{for(i.s();!(t=i.n()).done;)t.value.apply(this,e)}catch(e){i.e(e)}finally{i.f()}}c(u(o.prototype),"emit",this).apply(this,e)}},{key:"ack",value:function(r){var n=this,o=!1;return function(){if(!o){o=!0;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.packet({type:O.ACK,id:r,data:t})}}}},{key:"onack",value:function(e){var t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}},{key:"onconnect",value:function(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var t=this;this.receiveBuffer.forEach(function(e){return t.emitEvent(e)}),this.receiveBuffer=[],this.sendBuffer.forEach(function(e){t.notifyOutgoingListeners(e),t.packet(e)}),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach(function(e){return e()}),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:O.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(e){return this.flags.compress=e,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(e){return this.flags.timeout=e,this}},{key:"onAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}},{key:"prependAny",value:function(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}},{key:"offAny",value:function(e){if(this._anyListeners)if(e){for(var t=this._anyListeners,i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}},{key:"onAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}},{key:"prependAnyOutgoing",value:function(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}},{key:"offAnyOutgoing",value:function(e){if(this._anyOutgoingListeners)if(e){for(var t=this._anyOutgoingListeners,i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}},{key:"listenersAnyOutgoing",value:function(){return this._anyOutgoingListeners||[]}},{key:"notifyOutgoingListeners",value:function(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){var t,i=m(this._anyOutgoingListeners.slice());try{for(i.s();!(t=i.n()).done;)t.value.apply(this,e.data)}catch(e){i.e(e)}finally{i.f()}}}}]),o}();function C(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&e.jitter<=1?e.jitter:0,this.attempts=0}C.prototype.duration=function(){var e,t,i=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(e=Math.random(),t=Math.floor(e*this.jitter*i),i=0==(1&Math.floor(10*e))?i-t:i+t),0|Math.min(i,this.max)},C.prototype.reset=function(){this.attempts=0},C.prototype.setMin=function(e){this.ms=e},C.prototype.setMax=function(e){this.max=e},C.prototype.setJitter=function(e){this.jitter=e};var R=function(){t(o,v);var n=d(o);function o(e,t){s(this,o),(i=n.call(this)).nsps={},i.subs=[],e&&"object"===h(e)&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",i.opts=t,x(p(i),t),i.reconnection(!1!==t.reconnection),i.reconnectionAttempts(t.reconnectionAttempts||1/0),i.reconnectionDelay(t.reconnectionDelay||1e3),i.reconnectionDelayMax(t.reconnectionDelayMax||5e3),i.randomizationFactor(null!=(r=t.randomizationFactor)?r:.5),i.backoff=new C({min:i.reconnectionDelay(),max:i.reconnectionDelayMax(),jitter:i.randomizationFactor()}),i.timeout(null==t.timeout?2e4:t.timeout),i._readyState="closed",i.uri=e;var i,r=t.parser||Pe;return i.encoder=new r.Encoder,i.decoder=new r.Decoder,i._autoConnect=!1!==t.autoConnect,i._autoConnect&&i.open(),i}return e(o,[{key:"reconnection",value:function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}},{key:"reconnectionAttempts",value:function(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}},{key:"reconnectionDelay",value:function(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null!=(t=this.backoff)&&t.setMin(e),this)}},{key:"randomizationFactor",value:function(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null!=(t=this.backoff)&&t.setJitter(e),this)}},{key:"reconnectionDelayMax",value:function(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null!=(t=this.backoff)&&t.setMax(e),this)}},{key:"timeout",value:function(e){return arguments.length?(this._timeout=e,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(t){var e,i,r,n,o,s,a=this;return~this._readyState.indexOf("open")||(this.engine=new ge(this.uri,this.opts),e=this.engine,(i=this)._readyState="opening",this.skipReconnect=!1,r=M(e,"open",function(){i.onopen(),t&&t()}),n=M(e,"error",function(e){i.cleanup(),i._readyState="closed",a.emitReserved("error",e),t?t(e):i.maybeReconnectOnOpen()}),!1!==this._timeout&&(0===(o=this._timeout)&&r(),s=this.setTimeoutFn(function(){r(),e.close(),e.emit("error",new Error("timeout"))},o),this.opts.autoUnref&&s.unref(),this.subs.push(function(){clearTimeout(s)})),this.subs.push(r),this.subs.push(n)),this}},{key:"connect",value:function(e){return this.open(e)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var e=this.engine;this.subs.push(M(e,"ping",this.onping.bind(this)),M(e,"data",this.ondata.bind(this)),M(e,"error",this.onerror.bind(this)),M(e,"close",this.onclose.bind(this)),M(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(e){this.decoder.add(e)}},{key:"ondecoded",value:function(e){this.emitReserved("packet",e)}},{key:"onerror",value:function(e){this.emitReserved("error",e)}},{key:"socket",value:function(e,t){var i;return(i=this.nsps[e])||(i=new Ae(this,e,t),this.nsps[e]=i),i}},{key:"_destroy",value:function(e){for(var t=0,i=Object.keys(this.nsps);t<i.length;t++){var r=i[t];if(this.nsps[r].active)return}this._close()}},{key:"_packet",value:function(e){for(var t=this.encoder.encode(e),i=0;i<t.length;i++)this.engine.write(t[i],e.options)}},{key:"cleanup",value:function(){this.subs.forEach(function(e){return e()}),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var t=this;if(this._reconnecting||this.skipReconnect)return this;var e,i,r=this;this.backoff.attempts>=this._reconnectionAttempts?(this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1):(e=this.backoff.duration(),this._reconnecting=!0,i=this.setTimeoutFn(function(){r.skipReconnect||(t.emitReserved("reconnect_attempt",r.backoff.attempts),r.skipReconnect||r.open(function(e){e?(r._reconnecting=!1,r.reconnect(),t.emitReserved("reconnect_error",e)):r.onreconnect()}))},e),this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)}))}},{key:"onreconnect",value:function(){var e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}]),o}(),D={};function L(e,t){"object"===h(e)&&(t=e,e=void 0);var e=function(e,t,i){var t=1<arguments.length&&void 0!==t?t:"",r=e,i=(2<arguments.length?i:void 0)||"undefined"!=typeof location&&location;return"string"==typeof(e=null==e?i.protocol+"//"+i.host:e)&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?i.protocol+e:i.host+e),r=S(e=/^(https?|wss?):\/\//.test(e)?e:void 0!==i?i.protocol+"//"+e:"https://"+e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/",e=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host,r.id=r.protocol+"://"+e+":"+r.port+t,r.href=r.protocol+"://"+e+(i&&i.port===r.port?"":":"+r.port),r}(e,(t=t||{}).path||"/socket.io"),i=e.source,r=e.id,n=e.path,n=D[r]&&n in D[r].nsps,n=t.forceNew||t["force new connection"]||!1===t.multiplex||n?new R(i,t):(D[r]||(D[r]=new R(i,t)),D[r]);return e.query&&!t.query&&(t.query=e.queryKey),n.socket(e.path,t)}return a(L,{Manager:R,Socket:Ae,io:L,connect:L}),L});const VERSION="0.1.1",TILE_SIZE=16,GAME_WIDTH=160,GAME_HEIGHT=160,FPS=60,canvas=document.getElementById("pkmn"),app=new PIXI.Application({view:canvas,width:GAME_WIDTH,height:GAME_HEIGHT,backgroundColor:0});let import_data={maps:[],meta:{},player:{}},game_id=url_parameter("g"),meta={},maps=[],player,trainers=[],npcs=[],menus=[],items=[],keys={},battle={},editor={},dialogue={},tile_textures=[],spritesheets=[],item_sprites=[],message_text,paused=!1,game_mode=window.location.pathname.slice(1),chat=null,socket=io(),background=new PIXI.Container,atts_container=new PIXI.Container,npc_container=new PIXI.Container,player_container=new PIXI.Container,trainer_container=new PIXI.Container,message_container=new PIXI.Container,menu_container=new PIXI.Container,battle_container=new PIXI.Container,music,sfx,kanto_gamepad={up:!1,down:!1,left:!1,right:!1,action:!1,back:!1};function kanto_console(e,t){var i,r;-1<navigator.userAgent.toLowerCase().indexOf("chrome")?(r=["\n %c %c %c Kanto Engine v"+VERSION+" %c  %c  "+e+"  %c \n","background: #cedae6; padding:5px 0;","background: #cedae6; padding:5px 0;","color: #cedae6; background: #030307; padding:5px 0;","background: #cedae6; padding:5px 0;","color: #2f2f2f; background: #fff; padding:5px 0;","background: #cedae6; padding:5px 0;"],(i=window.console).log.apply(i,r)):window.console&&window.console.log("Kanto Engine - "+e)}function time(){return Date.now()}function parse_query_string(){const e=window.location.search;var t=e.split("?")[1];return new URLSearchParams(t)}kanto_load();const saveTemplateAsFile=(e,t)=>{t=new Blob([JSON.stringify(t)],{type:"text/json"});const i=document.createElement("a");i.download=e,i.href=window.URL.createObjectURL(t),i.dataset.downloadurl=["text/json",i.download,i.href].join(":");e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(e),i.remove()},move_element_in_array=(e,t,i)=>{if("[object Array]"!==Object.prototype.toString.call(e))throw new Error("Please provide a valid array.");var r=e.splice(t,1);if(!r.length)throw new Error("There is no item in the array at index "+t);e.splice(i,0,r[0])},delete_element_in_array=(e,t)=>{if("[object Array]"!==Object.prototype.toString.call(e))throw new Error("Please provide a valid array.");if(!e.splice(t,1).length)throw new Error("There is no item in the array at index "+from)};function store_data(e,t){localStorage.setItem(e,t)}function retrieve_data(e){return localStorage.getItem(e)}function url_parameter(e){let t=parse_query_string();return t.get(e)}class Editor{constructor(){this.initialized=!1,this.selected_texture=0,this.selected_attribute=1,this.enabled=!0,this.zoom=100,this.action_timeout=!1,this.palette=document.querySelector("#tile-editor img"),this.mode=null,this.templates={games:[],maps:[]},this.working_dialogue=[],this.palette&&(this.prepare_maps(),this.prepare_palette(),this.prepare_tiles(),this.prepare_atts(),this.prepare_properties(),this.log(),editor_event_listeners(),kanto_get_game_templates().then(e=>{this.templates.games=e,editor.prepare_game_template_list(e)}),kanto_get_map_templates().then(e=>{this.templates.maps=e,editor.prepare_map_template_list(e)})),this.event_listeners(),this.initialized=!0}event_listeners(){this.initialized||(document.querySelectorAll("#kanto-editor [data-open]").forEach(t=>{t.addEventListener("click",e=>{document.querySelectorAll(".editor").forEach(e=>{e.classList.remove("-active")}),document.querySelector(t.dataset.open).classList.add("-active"),editor.mode=t.dataset.mode,editor.refresh()})}),document.querySelectorAll("#kanto-editor [data-att]").forEach(t=>{t.addEventListener("click",e=>{editor.selected_attribute=parseInt(t.dataset.att),set_att_editor(editor.selected_attribute),editor.clear_working_dialogue(),editor.clear_working_pokemon()})}),document.querySelector("#editor-publish-game")&&document.querySelector("#editor-publish-game").addEventListener("click",e=>{editor.publish()}),document.querySelector("#editor-new-map")&&document.querySelector("#editor-new-map").addEventListener("click",e=>{editor.create_new_map()}),document.querySelector("#editor-delete-map")&&document.querySelector("#editor-delete-map").addEventListener("click",e=>{editor.delete_map()}),document.querySelector("#editor-add-message")&&document.querySelector("#editor-add-message").addEventListener("click",e=>{editor.add_message_to_dialogue()}),document.querySelector("#editor-message-add-option")&&document.querySelector("#editor-message-add-option").addEventListener("click",e=>{editor.add_message_field("option")}),document.querySelector("#editor-message-add-pre-callback")&&document.querySelector("#editor-message-add-pre-callback").addEventListener("click",e=>{editor.add_message_field("pre_callback")}),document.querySelector("#editor-message-add-post-callback")&&document.querySelector("#editor-message-add-post-callback").addEventListener("click",e=>{editor.add_message_field("post_callback")}),document.querySelector("#editor-message-add-response")&&document.querySelector("#editor-message-add-response").addEventListener("click",e=>{editor.add_message_field("response")}),document.querySelector("#editor-add-pokemon")&&document.querySelector("#editor-add-pokemon").addEventListener("click",e=>{editor.add_pokemon_to_tile()}))}update(){this.prepare_maps(),this.prepare_tiles(),this.prepare_atts(),this.prepare_properties(),this.save()}refresh(){atts_container.visible=!1,"atts"===this.mode&&(atts_container.visible=!0)}prepare_palette(){this.palette.addEventListener("click",e=>{var t=Math.floor(this.palette.width/TILE_SIZE);let i={x:Math.floor(e.offsetX/TILE_SIZE),y:Math.floor(e.offsetY/TILE_SIZE)};i.tile=i.x+t*i.y,this.selected_texture=i.tile,console.log(i),document.querySelector("#pkmn").focus()})}edit_tile(t){switch(this.mode){case"tiles":this.adjust_tile(t),this.save();break;case"atts":let e=this.selected_attribute;3==editor.mouse_event&&(e=0),this.adjust_attribute(t.game_position,e),map.build_npcs(),map.server_sync(),this.save()}}prepare_tiles(){background.children.forEach(i=>{i.interactive=!0,i.origin={texture:i.texture},i.on("pointerdown",e=>{editor.pointer_down=!0,editor.mouse_event=e.data.originalEvent.which,this.edit_tile(i)}),i.on("pointerup",e=>{editor.pointer_down=!1,editor.mouse_event=null}),i.on("mouseover",e=>{if(editor.pointer_down&&this.edit_tile(i),"tiles"==this.mode&&(i.alpha=.8,i.texture=tile_textures[this.selected_texture]),"atts"==this.mode){map.atts[i.game_position.index];switch(atts_container.children[i.game_position.index].alpha=.4,this.selected_attribute){case 1:atts_container.children[i.game_position.index].tint="0xFF0000";break;case 2:atts_container.children[i.game_position.index].tint="0x0000FF";break;case 3:atts_container.children[i.game_position.index].tint="0x00FF00";break;case 4:atts_container.children[i.game_position.index].tint="0xFFA500";break;case 5:atts_container.children[i.game_position.index].tint="0x000000";break;case 6:atts_container.children[i.game_position.index].tint="0xFFD5D5";break;case 7:atts_container.children[i.game_position.index].tint="0xDAA520";break;case 8:atts_container.children[i.game_position.index].tint="0x35530A";break;case 9:atts_container.children[i.game_position.index].tint="0x561D5E"}}}),i.on("mouseout",e=>{if("tiles"==this.mode&&(i.alpha=1,i.texture=i.origin.texture),"atts"==this.mode){var t=map.atts[i.game_position.index];switch(atts_container.children[i.game_position.index].alpha=1,t.type){case 1:atts_container.children[i.game_position.index].tint="0xFF0000";break;case 2:atts_container.children[i.game_position.index].tint="0x0000FF";break;case 3:atts_container.children[i.game_position.index].tint="0x00FF00";break;case 4:atts_container.children[i.game_position.index].tint="0xFFA500";break;case 5:atts_container.children[i.game_position.index].tint="0x000000";break;case 6:atts_container.children[i.game_position.index].tint="0xFFD5D5";break;case 7:atts_container.children[i.game_position.index].tint="0xDAA520";break;case 8:atts_container.children[i.game_position.index].tint="0x35530A";break;case 9:atts_container.children[i.game_position.index].tint="0x561D5E";break;default:atts_container.children[i.game_position.index].tint="0xEEEEEE",atts_container.children[i.game_position.index].alpha=0}}})})}prepare_atts(){set_att_editor(this.selected_attribute)}prepare_maps(){let i=document.querySelector("#map-editor #editor-maps-list");i.innerHTML="",maps.forEach(e=>{let t=document.createElement("li");t.innerHTML=e.id+": "+e.name,t.setAttribute("data-map",e.id),i.appendChild(t)}),document.querySelectorAll("#kanto-editor [data-map]").forEach(i=>{i.addEventListener("click",e=>{var t=parseInt(i.dataset.map),t=maps[t];player.place(t.starting_position.x,t.starting_position.y,t.id),this.update_editor_properties(),document.querySelector("#pkmn").focus()})}),this.update_editor_properties()}prepare_properties(){let e=document.querySelectorAll("[data-property]");e.forEach(t=>{t.addEventListener("change",e=>{this.adjust_property(t.dataset.property,t.value),this.update_editor_properties()})}),this.update_editor_properties()}update_editor_properties(){let e=document.querySelector("#kanto-editor");e&&(e.querySelector("input[name=editor-map-name]").value=map.name,e.querySelector("input[name=editor-map-music]").value=map.music,e.querySelector("input[name=editor-start-x]").value=map.starting_position.x,e.querySelector("input[name=editor-start-y]").value=map.starting_position.y,e.querySelector("input[name=editor-map-width]").value=map.width,e.querySelector("input[name=editor-map-height]").value=map.height,e.querySelector("input[name=editor-game-name]").value=meta.name,e.querySelector("input[name=editor-game-sprite]").value=player.spritesheet_id)}adjust_tile(e){e.texture=tile_textures[this.selected_texture],e.origin.texture=e.texture,maps[e.game_position.map].tiles[e.game_position.index]=this.selected_texture,map=maps[e.game_position.map]}adjust_attribute(e,t){let i="";switch(t){case 1:i="0xFF0000";break;case 2:i="0x0000FF";break;case 3:i="0x00FF00";break;case 4:i="0xFFA500";break;case 5:i="0x000000";break;case 6:i="0xFFD5D5";break;case 7:i="0xDAA520";break;case 8:i="0x35530A";break;case 9:i="0x561D5E";break;default:i="0xEEEEEE"}maps[e.map].atts[e.index]=t?this.gather_data():{type:0},map=maps[e.map],atts_container.children[e.index].tint=i}adjust_property(e,t){switch(e){case"name":maps[map.id].name=t;break;case"music":maps[map.id].music=parseInt(t),music&&music.play(map.music);break;case"start_x":maps[map.id].starting_position.x=parseInt(t);break;case"start_y":maps[map.id].starting_position.y=parseInt(t);break;case"game_name":localStorage.removeItem(meta.name),meta.name=t;break;case"game_sprite":player.change_spritesheet(parseInt(t))}map=maps[map.id],this.prepare_maps(),this.save()}save(){store_data(meta.name,kanto_game_export())}publish(){var e=kanto_game_export();fetch(`${window.location.protocol}//${window.location.host}/upload`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:e}).then(e=>e.json()).then(e=>{e.success?(alert(`Game upload successful. You may now view this game at the URL: ${window.location.protocol}//${window.location.host}/play?g=`+e.game_id),meta.game_id=e.game_id,store_data(meta.name,kanto_game_export())):alert("Game upload failed! Please try again later.")})}gather_data(){let e=document.querySelectorAll(".editor.-active input, .editor.-active textarea, .editor.-active select"),t={};return!!e&&(e.forEach(e=>{"number"==e.type?t[e.name]=parseInt(e.value):"message"==e.name?t[e.name]=e.value.split(/\r?\n/):t[e.name]=e.value}),this.working_dialogue&&0<this.working_dialogue.length&&(t.dialogue=this.prepare_dialogue_data()),this.working_pokemon&&0<this.working_pokemon.length&&(t.pokemon=this.working_pokemon),t)}prepare_dialogue_data(){let h=[];return this.working_dialogue.forEach(s=>{let a={};if(a.text=s.text,s.options&&(a.options=[],s.options.forEach(e=>{a.options.push({option:e,dialogue:[]})})),s.pre_callback&&(a.pre_callback={...s.pre_callback},a.pre_callback.args=this.prepare_callback_args(a.pre_callback.name,a.pre_callback.args)),s.post_callback&&(a.post_callback={...s.post_callback},a.post_callback.args=this.prepare_callback_args(a.post_callback.name,a.post_callback.args)),s.response){let o=!1;for(let n=h.length-1;0<=n;n--)!o&&h[n].options&&h[n].options.forEach((e,r)=>{o||(e.dialogue&&e.dialogue.forEach((e,i)=>{e.options&&e.options.forEach((e,t)=>{e.option==s.response&&(o=!0,h[n].options[r].dialogue[i].options[t].dialogue.push(a))})}),e.option==s.response&&(o=!0,h[n].options[r].dialogue.push(a)))})}else h.push(a)}),h}add_message_to_dialogue(){let e=document.querySelectorAll("#message-editor input, #message-editor textarea, #message-editor select"),t={};e&&(e.forEach(e=>{if(console.log(e),e.value){switch(e.name){case"option":t.options||(t.options=[]),t.options.push(e.value);break;case"pre_callback":console.log(e.options),t.pre_callback?t.pre_callback.name=e.options[e.selectedIndex].text:t.pre_callback={name:e.options[e.selectedIndex].text};break;case"pre_callback_args":t.pre_callback?t.pre_callback.args=e.value:t.pre_callback={args:e.value};break;case"post_callback":t.post_callback?t.post_callback.name=e.options[e.selectedIndex].text:t.post_callback={name:e.options[e.selectedIndex].text};break;case"post_callback_args":t.post_callback?t.post_callback.args=e.value:t.post_callback={args:e.value};break;default:t[e.name]=e.value}e.value="","type"==e.name&&(e.value="Text")}}),this.working_dialogue.push(t),this.reset_editors(),document.querySelector("#message-editor").classList.add("_hidden")),this.update_working_dialogue_list()}add_pokemon_to_tile(){let e=document.querySelectorAll("#pokemon-editor input, #pokemon-editor textarea, #pokemon-editor select"),t={};e&&(e.forEach(e=>{e.value&&(e.name,t[e.name]=e.value)}),this.working_pokemon.push(t),this.reset_editors(),document.querySelector("#pokemon-editor").classList.add("_hidden")),this.update_working_pokemon_list()}reset_editors(){let e=document.querySelector(".editor-message-form"),t=(e.innerHTML='<div class="editor-data-line"><span>Text:</span><textarea name="text"></textarea></div>',document.querySelector(".editor-pokemon-form"));t.innerHTML='<div class="editor-data-line"> <span>ID:</span> <input type="number" name="id"></input> </div> <div class="editor-data-line"> <span>Level:</span> <input type="number" name="level"></input> </div>'}add_message_field(e){let t=document.querySelector(".editor-message-form"),i=document.createElement("div");switch(i.classList.add("editor-data-line"),e){case"option":i.innerHTML='<div><span>Option:</span><input type="text" name="option"></div>';break;case"pre_callback":i.innerHTML="<div><span>Pre Callback:</span>"+this.callback_options("pre")+'<input type="text" name="pre_callback_args"></div>';break;case"post_callback":i.innerHTML="<div><span>Post Callback:</span>"+this.callback_options("post")+'<input type="text" name="post_callback_args"></div>';break;case"response":i.innerHTML='<div><span>Response:</span><input type="text" name="response"></div>'}t.appendChild(i)}callback_options(e="pre"){return`
        <select name="${e}_callback">
            <option>dialogue_sfx</option>
            <option>dialogue_cry_sfx</option>
            <option>dialogue_give_item</option>
            <option>dialogue_force_move_north</option>
            <option>dialogue_force_move_east</option>
            <option>dialogue_force_move_south</option>
            <option>dialogue_force_move_west</option>
        </select>`}prepare_callback_args(e,t){switch(e){case"dialogue_sfx":case"dialogue_give_item":return{name:t};case"dialogue_cry_sfx":return{id:t};case"dialogue_force_move_north":case"dialogue_force_move_east":case"dialogue_force_move_south":case"dialogue_force_move_west":return{spaces:t};default:return{name:t}}}update_working_dialogue_list(){let n=document.querySelector(".editor.-active .dialogue-editor-list"),o=(n.innerHTML="",0);this.working_dialogue.forEach((e,t)=>{let i=document.createElement("li"),r=(i.setAttribute("data-index",t),i.setAttribute("data-depth",o),e.options&&o++,e.response&&(i.innerHTML+=e.response+": "),"object"==typeof e&&(i.innerHTML+=e.text),document.createElement("div"));["up","down","x"].forEach(e=>{let t=document.createElement("button");switch(t.innerText=e,t.classList.add("message-option-"+e),e){case"up":t.addEventListener("click",e=>{e=parseInt(e.target.closest("li").getAttribute("data-index"));move_element_in_array(this.working_dialogue,e,e-1),editor.update_working_dialogue_list()});break;case"down":t.addEventListener("click",e=>{e=parseInt(e.target.closest("li").getAttribute("data-index"));move_element_in_array(this.working_dialogue,e,e+1),editor.update_working_dialogue_list()});break;case"x":t.addEventListener("click",e=>{e=parseInt(e.target.closest("li").getAttribute("data-index"));delete_element_in_array(this.working_dialogue,e),editor.update_working_dialogue_list()})}r.appendChild(t)}),i.appendChild(r),n.appendChild(i)})}update_working_pokemon_list(){let n=document.querySelector(".editor.-active .pokemon-editor-list");n.innerHTML="";this.working_pokemon.forEach((e,t)=>{let i=document.createElement("li"),r=(i.setAttribute("data-index",t),e.id&&(i.innerHTML+=e.id+": Level "+e.level),document.createElement("div"));["x"].forEach(e=>{let t=document.createElement("button");t.innerText=e,t.classList.add("pokemon-option-"+e),"x"===e&&t.addEventListener("click",e=>{e=parseInt(e.target.closest("li").getAttribute("data-index"));delete_element_in_array(this.working_pokemon,e),editor.update_working_pokemon_list()}),r.appendChild(t)}),i.appendChild(r),n.appendChild(i)})}clear_working_dialogue(){this.working_dialogue=[]}clear_working_pokemon(){this.working_pokemon=[]}create_new_map(){var e=new Kanto_Map;maps.push(e),player.place(e.starting_position.x,e.starting_position.y,e.id),this.update()}delete_map(){if("DELETE"==prompt(`Are you sure you want to delete ${map.name}? Type DELETE to continue:`)){let r=0;maps.forEach((e,t)=>{e.id==map.id&&(r=t)}),delete_element_in_array(maps,r);for(let i=0;i<maps.length;i++)maps[i].id=i,maps[i].atts.forEach((e,t)=>{switch(e.type){case 2:case 4:maps[i].atts[t].map>r?(console.log("Bringing down the index by one:",maps[i].atts[t]),console.log(maps[i].atts[t].map),maps[i].atts[t].map=maps[i].atts[t].map-1,console.log(maps[i].atts[t].map)):maps[i].atts[t].map==r&&(console.log("Attribute references a deleted map:",maps[i].atts[t]),console.log(maps[i].atts[t]),maps[i].atts[t]={type:0},console.log(maps[i].atts[t]))}});player.place(maps[0].starting_position.x,maps[0].starting_position.y,0),(map=maps[0]).build(),this.update()}}log(){document.querySelector("#coords")&&(document.querySelector("#coords").innerHTML=`{${player.position.map}, ${player.position.x}, ${player.position.y}}`)}prepare_game_template_list(e){if(document.querySelector("#editor-game-templates")){let i=document.querySelector("#editor-game-templates");i.innerHTML="",e.forEach(e=>{let t=document.createElement("li");t.innerHTML=e.meta.name,i.appendChild(t)}),document.querySelector("#editor-game-templates")&&document.querySelectorAll("#editor-game-templates li").forEach(t=>{t.addEventListener("click",e=>{editor.templates.games.forEach(e=>{e.meta.name==t.innerHTML&&kanto_switch_game(JSON.stringify(e))})})})}}prepare_map_template_list(e){if(document.querySelector("#editor-maps-templates")){let i=document.querySelector("#editor-maps-templates");i.innerHTML="",e.forEach(e=>{let t=document.createElement("li");t.innerHTML=e.name,i.appendChild(t)}),document.querySelector("#editor-maps-templates")&&document.querySelectorAll("#editor-maps-templates li").forEach(t=>{t.addEventListener("click",e=>{editor.templates.maps.forEach(e=>{e.name==t.innerHTML&&kanto_append_map(JSON.stringify(e))})})})}}}function add_padding(){let i=[],r=[];var n=map.height+2,o=map.width+2;for(let t=0;t<n;t++)for(let e=0;e<o;e++)0==t||t==n-1||0==e||e==map.width+1?(i.push(0),r.push({type:0})):(i.push(map.tiles[e-1+map.width*(t-1)]),r.push(map.atts[e-1+map.width*(t-1)]));console.log(JSON.stringify(i)),console.log(JSON.stringify(r))}function expand_map(t){if(t){let i,e,r;switch(t){case"North":i=map.width,e=map.height+1,r=0;break;case"South":i=map.width,e=map.height+1,r=e-1;break;case"West":i=map.width+1,e=map.height,r=0;break;case"East":i=map.width+1,e=map.height,r=i-1}if("North"==t||"South"==t)for(let t=0;t<e;t++)for(let e=0;e<i;e++){var n=e+i*t;t==r&&(map.tiles.splice(n,0,0),map.atts.splice(n,0,{type:0}))}else for(let t=0;t<e;t++)for(let e=0;e<i;e++){var o=e+i*t;e==r&&(map.tiles.splice(o,0,0),map.atts.splice(o,0,{type:0}))}switch(map.width=i,map.height=e,map.build_tiles(),map.build_atts(),map.build_items(),maps[map.id]=map,editor.update(),t){case"North":player.place(player.position.x,player.position.y+1);break;case"West":player.place(player.position.x+1,player.position.y)}}}function condense_map(n){if(n){let e,t,i;switch(n){case"North":e=map.width,t=map.height-1,i=0;break;case"South":e=map.width,t=map.height-1,i=t+1;break;case"West":e=map.width-1,t=map.height,i=0;break;case"East":e=map.width-1,t=map.height,i=e}let r=0;if("North"==n||"South"==n)for(let t=0;t<map.height;t++)for(let e=0;e<map.width;e++){var o=e+map.width*t;t==i&&(map.tiles.splice(o+r,1),map.atts.splice(o+r,1),r--)}else for(let t=0;t<map.height;t++)for(let e=0;e<map.width;e++){var s=e+map.width*t;e==i&&(map.tiles.splice(s+r,1),map.atts.splice(s+r,1),r--)}switch(map.width=e,map.height=t,map.build_tiles(),map.build_atts(),map.build_items(),maps[map.id]=map,editor.update(),n){case"North":player.place(player.position.x,player.position.y-1);break;case"West":player.place(player.position.x-1,player.position.y)}}}function fill_map(r){background.removeChildren(),map.tiles=[];for(let i=0;i<map.height;i++)for(let t=0;t<map.width;t++){var n=t+map.width*i;let e=new PIXI.Sprite(tile_textures[r]);map.tiles.push(r),e.x=t*TILE_SIZE,e.y=i*TILE_SIZE,e.game_position={map:map.id,x:t,y:i,index:n},background.addChild(e)}}function center_stage_assets(){background.origin.x=app.screen.width/2-TILE_SIZE/2,background.origin.y=app.screen.width/2-TILE_SIZE/2,atts_container.origin.x=app.screen.width/2-TILE_SIZE/2,atts_container.origin.y=app.screen.width/2-TILE_SIZE/2,player.sprite.x=app.screen.width/2,player.sprite.y=app.screen.height/2,background.x=background.origin.x+player.position.x*TILE_SIZE*-1,background.y=background.origin.y+player.position.y*TILE_SIZE*-1,atts_container.x=atts_container.origin.x+player.position.x*TILE_SIZE*-1,atts_container.y=atts_container.origin.y+player.position.y*TILE_SIZE*-1}function set_att_editor(e){let t=document.querySelector("#att-editor"),i=t.querySelector(".general-editor-display");switch(i.innerHTML="",e){case 1:i.innerHTML+="<h5>Wall</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="1" disabled></div>';break;case 2:i.innerHTML+="<h5>Warp</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="2" disabled></div>',i.innerHTML+='<div class="editor-data-line"><label>Map:</label><input name="map" type="number"></div>',i.innerHTML+='<div class="editor-data-line"><label>X:</label><input name="x" type="number"></div>',i.innerHTML+='<div class="editor-data-line"><label>Y:</label><input name="y" type="number"></div>';break;case 3:i.innerHTML+="<h5>Action</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="3" disabled></div>',i.innerHTML+='<ol class="dialogue-editor-list"></ol>',i.innerHTML+='<div class="dialogue-editor-options"><button class="dialogue-editor-add">Add to Dialogue</button></div>';break;case 4:i.innerHTML+="<h5>Exit</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="4" disabled></div>',i.innerHTML+='<div class="editor-data-line"><label>Map:</label><input name="map" type="number"></div>',i.innerHTML+='<div class="editor-data-line"><label>X:</label><input name="x" type="number"></div>',i.innerHTML+='<div class="editor-data-line"><label>Y:</label><input name="y" type="number"></div>';break;case 5:i.innerHTML+="<h5>NPC</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="5" disabled></div>',i.innerHTML+='<div class="editor-data-line"><label>Sprite:</label><input name="sprite" type="number"></div>',i.innerHTML+='<div class="editor-data-line"><label>Facing:</label><select name="facing"><option>North</option><option>South</option><option>West</option><option>East</option></select></div>',i.innerHTML+='<div class="editor-data-line"><label>Movement State:</label><select name="movement_state"><option>Active</option><option>Static</option><option>Frozen</option></select></div>',i.innerHTML+='<ol class="dialogue-editor-list"></ol>',i.innerHTML+='<div class="dialogue-editor-options"><button class="dialogue-editor-add">Add to Dialogue</button></div>';break;case 6:i.innerHTML+="<h5>NPC Wall</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="6" disabled></div>';break;case 7:i.innerHTML+="<h5>Item</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="7" disabled></div>',i.innerHTML+='<div class="editor-data-line"><label>Name:</label><input name="name" type="text"></div>',i.innerHTML+='<div class="editor-data-line"><label>Sprite:</label><input name="sprite" type="number"></div>';break;case 8:i.innerHTML+="<h5>Wild Battle</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="8" disabled></div>',i.innerHTML+='<ol class="pokemon-editor-list"></ol>',i.innerHTML+='<div class="pokemon-editor-options"><button class="pokemon-editor-add">Add Pokemon</button></div>';break;case 9:i.innerHTML+="<h5>Tile Event</h5>",i.innerHTML+='<div class="editor-data-line _hidden"><label>Type:</label><input name="type" type="number" value="9" disabled></div>',i.innerHTML+='<ol class="dialogue-editor-list"></ol>',i.innerHTML+='<div class="dialogue-editor-options"><button class="dialogue-editor-add">Add to Dialogue</button></div>'}editor_event_listeners()}async function kanto_get_game_templates(){let e=await fetch(`${window.location.protocol}//${window.location.host}/templates/games`,{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"}});return await e.json()}async function kanto_get_map_templates(){let e=await fetch(`${window.location.protocol}//${window.location.host}/templates/maps`,{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"}});return await e.json()}function editor_event_listeners(){document.querySelector("._modal")&&document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",e=>{e.target.closest("._modal").classList.add("_hidden"),editor.reset_editors()})}),document.querySelector(".dialogue-editor-add")&&document.querySelectorAll(".dialogue-editor-add").forEach(e=>{e.addEventListener("click",e=>{document.querySelector("#message-editor").classList.remove("_hidden")})}),document.querySelector(".pokemon-editor-add")&&document.querySelectorAll(".pokemon-editor-add").forEach(e=>{e.addEventListener("click",e=>{document.querySelector("#pokemon-editor").classList.remove("_hidden")})})}function battle_prepare(e,t){var i="../assets/graphics/pokemon";battle.portraits={front:e.toLowerCase(),back:t.toLowerCase()},app.loader.resources["front_portrait_"+battle.portraits.front]||app.loader.add("front_portrait_"+battle.portraits.front,i+`/${battle.portraits.front}.png`),app.loader.resources["back_portrait_"+battle.portraits.back]||app.loader.add("back_portrait_"+battle.portraits.back,i+`/${battle.portraits.back}b.png`),music.load(14),app.loader.load(battle_loaded),battle_enter_animation()}function battle_enter_animation(){battle.animation=setInterval(()=>{let e=battle_container.getChildByName("transition");.75==e.alpha?e.alpha=0:e.alpha=.75},200),setTimeout(()=>{clearInterval(battle.animation),battle_container.getChildByName("transition").alpha=1},1500),setTimeout(()=>{battle_start()},2e3)}function battle_loaded(){battle_container.getChildByName("front_portrait")&&battle_remove_portraits();let e=new PIXI.Sprite.from(app.loader.resources["front_portrait_"+battle.portraits.front].url),t=(e.x=GAME_WIDTH-e.width-5,e.y=5,e.name="front_portrait",e.visible=!1,battle_container.addChild(e),new PIXI.Sprite.from(app.loader.resources["back_portrait_"+battle.portraits.back].url));t.x=5,t.y=50,t.width=64,t.height=64,t.name="back_portrait",t.visible=!1,battle_container.addChild(t)}function battle_start(){battle_container.getChildByName("transition").alpha=0,battle_container.getChildByName("background").visible=!0,setTimeout(()=>{battle_container.getChildByName("front_portrait").visible=!0,battle_container.getChildByName("back_portrait").visible=!0,dialogue.queue_messages([{text:`Wild ${battle.portraits.front.toUpperCase()} appeared!`,pre_callback:{name:"dialogue_cry_sfx",args:{id:battle.pokemon.id}}},{text:`Go! ${player.pokemon[0].name.toUpperCase()}!`,pre_callback:{name:"dialogue_cry_sfx",args:{id:player.pokemon[0].id}},post_callback:{name:"battle_complete"}}])},2e3)}function battle_complete(){music.immediate_play(14),dialogue.queue_messages([{text:`Enemy ${battle.portraits.front.toUpperCase()} fainted!`},{text:player.pokemon[0].name.toUpperCase()+" gained 117 EXP. Points!",post_callback:{name:"battle_end"}}])}function battle_end(){battle_remove_portraits(),message_container.visible=!1,music.stop(),setTimeout(()=>{battle_container.getChildByName("background").visible=!1,player.frozen=!1,player.in_battle=!1,player.emote.visible=!1,player.controls="walking",music.immediate_play(music.get_context()),socket.emit("trainer_exiting_battle",{lobby_id:meta.lobby_id})},500)}function battle_remove_portraits(){battle_container.removeChild(battle_container.getChildByName("front_portrait")),battle_container.removeChild(battle_container.getChildByName("back_portrait"))}function dialogue_sfx(e){console.log("callback event: dialogue_sfx",e),e.name&&sfx.play(e.name)}function dialogue_cry_sfx(e){console.log("callback event: dialogue_cry_sfx",e),e.id&&sfx.cry(e.id)}function dialogue_give_item(e){console.log("callback event: dialogue_give_item",e),e.name&&(music.stop(),player.items.push(new Item(e.name)),sfx.play("item-received"),setTimeout(()=>{music.play()},4e3))}function dialogue_wild_battle(e){console.log("callback event: dialogue_wild_battle",e),socket.emit("dialogue_wild_battle",{lobby_id:meta.lobby_id,trainer:trainer})}function dialogue_trainer_battle(e){console.log("callback event: dialogue_trainer_battle",e),socket.emit("dialogue_trainer_battle",{lobby_id:meta.lobby_id,trainer:trainer})}function dialogue_force_move_north(e){e.spaces&&player.force_move(0,parseInt(e.spaces))}function dialogue_force_move_east(e){e.spaces&&player.force_move(1,parseInt(e.spaces))}function dialogue_force_move_south(e){e.spaces&&player.force_move(2,parseInt(e.spaces))}function dialogue_force_move_west(e){e.spaces&&player.force_move(3,parseInt(e.spaces))}class Chat{constructor(){this.messages=[],this.cooldown=!1,this.pattern="^[^<>/]*$",this.regex=new RegExp(this.pattern),this.feed=document.querySelector("#chat-feed"),this.enabled=!0}trainer_message(e,t,i){if(!chat.enabled)return!1;this.messages.push(e+": "+t);let r=document.createElement("p");r.innerHTML=`<span style="color: ${i.color}">${e}:</span> `+t,this.feed.appendChild(r),this.feed.scrollTop=this.feed.scrollHeight}server_message(e){if(!chat.enabled)return!1;this.messages.push("Server: "+e);let t=document.createElement("p");t.classList.add("-lobby-notice"),t.innerHTML=""+e,this.feed.appendChild(t),this.feed.scrollTop=this.feed.scrollHeight}emit_message(e){if(!chat.enabled)return!1;this.validate_message(e)&&socket.emit("chat_add_message",{lobby_id:meta.lobby_id,message:e})}validate_message(e){return this.regex.test(e)}}function keysDown(e){if("37"!=e.keyCode&&"38"!=e.keyCode&&"39"!=e.keyCode&&"40"!=e.keyCode||paused||e.preventDefault(),e.target.getAttribute("data-action"))switch(e.preventDefault(),e.target.getAttribute("data-action")){case"up":e.keyCode=38;break;case"down":e.keyCode=40;break;case"left":e.keyCode=37;break;case"right":e.keyCode=39;break;case"action":e.keyCode=88}keys[e.keyCode]=!0}function keysUp(e){if(e.target.getAttribute("data-action"))switch(e.preventDefault(),e.target.getAttribute("data-action")){case"up":e.keyCode=38;break;case"down":e.keyCode=40;break;case"left":e.keyCode=37;break;case"right":e.keyCode=39;break;case"action":e.keyCode=88}keys[e.keyCode]=!1}function controls_loop(){if(player.moving||!player.can_move||paused||(keys[87]||keys[38]?"menu"===player.controls?menus[player.menu.current].move_cursor("North"):player.frozen||player.move(0):keys[83]||keys[40]?"menu"===player.controls?menus[player.menu.current].move_cursor("South"):player.frozen||player.move(2):keys[65]||keys[37]?"menu"===player.controls||player.frozen||player.move(3):!keys[68]&&!keys[39]||"menu"===player.controls||player.frozen||player.move(1)),keys[88]){if(paused)return;var e;if(dialogue.active)return void(dialogue.option_prompt_active?(e=(e=menus[player.menu.current]).options[e.cursor.index],dialogue.selected_option(e.name)):dialogue.next());switch(player.controls){case"menu":if(!player.menu.cooldown){setTimeout(()=>{player.menu.cooldown=!1},300),player.menu.cooldown=!0,sfx.play("action");let e=menus[player.menu.current],i=e.options[e.cursor.index];"Item"===i.type&&player.use_item(i.name),i.callback?i.callback():i.open_menu&&menus.forEach((e,t)=>{e.name==i.open_menu&&(player.menu.current=t,player.menu.history.push(t),e.open())})}break;case"battle":break;default:player.can_check_action&&(player.check_action(player.position.f),player.can_check_action=!1,setTimeout(()=>{player.can_check_action=!0},1e3))}}if(keys[90]){if(paused)return;"menu"===player.controls?player.menu.cooldown||(setTimeout(()=>{player.menu.cooldown=!1},300),player.menu.cooldown=!0,sfx.play("action"),menus[player.menu.current].close()):!player.can_check_action||player.frozen||player.menu.cooldown||(multiplayer_player_encounter(),player.can_check_action=!1,setTimeout(()=>{player.can_check_action=!0},1e3))}if(keys[13]){let e=document.querySelector("#chat-input");chat.cooldown||(chat.cooldown=!0,paused=document.activeElement===e?(document.querySelector("#pkmn").focus(),e.value&&(chat.emit_message(e.value),e.value=""),!1):(e.focus(),!0),setTimeout(()=>{chat.cooldown=!1},300))}!keys[77]||player.frozen||paused||player.menu.cooldown||(menu_container.visible?1!=player.menu.history.length||player.menu.cooldown||(setTimeout(()=>{player.menu.cooldown=!1},300),player.menu.cooldown=!0,sfx.play("action"),menus[player.menu.current].close()):(sfx.play("start-menu"),kanto_update_menus(),menu_container.visible=!0,menus[0].open(),player.menu.history.push(0),player.menu.current=0,player.menu.active=!0,player.controls="menu"),setTimeout(()=>{player.menu.cooldown=!1},300),player.menu.cooldown=!0)}function editor_controls_loop(){paused||(editor.action_timeout||player.moving||!player.can_move||(keys[189]&&(app.renderer.resize(app.renderer.width+editor.zoom,app.renderer.height+editor.zoom),center_stage_assets(),editor.action_timeout=!0,setTimeout(()=>{editor.action_timeout=!1},500)),keys[187]&&(app.renderer.resize(app.renderer.width-editor.zoom,app.renderer.height-editor.zoom),center_stage_assets(),editor.action_timeout=!0,setTimeout(()=>{editor.action_timeout=!1},500))),!keys[69]||editor.action_timeout||player.moving||(expand_map(player.facing),editor.action_timeout=!0,setTimeout(()=>{editor.action_timeout=!1},250)),!keys[84]||editor.action_timeout||player.moving||(condense_map(player.facing),editor.action_timeout=!0,setTimeout(()=>{editor.action_timeout=!1},250)))}window.addEventListener("keydown",keysDown),window.addEventListener("keyup",keysUp),window.addEventListener("pointerdown",keysDown),window.addEventListener("pointerup",keysUp);class Dialogue{constructor(){this.queue=[],this.msg=null,this.ticker=null,this.text=null,this.active=!1,this.speed=3,this.arrow={animation:0,mask:message_container.getChildByName("message_arrow")},this.disable_next=!1,this.awaiting_action=!1,this.option_prompt_active=!1}add_message(e){let t="",i=[];"object"==typeof e?(e.text&&(t=e.text),e.options&&(i=e.options),e.pre_callback&&"function"==typeof window[e.pre_callback.name]&&window[e.pre_callback.name](e.pre_callback.args),e.post_callback&&(this.post_callback=e.post_callback)):"string"==typeof e&&(t=e),this.active=!0,this.msg=new Message(t,i),player.frozen=!0,message_container.visible=!0,message_text.text="",write_game_text()}queue_messages(e){console.log(e),Array.isArray(e)?this.queue.push(...e):this.queue.push(e),this.process_queue()}process_queue(){0<this.queue.length&&(this.add_message(this.queue[0]),this.queue.shift())}next(){this.awaiting_action&&!this.disable_next&&(null==this.msg&&0==this.queue.length?(player.in_battle||(message_container.visible=!1,player.frozen=!1),message_text.text="",npcs.forEach(e=>{e.frozen=!1}),this.post_callback&&("function"==typeof window[this.post_callback.name]&&window[this.post_callback.name](this.post_callback.args),this.post_callback=null),setTimeout(()=>{0==dialogue.queue.length&&(dialogue.active=!1)},600)):null==this.msg&&0<this.queue.length?this.process_queue():(sfx.play("action"),this.msg.next_row()),this.awaiting_action=!1)}open_option_prompt(e){let i=null,r=null;if(this.queued_options=e,menus.forEach((e,t)=>{"Dialogue"==e.name&&(i=e,r=t)}),i){let t=[];e.forEach(e=>{t.push({name:e.option})}),i.update_options(t),menu_container.visible=!0,i.reset(),i.open(),player.menu.history.push(r),player.menu.current=r,player.menu.active=!0,player.controls="menu",this.option_prompt_active=!0}}selected_option(t){this.queued_options&&!this.disable_next&&this.queued_options.forEach(e=>{e.option==t&&(this.awaiting_action=!1,this.option_prompt_active=!1,sfx.play("action"),kanto_close_menus(),this.queue_messages(e.dialogue))})}}class Message{constructor(e,t=[]){this.text=e,this.options=t,this.index=0,this.tick=0,this.row_limit=17,this.length=e.length,this.words=e.split(" "),this.rows=[],this.current_row=0,this.read_characters=0,this.animation={active:!1,keyframes:[12.5,8,18],tick:0,arrow:time()},this.generate_rows(),this.text=this.text.replace(/;/g,"")}next_word(){var t=null,i=0;return this.words.forEach(e=>{(i+=e.length)>=this.index+e.length&&null==t&&(t=e)}),t}next_row(){var e=this.rows[this.current_row+1];0<this.current_row&&this.current_row<this.rows.length-1&&(this.animation.active=!0,this.animation.tick=0),e&&(this.read_characters+=this.rows[this.current_row].length+1,this.current_row++,dialogue.arrow.mask.visible=!0,dialogue.arrow.animation=0)}generate_rows(){let t=0,i=[],r=!1;this.words.forEach(e=>{e.includes(";")&&(e=e.replace(";",""),r=!0),/[.,:!?]/.test(e.charAt(e.length-1))?t+=e.length:t+=e.length+1,t>this.row_limit&&(this.rows.push(i.join(" ")),i=[],t=0,/[.,:!?]/.test(e.charAt(e.length-1))?t+=e.length:t+=e.length+1),i.push(e),r&&(t=this.row_limit,r=!1)}),i&&this.rows.push(i.join(" "))}}function write_game_text(){if(dialogue.msg&&dialogue.msg.animation.active)animate_game_text();else{if(dialogue.msg){if(dialogue.msg.tick++,keys[88]?dialogue.speed=1.5:dialogue.speed=3,dialogue.msg.index>dialogue.msg.length)return 0<dialogue.msg.options.length&&dialogue.open_option_prompt(dialogue.msg.options),dialogue.msg=null,dialogue.awaiting_action=!0,dialogue.disable_next=!0,setTimeout(()=>{dialogue.disable_next=!1},300),clearInterval(dialogue.interval_id),void(dialogue.interval_id=null);dialogue.text=dialogue.msg.text.slice(0+dialogue.msg.read_characters,dialogue.msg.index),dialogue.msg.rows[dialogue.msg.current_row-1]?message_text.text=dialogue.msg.rows[dialogue.msg.current_row-1]+"\n"+dialogue.text:message_text.text=dialogue.text,message_text.y=dialogue.msg.animation.keyframes[2]}dialogue.msg&&dialogue.msg.tick>dialogue.speed&&(dialogue.msg.tick=0,dialogue.msg.rows[dialogue.msg.current_row].length+dialogue.msg.read_characters>=dialogue.text.length+dialogue.msg.read_characters?dialogue.msg.index++:dialogue.msg.index==dialogue.msg.rows[dialogue.msg.current_row].length+dialogue.msg.read_characters+1&&(0==dialogue.msg.current_row?dialogue.msg.next_row():(dialogue.awaiting_action=!0,animate_arrow(dialogue.msg.tick)))),dialogue.interval_id||(dialogue.interval_id=setInterval(write_game_text,1e3/FPS))}}function animate_game_text(){dialogue.msg.animation.tick++,6<dialogue.msg.animation.tick?dialogue.msg.animation.active=!1:4<dialogue.msg.animation.tick?message_text.y=dialogue.msg.animation.keyframes[1]:2<dialogue.msg.animation.tick&&(message_text.y=dialogue.msg.animation.keyframes[0])}function animate_arrow(){var e=time();0==dialogue.arrow.animation&&(dialogue.arrow.mask.visible=!1,dialogue.arrow.animation=e),e>dialogue.arrow.animation+500&&(dialogue.arrow.mask.visible?dialogue.arrow.mask.visible=!1:dialogue.arrow.mask.visible=!0,dialogue.arrow.animation=e)}class Item{constructor(e="Untitled Item",t="Special"){this.name=e,this.type=t}use(){switch(console.log("Using "+this.name),this.name){case"BICYCLE":1==player.speed?(player.history.spritesheet_id=player.spritesheet_id,player.change_spritesheet(4),player.speed=2,music.immediate_play(32)):(player.history.spritesheet_id?player.change_spritesheet(player.history.spritesheet_id):player.change_spritesheet(0),player.speed=1,music.immediate_play(map.music)),multiplayer_update_speed(),kanto_close_menus();break;case"GREAT BALL":dialogue.queue_messages(["OAK: This isn't the time to use this!"])}}}function kanto_load(){kanto_console("https://github.com/MGPelloni/kanto"),kanto_load_assets()}function kanto_load_assets(){app.loader.add("tilemap","assets/graphics/tiles.png").add("sprites","assets/graphics/sprites.png").add("items","assets/graphics/items.png").add("message","assets/graphics/message.jpg").add("emote-shock","assets/graphics/emotes/shock.png"),app.loader.load(kanto_fetch_game)}function kanto_fetch_game(){"create"!=game_mode||game_id?fetch(`${window.location.protocol}//${window.location.host}/game`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({game:game_id})}).then(e=>e.json()).then(e=>{kanto_load_game(e)}):kanto_new_game()}function kanto_new_game(){meta={name:""},map=new Kanto_Map,maps.push(map),kanto_start()}function kanto_load_game(e){e=e.replaceAll("POKeMON","POKéMON"),import_data=JSON.parse(e),meta=import_data.meta,maps=kanto_load_maps(),map=maps[0],kanto_start()}function kanto_switch_game(e){e=e.replaceAll("POKeMON","POKéMON"),import_data=JSON.parse(e),kanto_reset()}function kanto_reset(){meta={name:import_data.meta.name},maps=kanto_load_maps(),map=maps[0],player.current_map=map,player.position.map=map.id,player.position.x=map.starting_position.x,player.position.y=map.starting_position.y,player.change_spritesheet(import_data.player.spritesheet_id),map.build(),editor.prepare_maps()}function kanto_load_maps(){let i=[],e=Object.entries(import_data.maps);return e.forEach(([e,t])=>{t.id=parseInt(e),kanto_map=new Kanto_Map(t.id,t.name,t.width,t.height,t.tiles,t.atts,t.music,t.starting_position),i.push(kanto_map)}),i}function kanto_append_map(e){let i=JSON.parse(e);i.id=maps.length,i.atts.forEach((e,t)=>{2!=e.type&&4!=e.type||(i.atts[t]={type:0})});e=new Kanto_Map(i.id,i.name,i.width,i.height,i.tiles,i.atts,i.music,i.starting_position);return console.log(e),maps.push(e),editor.update(),maps}function kanto_map_export(){let e=map;return delete e.id,delete e.x,delete e.y,delete e.items,JSON.stringify(map)}function kanto_game_export(){let e=meta,t=(delete e.lobby_id,maps.map(e=>({...e})));t.forEach(e=>{delete e.id,delete e.x,delete e.y,delete e.items});var i={sprite:player.spritesheet_id,pokemon:player.pokemon,items:player.items},i={meta:e,player:i,maps:t};return JSON.stringify(i)}function kanto_json_map_export(){return saveTemplateAsFile("kanto-map-export.json",JSON.parse(kanto_map_export()))}function kanto_json_game_export(){return saveTemplateAsFile("kanto-game-export.json",JSON.parse(kanto_game_export()))}function kanto_start(){prepare_background(),prepare_npc_container(),prepare_player_container(),prepare_trainer_container(),prepare_atts_container(),prepare_tilemap(),prepare_spritesheets(),prepare_item_sprites(),prepare_audio();let e=Math.floor(40*Math.random());import_data.player&&import_data.player.sprite&&(e=import_data.player.sprite),((player=new Player({map:map.id,x:map.starting_position.x,y:map.starting_position.y,f:2},e)).current_map=map).build(),app.ticker.maxFPS=FPS,app.ticker.add(move_loop),app.ticker.add(controls_loop),"create"==game_mode&&prepare_editor(),prepare_battle_container(),prepare_menus(),prepare_dialogue(),prepare_items(),prepare_multiplayer(),prepare_browser()}function prepare_atts_container(){atts_container.origin={x:app.view.width/2-TILE_SIZE/2,y:app.view.width/2-TILE_SIZE/2},atts_container.x=atts_container.origin.x,atts_container.y=atts_container.origin.y,atts_container.visible=!1,app.stage.addChild(atts_container)}function prepare_battle_container(){battle_container.x=0,battle_container.y=0,battle_container.width=GAME_WIDTH,battle_container.height=GAME_HEIGHT,battle_container.visible=!0;let e=new PIXI.Sprite(PIXI.Texture.WHITE),t=(e.x=0,e.y=0,e.width=GAME_WIDTH,e.height=GAME_HEIGHT,e.name="background",e.visible=!1,new PIXI.Sprite(PIXI.Texture.WHITE));t.width=GAME_WIDTH,t.height=GAME_HEIGHT,t.tint=0,t.name="transition",t.visible=!0,t.alpha=0,app.stage.addChild(battle_container),battle_container.addChild(e),battle_container.addChild(t)}function prepare_npc_container(){npc_container.origin={x:app.view.width/2-TILE_SIZE/2,y:app.view.width/2-TILE_SIZE/2-4},npc_container.x=npc_container.origin.x,npc_container.y=npc_container.origin.y,npc_container.visible=!0,app.stage.addChild(npc_container)}function prepare_player_container(){player_container.origin={x:0,y:0},player_container.width=GAME_WIDTH,player_container.height=GAME_HEIGHT,player_container.x=player_container.origin.x,player_container.y=player_container.origin.y,app.stage.addChild(player_container)}function prepare_trainer_container(){trainer_container.origin={x:app.view.width/2-TILE_SIZE/2,y:app.view.width/2-TILE_SIZE/2-4},trainer_container.x=trainer_container.origin.x,trainer_container.y=trainer_container.origin.y,trainer_container.visible=!0,app.stage.addChild(trainer_container)}function prepare_background(){background.origin={x:app.view.width/2-TILE_SIZE/2,y:app.view.width/2-TILE_SIZE/2},background.x=background.origin.x,background.y=background.origin.y,app.stage.addChild(background)}function prepare_tilemap(){var t=new PIXI.Texture.from(app.loader.resources.tilemap.url),i=Math.floor(t.width/TILE_SIZE),r=Math.floor(t.height/TILE_SIZE);for(let e=0;e<i*r;e++){var n=e%i,o=Math.floor(e/i);tile_textures[e]=new PIXI.Texture(t,new PIXI.Rectangle(n*TILE_SIZE,o*TILE_SIZE,TILE_SIZE,TILE_SIZE))}}function prepare_item_sprites(){var t=new PIXI.Texture.from(app.loader.resources.items.url);for(let e=0;e<t.width/TILE_SIZE;e++)item_sprites.push(new PIXI.Texture(t,new PIXI.Rectangle(e*TILE_SIZE,0,TILE_SIZE,TILE_SIZE)))}function prepare_spritesheets(){var i=new PIXI.Texture.from(app.loader.resources.sprites.url),r=TILE_SIZE,e=i.width/TILE_SIZE;for(let t=0;t<e;t++){let e={};var n=t*r,o=TILE_SIZE,s=TILE_SIZE;e.standSouth=[new PIXI.Texture(i,new PIXI.Rectangle(n,0,o,s))],e.standNorth=[new PIXI.Texture(i,new PIXI.Rectangle(n,+s,o,s))],e.standWest=[new PIXI.Texture(i,new PIXI.Rectangle(n,2*s,o,s))],e.standEast=[new PIXI.Texture(i,new PIXI.Rectangle(n,2*s,o,s),null,null,12)],e.walkSouth=[new PIXI.Texture(i,new PIXI.Rectangle(n,3*s,o,s)),new PIXI.Texture(i,new PIXI.Rectangle(n,0,o,s)),new PIXI.Texture(i,new PIXI.Rectangle(n,3*s,o,s),null,null,12),new PIXI.Texture(i,new PIXI.Rectangle(n,0,o,s))],e.walkWest=[new PIXI.Texture(i,new PIXI.Rectangle(n,5*s,o,s)),new PIXI.Texture(i,new PIXI.Rectangle(n,2*s,o,s))],e.walkEast=[new PIXI.Texture(i,new PIXI.Rectangle(n,5*s,o,s),null,null,12),new PIXI.Texture(i,new PIXI.Rectangle(n,2*s,o,s),null,null,12)],e.walkNorth=[new PIXI.Texture(i,new PIXI.Rectangle(n,4*s,o,s)),new PIXI.Texture(i,new PIXI.Rectangle(n,+s,o,s)),new PIXI.Texture(i,new PIXI.Rectangle(n,4*s,o,s),null,null,12),new PIXI.Texture(i,new PIXI.Rectangle(n,+s,o,s))],spritesheets.push(e)}}function prepare_audio(){Howler.mute(!0),music=new Music,sfx=new Sfx}function prepare_dialogue(){var e=new PIXI.Texture.from(app.loader.resources.message.url);(message_bg=new PIXI.Sprite(e)).width=app.view.width,message_bg.aspect=e.baseTexture.resource.width/e.baseTexture.resource.height,message_bg.height=1/message_bg.aspect*message_bg.width,message_container.y=app.view.height-message_bg.height,message_container.visible=!0,message_bounds={width:app.view.width-20},(message_text=new PIXI.Text("",{fontFamily:"pokemon_gbregular",fontSize:16,fill:0,align:"left",wordWrap:!0,wordWrapWidth:2*message_bounds.width})).x=8,message_text.y=18,message_text.style.lineHeight=30,message_text.scale.x=.5,message_text.scale.y=.5,message_text.resolution=4;let t=new PIXI.Sprite(PIXI.Texture.WHITE);t.name="message_arrow",t.tint="0xFFFBFF",t.x=message_bg.width-16,t.y=message_bg.height-18,t.width=7,t.height=6,app.stage.addChild(message_container),message_container.addChild(message_bg),message_container.addChild(message_text),message_container.addChild(t),message_container.visible=!1,dialogue=new Dialogue}function prepare_items(){items=[new Item("POKé BALL","Ball"),new Item("GREAT BALL","Ball"),new Item("POTION","Restore"),new Item("SUPER POTION","Restore"),new Item("ANTIDOTE","Status"),new Item("BICYCLE","Special")]}function prepare_menus(){menu_container.visible=!1,app.stage.addChild(menu_container),menus.push(new Menu("Start",[{name:"POKéDEX",type:"menu",callback:()=>{dialogue.queue_messages(["Your POKéDEX doesn't seem to be working.."])}},{name:"POKéMON",type:"menu",open_menu:"Pokemon"},{name:"ITEM",type:"menu",open_menu:"Items"},{name:"RED",type:"menu",callback:()=>{dialogue.queue_messages(["You have no badges or money!","Embarrassing!"])}},{name:"SPRITE",type:"menu",callback:()=>{player.change_spritesheet()}},{name:"OPTION",type:"menu"},{name:"EXIT",type:"menu",callback:()=>{menus[player.menu.current].close()}}],{width:80,height:128,x:80,y:0})),menus.push(new Menu("Items",[{name:"Cancel",type:"menu",callback:()=>{menus[player.menu.current].close()}}],{width:96,height:64,x:32,y:48})),menus.push(new Menu("Battle",[{name:"Fight",type:"menu",callback:()=>{menus[player.menu.current].close()}},{name:"PKMN",type:"menu",callback:()=>{menus[player.menu.current].close()}},{name:"Item",type:"menu",callback:()=>{menus[player.menu.current].close()}},{name:"Run",type:"menu",callback:()=>{sfx.play("run")}}],{width:96,height:64,x:GAME_WIDTH-96,y:GAME_HEIGHT-64}));let t=[];player.pokemon.forEach(e=>{t.push({name:e.name,type:"Pokemon"})}),menus.push(new Menu("Pokemon",t,{width:GAME_WIDTH,height:GAME_HEIGHT,x:0,y:0})),menus.push(new Menu("Dialogue",[{name:"YES"},{name:"NO"}],{width:48,height:48,x:112,y:56}))}function prepare_multiplayer(){let e=url_parameter("l");e=e||game_id,multiplayer_join_lobby(meta.lobby_id=e),chat=new Chat,"create"==game_mode&&(chat.enabled=!1),chat.enabled&&(document.querySelector("#chat-input")&&document.querySelector("#chat-input").addEventListener("focus",e=>{paused=!0}),document.querySelector("#chat-settings")&&document.querySelector("#chat-settings").addEventListener("click",e=>{var t=prompt("What would you like your name to be?");t&&(store_data("player_name",t),player.name=t,multiplayer_update_name())}))}function prepare_editor(){editor=new Editor,app.ticker.add(editor_controls_loop)}function prepare_browser(){"create"==game_mode?document.addEventListener("click",e=>{var t=document.querySelector("#pkmn");paused=document.activeElement!==t}):document.querySelector("#pkmn").addEventListener("click",e=>{paused=!1}),canvas.addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("contextmenu",e=>{e.preventDefault()}),document.getElementsByTagName("body")[0].addEventListener("touchstart",function(e){e.returnValue=!1}),document.querySelector("#pkmn").focus(),document.querySelector(".toggle-volume").addEventListener("click",e=>{music.enabled?(music.disable(),sfx.disable(),document.querySelector(".toggle-volume").classList.add("-muted")):(music.enable(),sfx.enable(),document.querySelector(".toggle-volume").classList.remove("-muted")),document.querySelector("#pkmn").focus()})}class Kanto_Map{constructor(e=null,t="Untitled Map",i=5,r=5,n=[],o=[],s=0,a={x:0,y:0}){null==e&&(e=maps.length),this.id=e,this.name=t,this.x=i*TILE_SIZE/2*-1,this.y=r*TILE_SIZE/2*-1,this.height=r,this.width=i,this.starting_position=a,this.tiles=n,this.atts=o,this.music=s,this.items=[],0!=this.tiles.length&&this.tiles||this.generate_tiles(),0!=this.atts.length&&this.atts||this.generate_atts()}generate_tiles(){this.tiles=[];for(let e=0;e<this.width*this.height;e++)this.tiles.push(Math.floor(3*Math.random())+1);console.log("Generated random map: ",this.tiles)}generate_atts(){this.atts=[];for(let e=0;e<this.width*this.height;e++)this.atts.push({type:0});console.log("Generated random atts: ",this.atts)}build_items(){this.items=[];for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){var r=t+this.width*i;if(7==this.atts[r].type){let e={name:this.atts[r].name,sprite:new PIXI.Sprite.from(item_sprites[this.atts[r].sprite-1]),position:{map:this.id,x:t,y:i,index:r},available:!0};e.sprite.game_position={map:this.id,x:t,y:i,index:r},e.sprite.x=t*TILE_SIZE,e.sprite.y=i*TILE_SIZE,this.items.push(e),background.addChild(e.sprite)}}}build_tiles(){background.removeChildren();for(let r=0;r<this.height;r++)for(let i=0;i<this.width;i++){var n=i+this.width*r,o=this.tiles[n];let e;var s=new PIXI.BaseTexture.from(app.loader.resources.tilemap.url),a=TILE_SIZE,h=TILE_SIZE;let t=null;switch(o){case 38:(e=new PIXI.AnimatedSprite(create_flower_top_spritesheet())).animationSpeed=.05,e.play();break;case 23:(e=new PIXI.AnimatedSprite(create_flower_bottom_spritesheet())).animationSpeed=.05,e.play();break;case 109:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,77*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,77*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 124:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,78*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,78*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 95:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,79*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,79*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 110:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,80*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,80*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 125:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,81*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,81*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 93:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,82*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,82*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 108:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,83*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,83*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;case 123:t=[new PIXI.Texture(s,new PIXI.Rectangle(0*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(4*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(3*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(2*a,84*h,a,h)),new PIXI.Texture(s,new PIXI.Rectangle(+a,84*h,a,h))],(e=new PIXI.AnimatedSprite(t)).animationSpeed=.05,e.play();break;default:e=new PIXI.Sprite(tile_textures[o])}e.x=i*TILE_SIZE,e.y=r*TILE_SIZE,e.game_position={map:this.id,x:i,y:r,index:n},background.addChild(e)}}build_atts(){atts_container.removeChildren();for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){var r=t+this.width*i,r=this.atts[r];let e=new PIXI.Sprite(PIXI.Texture.WHITE);switch(e.width=10,e.height=10,e.x=t*TILE_SIZE+3,e.y=i*TILE_SIZE+3,r.type){case 1:e.tint="0xFF0000";break;case 2:e.tint="0x0000FF";break;case 3:e.tint="0x00FF00";break;case 4:e.tint="0xFFA500";break;case 5:e.tint="0x000000",e.alpha=.5;break;case 6:e.tint="0xFFD5D5";break;case 7:e.tint="0xDAA520";break;case 8:e.tint="0x35530A";break;case 9:e.tint="0x561D5E";break;default:e.tint="0xEEEEEE",e.alpha=0}atts_container.addChild(e)}}build_npcs(){npcs.forEach(e=>{clearInterval(e.wander_interval)}),npcs=[],npc_container.removeChildren();for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){var i=e+this.width*t,i=this.atts[i];5===i.type&&(i=new Npc({map:this.id,x:e,y:t},i.sprite,i.dialogue,i.facing,i.movement_state,npcs.length),npcs.push(i))}}server_sync(){socket.emit("map_server_sync",{lobby_id:game_id,map:this.id})}build(){this.build_tiles(),this.build_npcs(),this.build_atts(),this.build_items(),this.server_sync(),music&&music.play(this.music),player.place(this.starting_position.x,this.starting_position.y,this.id)}refresh(){this.build_tiles(),this.build_npcs(),this.build_atts(),this.build_items(),this.server_sync()}}function check_sprite_tile_actions(e){switch(e){case 448:dialogue.add_message("A TOWN MAP.");break;case 975:case 976:dialogue.add_message("Crammed full of POKéMON books!");break;case 819:case 820:dialogue.add_message("Wow! Tons of POKéMON stuff!");break;case 808:case 977:sfx.play("turn-on-pc"),dialogue.queue_messages(["RED turned on the PC.","...","It doesn't seem to be working.."])}}class Menu{constructor(e,t=[],i={x:0,y:0,width:50,height:50}){this.name=e,this.options=t,this.dimensions=i,this.dimensions.menu_margin=17,this.dimensions.option_margin=15,this.create_sprite(),this.create_cursor(),this.set_properties()}set_properties(){this.max_options=this.options.length-1}create_cursor(){this.cursor={initial_position:{x:this.dimensions.x+8,y:this.dimensions.y+this.dimensions.menu_margin},increment:15,index:0,sprite:null},this.cursor.sprite=new PIXI.Graphics,this.cursor.sprite.beginFill(0),this.cursor.sprite.moveTo(0,0),this.cursor.sprite.lineTo(4,4),this.cursor.sprite.lineTo(0,9),this.cursor.sprite.endFill(),this.cursor.sprite.x=this.cursor.initial_position.x,this.cursor.sprite.y=this.cursor.initial_position.y,this.sprite.addChild(this.cursor.sprite)}create_sprite(){let r=new PIXI.Container,n=(r.visible=!1,new PIXI.Sprite(PIXI.Texture.WHITE));n.width=this.dimensions.width,n.height=this.dimensions.height,n.x=this.dimensions.x,n.y=this.dimensions.y,r.addChild(n),this.options.forEach((e,t)=>{let i=new PIXI.Text(e.name,{fontFamily:"pokemon_gbregular",fontSize:8,fill:0,align:"left"});i.x=n.x+16,i.y=n.y+this.dimensions.option_margin*t+this.dimensions.menu_margin,i.resolution=4,r.addChild(i)}),this.sprite=r,menu_container.addChild(this.sprite)}update_options(e){this.options=e,this.create_sprite(),this.create_cursor(),this.set_properties()}move_cursor(e){if(!player.menu.cooldown){switch(e){case"North":this.cursor.index--;break;case"South":this.cursor.index++}this.cursor.index<0?this.cursor.index=this.max_options:this.cursor.index>this.max_options&&(this.cursor.index=0),this.cursor.sprite.y=this.cursor.index*this.cursor.increment+this.cursor.initial_position.y,player.menu.cooldown=!0,setTimeout(()=>{player.menu.cooldown=!1},200)}}reset(){this.cursor.sprite.y=this.cursor.initial_position.y,this.cursor.index=0}open(){this.reset(),this.sprite.visible=!0}close(){this.sprite.visible=!1,player.menu.history.pop(),0<player.menu.history.length?player.menu.current=player.menu.history[player.menu.history.length-1]:(player.controls="walking",player.menu.active=!1,menu_container.visible=!1)}}function kanto_get_menu(t){let i=!1;return menus.forEach(e=>{e.name==t&&(i=e)}),i}function kanto_update_menus(){let e=kanto_get_menu("Items"),t=[];player.items.forEach(e=>{t.push({name:e.name,type:"Item"})}),t.push({name:"CANCEL",type:"menu",callback:()=>{menus[player.menu.current].close()}}),e.update_options(t)}function kanto_close_menus(){menus.forEach(e=>{e.close()})}function collision_check(t,i,e=null){let r=map;if(e&&(r=maps[e]),t<0||t>=r.width)return!0;if(i<0||i>=r.height)return!0;switch(r.atts[t+r.width*i].type){case 1:case 3:case 7:return!0}if(t==player.position.x&&i==player.position.y)return!0;let n=!1;return npcs.forEach(e=>{player.position.map==e.position.map&&t==e.position.x&&i==e.position.y&&(n=!0)}),trainers.forEach(e=>{player.position.map==e.position.map&&t==e.position.x&&i==e.position.y&&(n=!0)}),!!n}function exit_check(){return 4==player.current_map.atts[player.position.index].type}function move_loop(){player.moving&&("North"==player.direction&&(background.y+=player.speed,atts_container.y+=player.speed,npc_container.y+=player.speed,trainer_container.y+=player.speed),"South"==player.direction&&(background.y-=player.speed,atts_container.y-=player.speed,npc_container.y-=player.speed,trainer_container.y-=player.speed),"West"==player.direction&&(background.x+=player.speed,atts_container.x+=player.speed,npc_container.x+=player.speed,trainer_container.x+=player.speed),"East"==player.direction&&(background.x-=player.speed,atts_container.x-=player.speed,npc_container.x-=player.speed,trainer_container.x-=player.speed),player.current_move_ticker>=16/player.speed-1&&(player.moving=!1,player.facing=player.direction,player.direction=null,player.can_move=!1,setTimeout(()=>{player.position_update(),player.can_move=!0,player.current_move_ticker=0},8/player.speed)),player.current_move_ticker++),npcs.forEach((e,t)=>{if(e.moving&&e.can_move){switch(e.position.f){case 0:e.sprite.y-=.5;break;case 1:e.sprite.x+=.5;break;case 2:e.sprite.y+=.5;break;case 3:e.sprite.x-=.5}31<=e.current_move_ticker&&(e.moving=!1,e.can_move=!1,setTimeout(()=>{npcs[t].position_update(),npcs[t].can_move=!0,npcs[t].current_move_ticker=0},8)),e.current_move_ticker++}}),trainers.forEach((e,t)=>{if(e.moving){switch(e.next_position.f){case 0:e.sprite.y-=e.speed,e.emote.y-=e.speed;break;case 1:e.sprite.x+=e.speed,e.emote.x+=e.speed;break;case 2:e.sprite.y+=e.speed,e.emote.y+=e.speed;break;case 3:e.sprite.x-=e.speed,e.emote.x-=e.speed}e.current_move_ticker>=16/e.speed-1&&(e.moving=!1,e.position=e.next_position),e.current_move_ticker++}})}function multiplayer_join_lobby(){var e={name:player.name,position:{map:player.position.map,x:player.position.x,y:player.position.y,f:2},spritesheet_id:player.spritesheet_id};socket.emit("join_lobby",{lobby_id:meta.lobby_id,game_id:game_id,trainer:e})}function multiplayer_update_position(e=!1){var t=player.position.x+player.current_map.width*player.position.y,t=player.current_map.atts[t];let i={position:{map:player.position.map,x:player.position.x,y:player.position.y,f:player.position.f}};i.exiting=e,2===t.type&&(i.position={map:t.map,x:t.x,y:t.y,f:player.position.f},i.exiting=!0),socket.emit("position_update",{lobby_id:meta.lobby_id,trainer:i})}function multiplayer_update_facing(){player.position.f!==player.last_position.f&&(player.last_position.f=player.position.f,socket.emit("facing_update",{lobby_id:meta.lobby_id,f:player.position.f}))}function multiplayer_update_speed(){socket.emit("speed_update",{lobby_id:meta.lobby_id,s:player.speed})}function multiplayer_update_spritesheet(){socket.emit("spritesheet_update",{lobby_id:meta.lobby_id,spritesheet_id:player.spritesheet_id})}function multiplayer_update_name(){socket.emit("name_update",{lobby_id:meta.lobby_id,name:player.name})}function multiplayer_player_encounter(){socket.emit("player_encounter",{lobby_id:meta.lobby_id})}class Music{constructor(){this.path="../assets/audio/music",this.enabled=!1,this.tracks={},this.current_track=null,this.next_track=null,this.fading=!1,this.preload_tracks=[25,32,13],this.track_loops={},this.loop_interval=null,this.set_track_loops()}load(e){!this.enabled||this.tracks[e]||(this.tracks[e]=new Howl({src:[this.path+`/${e}.mp3`],loop:!0,volume:.5}))}heartbeat(){var e=music.tracks[music.current_track].seek();music.track_loops[music.current_track]&&e>music.track_loops[music.current_track].end&&music.tracks[music.current_track].seek(music.track_loops[music.current_track].start)}play(e){this.enabled&&(e=e||this.current_track,this.load(e),this.next_track=e,this.current_track&&this.current_track!==this.next_track?(this.tracks[this.current_track].fade(this.tracks[this.current_track].volume(),0,1500),this.fade_out_track=this.current_track,this.fading||(setTimeout(()=>{this.fade_out_track==this.current_track?(music.stop(),music.tracks[music.next_track].volume(.5),music.tracks[music.next_track].play(),music.current_track=music.next_track,music.fading=!1):music.tracks[music.fade_out_track].stop()},1500),this.fading=!0)):this.tracks[e].playing()||(this.current_track=e,this.tracks[e].play()),this.loop_interval&&clearInterval(this.loop_interval),this.track_loops[this.current_track]&&(this.loop_interval=setInterval(music.heartbeat,100)))}immediate_play(e){this.current_track=e,this.enabled&&(this.tracks[e]||this.load(e),this.stop(),this.reset_volumes(),this.tracks[e].play())}reset_volumes(){Object.entries(this.tracks).forEach(([,e])=>{e.volume(.5)})}stop(){Object.entries(this.tracks).forEach(([,e])=>{e.stop()})}enable(){Howler.mute(!1),this.enabled=!0,this.current_track?this.play(this.current_track):map.music&&this.play(map.music),this.tracks[this.preload_tracks[0]]||this.preload_tracks.forEach(e=>{this.load(e)})}get_context(){return 2==player.speed?32:map.music}disable(){Howler.mute(!0),this.enabled=!1,this.stop(),clearInterval(this.loop_interval)}set_track_loops(){this.track_loops[13]={start:44.4,end:75.688},this.track_loops[14]={start:12.35,end:34.80799999999999},this.track_loops[16]={start:0,end:57.8},this.track_loops[25]={start:1.4653333333333336,end:20.1},this.track_loops[26]={start:0,end:83.3933},this.track_loops[28]={start:2.3,end:61.672},this.track_loops[32]={start:34.55733333333333,end:68.81066666666666},this.track_loops[37]={start:1.7893333333333317,end:68.63066666666666},this.track_loops[1e3]={start:13.0118820861678,end:130.10430839002268}}}class Npc{constructor(e={map:0,x:0,y:0,f:0},t=0,i=[],r="South",n="Active",o=0){switch(this.position=e,r){case"North":this.position.f=0;break;case"East":this.position.f=1;break;case"South":this.position.f=2;break;case"West":this.position.f=3}switch(this.initial_properties={position:e},this.uid=`M${this.position.map}X${this.position.x}Y`+this.position.y,this.dialogue=i,this.spritesheet_id=t,this.spritesheet=spritesheets[t],this.frozen=!1,this.moving=!1,this.can_move=!0,"Active"!=n&&(this.can_move=!1),this.current_move_ticker=0,this.pokemon=[],this.items=[],this.set_sprite(),npc_container.addChild(this.sprite),this.place(e.x,e.y,e.f),n){case"Static":this.wander_interval=setInterval(this.look_around,1e3,o);break;case"Frozen":this.wander_interval=setInterval(this.return_to_original_facing,3e3,o)}}set_sprite(){switch(this.position.f){case 0:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standNorth);break;case 1:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standEast);break;case 2:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standSouth);break;case 3:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standWest)}this.can_move&&(this.sprite.visible=!1),this.sprite.animationSpeed=.125,this.sprite.loop=!1,this.sprite.x=this.position.x*TILE_SIZE,this.sprite.y=this.position.y*TILE_SIZE,this.sprite.width=TILE_SIZE,this.sprite.height=TILE_SIZE}place(e,t,i){this.position.x=e,this.position.y=t,this.position.f=i,this.position.index=e+map.width*t,this.position.tile=map.atts[e+map.width*t],this.sprite.x=e*TILE_SIZE,this.sprite.y=t*TILE_SIZE,this.face_sprite(i)}freeze(e=250){this.frozen=!0,setTimeout(()=>{this.frozen=!1},e)}face_player(){switch(player.facing){case"North":this.sprite.textures=this.spritesheet.standSouth;break;case"South":this.sprite.textures=this.spritesheet.standNorth;break;case"West":this.sprite.textures=this.spritesheet.standEast;break;case"East":this.sprite.textures=this.spritesheet.standWest}}change_spritesheet(e=0){switch(this.spritesheet_id=e,this.spritesheet=spritesheets[e],this.position.f){case 0:this.sprite.textures=this.spritesheet.standNorth;break;case 1:this.sprite.textures=this.spritesheet.standEast;break;case 2:this.sprite.textures=this.spritesheet.standSouth;break;case 3:this.sprite.textures=this.spritesheet.standWest}}position_update(){this.position.index=this.position.x+map.width*this.position.y,this.position.tile=map.tiles[this.position.index],this.position.att=map.atts[this.position.index],this.sprite.x=this.position.x*TILE_SIZE,this.sprite.y=this.position.y*TILE_SIZE,editor.enabled&&editor.log()}move(e){switch(this.moving=!0,this.current_move_ticker=0,e){case"North":this.sprite.textures=this.spritesheet.walkNorth,this.sprite.play(),this.position.f=0,this.position.y--;break;case"East":this.sprite.textures=this.spritesheet.walkEast,this.sprite.play(),this.position.f=1,this.position.x++;break;case"South":this.sprite.textures=this.spritesheet.walkSouth,this.sprite.play(),this.position.f=2,this.position.y++;break;case"West":this.sprite.textures=this.spritesheet.walkWest,this.sprite.play(),this.position.f=3,this.position.x--}}look_around(e){if(npcs[e]&&!npcs[e].frozen){var t=Math.floor(3*Math.random())+1,i=Math.floor(3*Math.random())+1;if(1==t)switch(i){case 0:npcs[e].sprite.textures=npcs[e].spritesheet.standNorth;break;case 1:npcs[e].sprite.textures=npcs[e].spritesheet.standEast;break;case 2:npcs[e].sprite.textures=npcs[e].spritesheet.standSouth;break;case 3:npcs[e].sprite.textures=npcs[e].spritesheet.standWest}}}return_to_original_facing(e){if(npcs[e]&&!npcs[e].frozen)switch(npcs[e].initial_properties.position.f){case 0:npcs[e].sprite.textures=npcs[e].spritesheet.standNorth;break;case 1:npcs[e].sprite.textures=npcs[e].spritesheet.standEast;break;case 2:npcs[e].sprite.textures=npcs[e].spritesheet.standSouth;break;case 3:npcs[e].sprite.textures=npcs[e].spritesheet.standWest}}face_sprite(e){switch(e){case 0:this.sprite.textures=this.spritesheet.standNorth;break;case 1:this.sprite.textures=this.spritesheet.standEast;break;case 2:this.sprite.textures=this.spritesheet.standSouth;break;case 3:this.sprite.textures=this.spritesheet.standWest}}}class Player{constructor(e={map:0,x:0,y:0,f:2},t=0){this.name=retrieve_data("player_name")??"RED",this.position=e,this.spritesheet_id=t,this.spritesheet=spritesheets[t],this.facing="South",this.can_check_action=!0,this.frozen=!1,this.moving=!1,this.can_move=!0,this.controls="walking",this.current_move_ticker=0,this.current_map=maps[0],this.last_position={},this.speed=1,this.in_battle=!1,this.automove={},this.pokemon=[POKEMON[Math.floor(151*Math.random())]],this.items=[],this.money=0,this.history={},this.menu={active:!1,cooldown:!1,current:null,history:[]},this.set_sprite(),this.set_emote(),player_container.addChild(this.sprite),player_container.addChild(this.emote),this.place(e.x,e.y)}set_sprite(){this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standSouth),this.sprite.anchor.set(.5),this.sprite.animationSpeed=.125,this.sprite.loop=!1,this.sprite.x=app.view.width/2,this.sprite.y=app.view.height/2-4,this.sprite.width=TILE_SIZE,this.sprite.height=TILE_SIZE,this.sprite.zIndex=1}set_emote(){this.emote=new PIXI.Sprite.from(app.loader.resources["emote-shock"].url),this.emote.anchor.set(.5),this.emote.x=app.view.width/2,this.emote.y=app.view.height/2-4-16,this.emote.width=TILE_SIZE,this.emote.height=TILE_SIZE,this.emote.visible=!1,this.emote.zIndex=2}move(t){if(!player.moving&&player.can_move&&!paused){this.last_position.f=this.position.f;let e={x:this.position.x,y:this.position.y};switch(t){case 0:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkNorth||(this.sprite.textures=this.spritesheet.walkNorth,this.sprite.play(),this.facing="North"),this.position.f=0,e.y--,0==collision_check(e.x,e.y)?(this.direction="North",this.moving=!0,this.position.y--,multiplayer_update_position()):(this.automove.active&&this.stop_forced_movement(),exit_check()?(i=this.current_map.atts[this.position.index],this.place(i.x,i.y,i.map),0==collision_check(i.x,i.y-1,i.map)&&(this.direction="North",this.moving=!0,this.position.y--),multiplayer_update_position(!0),sfx.play("go-outside")):(sfx.play("collision"),multiplayer_update_facing()));break;case 1:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkEast||(this.sprite.textures=this.spritesheet.walkEast,this.sprite.play(),this.facing="East"),e.x++,this.position.f=1,0==collision_check(e.x,e.y)?(this.direction="East",this.moving=!0,this.position.x++,multiplayer_update_position()):(this.automove.active&&this.stop_forced_movement(),exit_check()?(i=this.current_map.atts[this.position.index],this.place(i.x,i.y,i.map),0==collision_check(i.x+1,i.y,i.map)&&(this.direction="East",this.moving=!0,this.position.x++),sfx.play("go-outside"),multiplayer_update_position(!0)):(sfx.play("collision"),multiplayer_update_facing()));break;case 2:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkSouth||(this.sprite.textures=this.spritesheet.walkSouth,this.sprite.play(),this.facing="South"),e.y++,this.position.f=2,0==collision_check(e.x,e.y)?(this.direction="South",this.moving=!0,this.position.y++,multiplayer_update_position()):(this.automove.active&&this.stop_forced_movement(),exit_check()?(i=this.current_map.atts[this.position.index],this.place(i.x,i.y,i.map),0==collision_check(i.x,i.y+1,i.map)&&(this.position.y++,this.direction="South",this.moving=!0),multiplayer_update_position(!0),sfx.play("go-outside")):(sfx.play("collision"),multiplayer_update_facing()));break;case 3:var i;this.sprite.playing&&this.sprite.textures===this.spritesheet.walkWest||(this.sprite.textures=this.spritesheet.walkWest,this.sprite.play(),this.facing="West"),e.x--,this.position.f=3,0==collision_check(e.x,e.y)?(this.direction="West",this.moving=!0,this.position.x--,multiplayer_update_position()):(this.automove.active&&this.stop_forced_movement(),exit_check()?(i=this.current_map.atts[this.position.index],this.place(i.x,i.y,i.map),0==collision_check(i.x-1,i.y,i.map)&&(this.direction="West",this.moving=!0,this.position.x--),multiplayer_update_position(!0),sfx.play("go-outside")):(sfx.play("collision"),multiplayer_update_facing()))}}}stop_forced_movement(){clearInterval(player.automove.interval),this.frozen=!1,this.automove.active=!1}force_move(e,t){if(this.automove.active)return!1;switch(this.frozen=!0,this.automove.active=!0,this.automove.position={...this.position},e){case 0:this.automove.position.y-=t,this.automove.interval=setInterval(()=>{this.move(e),player.position.y<=player.automove.position.y&&this.stop_forced_movement()},16);break;case 1:this.automove.position.x+=t,this.automove.interval=setInterval(()=>{this.move(e),player.position.x>=player.automove.position.x&&this.stop_forced_movement()},16);break;case 2:this.automove.position.y+=t,this.automove.interval=setInterval(()=>{this.move(e),player.position.y>=player.automove.position.y&&this.stop_forced_movement()},16);break;case 3:this.automove.position.x-=t,this.automove.interval=setInterval(()=>{this.move(e),player.position.x<=player.automove.position.x&&this.stop_forced_movement()},16)}}move_to_trainer(e,t){switch(e){case 0:this.automove.interval=setInterval(()=>{1<this.position.y-t.position.y?this.move(0):(setTimeout(()=>{player.start_battle()},5e3),clearInterval(this.automove.interval))},16);break;case 1:this.automove.interval=setInterval(()=>{1<t.position.x-this.position.x?this.move(1):(setTimeout(()=>{player.start_battle()},5e3),clearInterval(this.automove.interval))},16);break;case 2:this.automove.interval=setInterval(()=>{1<t.position.y-this.position.y?this.move(2):(setTimeout(()=>{player.start_battle()},5e3),clearInterval(this.automove.interval))},16);break;case 3:this.automove.interval=setInterval(()=>{1<this.position.x-t.position.x?this.move(3):(setTimeout(()=>{player.start_battle()},5e3),clearInterval(this.automove.interval))},16)}}encounter(e){switch(player.position.f){case 0:setTimeout(()=>{player.move_to_trainer(0,e)},1484);break;case 1:setTimeout(()=>{player.move_to_trainer(1,e)},1484);break;case 2:setTimeout(()=>{player.move_to_trainer(2,e)},1484);break;case 3:setTimeout(()=>{player.move_to_trainer(3,e)},1484)}this.frozen=!0,this.emote.visible=!0,music.immediate_play(25),setTimeout(()=>{this.emote.visible=!1},1500)}start_battle(){music.immediate_play(music.get_context()),this.frozen=!1}wild_pokemon_battle(e){this.frozen=!0,this.emote.visible=!0,this.in_battle=!0,this.controls="battle",battle.pokemon=e,music.immediate_play(13),battle_prepare(e.name,this.pokemon[0].name)}encountered(){this.frozen=!0,music.immediate_play(25),setTimeout(()=>{this.frozen=!1,music.immediate_play(music.get_context())},5e3)}place(e,t,i=!1){!1!==i&&i!==this.current_map.id&&(map=maps[i],this.current_map=maps[i],map.build(),this.position.map=i,trainers.forEach((e,t)=>{e.position.map==this.position.map?(trainers[t].sprite.visible=!0,trainers[t].change_facing()):trainers[t].sprite.visible=!1})),background.x=background.origin.x+e*TILE_SIZE*-1,background.y=background.origin.y+t*TILE_SIZE*-1,atts_container.x=atts_container.origin.x+e*TILE_SIZE*-1,atts_container.y=atts_container.origin.y+t*TILE_SIZE*-1,npc_container.x=npc_container.origin.x+e*TILE_SIZE*-1,npc_container.y=npc_container.origin.y+t*TILE_SIZE*-1,trainer_container.x=trainer_container.origin.x+e*TILE_SIZE*-1,trainer_container.y=trainer_container.origin.y+t*TILE_SIZE*-1,this.position.x=e,this.position.y=t,this.position.index=this.position.x+this.current_map.width*this.position.y,this.position.tile=this.current_map.atts[e+this.current_map.width*t],editor.enabled&&(editor.prepare_tiles(),editor.prepare_properties(),editor.enabled&&editor.log())}freeze(e=250){this.frozen=!0,setTimeout(()=>{this.frozen=!1},e)}check_action(e){var t,i;let r;switch(e){case 0:r=this.position.x+this.current_map.width*(this.position.y-1);break;case 1:r=this.position.x+1+this.current_map.width*this.position.y;break;case 2:r=this.position.x+this.current_map.width*(this.position.y+1);break;case 3:r=this.position.x-1+this.current_map.width*this.position.y}switch(t=this.current_map.tiles[r],(i=this.current_map.atts[r]).type){case 1:dialogue.active||check_sprite_tile_actions(t);break;case 3:dialogue.active||dialogue.queue_messages(i.dialogue);break;case 7:var n=new Item(i.name);dialogue.add_message(`Found; ${i.name}!`),sfx.play("item-found"),this.items.push(n),this.current_map.atts[r]={type:0},maps[this.current_map.id].atts[r]={type:0},map.items.forEach((e,t)=>{e.position.index==r&&(map.items[t].sprite.visible=!1,map.items[t].available=!1)}),map.build_tiles(),map.build_atts(),map.build_items(),maps[map.id]=map}npcs.forEach((e,t)=>{r!=e.position.index||dialogue.active||(e.frozen=!0,e.face_player(),dialogue.queue_messages(e.dialogue))}),trainers.forEach((e,t)=>{e.position.map==this.position.map&&r==e.position.x+this.current_map.width*e.position.y&&dialogue.queue_messages(""+e.name)}),console.log(i)}change_spritesheet(e=0){switch(e=e||Math.floor(40*Math.random()),this.spritesheet_id=e,this.spritesheet=spritesheets[e],this.facing){case"North":this.sprite.textures=this.spritesheet.standNorth;break;case"South":this.sprite.textures=this.spritesheet.standSouth;break;case"West":this.sprite.textures=this.spritesheet.standWest;break;case"East":this.sprite.textures=this.spritesheet.standEast}multiplayer_update_spritesheet()}position_update(){switch(this.position.index=this.position.x+this.current_map.width*this.position.y,this.position.tile=this.current_map.tiles[this.position.index],this.position.att=this.current_map.atts[this.position.index],this.position.att.type){case 2:138==this.position.tile?sfx.play("go-inside"):sfx.play("go-outside"),this.place(this.position.att.x,this.position.att.y,this.position.att.map),this.freeze();break;case 9:dialogue.queue_messages(this.position.att.dialogue)}editor.enabled&&editor.log()}use_item(t){this.items.forEach(e=>{e.name==t&&e.use()})}}const POKEMON=[{id:1,name:"Bulbasaur",type:["Grass","Poison"],base:{atk:49,def:49,hp:45,sp_atk:65,sp_def:65,speed:45},learnset:[{name:"TACKLE",level:1},{name:"GROWL",level:1},{name:"LEECH SEED",level:7},{name:"VINE WHIP",level:13},{name:"POISON POWDER",level:20},{name:"RAZOR LEAF",level:27},{name:"GROWTH",level:34},{name:"SLEEP POWDER",level:41},{name:"SOLARBEAM",level:48}],tm:["SWORDS DANCE"],hm:["CUT"],evolutions:[{name:"Ivysaur",level:16}],growth:"MEDIUM_SLOW"},{id:2,name:"Ivysaur",type:["Grass","Poison"],base:{atk:62,def:63,hp:60,sp_atk:80,sp_def:80,speed:60}},{id:3,name:"Venusaur",type:["Grass","Poison"],base:{atk:82,def:83,hp:80,sp_atk:100,sp_def:100,speed:80}},{id:4,name:"Charmander",type:["Fire"],base:{atk:52,def:43,hp:39,sp_atk:60,sp_def:50,speed:65}},{id:5,name:"Charmeleon",type:["Fire"],base:{atk:64,def:58,hp:58,sp_atk:80,sp_def:65,speed:80}},{id:6,name:"Charizard",type:["Fire","Flying"],base:{atk:84,def:78,hp:78,sp_atk:109,sp_def:85,speed:100}},{id:7,name:"Squirtle",type:["Water"],base:{atk:48,def:65,hp:44,sp_atk:50,sp_def:64,speed:43}},{id:8,name:"Wartortle",type:["Water"],base:{atk:63,def:80,hp:59,sp_atk:65,sp_def:80,speed:58}},{id:9,name:"Blastoise",type:["Water"],base:{atk:83,def:100,hp:79,sp_atk:85,sp_def:105,speed:78}},{id:10,name:"Caterpie",type:["Bug"],base:{atk:30,def:35,hp:45,sp_atk:20,sp_def:20,speed:45}},{id:11,name:"Metapod",type:["Bug"],base:{atk:20,def:55,hp:50,sp_atk:25,sp_def:25,speed:30}},{id:12,name:"Butterfree",type:["Bug","Flying"],base:{atk:45,def:50,hp:60,sp_atk:90,sp_def:80,speed:70}},{id:13,name:"Weedle",type:["Bug","Poison"],base:{atk:35,def:30,hp:40,sp_atk:20,sp_def:20,speed:50}},{id:14,name:"Kakuna",type:["Bug","Poison"],base:{atk:25,def:50,hp:45,sp_atk:25,sp_def:25,speed:35}},{id:15,name:"Beedrill",type:["Bug","Poison"],base:{atk:90,def:40,hp:65,sp_atk:45,sp_def:80,speed:75}},{id:16,name:"Pidgey",type:["Normal","Flying"],base:{atk:45,def:40,hp:40,sp_atk:35,sp_def:35,speed:56}},{id:17,name:"Pidgeotto",type:["Normal","Flying"],base:{atk:60,def:55,hp:63,sp_atk:50,sp_def:50,speed:71}},{id:18,name:"Pidgeot",type:["Normal","Flying"],base:{atk:80,def:75,hp:83,sp_atk:70,sp_def:70,speed:101}},{id:19,name:"Rattata",type:["Normal"],base:{atk:56,def:35,hp:30,sp_atk:25,sp_def:35,speed:72}},{id:20,name:"Raticate",type:["Normal"],base:{atk:81,def:60,hp:55,sp_atk:50,sp_def:70,speed:97}},{id:21,name:"Spearow",type:["Normal","Flying"],base:{atk:60,def:30,hp:40,sp_atk:31,sp_def:31,speed:70}},{id:22,name:"Fearow",type:["Normal","Flying"],base:{atk:90,def:65,hp:65,sp_atk:61,sp_def:61,speed:100}},{id:23,name:"Ekans",type:["Poison"],base:{atk:60,def:44,hp:35,sp_atk:40,sp_def:54,speed:55}},{id:24,name:"Arbok",type:["Poison"],base:{atk:95,def:69,hp:60,sp_atk:65,sp_def:79,speed:80}},{id:25,name:"Pikachu",type:["Electric"],base:{atk:55,def:40,hp:35,sp_atk:50,sp_def:50,speed:90}},{id:26,name:"Raichu",type:["Electric"],base:{atk:90,def:55,hp:60,sp_atk:90,sp_def:80,speed:110}},{id:27,name:"Sandshrew",type:["Ground"],base:{atk:75,def:85,hp:50,sp_atk:20,sp_def:30,speed:40}},{id:28,name:"Sandslash",type:["Ground"],base:{atk:100,def:110,hp:75,sp_atk:45,sp_def:55,speed:65}},{id:29,name:"Nidoranf",type:["Poison"],base:{atk:47,def:52,hp:55,sp_atk:40,sp_def:40,speed:41}},{id:30,name:"Nidorina",type:["Poison"],base:{atk:62,def:67,hp:70,sp_atk:55,sp_def:55,speed:56}},{id:31,name:"Nidoqueen",type:["Poison","Ground"],base:{atk:92,def:87,hp:90,sp_atk:75,sp_def:85,speed:76}},{id:32,name:"Nidoranm",type:["Poison"],base:{atk:57,def:40,hp:46,sp_atk:40,sp_def:40,speed:50}},{id:33,name:"Nidorino",type:["Poison"],base:{atk:72,def:57,hp:61,sp_atk:55,sp_def:55,speed:65}},{id:34,name:"Nidoking",type:["Poison","Ground"],base:{atk:102,def:77,hp:81,sp_atk:85,sp_def:75,speed:85}},{id:35,name:"Clefairy",type:["Fairy"],base:{atk:45,def:48,hp:70,sp_atk:60,sp_def:65,speed:35}},{id:36,name:"Clefable",type:["Fairy"],base:{atk:70,def:73,hp:95,sp_atk:95,sp_def:90,speed:60}},{id:37,name:"Vulpix",type:["Fire"],base:{atk:41,def:40,hp:38,sp_atk:50,sp_def:65,speed:65}},{id:38,name:"Ninetales",type:["Fire"],base:{atk:76,def:75,hp:73,sp_atk:81,sp_def:100,speed:100}},{id:39,name:"Jigglypuff",type:["Normal","Fairy"],base:{atk:45,def:20,hp:115,sp_atk:45,sp_def:25,speed:20}},{id:40,name:"Wigglytuff",type:["Normal","Fairy"],base:{atk:70,def:45,hp:140,sp_atk:85,sp_def:50,speed:45}},{id:41,name:"Zubat",type:["Poison","Flying"],base:{atk:45,def:35,hp:40,sp_atk:30,sp_def:40,speed:55}},{id:42,name:"Golbat",type:["Poison","Flying"],base:{atk:80,def:70,hp:75,sp_atk:65,sp_def:75,speed:90}},{id:43,name:"Oddish",type:["Grass","Poison"],base:{atk:50,def:55,hp:45,sp_atk:75,sp_def:65,speed:30}},{id:44,name:"Gloom",type:["Grass","Poison"],base:{atk:65,def:70,hp:60,sp_atk:85,sp_def:75,speed:40}},{id:45,name:"Vileplume",type:["Grass","Poison"],base:{atk:80,def:85,hp:75,sp_atk:110,sp_def:90,speed:50}},{id:46,name:"Paras",type:["Bug","Grass"],base:{atk:70,def:55,hp:35,sp_atk:45,sp_def:55,speed:25}},{id:47,name:"Parasect",type:["Bug","Grass"],base:{atk:95,def:80,hp:60,sp_atk:60,sp_def:80,speed:30}},{id:48,name:"Venonat",type:["Bug","Poison"],base:{atk:55,def:50,hp:60,sp_atk:40,sp_def:55,speed:45}},{id:49,name:"Venomoth",type:["Bug","Poison"],base:{atk:65,def:60,hp:70,sp_atk:90,sp_def:75,speed:90}},{id:50,name:"Diglett",type:["Ground"],base:{atk:55,def:25,hp:10,sp_atk:35,sp_def:45,speed:95}},{id:51,name:"Dugtrio",type:["Ground"],base:{atk:100,def:50,hp:35,sp_atk:50,sp_def:70,speed:120}},{id:52,name:"Meowth",type:["Normal"],base:{atk:45,def:35,hp:40,sp_atk:40,sp_def:40,speed:90}},{id:53,name:"Persian",type:["Normal"],base:{atk:70,def:60,hp:65,sp_atk:65,sp_def:65,speed:115}},{id:54,name:"Psyduck",type:["Water"],base:{atk:52,def:48,hp:50,sp_atk:65,sp_def:50,speed:55}},{id:55,name:"Golduck",type:["Water"],base:{atk:82,def:78,hp:80,sp_atk:95,sp_def:80,speed:85}},{id:56,name:"Mankey",type:["Fighting"],base:{atk:80,def:35,hp:40,sp_atk:35,sp_def:45,speed:70}},{id:57,name:"Primeape",type:["Fighting"],base:{atk:105,def:60,hp:65,sp_atk:60,sp_def:70,speed:95}},{id:58,name:"Growlithe",type:["Fire"],base:{atk:70,def:45,hp:55,sp_atk:70,sp_def:50,speed:60}},{id:59,name:"Arcanine",type:["Fire"],base:{atk:110,def:80,hp:90,sp_atk:100,sp_def:80,speed:95}},{id:60,name:"Poliwag",type:["Water"],base:{atk:50,def:40,hp:40,sp_atk:40,sp_def:40,speed:90}},{id:61,name:"Poliwhirl",type:["Water"],base:{atk:65,def:65,hp:65,sp_atk:50,sp_def:50,speed:90}},{id:62,name:"Poliwrath",type:["Water","Fighting"],base:{atk:95,def:95,hp:90,sp_atk:70,sp_def:90,speed:70}},{id:63,name:"Abra",type:["Psychic"],base:{atk:20,def:15,hp:25,sp_atk:105,sp_def:55,speed:90}},{id:64,name:"Kadabra",type:["Psychic"],base:{atk:35,def:30,hp:40,sp_atk:120,sp_def:70,speed:105}},{id:65,name:"Alakazam",type:["Psychic"],base:{atk:50,def:45,hp:55,sp_atk:135,sp_def:95,speed:120}},{id:66,name:"Machop",type:["Fighting"],base:{atk:80,def:50,hp:70,sp_atk:35,sp_def:35,speed:35}},{id:67,name:"Machoke",type:["Fighting"],base:{atk:100,def:70,hp:80,sp_atk:50,sp_def:60,speed:45}},{id:68,name:"Machamp",type:["Fighting"],base:{atk:130,def:80,hp:90,sp_atk:65,sp_def:85,speed:55}},{id:69,name:"Bellsprout",type:["Grass","Poison"],base:{atk:75,def:35,hp:50,sp_atk:70,sp_def:30,speed:40}},{id:70,name:"Weepinbell",type:["Grass","Poison"],base:{atk:90,def:50,hp:65,sp_atk:85,sp_def:45,speed:55}},{id:71,name:"Victreebel",type:["Grass","Poison"],base:{atk:105,def:65,hp:80,sp_atk:100,sp_def:70,speed:70}},{id:72,name:"Tentacool",type:["Water","Poison"],base:{atk:40,def:35,hp:40,sp_atk:50,sp_def:100,speed:70}},{id:73,name:"Tentacruel",type:["Water","Poison"],base:{atk:70,def:65,hp:80,sp_atk:80,sp_def:120,speed:100}},{id:74,name:"Geodude",type:["Rock","Ground"],base:{atk:80,def:100,hp:40,sp_atk:30,sp_def:30,speed:20}},{id:75,name:"Graveler",type:["Rock","Ground"],base:{atk:95,def:115,hp:55,sp_atk:45,sp_def:45,speed:35}},{id:76,name:"Golem",type:["Rock","Ground"],base:{atk:120,def:130,hp:80,sp_atk:55,sp_def:65,speed:45}},{id:77,name:"Ponyta",type:["Fire"],base:{atk:85,def:55,hp:50,sp_atk:65,sp_def:65,speed:90}},{id:78,name:"Rapidash",type:["Fire"],base:{atk:100,def:70,hp:65,sp_atk:80,sp_def:80,speed:105}},{id:79,name:"Slowpoke",type:["Water","Psychic"],base:{atk:65,def:65,hp:90,sp_atk:40,sp_def:40,speed:15}},{id:80,name:"Slowbro",type:["Water","Psychic"],base:{atk:75,def:110,hp:95,sp_atk:100,sp_def:80,speed:30}},{id:81,name:"Magnemite",type:["Electric","Steel"],base:{atk:35,def:70,hp:25,sp_atk:95,sp_def:55,speed:45}},{id:82,name:"Magneton",type:["Electric","Steel"],base:{atk:60,def:95,hp:50,sp_atk:120,sp_def:70,speed:70}},{id:83,name:"Farfetch'd",type:["Normal","Flying"],base:{atk:90,def:55,hp:52,sp_atk:58,sp_def:62,speed:60}},{id:84,name:"Doduo",type:["Normal","Flying"],base:{atk:85,def:45,hp:35,sp_atk:35,sp_def:35,speed:75}},{id:85,name:"Dodrio",type:["Normal","Flying"],base:{atk:110,def:70,hp:60,sp_atk:60,sp_def:60,speed:110}},{id:86,name:"Seel",type:["Water"],base:{atk:45,def:55,hp:65,sp_atk:45,sp_def:70,speed:45}},{id:87,name:"Dewgong",type:["Water","Ice"],base:{atk:70,def:80,hp:90,sp_atk:70,sp_def:95,speed:70}},{id:88,name:"Grimer",type:["Poison"],base:{atk:80,def:50,hp:80,sp_atk:40,sp_def:50,speed:25}},{id:89,name:"Muk",type:["Poison"],base:{atk:105,def:75,hp:105,sp_atk:65,sp_def:100,speed:50}},{id:90,name:"Shellder",type:["Water"],base:{atk:65,def:100,hp:30,sp_atk:45,sp_def:25,speed:40}},{id:91,name:"Cloyster",type:["Water","Ice"],base:{atk:95,def:180,hp:50,sp_atk:85,sp_def:45,speed:70}},{id:92,name:"Gastly",type:["Ghost","Poison"],base:{atk:35,def:30,hp:30,sp_atk:100,sp_def:35,speed:80}},{id:93,name:"Haunter",type:["Ghost","Poison"],base:{atk:50,def:45,hp:45,sp_atk:115,sp_def:55,speed:95}},{id:94,name:"Gengar",type:["Ghost","Poison"],base:{atk:65,def:60,hp:60,sp_atk:130,sp_def:75,speed:110}},{id:95,name:"Onix",type:["Rock","Ground"],base:{atk:45,def:160,hp:35,sp_atk:30,sp_def:45,speed:70}},{id:96,name:"Drowzee",type:["Psychic"],base:{atk:48,def:45,hp:60,sp_atk:43,sp_def:90,speed:42}},{id:97,name:"Hypno",type:["Psychic"],base:{atk:73,def:70,hp:85,sp_atk:73,sp_def:115,speed:67}},{id:98,name:"Krabby",type:["Water"],base:{atk:105,def:90,hp:30,sp_atk:25,sp_def:25,speed:50}},{id:99,name:"Kingler",type:["Water"],base:{atk:130,def:115,hp:55,sp_atk:50,sp_def:50,speed:75}},{id:100,name:"Voltorb",type:["Electric"],base:{atk:30,def:50,hp:40,sp_atk:55,sp_def:55,speed:100}},{id:101,name:"Electrode",type:["Electric"],base:{atk:50,def:70,hp:60,sp_atk:80,sp_def:80,speed:150}},{id:102,name:"Exeggcute",type:["Grass","Psychic"],base:{atk:40,def:80,hp:60,sp_atk:60,sp_def:45,speed:40}},{id:103,name:"Exeggutor",type:["Grass","Psychic"],base:{atk:95,def:85,hp:95,sp_atk:125,sp_def:75,speed:55}},{id:104,name:"Cubone",type:["Ground"],base:{atk:50,def:95,hp:50,sp_atk:40,sp_def:50,speed:35}},{id:105,name:"Marowak",type:["Ground"],base:{atk:80,def:110,hp:60,sp_atk:50,sp_def:80,speed:45}},{id:106,name:"Hitmonlee",type:["Fighting"],base:{atk:120,def:53,hp:50,sp_atk:35,sp_def:110,speed:87}},{id:107,name:"Hitmonchan",type:["Fighting"],base:{atk:105,def:79,hp:50,sp_atk:35,sp_def:110,speed:76}},{id:108,name:"Lickitung",type:["Normal"],base:{atk:55,def:75,hp:90,sp_atk:60,sp_def:75,speed:30}},{id:109,name:"Koffing",type:["Poison"],base:{atk:65,def:95,hp:40,sp_atk:60,sp_def:45,speed:35}},{id:110,name:"Weezing",type:["Poison"],base:{atk:90,def:120,hp:65,sp_atk:85,sp_def:70,speed:60}},{id:111,name:"Rhyhorn",type:["Ground","Rock"],base:{atk:85,def:95,hp:80,sp_atk:30,sp_def:30,speed:25}},{id:112,name:"Rhydon",type:["Ground","Rock"],base:{atk:130,def:120,hp:105,sp_atk:45,sp_def:45,speed:40}},{id:113,name:"Chansey",type:["Normal"],base:{atk:5,def:5,hp:250,sp_atk:35,sp_def:105,speed:50}},{id:114,name:"Tangela",type:["Grass"],base:{atk:55,def:115,hp:65,sp_atk:100,sp_def:40,speed:60}},{id:115,name:"Kangaskhan",type:["Normal"],base:{atk:95,def:80,hp:105,sp_atk:40,sp_def:80,speed:90}},{id:116,name:"Horsea",type:["Water"],base:{atk:40,def:70,hp:30,sp_atk:70,sp_def:25,speed:60}},{id:117,name:"Seadra",type:["Water"],base:{atk:65,def:95,hp:55,sp_atk:95,sp_def:45,speed:85}},{id:118,name:"Goldeen",type:["Water"],base:{atk:67,def:60,hp:45,sp_atk:35,sp_def:50,speed:63}},{id:119,name:"Seaking",type:["Water"],base:{atk:92,def:65,hp:80,sp_atk:65,sp_def:80,speed:68}},{id:120,name:"Staryu",type:["Water"],base:{atk:45,def:55,hp:30,sp_atk:70,sp_def:55,speed:85}},{id:121,name:"Starmie",type:["Water","Psychic"],base:{atk:75,def:85,hp:60,sp_atk:100,sp_def:85,speed:115}},{id:122,name:"Mr. Mime",type:["Psychic","Fairy"],base:{atk:45,def:65,hp:40,sp_atk:100,sp_def:120,speed:90}},{id:123,name:"Scyther",type:["Bug","Flying"],base:{atk:110,def:80,hp:70,sp_atk:55,sp_def:80,speed:105}},{id:124,name:"Jynx",type:["Ice","Psychic"],base:{atk:50,def:35,hp:65,sp_atk:115,sp_def:95,speed:95}},{id:125,name:"Electabuzz",type:["Electric"],base:{atk:83,def:57,hp:65,sp_atk:95,sp_def:85,speed:105}},{id:126,name:"Magmar",type:["Fire"],base:{atk:95,def:57,hp:65,sp_atk:100,sp_def:85,speed:93}},{id:127,name:"Pinsir",type:["Bug"],base:{atk:125,def:100,hp:65,sp_atk:55,sp_def:70,speed:85}},{id:128,name:"Tauros",type:["Normal"],base:{atk:100,def:95,hp:75,sp_atk:40,sp_def:70,speed:110}},{id:129,name:"Magikarp",type:["Water"],base:{atk:10,def:55,hp:20,sp_atk:15,sp_def:20,speed:80}},{id:130,name:"Gyarados",type:["Water","Flying"],base:{atk:125,def:79,hp:95,sp_atk:60,sp_def:100,speed:81}},{id:131,name:"Lapras",type:["Water","Ice"],base:{atk:85,def:80,hp:130,sp_atk:85,sp_def:95,speed:60}},{id:132,name:"Ditto",type:["Normal"],base:{atk:48,def:48,hp:48,sp_atk:48,sp_def:48,speed:48}},{id:133,name:"Eevee",type:["Normal"],base:{atk:55,def:50,hp:55,sp_atk:45,sp_def:65,speed:55}},{id:134,name:"Vaporeon",type:["Water"],base:{atk:65,def:60,hp:130,sp_atk:110,sp_def:95,speed:65}},{id:135,name:"Jolteon",type:["Electric"],base:{atk:65,def:60,hp:65,sp_atk:110,sp_def:95,speed:130}},{id:136,name:"Flareon",type:["Fire"],base:{atk:130,def:60,hp:65,sp_atk:95,sp_def:110,speed:65}},{id:137,name:"Porygon",type:["Normal"],base:{atk:60,def:70,hp:65,sp_atk:85,sp_def:75,speed:40}},{id:138,name:"Omanyte",type:["Rock","Water"],base:{atk:40,def:100,hp:35,sp_atk:90,sp_def:55,speed:35}},{id:139,name:"Omastar",type:["Rock","Water"],base:{atk:60,def:125,hp:70,sp_atk:115,sp_def:70,speed:55}},{id:140,name:"Kabuto",type:["Rock","Water"],base:{atk:80,def:90,hp:30,sp_atk:55,sp_def:45,speed:55}},{id:141,name:"Kabutops",type:["Rock","Water"],base:{atk:115,def:105,hp:60,sp_atk:65,sp_def:70,speed:80}},{id:142,name:"Aerodactyl",type:["Rock","Flying"],base:{atk:105,def:65,hp:80,sp_atk:60,sp_def:75,speed:130}},{id:143,name:"Snorlax",type:["Normal"],base:{atk:110,def:65,hp:160,sp_atk:65,sp_def:110,speed:30}},{id:144,name:"Articuno",type:["Ice","Flying"],base:{atk:85,def:100,hp:90,sp_atk:95,sp_def:125,speed:85}},{id:145,name:"Zapdos",type:["Electric","Flying"],base:{atk:90,def:85,hp:90,sp_atk:125,sp_def:90,speed:100}},{id:146,name:"Moltres",type:["Fire","Flying"],base:{atk:100,def:90,hp:90,sp_atk:125,sp_def:85,speed:90}},{id:147,name:"Dratini",type:["Dragon"],base:{atk:64,def:45,hp:41,sp_atk:50,sp_def:50,speed:50}},{id:148,name:"Dragonair",type:["Dragon"],base:{atk:84,def:65,hp:61,sp_atk:70,sp_def:70,speed:70}},{id:149,name:"Dragonite",type:["Dragon","Flying"],base:{atk:134,def:95,hp:91,sp_atk:100,sp_def:100,speed:80}},{id:150,name:"Mewtwo",type:["Psychic"],base:{atk:110,def:90,hp:106,sp_atk:154,sp_def:90,speed:130}},{id:151,name:"Mew",type:["Psychic"],base:{atk:100,def:100,hp:100,sp_atk:100,sp_def:100,speed:100}}];class Sfx{constructor(){this.path="../assets/audio/sfx",this.enabled=!1,this.tracks={},this.timeout=300,this.preload_tracks=["collision","start-menu","action","go-inside","go-outside","item-found"]}play(e,t="misc"){this.enabled&&(this.tracks[e]||this.load(e,t),this.tracks[e].active||(this.tracks[e].active=!0,this.tracks[e].play(),setTimeout(()=>{this.tracks[e].active=!1},this.timeout,e)))}cry(e){let t="";switch((e="number"==typeof e?e.toString():e).length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}this.play(t,"cries")}load(t,i="misc"){if(this.enabled){let e="item-received"==t?.2:.5;this.tracks[t]=new Howl({src:[this.path+`/${i}/${t}.wav`],loop:!1,volume:e})}}stop(){Object.entries(this.tracks).forEach(([,e])=>{e.stop()})}enable(){this.enabled=!0,this.tracks[this.preload_tracks[0]]||this.preload_tracks.forEach(e=>{this.load(e)})}disable(){this.enabled=!1}}function create_flower_top_spritesheet(){var e=new PIXI.BaseTexture.from(app.loader.resources.tilemap.url),t=TILE_SIZE,i=TILE_SIZE;return[new PIXI.Texture(e,new PIXI.Rectangle(0,76*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(+t,76*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(8*t,2*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(0,76*i,t,i))]}function create_flower_bottom_spritesheet(){var e=new PIXI.BaseTexture.from(app.loader.resources.tilemap.url),t=TILE_SIZE,i=TILE_SIZE;return[new PIXI.Texture(e,new PIXI.Rectangle(2*t,76*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(3*t,76*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(8*t,+i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(2*t,76*i,t,i))]}function create_water_spritesheet(){var e=new PIXI.BaseTexture.from(app.loader.resources.tilemap.url),t=TILE_SIZE,i=TILE_SIZE;return[new PIXI.Texture(e,new PIXI.Rectangle(4*t,7*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(0,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(+t,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(2*t,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(3*t,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(2*t,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(+t,77*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(0,77*i,t,i))]}function create_water_top_spritesheet(){var e=new PIXI.BaseTexture.from(app.loader.resources.tilemap.url),t=TILE_SIZE,i=TILE_SIZE;return[new PIXI.Texture(e,new PIXI.Rectangle(4*t,8*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(0,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(+t,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(2*t,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(3*t,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(2*t,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(+t,78*i,t,i)),new PIXI.Texture(e,new PIXI.Rectangle(0,78*i,t,i))]}socket.on("npc_moved",function(t){npcs.forEach(e=>{e.uid==t.uid&&e.move(t.moving)})}),socket.on("map_server_sync",function(e){e.npcs.forEach(t=>{npcs.forEach(e=>{t.uid==e.uid&&e.place(t.position.x,t.position.y,t.position.f),e.sprite.visible=!0})})}),socket.on("set_game_id",function(e){game_id=e.game_id,meta.game_id=e.game_id;let t=new URL(window.location);t.searchParams.set("g",game_id),window.history.pushState({},"",t)}),socket.on("create_current_trainers",function(e){e.forEach(e=>{e=new Trainer(e.name,e.position,e.spritesheet_id,e.socket_id);trainers.push(e)})}),socket.on("trainer_moved",function(i){console.log("[trainer_moved]",i.position),trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(i.exiting?(e.position=i.position,e.next_position=i.position,i.position.map!==player.position.map?e.sprite.visible=!1:e.sprite.visible=!0,e.position_update(i.position)):(e.moving&&(e.position_update(e.next_position),e.position=e.next_position),i.position.map!==player.position.map?e.sprite.visible=!1:e.sprite.visible=!0,e.next_position=i.position,e.move(i.position.f)))})}),socket.on("trainer_joined",function(e){e=new Trainer(e.name,e.position,e.spritesheet_id,e.socket_id);trainers.push(e)}),socket.on("trainer_disconnected",function(i){trainers.forEach((e,t)=>{e.socket_id==i&&(trainers[t].remove(),trainers.splice(t,1))})}),socket.on("trainer_faced",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&trainers[t].face_sprite(i.f)})}),socket.on("trainer_speed",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(trainers[t].speed=i.s)})}),socket.on("trainer_sprite",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&trainers[t].change_spritesheet(i.spritesheet_id)})}),socket.on("trainer_name",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(trainers[t].name=i.name)})}),socket.on("trainer_entering_battle",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(trainers[t].display_emote("shock"),trainers[t].sprite.alpha=.75,trainers[t].battle_animation=setInterval(()=>{.75==trainers[t].sprite.alpha?trainers[t].sprite.alpha=.55:trainers[t].sprite.alpha=.75},250),trainers[t].in_battle=!0)})}),socket.on("trainer_exiting_battle",function(i){trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(trainers[t].emote.visible=!1,trainers[t].sprite.alpha=1,trainers[t].in_battle=!1,clearInterval(trainers[t].battle_animation))})}),socket.on("player_encounter",i=>{let r=null;trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&(r=e)}),r&&player.encounter(r)}),socket.on("player_encountered",i=>{player.encountered(),trainers.forEach((e,t)=>{e.socket_id==i.socket_id&&e.encounter()})}),socket.on("chat_trainer_message",function(e){chat.trainer_message(e.name,e.message,e.atts)}),socket.on("chat_server_message",function(e){chat.server_message(e.message)}),socket.on("wild_pokemon_battle",function(e){player.wild_pokemon_battle(e.pokemon)});class Trainer{constructor(e="",t={map:0,x:0,y:0,f:2},i=0,r=0){switch(this.name=e,this.position=t,this.position.f){case 0:this.facing="North";break;case 1:this.facing="East";break;case 2:this.facing="South";break;case 3:this.facing="West"}this.socket_id=r,this.spritesheet_id=i,this.spritesheet=spritesheets[i],this.can_check_action=!0,this.frozen=!1,this.moving=!1,this.can_move=!0,this.controls="walking",this.current_move_ticker=0,this.current_map=maps[0],this.speed=1,this.pokemon=[],this.items=[],this.set_sprite(),this.set_emote(),trainer_container.addChild(this.sprite),trainer_container.addChild(this.emote),this.position_update(t)}set_sprite(){switch(this.position.f){case 0:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standNorth);break;case 1:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standEast);break;case 2:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standSouth);break;case 3:this.sprite=new PIXI.AnimatedSprite(this.spritesheet.standWest)}this.sprite.animationSpeed=.125,this.sprite.loop=!1,this.sprite.x=this.position.x*TILE_SIZE,this.sprite.y=this.position.y*TILE_SIZE,this.sprite.width=TILE_SIZE,this.sprite.height=TILE_SIZE,this.sprite.zIndex=1}set_emote(){this.emote=new PIXI.Sprite.from(app.loader.resources["emote-shock"].url),this.emote.x=this.position.x*TILE_SIZE,this.emote.y=this.position.y*TILE_SIZE-TILE_SIZE,this.emote.width=TILE_SIZE,this.emote.height=TILE_SIZE,this.emote.visible=!1,this.emote.zIndex=1}display_emote(e=0,t=1500){this.position.map==player.position.map&&(this.emote.visible=!0),setTimeout(()=>{this.emote.visible=!1},t,this)}encounter(){this.frozen=!0,this.display_emote("shock"),setTimeout(()=>{this.emote.visible=!1},1500),setTimeout(()=>{this.frozen=!1},5e3)}encountered(){this.frozen=!0,setTimeout(()=>{this.frozen=!1},5e3)}place(e,t,i){this.position.map=e,this.position.x=t,this.position.y=i}freeze(e=250){this.frozen=!0,setTimeout(()=>{this.frozen=!1},e)}change_spritesheet(e=0){switch(this.spritesheet_id=e,this.spritesheet=spritesheets[e],this.facing){case"North":this.sprite.textures=this.spritesheet.standNorth;break;case"South":this.sprite.textures=this.spritesheet.standSouth;break;case"West":this.sprite.textures=this.spritesheet.standWest;break;case"East":this.sprite.textures=this.spritesheet.standEast}}change_facing(){switch(this.facing){case"North":this.sprite.textures=this.spritesheet.standNorth;break;case"South":this.sprite.textures=this.spritesheet.standSouth;break;case"West":this.sprite.textures=this.spritesheet.standWest;break;case"East":this.sprite.textures=this.spritesheet.standEast}}move(e){switch(this.current_move_ticker=0,this.moving=!0,e){case 0:this.sprite.playing&&this.sprite.textures===player.spritesheet.walkNorth||(this.sprite.textures=this.spritesheet.walkNorth,this.sprite.play());break;case 1:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkEast||(this.sprite.textures=this.spritesheet.walkEast,this.sprite.play());break;case 2:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkSouth||(this.sprite.textures=this.spritesheet.walkSouth,this.sprite.play());break;case 3:this.sprite.playing&&this.sprite.textures===this.spritesheet.walkWest||(this.sprite.textures=this.spritesheet.walkWest,this.sprite.play())}}position_update(e){this.sprite.x=e.x*TILE_SIZE,this.sprite.y=e.y*TILE_SIZE,this.emote.x=e.x*TILE_SIZE,this.emote.y=e.y*TILE_SIZE-TILE_SIZE}remove(){trainer_container.removeChild(this.sprite)}face_sprite(e){switch(e){case 0:this.sprite.textures=this.spritesheet.standNorth;break;case 1:this.sprite.textures=this.spritesheet.standEast;break;case 2:this.sprite.textures=this.spritesheet.standSouth;break;case 3:this.sprite.textures=this.spritesheet.standWest}}}